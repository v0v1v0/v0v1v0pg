<div class="container">

<table style="width: 100%;"><tr>
<td>graph.fanova</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>One-way graphical functional ANOVA</h2>

<h3>Description</h3>

<p>One-way ANOVA tests for functional data with graphical interpretation
</p>


<h3>Usage</h3>

<pre><code class="language-R">graph.fanova(
  nsim,
  curve_set,
  groups,
  variances = "equal",
  contrasts = FALSE,
  n.aver = 1L,
  mirror = FALSE,
  savefuns = FALSE,
  test.equality = c("mean", "var", "cov"),
  cov.lag = 1,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>The number of random permutations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>curve_set</code></td>
<td>
<p>The original data (an array of functions) provided as a
<code>curve_set</code> object or a <code>fdata</code> object of <span class="pkg">fda.usc</span>.
The curve set should include the argument values for the functions in the component <code>r</code>, and
the observed functions in the component <code>obs</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groups</code></td>
<td>
<p>The original groups (a factor vector representing the assignment to groups).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variances</code></td>
<td>
<p>Either "equal" or "unequal". If "unequal", then correction for unequal variances
as explained in details will be done. Only relevant for the case <code>test.equality = "means"</code> (default).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrasts</code></td>
<td>
<p>Logical. FALSE and TRUE specify the two test functions as described in
description part of this help file.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.aver</code></td>
<td>
<p>If variances = "unequal", there is a possibility to use variances smoothed
by appying moving average to the estimated sample variances. n.aver determines
how many values on each side do contribute (incl. value itself).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mirror</code></td>
<td>
<p>The complement of the argument circular of <code>filter</code>. Another parameter
for the moving average to estimate sample variances (see <code>n.aver</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>savefuns</code></td>
<td>
<p>Logical. If TRUE, then the functions from permutations are saved to the attribute
simfuns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test.equality</code></td>
<td>
<p>A character with possible values <code>mean</code> (default), <code>var</code> and
<code>cov</code>. If <code>mean</code>, the functional ANOVA is performed to compare the means in the groups.
If <code>var</code>, then the equality of variances of the curves in the groups is tested by performing
the graphical functional ANOVA test on the functions
</p>
<p style="text-align: center;"><code class="reqn">Z_{ij}(r) = T_{ij}(r) - \bar{T}_j(r).</code>
</p>

<p>If <code>cov</code>, then the equality of lag <code>cov.lag</code> covariance is tested by performing the fANOVA with
</p>
<p style="text-align: center;"><code class="reqn">W_{ij}(r) = \sqrt{|V_{ij}(r)|\cdot sign(V_{ij}(r))},</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">V_{ij}(r) = (T_{ij}(r) - \bar{T}_j(r))((T_{ij}(r+s) - \bar{T}_j(r+s))).</code>
</p>

<p>See Mrkvicka et al. (2020) for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov.lag</code></td>
<td>
<p>The lag of the covariance for testing the equality of covariances,
see <code>test.equality</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters to be passed to <code>global_envelope_test</code>.
For example, the type of multiple testing control, FWER or FDR must be set by <code>typeone</code>.
And, if <code>typeone = "fwer"</code>, the type of the global envelope can be chosen by
specifying the argument <code>type</code>. See <code>global_envelope_test</code>
for the defaults and available options.
(The test here uses <code>alternative="two.sided"</code> and <code>nstep=1</code> (when relevant),
but all the other specifications are to be given in <code>...</code>.)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function can be used to perform one-way graphical functional ANOVA tests described
in Mrkvička et al. (2020). Both 1d and 2d functions are allowed in curve sets.
</p>
<p>The tests assume that there are <code class="reqn">J</code> groups which contain
<code class="reqn">n_1,\dots,n_J</code> functions
<code class="reqn">T_{ij}, i=\dots,J, j=1,\dots,n_j</code>.
The functions should be given in the argument <code>curve_set</code>,
and the groups in the argument <code>groups</code>.
The tests assume that <code class="reqn">T_{ij}, i=1,...,n_j</code> is an iid sample from
a stochastic process with mean function <code class="reqn">\mu_j</code> and
covariance function <code class="reqn">\gamma_j(s,t)</code> for s,t in R and j = 1,..., J.
</p>
<p>To test the hypothesis
</p>
<p style="text-align: center;"><code class="reqn">H_0 : \mu_1(r) \equiv \mu_2(r)\equiv \dots \equiv \mu_J(r),</code>
</p>

<p>you can use the test function
</p>
<p style="text-align: center;"><code class="reqn">\mathbf{T} = (\overline{T}_1({\bf r}), \overline{T}_2({\bf r}), \dots , \overline{T}_J({\bf r}))</code>
</p>

<p>where <code class="reqn">\overline{T}_i({\bf r})</code> is a vector of mean values of functions in the group j.
This test function is used when <code>contrasts = FALSE</code> (default).
</p>
<p>The hypothesis can equivalently be written as
</p>
<p style="text-align: center;"><code class="reqn">H_0 : \mu_i(r) - \mu_j(r) = 0, i=1,\dots,J-1, j=1,\dots,J.</code>
</p>

<p>and, alternatively, one can use the test function (vector)
taken to consist of the differences of the group averages,
</p>
<p style="text-align: center;"><code class="reqn">\mathbf{T'} = (\overline{T}_1({\bf r})-\overline{T}_2({\bf r}),
\overline{T}_1({\bf r})-\overline{T}_3({\bf r}), \dots , \overline{T}_{J-1}({\bf r})-\overline{T}_J({\bf r})).</code>
</p>

<p>The choice is available with the option <code>contrasts = TRUE</code>.
This test corresponds to the post-hoc test done usually after an ANOVA test is significant, but
it can be directed tested by means of the combined rank test (Mrkvička et al., 2017) with this test vector.
</p>
<p>The test as such assumes that the variances are equal across the groups of functions. To deal with
unequal variances, the differences are rescaled as the first step as follows
</p>
<p style="text-align: center;"><code class="reqn">S_{ij}(r) = \frac{T_{ij}(r) - \overline{T}(r))}{\sqrt{Var(T_j(r))}} \sqrt{Var(T(r))} + \overline{T}(r))</code>
</p>

<p>where <code class="reqn">\overline{T}({\bf r})</code> is the overall sample mean and
<code class="reqn">\sqrt{Var(T(r))}</code> is the overall sample standard deviation.
This scaling of the test functions can be obtained by giving the argument <code>variances = "unequal"</code>.
</p>


<h3>References</h3>

<p>Mrkvička, T., Myllymäki, M., Jilek, M. and Hahn, U. (2020) A one-way ANOVA test for functional data with graphical interpretation. Kybernetika 56 (3), 432-458. doi: 10.14736/kyb-2020-3-0432
</p>
<p>Mrkvička, T., Myllymäki, M., and Hahn, U. (2017). Multiple Monte Carlo testing, with applications in spatial point processes. Statistics and Computing 27 (5): 1239-1255. doi:10.1007/s11222-016-9683-9
</p>
<p>Myllymäki, M and Mrkvička, T. (2020). GET: Global envelopes in R. arXiv:1911.06583 [stat.ME]. https://doi.org/10.48550/arXiv.1911.06583
</p>


<h3>See Also</h3>

<p><code>frank.fanova</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#-- NOx levels example (see for details Myllymaki and Mrkvicka, 2020)
if(require("fda.usc", quietly=TRUE)) {
  # Prepare data
  data("poblenou")
  fest &lt;- poblenou$df$day.festive; week &lt;- as.integer(poblenou$df$day.week)
  Type &lt;- vector(length=length(fest))
  Type[fest == 1 | week &gt;= 6] &lt;- "Free"
  Type[fest == 0 &amp; week %in% 1:4] &lt;- "MonThu"
  Type[fest == 0 &amp; week == 5] &lt;- "Fri"
  Type &lt;- factor(Type, levels = c("MonThu", "Fri", "Free"))

  # (log) Data as a curve_set
  cset &lt;- curve_set(r = 0:23,
     obs = t(log(poblenou[['nox']][['data']])))
  # Graphical functional ANOVA
  nsim &lt;- 2999
  
  res.c &lt;- graph.fanova(nsim = nsim, curve_set = cset,
                        groups = Type, variances = "unequal",
                        contrasts = TRUE)
  plot(res.c) + ggplot2::labs(x = "Hour", y = "Diff.")
}

#-- Centred government expenditure centralization ratios example
# This is an example analysis of the centred GEC in Mrkvicka et al.
data("cgec")

# Number of simulations
nsim &lt;- 2499 # increase to reduce Monte Carlo error


# Test for unequal lag 1 covariances
res.cov1 &lt;- graph.fanova(nsim = nsim, curve_set = cgec$cgec,
                         groups = cgec$group,
                         test.equality = "cov", cov.lag = 1)
plot(res.cov1)
# Add labels
plot(res.cov1, labels = paste("Group ", 1:3, sep="")) +
  ggplot2::xlab(substitute(paste(italic(i), " (", j, ")", sep=""), list(i="r", j="Year")))
# Test for equality of variances among groups
res.var &lt;- graph.fanova(nsim = nsim, curve_set = cgec$cgec,
                        groups = cgec$group,
                        test.equality = "var")
plot(res.var)

# Test for equality of means assuming equality of variances
# a) using 'means'
res &lt;- graph.fanova(nsim = nsim, curve_set = cgec$cgec,
                    groups = cgec$group,
                    variances = "equal", contrasts = FALSE)
plot(res)
# b) using 'contrasts'
res2 &lt;- graph.fanova(nsim = nsim, curve_set = cgec$cgec,
                     groups = cgec$group,
                     variances = "equal", contrasts = TRUE)
plot(res2)

# Image set examples
data("imageset3")

res &lt;- graph.fanova(nsim = 19, # Increase nsim for serious analysis!
                    curve_set = imageset3$image_set,
                    groups = imageset3$Group)
plot(res, what = c("obs", "lo.sign", "hi.sign"), sign.type = "col")

</code></pre>


</div>