<div class="container">

<table style="width: 100%;"><tr>
<td>fitFixedKnots</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Functions to Fit Univariate Break Point Regression Models</h2>

<h3>Description</h3>

<p>There are two main functions here. The functions <code>fitFixedKnots</code> allows the fit a univariate regression using piecewise polynomials with "known" break points while the function <code>fitFreeKnots</code> estimates the break points.  
</p>


<h3>Usage</h3>

<pre><code class="language-R">fitFixedKnots(y, x, weights = NULL, knots = NULL, data = NULL, degree = 3, 
             fixed = NULL, base=c("trun","Bbase"), ...)
fitFreeKnots(y, x, weights = NULL, knots = NULL, degree = 3, fixed =
                 NULL, trace = 0, data = NULL, base=c("trun","Bbase"), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>the x variable (explanatory)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>the response variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>the prior weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>the position of the interior knots for  <code>fitFixedKnots</code> or starting values for <code>fitFreeKnots</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the data frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree</code></td>
<td>
<p>the degree if the piecewise  polynomials</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>this is to be able to fit fixed break points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>base</code></td>
<td>
<p>The basis for the piecewise polynomials, <code>turn</code> for truncated (default) and <code>Bbase</code> for B-base piecewise polynomials   </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>controlling the trace of of <code>optim()</code> </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>for extra arguments</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The functions <code>fitFreeKnots()</code> is loosely based on the  <code>curfit.free.knot()</code> function of package 
<span class="pkg">DierckxSpline</span> of  Sundar Dorai-Raj and Spencer Graves. 
</p>


<h3>Value</h3>

<p>The functions <code>fitFixedKnots</code> and <code>fitFreeKnots</code> return an object <code>FixBreakPointsReg</code> and 
<code>FreeBreakPointsReg</code> respectively with the following items:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>fitted.values</code></td>
<td>
<p>the fitted values of the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>the residuals of the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>the degrees of freedom fitted in the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rss</code></td>
<td>
<p>the residuals sum of squares</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>the knots used in creating the beta-function base</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed</code></td>
<td>
<p>the fixed break points if any</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breakPoints</code></td>
<td>
<p>the interior (estimated) break points (or knots)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coef</code></td>
<td>
<p>the coefficients of the linear  part of the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degree</code></td>
<td>
<p>the degree of the piecewise polynomial</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>the y variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>the x variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>the prior weights</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>The prediction function in piecewise polynomials using the B-spline basis is tricky because by adding the newdata for x to the current one the B-basis function for the piecewise polynomials changes.  This does not seems to be the case with the truncated basis, that is, when the option <code>base="turn"</code> is used (see the example below).
</p>
<p>If the newdata are outside the range of the old x then there could a considerable discrepancies between the all fitted values and the predicted ones if the option <code>base="Bbase"</code> is used. The prediction function for the objects <code>FixBreakPointsReg</code> or <code>FreeBreakPointsReg</code>
has the option <code>old.x.range=TRUE</code> which allow the user two choices:  
</p>
<p>The first is to use the old end-points for the creation of the new B-basis which were determine from the original range of x. This choice is implemented as a default in the <code>predict</code> method for <code>FixBreakPointsReg</code> and <code>FreeBreakPointsReg</code> objects with the argument <code>old.x.range=TRUE</code>. 
</p>
<p>The second  is to create new end-points from the new and old data  x values. In this case 
the range of x  will be bigger that the original one if the <code>newdata</code> has values outside the original x range.  
In this case (<code>old.x.range=FALSE</code>) the prediction could be possible  better outside the x range but would not coincide with the original predictions i.e. fitted(model)
since basis have changed. 
</p>


<h3>Author(s)</h3>

<p>Mikis Stasinopoulos <a href="mailto:d.stasinopoulos@londonmet.ac.uk">d.stasinopoulos@londonmet.ac.uk</a>
</p>


<h3>References</h3>

<p>Dierckx, P. (1991) <em>Curve and Surface Fitting with Splines</em>, Oxford Science Publications
</p>
<p>Rigby, R. A. and  Stasinopoulos D. M. (2005). Generalized additive models for location, scale and shape,(with discussion), 
<em>Appl. Statist.</em>, <b>54</b>, part 3, pp 507-554.
</p>
<p>Rigby R.A., Stasinopoulos D. M., Heller G., and De Bastiani F., (2019) <em>Distributions for Modeling Location, Scale and Shape: Using GAMLSS in R</em>, Chapman and Hall/CRC. 
</p>
<p>Stasinopoulos D. M. Rigby R.A. (2007) Generalized additive models for location scale and shape (GAMLSS) in R.
<em>Journal of Statistical Software</em>, <b>23</b>(7), 1â€“46, <a href="https://doi.org/10.18637/jss.v023.i07">doi:10.18637/jss.v023.i07</a>
</p>
<p>Stasinopoulos D. M., Rigby R.A., Heller G., Voudouris V., and De Bastiani F., (2017) <em>Flexible Regression and Smoothing: Using GAMLSS in R</em>, Chapman and Hall/CRC. 
</p>
<p>(see also <a href="https://www.gamlss.com/">https://www.gamlss.com/</a>).
</p>


<h3>Examples</h3>

<pre><code class="language-R"># creating  a linear + linear function
   x &lt;- seq(0,10, length.out=201)
knot &lt;- 5
 set.seed(12543)
 mu &lt;- ifelse(x&lt;=knot,5+0.5*x,5+0.5*x+(x-knot))
  y &lt;- rNO(201, mu=mu, sigma=.5)
# plot the data
 plot(y~x, xlim=c(-1,13), ylim=c(3,18))

# fit model using fixed break points
 m1 &lt;- fitFixedKnots(y, x, knots=5, degree=1)
knots(m1)
lines(fitted(m1)~x, col="red")

# now estimating the knot
m2 &lt;- fitFreeKnots(y, x, knots=5, degree=1)
knots(m2)
summary(m2)

# now predicting 
plot(y~x, xlim=c(-5,13), ylim=c(3,18))
lines(fitted(m2)~x, col="green", lwd=3)
points(-2:13,predict(m2, newdata=-2:13), col="red",pch = 21, bg="blue")
points(-2:13,predict(m2, newdata=-2:13, old.x.range=FALSE), col="red",pch = 21, bg="grey")

# fit different basis 
m21 &lt;- fitFreeKnots(y, x, knots=5, degree=1, base="Bbase")
deviance(m2) 
deviance(m21) # should be identical

# predicting with m21 
 plot(y~x, xlim=c(-5,13), ylim=c(3,18))
lines(fitted(m21)~x, col="green", lwd=3)
points(-2:13,predict(m21, newdata=-2:13), col="red",pch = 21, bg="blue")
points(-2:13,predict(m21, newdata=-2:13, old.x.range=FALSE), col="red",pch = 21, bg="grey")
</code></pre>


</div>