<div class="container">

<table style="width: 100%;"><tr>
<td>flm_stat</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Projected Cramér–von Mises test statistic for the
goodness-of-fit test of functional linear models</h2>

<h3>Description</h3>

<p>Computation of the Projected Cramér–von Mises (PCvM) test
statistic and its associated <code class="reqn">\mathbf{A}_\bullet</code> matrix.
For a sample of functional covariates <code class="reqn">X_1, \ldots, X_n</code>, the test
statistic is computed from
<code class="reqn">\mathbf{x}_{1,p}, \ldots, \mathbf{x}_{n,p}</code>,
the coefficients (scores) of the sample in a <code class="reqn">p</code>-truncated basis
expansion, such as Functional Principal Components (FPC).
</p>
<p>The PCvM statistic is defined as
</p>
<p style="text-align: center;"><code class="reqn">\mathrm{PCvM}_{n,p,q} = c \cdot \mathrm{tr}(\hat{\mathbf{E}}_q'
\mathbf{A}_\bullet \hat{\mathbf{E}}_q)</code>
</p>

<p>where
</p>
<p style="text-align: center;"><code class="reqn">c = 2 \pi^{(p + q) / 2 - 1} / (q \Gamma(p / 2) \Gamma(q / 2) n^2),</code>
</p>

<p><code class="reqn">\hat{\mathbf{E}}_q</code> is the <code class="reqn">n \times q</code>
matrix of multivariate residuals, and
<code class="reqn">\mathbf{A}_\bullet</code> is a <code class="reqn">n \times n</code>
matrix whose <code class="reqn">ij</code>-th element is
<code class="reqn">\sum_{r = 1}^n A_{ijr}</code>, for <code class="reqn">A_{ijr}</code> depending on
<code class="reqn">(\mathbf{x}_{i,p}, \mathbf{x}_{j,p}, \mathbf{x}_{r,p})</code>. Its exact expression can be seen in
Escanciano (2006) and García-Portugués et al. (2021).
</p>


<h3>Usage</h3>

<pre><code class="language-R">flm_stat(E, p, Adot_vec, constant = TRUE)

Adot(X)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>
<p>the matrix of multivariate residuals, with dimension
<code>c(n, q)</code>. A vector if <code class="reqn">q = 1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>dimension of the covariates space. Must be a positive integer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Adot_vec</code></td>
<td>
<p>output from <code>Adot</code>. A vector of length
<code>n * (n - 1) / 2 + 1</code>. This corresponds to the most expensive
computation in the test statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constant</code></td>
<td>
<p>whether to include the constant of the PCvM test
statistic, <code class="reqn">c</code>, in its computation. Defaults to <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>a matrix of size <code>c(n, p)</code> containing the coefficients
(scores) of the functional data in a <code>p</code>-truncated <em>orthonormal</em>
basis expansion, such as FPC. Must not contain repeated rows.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>Adot</code> assumes that <code>X</code> does not have repeated rows or otherwise
<code>NaN</code>s will be present in the result. If <code>X</code> has repeated rows,
<code>Adot</code> will throw a warning.
</p>
<p>The implementation of the PCvM test statistic for scalar response is
addressed in García-Portugués et al. (2014), whereas García-Portugués et al.
(2021) presents its multivariate extension and shows that
<code class="reqn">\mathbf{A}_\bullet</code> induces a weighted quadratic norm (if
there are no repetitions in the sample). The PCvM statistic is rooted in
the proposal by Escanciano (2006).
</p>
<p>Both <code>flm_stat</code> and <code>A_dot</code> are coded in C++.
</p>


<h3>Value</h3>


<ul>
<li>
<p><code>flm_stat</code>: the value of the test statistic, a scalar.
</p>
</li>
<li>
<p><code>A_dot</code>: a vector of length <code>n * (n - 1) / 2 + 1</code>.
The first entry contains the common diagonal element of
<code class="reqn">\mathbf{A}_\bullet</code>. The remaining entries are the upper
triangular matrix (excluding the diagonal) of
<code class="reqn">\mathbf{A}_\bullet</code>, stacked by columns.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Eduardo García-Portugués.
</p>


<h3>References</h3>

<p>García-Portugués, E., Álvarez-Liébana, J., Álvarez-Pérez, G. and
Gonzalez-Manteiga, W. (2021). A goodness-of-fit test for the functional
linear model with functional response. <em>Scandinavian Journal of
Statistics</em>, 48(2):502–528. <a href="https://doi.org/10.1111/sjos.12486">doi:10.1111/sjos.12486</a>
</p>
<p>Escanciano, J. C. (2006) A consistent diagnostic test for regression
models using projections. <em>Econometric Theory</em>, 22(6):1030–-1051.
<a href="https://doi.org/10.1017/S0266466606060506">doi:10.1017/S0266466606060506</a>
</p>
<p>García-Portugués, E., González-Manteiga, W. and Febrero-Bande, M. (2014). A
goodness-of-fit test for the functional linear model with scalar response.
<em>Journal of Computational and Graphical Statistics</em>, 23(3):761–778.
<a href="https://doi.org/10.1080/10618600.2013.812519">doi:10.1080/10618600.2013.812519</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## flm_stat

# Generate data
n &lt;- 200
q &lt;- 2
p &lt;- 3
E &lt;- matrix(rnorm(n * q), nrow = n, ncol = q)
X_fdata &lt;- r_ou(n = n, t = seq(0, 1, l = 101))

# Compute FPC
X_fpc &lt;- fpc(X_fdata)

# Adot
Adot_vec &lt;- Adot(X = X_fpc[["scores"]])

# Check equality
constant &lt;- n^(-2) * 2 * pi^((p / 2) - 1) / gamma(p / 2)
constant * .Fortran("pcvm_statistic", n = as.integer(n),
                    Adot_vec = Adot_vec, residuals = E[, 2],
                    statistic = 0)$statistic
flm_stat(E = E[, 2, drop = FALSE], p = p, Adot_vec = Adot_vec,
         constant = FALSE)

## Adot

# Generate data
n &lt;- 200
X_fdata &lt;- r_ou(n = n, t = seq(0, 1, l = 101))

# Compute FPC
X_fpc &lt;- fpc(X_fdata)

# Using inprod_fdata and Adot
Adot_vec &lt;- Adot(X = X_fpc[["scores"]])

# Check with fda.usc::Adot with adequate inprod
head(drop(Adot_vec))
head(fda.usc::Adot(X_fdata))

# Obtention of the entire Adot matrix
Ad &lt;- diag(rep(Adot_vec[1], n))
Ad[upper.tri(Ad, diag = FALSE)] &lt;- Adot_vec[-1]
head(Ad &lt;- t(Ad) + Ad - diag(diag(Ad)))

# Positive definite
eigen(Ad)$values

# # Warning if X contains repeated observations
# Adot(X = rbind(1:3, 1:3, 3:5))

# Comparison with .Fortran("adot", PACKAGE = "fda.usc")
n &lt;- as.integer(n)
a &lt;- as.double(rep(0, (n * (n - 1) / 2 + 1)))
inprod &lt;- X_fpc[["scores"]] %*% t(X_fpc[["scores"]])
inprod &lt;- inprod[upper.tri(inprod, diag = TRUE)]
X &lt;- X_fpc[["scores"]]
microbenchmark::microbenchmark(
  .Fortran("adot", n = n, inprod = inprod, Adot_vec = a,
           PACKAGE = "fda.usc"),
  Adot(X = X),
  times = 50, control = list(warmup = 10))

</code></pre>


</div>