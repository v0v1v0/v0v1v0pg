<div class="container">

<table style="width: 100%;"><tr>
<td>stat_panel_counts</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Number of observations in a plot panel</h2>

<h3>Description</h3>

<p><code>stat_panel_counts()</code> counts the number of observations in each panel.
<code>stat_group_counts()</code> counts the number of observations in each group.
By default they add one or more text labels to the top right corner of each
panel. Grouping is ignored by <code>stat_panel_counts()</code>. If no grouping
exists, the two statistics behave similarly.
</p>


<h3>Usage</h3>

<pre><code class="language-R">stat_panel_counts(
  mapping = NULL,
  data = NULL,
  geom = "text_npc",
  position = "identity",
  label.x = "right",
  label.y = "top",
  na.rm = FALSE,
  show.legend = FALSE,
  inherit.aes = TRUE,
  ...
)

stat_group_counts(
  mapping = NULL,
  data = NULL,
  geom = "text_npc",
  position = "identity",
  label.x = "right",
  label.y = "top",
  hstep = 0,
  vstep = NULL,
  digits = 2,
  na.rm = FALSE,
  show.legend = FALSE,
  inherit.aes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mapping</code></td>
<td>
<p>The aesthetic mapping, usually constructed with
<code>aes</code> or <code>aes_</code>. Only needs to be
set at the layer level if you are overriding the plot defaults.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A layer specific dataset. Rarely used, as you will not want to
override the plot defaults.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>geom</code></td>
<td>
<p>The geometric object to use display the data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>position</code></td>
<td>
<p>The position adjustment to use on this layer</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label.x, label.y</code></td>
<td>
<p><code>numeric</code> Coordinates (in npc units) to be used
for absolute positioning of the labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>a logical indicating whether <code>NA</code> values should be stripped
before the computation proceeds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes it if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics, rather
than combining with them. This is most useful for helper functions that
define both data and aesthetics and should not inherit behaviour from the
default plot specification, e.g., <code>borders</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments passed on to <code>layer</code>. This
can include aesthetics whose values you want to set, not map. See
<code>layer</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hstep, vstep</code></td>
<td>
<p>numeric in npc units, the horizontal and vertical step
used between labels for different groups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>integer Number of digits for fraction and percent labels.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These statistics can be used to automatically count observations in
each panel of a plot, and by default add these counts as text labels. These
statistics, unlike <code>stat_quadrant_counts()</code> requires only one of
<em>x</em> or <em>y</em> aesthetics and can be used together with statistics
that have the same requirement, like <code>stat_density()</code>.
</p>
<p>The default position of the label is in the top right corner. When using
facets even with free limits for <em>x</em> and <em>y</em> axes, the location
of the labels is consistent across panels. This is achieved by use of
<code>geom = "text_npc"</code> or <code>geom = "label_npc"</code>. To pass the
positions in native data units to <code>label.x</code> and <code>label.y</code>, pass
also explicitly <code>geom = "text"</code>, <code>geom = "label"</code> or some other
geometry that use the <em>x</em> and/or <em>y</em> aesthetics. A vector with
the same length as the number of panels in the figure can be used if
needed.
</p>


<h3>Value</h3>

<p>A plot layer instance. Using as output <code>data</code> the counts of
observations in each plot panel or per group in each plot panel.
</p>


<h3>Computed variables</h3>

<p>Data frame with one or more rows, one for each
group of observations for which counts are counted in <code>data</code>. </p>

<dl>
<dt>x,npcx</dt>
<dd>
<p>x value of label position in data- or npc units, respectively</p>
</dd>
<dt>y,npcy</dt>
<dd>
<p>y value of label position in data- or npc units, respectively</p>
</dd>
<dt>count</dt>
<dd>
<p>number of  observations as an integer</p>
</dd>
<dt>count.label</dt>
<dd>
<p>number of observations as character</p>
</dd>
</dl>
<p>As shown in one example below <code>geom_debug</code> can be
used to print the computed values returned by any statistic. The output
shown includes also values mapped to aesthetics, like <code>label</code> in the
example. <code>x</code> and <code>y</code> are included in the output only if mapped.
</p>


<h3>Note</h3>

<p>If a factor is mapped to <code>x</code> or to <code>y</code> aesthetics each level
of the factor constitutes a group, in this case the default positioning and
geom using NPC pseudo aesthetics will have to be overriden by passing
<code>geom = "text"</code> and data coordinates used. The default for factors
may change in the future.
</p>


<h3>See Also</h3>

<p>Other Functions for quadrant and volcano plots: 
<code>geom_quadrant_lines()</code>,
<code>stat_quadrant_counts()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# generate artificial data with numeric x and y
set.seed(67821)
x &lt;- 1:100
y &lt;- rnorm(length(x), mean = 10)
group &lt;- factor(rep(c("A", "B"), times = 50))
my.data &lt;- data.frame(x, y, group)

# using automatically generated text labels

ggplot(my.data, aes(x, y)) +
  geom_point() +
  stat_panel_counts()

ggplot(my.data, aes(x, y, colour = group)) +
  geom_point() +
  stat_panel_counts()

ggplot(my.data, aes(x, y, colour = group)) +
  geom_point() +
  stat_group_counts()

ggplot(my.data, aes(x, y, colour = group)) +
  geom_point() +
  stat_group_counts(label.x = "left", hstep = 0.06, vstep = 0)

ggplot(my.data, aes(x, y, colour = group)) +
  geom_point() +
  stat_group_counts(aes(label = after_stat(pc.label)))

ggplot(my.data, aes(x, y, colour = group)) +
  geom_point() +
  stat_group_counts(aes(label = after_stat(pc.label)), digits = 3)

ggplot(my.data, aes(x, y, colour = group)) +
  geom_point() +
  stat_group_counts(aes(label = after_stat(fr.label)))

ggplot(my.data, aes(x, y, colour = group)) +
  geom_point() +
  stat_group_counts(aes(label = after_stat(dec.label)))

# one of x or y can be a factor
# label.x or label.y along the factor can be set to "factor" together
# with the use of geom_text()

ggplot(mpg,
       aes(factor(cyl), hwy)) +
  stat_boxplot() +
  stat_group_counts(geom = "text",
                    label.y = 10,
                    label.x = "factor") +
  stat_panel_counts()

# Numeric values can be used to build labels with alternative formats
# Here with sprintf(), but paste() and format() also work.

ggplot(my.data, aes(x, y)) +
 geom_point() +
 stat_panel_counts(aes(label = sprintf("%i observations",
                                       after_stat(count)))) +
 scale_y_continuous(expand = expansion(mult = c(0.05, 0.12)))

ggplot(mpg,
       aes(factor(cyl), hwy)) +
  stat_boxplot() +
  stat_group_counts(geom = "text",
                    aes(label = sprintf("(%i)", after_stat(count))),
                    label.y = 10,
                    label.x = "factor")

ggplot(mpg,
       aes(factor(cyl), hwy)) +
  stat_boxplot() +
  stat_group_counts(aes(label = sprintf("n[%i]~`=`~%i",
                                        after_stat(x), after_stat(count))),
                    parse = TRUE,
                    geom = "text",
                    label.y = 10,
                    label.x = "factor") +
  stat_panel_counts(aes(label = sprintf("sum(n[i])~`=`~%i",
                                        after_stat(count))),
                    parse = TRUE)

# label position

ggplot(my.data, aes(y)) +
  stat_panel_counts(label.x = "left") +
  stat_density(alpha = 0.5)

ggplot(my.data, aes(y, colour = group)) +
  stat_group_counts(label.y = "top") +
  stat_density(aes(fill = group), alpha = 0.3)

# The numeric value can be used as a label as is

ggplot(mpg,
       aes(factor(cyl), hwy)) +
  stat_boxplot() +
  stat_group_counts(geom = "text",
                    aes(label = after_stat(count)),
                    label.x = "factor",
                    label.y = 10) +
  annotate(geom = "text", x = 0.55, y = 10, label = "n[i]~`=`", parse = TRUE)

# We use geom_debug() to see the computed values

gginnards.installed &lt;- requireNamespace("gginnards", quietly = TRUE)
if (gginnards.installed) {
  library(gginnards)

  ggplot(my.data, aes(x, y)) +
    geom_point() +
    stat_panel_counts(geom = "debug")
}

if (gginnards.installed) {
  ggplot(my.data, aes(x, y, colour = group)) +
    geom_point() +
    stat_group_counts(geom = "debug")
}

</code></pre>


</div>