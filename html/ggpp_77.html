<div class="container">

<table style="width: 100%;"><tr>
<td>position_nudge_line</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Nudge labels away from a line</h2>

<h3>Description</h3>

<p><code>position_nudge_line()</code> is generally useful for adjusting the starting
position of labels or text to be repelled while preserving the original
position as the start of the segments. The difference compared to
<code>position_nudge_center</code> is that the nudging is away from from a
line or curve fitted to the data points or supplied as coefficients. While
<code>position_nudge_center()</code> is most useful for "round-shaped", vertically-
or horizontally elongated clouds of points, <code>position_nudge_line()</code> is
most suitable when observations follow a linear or curvilinear relationship
between <em>x</em> and <em>y</em> values. In contrast to
<code>position_nudge</code>, <code>position_nudge_line()</code> returns
in 'data' both the original coordinates and the nudged coordinates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">position_nudge_line(
  x = NA_real_,
  y = NA_real_,
  xy_relative = c(0.03, 0.03),
  abline = NULL,
  method = NULL,
  formula = y ~ x,
  direction = c("automatic", "none", "split"),
  line_nudge = 1,
  kept.origin = c("original", "none")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x, y</code></td>
<td>
<p>Amount of vertical and horizontal distance to move. A numeric
vector of length 1 or longer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xy_relative</code></td>
<td>
<p>Nudge relative to <em>x</em> and <em>y</em> data expanse, ignored unless
<code>x</code> and <code>y</code> are both <code>NA</code>s.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>abline</code></td>
<td>
<p>a vector of length two giving the intercept and slope.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>One of <code>"spline"</code>, <code>"lm"</code> or <code>"auto"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A model formula for <code>lm</code> when <code>method =
"lm"</code>. Ignored otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>direction</code></td>
<td>
<p>One of <code>"automatic"</code>, <code>"none"</code>, or <code>"split"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>line_nudge</code></td>
<td>
<p>A positive multiplier &gt;= 1, increasing nudging away from
the curve or line compared to nudging from points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kept.origin</code></td>
<td>
<p>One of <code>"original"</code> or <code>"none"</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The default amount of nudging is 3
<em>x</em> and <em>y</em> axes, which in most cases is good. In most cases it is best to
apply nudging along a direction perpendicular to the line or curve, if this
is the aim, passing an argument to only one of <code>x</code>, <code>y</code> or
<code>xy_relative</code> will be enough. When <code>direction = "split"</code> nudging
is away from an implicit line or curve on either side with positive
nudging. The line or curve can be smooth spline or linear regression fitted
on-the-fly to the data points, or a straight line defined by its
coefficients passed to <code>abline</code>. The fitting is well defined only if
the observations fall roughly on a curve or straight line that is monotonic
in <code>y</code>. By means of <code>line_nudge</code> one can increment nudging away
from the line or curve compared to away from the points, which is useful
for example to keep labels outside of a confidence band. Direction defaults
to <code>"split"</code> when <code>line_nudge</code> &gt; 1, and otherwise to
<code>"none"</code>.
</p>


<h3>Value</h3>

<p>A <code>"Position"</code> object.
</p>


<h3>Note</h3>

<p>For <code>method = "lm"</code> only model formulas corresponding to
polynomials with no missing terms are supported. If using<code>poly</code>
in the model formula, <code>raw = TRUE</code> is required.
</p>
<p>In practice, <code>x</code> and <code>y</code> should have the same sign for nudging to
work correctly.
</p>
<p>This position is most useful when labeling points conforming a cloud along
an arbitrary curve or line.
</p>


<h3>See Also</h3>

<p><code>position_nudge</code>,
<code>position_nudge_repel</code>.
</p>
<p>Other position adjustments: 
<code>position_dodgenudge()</code>,
<code>position_jitternudge()</code>,
<code>position_nudge_center()</code>,
<code>position_nudge_keep()</code>,
<code>position_nudge_to()</code>,
<code>position_stacknudge()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
set.seed(16532)
df &lt;- data.frame(
  x = -10:10,
  y = (-10:10)^2,
  yy = (-10:10)^2 + rnorm(21, 0, 4),
  yyy = (-10:10) + rnorm(21, 0, 4),
  l = letters[1:21]
)

# Setting the nudging distance

ggplot(df, aes(x, y, label = l)) +
  geom_line(linetype = "dotted") +
  geom_point() +
  geom_text(position = position_nudge_line())

ggplot(df, aes(x, y, label = l)) +
  geom_line(linetype = "dotted") +
  geom_point() +
  geom_text_s(position = position_nudge_line())

ggplot(df, aes(x, y, label = l)) +
  geom_line(linetype = "dotted") +
  geom_point() +
  geom_text(position = position_nudge_line(xy_relative = -0.03))

ggplot(df, aes(x, y, label = l)) +
  geom_line(linetype = "dotted") +
  geom_point() +
  geom_text(position = position_nudge_line(x = 0.6, y = 3.2))

ggplot(df, aes(x, y, label = l)) +
  geom_line(linetype = "dotted") +
  geom_point() +
  geom_text(position = position_nudge_line(x = -0.6, y = -4))

# Other curves, using defaults

ggplot(df, aes(x, -y, label = l)) +
  geom_line(linetype = "dotted") +
  geom_point() +
  geom_text(position = position_nudge_line())

ggplot(subset(df, x &gt;= 0), aes(y, sqrt(y), label = l)) +
  geom_line(linetype = "dotted") +
  geom_point() +
  geom_text(position = position_nudge_line())

# Points scattered near a curve or line, we use 'direction = "split"'

ggplot(df, aes(x)) +
  geom_line(aes(y = y), linetype = "dotted") +
  geom_point(aes(y = yy)) +
  geom_text(aes(y = yy, label = l),
            position = position_nudge_line(direction = "split"))

ggplot(subset(df, x &gt;= 0), aes(y, yy)) +
  stat_smooth(method = "lm", formula = y ~ x) +
  geom_point() +
  geom_text(aes(label = l),
            position = position_nudge_line(direction = "split"))

# increasing the nudging for labels near the line

ggplot(subset(df, x &gt;= 0), aes(y, yy)) +
  stat_smooth(method = "lm", formula = y ~ x) +
  geom_point() +
  geom_text(aes(label = l),
              position = position_nudge_line(line_nudge = 2,
                                             direction = "split"))

# fitting a linear model instead of the default spline

ggplot(subset(df, x &gt;= 0), aes(y, yy)) +
  stat_smooth(method = "lm", formula = y ~ x) +
  geom_point() +
  geom_text(aes(label = l),
            position = position_nudge_line(method = "lm",
                                           direction = "split"))

ggplot(subset(df, x &gt;= 0), aes(x, x^2)) +
  stat_smooth(method = "lm", formula = y ~ poly(x, 2, raw = TRUE)) +
  geom_point() +
  geom_text(aes(label = l),
            position = position_nudge_line(method = "lm",
                                           formula = y ~ poly(x, 2, raw = TRUE)))

</code></pre>


</div>