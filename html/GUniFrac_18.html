<div class="container">

<table style="width: 100%;"><tr>
<td>ZicoSeq</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>A linear Model-based Permutation Test for Differential Abundance Analysis of Microbiome Data and Other Omics Data</h2>

<h3>Description</h3>

<p>ZicoSeq is a permutation test (Smith permutation) for differential abundance analysis of microbiome sequencing data. The input 
can be a count or a proportion matrix.  When a count matrix is provided, it provides an option to draw posterior samples 
of the underlying proportions to account for the sampling variability during the sequencing process. The test results are
aggregated over these posterior samples.  For both count and proportion data, a reference-based ratio approach is used
to account for compositional effects.  As a general methodology, ZicoSeq can also be applied to differential analysis of other
omics data. In this case, they are not treated as compositional data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ZicoSeq(
  meta.dat,
  feature.dat,
  grp.name,
  adj.name = NULL,
  feature.dat.type = c('count', 'proportion', 'other'),
  prev.filter = 0,
  mean.abund.filter = 0,
  max.abund.filter = 0,
  min.prop = 0,
  is.winsor = TRUE,
  outlier.pct = 0.03,
  winsor.end = c('top', 'bottom', 'both'),
  is.post.sample = TRUE,
  post.sample.no = 25,
  link.func = list(function(x) sign(x) * (abs(x))^0.5),
  stats.combine.func = max,
  perm.no = 99,
  strata = NULL,
  ref.pct = 0.5,
  stage.no = 6,
  excl.pct = 0.2,
  p.max = 500,
  is.fwer = FALSE,
  verbose = TRUE,
  return.feature.dat = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>meta.dat</code></td>
<td>
<p>a data frame containing the sample meta data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature.dat</code></td>
<td>
<p>a matrix of feature data, row - features (OTUs, genes, etc) , column - samples.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grp.name</code></td>
<td>
<p>the name for the variable of interest. It could be numeric or categorical; should be in <code>meta.dat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adj.name</code></td>
<td>
<p>the name(s) for the variable(s) to be adjusted. Multiple variables are allowed.
They could be numeric or categorical; should be in <code>meta.dat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature.dat.type</code></td>
<td>
<p>the type of the feature data. It could be "count", "proportion" or "other". For "proportion" data type, posterior sampling will not be performed,
but the reference-based ratio approach will still be used to address compositional effects. For "other" data type, neither posterior sampling or reference-base ratio approach
will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prev.filter</code></td>
<td>
<p>the prevalence (percentage of nonzeros) cutoff, under which the features will  be filtered. The default is 0. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean.abund.filter</code></td>
<td>
<p>the mean relative abundance cutoff, under which the features will  be filtered. The default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.abund.filter</code></td>
<td>
<p>the max relative abundance cutoff, under which the features will  be filtered. The default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.prop</code></td>
<td>
<p> proportions less than this value will be replaced with this value. Only relevant when log transformation is used.
Default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>is.winsor</code></td>
<td>
<p>a logical value indicating whether winsorization should be performed to replace outliers. The default is TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outlier.pct</code></td>
<td>
<p>the expected percentage of outliers. These outliers will be winsorized. The default is 0.03. For count/proportion data, 
<code>outlier.pct</code> should be less than <code>prev.filter</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>winsor.end</code></td>
<td>
<p>a character indicating whether the outliers at the "top", "bottom" or "both" will be winsorized.
The default is "top". If the <code>feature.dat.type</code> is "other", "both" may be considered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>is.post.sample</code></td>
<td>
<p>a logical value indicating whether to perform posterior sampling of the underlying proportions.
Only relevant when the feature data are counts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>post.sample.no</code></td>
<td>
<p>the number of posterior samples if posterior sampling is used. The default is 25.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>link.func</code></td>
<td>
<p>a list of transformation functions for the feature data or the ratios. Based on our experience, 
square-root transformation is a robust choice for many datasets.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perm.no</code></td>
<td>
<p>the number of permutations. If the raw p values are of the major interest, set <code>perm.no</code> to at least 999.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata</code></td>
<td>
<p>a factor such as subject IDs indicating the permutation strata or characters indicating the strata variable in <code>meta.dat</code>. Permutation will be confined to each stratum. This can be used for paired or some longitudinal designs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stats.combine.func</code></td>
<td>
<p>function to combine the F-statistic for the omnibus test. The default is <code>max</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.pct</code></td>
<td>
<p>percentage of reference taxa. The default is 0.5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.max</code></td>
<td>
<p>the maximum number of (most abundant) taxa to be considered in reference taxa selection; only relevant when the nubmer of taxa is huge. The default is 500, i.e., when the nubmer of taxa is larger than 500, only the 500 most abundant taxa will be used for reference selection. This is to reduce the computational time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stage.no</code></td>
<td>
<p>the number of stages if multiple-stage normalization is used. The default is 6.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>excl.pct</code></td>
<td>
<p>the maximum percentage of significant features (nominal p-value &lt; 0.05) in the reference set that should be removed. 
Only relevant when multiple-stage normalization is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>is.fwer</code></td>
<td>
<p>a logical value indicating whether the family-wise error rate control (West-Young) should be performed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical value indicating whether the trace information should be printed out.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.feature.dat</code></td>
<td>
<p>a logical value indicating whether the winsorized, filtered "feature.dat" matrix should be returned.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>ZicoSeq</code> is a linear model-based permutation test developed for differential abundance analysis of zero-inflated compositional data. Although its development is
motivated by zero-inflated microbiome sequence count data, it can be applied to proportion (composition) data and more generally to other types of omics data. 
Currently, it has the following components: 1. Winsorization to decrease the influence of outliers; 2. Posterior sampling based on a beta mixture prior to address sampling variability 
and zero inflation; 3. Reference-based multiple-stage normalization to address compositional effects; 4. An omnibus test to address diverse feature-covariate relationships; 5. Permutation-based 
false discovery rate control / family-wise error rate control for multiple testing correction, which takes into account the correlation structure in the feature data.
</p>


<h3>Value</h3>

<p>A list with the elements
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>the call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>feature.dat</code></td>
<td>
<p>the winsorized, filtered <code>feature.dat</code> matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>meta.dat</code></td>
<td>
<p><code>meta.dat</code> used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grp.name</code></td>
<td>
<p>the name of the variable of interest.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter.features</code></td>
<td>
<p>a vector of the names of the features that are filtered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref.features</code></td>
<td>
<p>a vector of the names of the reference features. Only relevant when reference approach is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R2</code></td>
<td>
<p>a matrix of percent explained variance (number of features by number of transformation functions).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>F0</code></td>
<td>
<p>a matrix of F-statistics (number of features by number of transformation functions).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>RSS</code></td>
<td>
<p>a matrix of residual sum squares (number of features by number of transformation functions).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df.model, df.residual</code></td>
<td>
<p>degrees of freedom for the model and residual space.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coef.list</code></td>
<td>
<p>a list of the linear regression coefficients under the specified transformations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.raw</code></td>
<td>
<p>the raw p-values based on permutations (not accurate if <code>perm.no</code> is small).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.adj.fdr</code></td>
<td>
<p>permutation-based FDR-adjusted p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.adj.fwer</code></td>
<td>
<p>permutation-based FWER-adjusted (West-Young) p-values.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Jun Chen</p>


<h3>References</h3>

<p>Yang, L. &amp; Chen, J. 2022. A comprehensive evaluation of differential abundance analysis methods: current status and potential solutions.
Microbiome, 10(1), 1-23.
</p>


<h3>See Also</h3>


<p><code>ZicoSeq.plot</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
data(throat.otu.tab)
data(throat.tree)
data(throat.meta)

comm &lt;- t(throat.otu.tab)
meta.dat &lt;- throat.meta

set.seed(123)
# For count data
zico.obj &lt;- ZicoSeq(meta.dat = meta.dat, feature.dat = comm, 
		grp.name = 'SmokingStatus', adj.name = 'Sex', feature.dat.type = "count",
		# Filter to remove rare taxa
		prev.filter = 0.2, mean.abund.filter = 0,  max.abund.filter = 0.002, min.prop = 0, 
		# Winsorization to replace outliers
		is.winsor = TRUE, outlier.pct = 0.03, winsor.end = 'top',
		# Posterior sampling to impute zeros
		is.post.sample = TRUE, post.sample.no = 25, 
		# Multiple link functions to capture diverse taxon-covariate relation
		link.func = list(function (x) x^0.25, function (x) x^0.5, function (x) x^0.75), 
		stats.combine.func = max,
		# Permutation-based multiple testing correction
		perm.no = 99,  strata = NULL, 
		# Reference-based multiple stage normalization
		ref.pct = 0.5, stage.no = 6, excl.pct = 0.2,
		# Family-wise error rate control
		is.fwer = FALSE,
		verbose = TRUE, return.feature.dat = FALSE)

which(zico.obj$p.adj.fdr &lt;= 0.05)

# For proportion data
comm.p &lt;- t(t(comm) / colSums(comm))
zico.obj &lt;- ZicoSeq(meta.dat = meta.dat, feature.dat = comm.p, 
		grp.name = 'SmokingStatus', adj.name = 'Sex', feature.dat.type = "proportion",
		# Filter to remove rare taxa
		prev.filter = 0.2, mean.abund.filter = 0,  max.abund.filter = 0.002, min.prop = 0, 
		# Winsorization to replace outliers
		is.winsor = TRUE, outlier.pct = 0.03, winsor.end = 'top',
		# Posterior sampling will be automatically disabled
		is.post.sample = FALSE, post.sample.no = 25, 
		# Use the square-root transformation
		link.func = list(function (x) x^0.5), stats.combine.func = max,
		# Permutation-based multiple testing correction
		perm.no = 99,  strata = NULL, 
		# Reference-based multiple stage normalization
		ref.pct = 0.5, stage.no = 6, excl.pct = 0.2,
		# Family-wise error rate control
		is.fwer = FALSE,
		verbose = TRUE, return.feature.dat = FALSE)

which(zico.obj$p.adj.fdr &lt;= 0.05)


# For other type of data. The user should be responsible for the filtering.
comm.o &lt;- comm[rowMeans(comm != 0) &gt;= 0.2, ] + 1
comm.o &lt;- log(t(t(comm.o) / colSums(comm.o)))
zico.obj &lt;- ZicoSeq(meta.dat = meta.dat, feature.dat = comm.o, 
		grp.name = 'SmokingStatus', adj.name = 'Sex', feature.dat.type = "other",
		# Filter will not be applied
		prev.filter = 0, mean.abund.filter = 0,  max.abund.filter = 0, min.prop = 0, 
		# Winsorization to both ends of the distribution 
		is.winsor = TRUE, outlier.pct = 0.03, winsor.end = 'both',
		# Posterior sampling will be automatically disabled
		is.post.sample = FALSE, post.sample.no = 25, 
		# Identity function is used
		link.func = list(function (x) x), stats.combine.func = max,
		# Permutation-based multiple testing correction
		perm.no = 99,  strata = NULL, 
		# Reference-based multiple-stage normalization will not be performed
		ref.pct = 0.5, stage.no = 6, excl.pct = 0.2,
		# Family-wise error rate control
		is.fwer = TRUE,
		verbose = TRUE, return.feature.dat = FALSE)

which(zico.obj$p.adj.fdr &lt;= 0.05)

</code></pre>


</div>