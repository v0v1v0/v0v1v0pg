<div class="container">

<table style="width: 100%;"><tr>
<td>gbm.map</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Maps of predicted abundance from Boosted Regression Tree modelling</h2>

<h3>Description</h3>

<p>Generates maps from the outputs of gbm.step then Gbm.predict.grids, handled
automatically within gbm.auto but can be run alone, and generates
representativeness surfaces from the output of gbm.rsb.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gbm.map(
  x,
  y,
  z,
  byx = NULL,
  byy = NULL,
  grdfun = mean,
  mapmain = "Predicted CPUE (numbers per hour): ",
  species = "Response Variable",
  heatcolours = c("white", "yellow", "orange", "red", "brown4"),
  colournumber = 8,
  shape = NULL,
  landcol = "grey80",
  mapback = "lightblue",
  legendloc = "bottomright",
  legendtitle = "CPUE",
  lejback = "white",
  zero = TRUE,
  quantile = 1,
  byxout = FALSE,
  breaks = NULL,
  byxport = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Vector of longitudes, from make.grid in mapplots; x. Order by this
(descending) SECOND.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Vector of latitudes, from make.grid in mapplots; grids[,gridslat].
Order by this (descending) first.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>Vector of abundances generated by gbm.predict.grids, from make.grid
in mapplots; grids[,predabund].</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>byx</code></td>
<td>
<p>Longitudinal width of grid cell, from make.grid in mapplots.
Autogenerated if left blank.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>byy</code></td>
<td>
<p>Latitudinal height of grid cell, from make.grid in mapplots.
Autogenerated if left blank.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grdfun</code></td>
<td>
<p>make.grid operand for &gt;=2 values per cell. Default:mean, other
options: sum prod min max sd se var.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapmain</code></td>
<td>
<p>Plot title, has species value appended. Default "Predicted
CPUE (numbers per hour): ".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>species</code></td>
<td>
<p>Response variable name, from basemap in mapplots;
names(samples[i]). Defaults to "Response Variable".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>heatcolours</code></td>
<td>
<p>Vector for abundance colour scale, defaults to the heatcol from
legend.grid and draw.grid in mapplots which is c("white", "yellow", "orange"
, "red", "brown4").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colournumber</code></td>
<td>
<p>Number of colours to spread heatcol over, default:8.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shape</code></td>
<td>
<p>Basemap shape to draw, from draw.shape in mapplots. Defaults to
NULL which calls gbm.basemap to generate it for you. First read in a shp file e.g. myshape &lt;-
sf::st_read(dsn = paste0(savename, ".shp"), layer = savename, quiet = TRUE), then use shape = myshape.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>landcol</code></td>
<td>
<p>Colour for 'null' area of map (for marine plots, this is
land), from draw.shape in mapplots. Default "grey80" (light grey).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapback</code></td>
<td>
<p>Basemap background colour, defaults to lightblue (ocean for
marine plots).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legendloc</code></td>
<td>
<p>Location on map of legend box, from legend.grid in mapplots,
default bottomright.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legendtitle</code></td>
<td>
<p>The metric of abundance, e.g. CPUE for fisheries, from
legend.grid in mapplots. Default "CPUE".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lejback</code></td>
<td>
<p>Background colour of legend, from legend.grid in mapplots.
Default "white".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zero</code></td>
<td>
<p>Force include 0-only bin in breaks.grid and thus legend? Default
TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantile</code></td>
<td>
<p>Set max quantile of data to include in bins, from breaks.grid
in mapplots; lower to e.g. 0.975 cutoff outliers; default 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>byxout</code></td>
<td>
<p>Export byx to use elsewhere? Default:FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks</code></td>
<td>
<p>Vector of breakpoints for colour scales; default blank,
generated automatically.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>byxport</code></td>
<td>
<p>Dummy param for package testing for CRAN, ignore.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments for legend.grid's ... which passes to legend.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#superseded"><img src="../help/figures/lifecycle-superseded.svg" alt="[Superseded]"></a>
Superseded by gbm.mapsf on 2023-08-07, but still works.
</p>
<p>Errors and their origins:
</p>
<p>Error in seq.default(xlim[1], xlim[2], by = byx):wrong sign in 'by' argument
Check that your lat &amp; long columns are the right way around. Ensure grids
data are gridded, i.e. they are in a regular pattern of same/similar lines of lat/lon, even if
they're missing sections.
</p>
<p>Suggested parameter values:
z = rsbdf[,"Unrepresentativeness"]
</p>
<p>mapmain = "Unrepresentativeness: "
</p>
<p>legendtitle = "UnRep 0-1"
</p>


<h3>Value</h3>

<p>Species abundance maps using data provided by gbm.auto, and
Representativeness Surface Builder maps using data provided by gbm.rsb, to be
run in a png/par/gbm.map/dev.off sequence.
</p>


<h3>Author(s)</h3>

<p>Simon Dedman, <a href="mailto:simondedman@gmail.com">simondedman@gmail.com</a>
</p>
<p>Hans Gerritsen
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Not run: downloads and saves external data.
# Suggested code for outputting to png:
data(grids)
# set working directory somewhere suitable
png(filename = "gbmmap.png", width = 7680, height = 7680, units = "px",
pointsize = 192, bg = "white", res = NA, family = "", type = "cairo-png")
par(mar = c(3.2,3,1.3,0), las = 1, mgp = c(2.1,0.5,0), xpd = FALSE)
gbm.map(x = grids[,"Longitude"], y = grids[,"Latitude"], z = grids[,"Effort"]
, species = "Effort")
dev.off()


</code></pre>


</div>