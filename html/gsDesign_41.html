<div class="container">

<table style="width: 100%;"><tr>
<td>print.nSurvival</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Time-to-event sample size calculation (Lachin-Foulkes)</h2>

<h3>Description</h3>

<p><code>nSurvival()</code> is used to calculate the sample size for a clinical trial
with a time-to-event endpoint. The Lachin and Foulkes (1986) method is used.
<code>nEvents</code> uses the Schoenfeld (1981) approximation to provide sample
size and power in terms of the underlying hazard ratio and the number of
events observed in a survival analysis. The functions <code>hrz2n()</code>,
<code>hrn2z()</code> and <code>zn2hr()</code> also use the Schoenfeld approximation to
provide simple translations between hazard ratios, z-values and the number
of events in an analysis; input variables can be given as vectors.
</p>
<p><code>nSurvival()</code> produces an object of class "nSurvival" with the number
of subjects and events for a set of pre-specified trial parameters, such as
accrual duration and follow-up period. The calculation is based on Lachin
and Foulkes (1986) method and can be used for risk ratio or risk difference.
The function also consider non-uniform (exponential) entry as well as
uniform entry.
</p>
<p>If the logical <code>approx</code> is <code>TRUE</code>, the variance under alternative
hypothesis is used to replace the variance under null hypothesis.  For
non-uniform entry, a non-zero value of <code>gamma</code> for exponential entry
must be supplied. For positive <code>gamma</code>, the entry distribution is
convex, whereas for negative <code>gamma</code>, the entry distribution is
concave.
</p>
<p><code>nEvents()</code> uses the Schoenfeld (1981) method to approximate the number
of events <code>n</code> (given <code>beta</code>) or the power (given <code>n</code>).
Arguments may be vectors or scalars, but any vectors must have the same
length.
</p>
<p>The functions <code>hrz2n</code>, <code>hrn2z</code> and <code>zn2hr</code> also all apply the
Schoenfeld approximation for proportional hazards modeling.  This
approximation is based on the asymptotic normal distribtuion of the logrank
statistic as well as related statistics are asymptotically normal.  Let
<code class="reqn">\lambda</code> denote the underlying hazard ratio (<code>lambda1/lambda2</code> in
terms of the arguments to <code>nSurvival</code>). Further, let <code class="reqn">n</code> denote the
number of events observed when computing the statistic of interest and
<code class="reqn">r</code> the ratio of the sample size in an experimental group relative to a
control. The estimated natural logarithm of the hazard ratio from a
proportional hazards ratio is approximately normal with a mean of
<code class="reqn">log{\lambda}</code> and variance <code class="reqn">(1+r)^2/nr</code>. Let <code class="reqn">z</code> denote a
logrank statistic (or a Wald statistic or score statistic from a
proportional hazards regression model). The same asymptotic theory implies
<code class="reqn">z</code> is asymptotically equivalent to a normalized estimate of the hazard
ratio <code class="reqn">\lambda</code> and thus <code class="reqn">z</code> is asymptotically normal with variance
1 and mean </p>
<p style="text-align: center;"><code class="reqn">\frac{log{\lambda}r}{(1+r)^2}.</code>
</p>
<p> Plugging the estimated
hazard ratio into the above equation allows approximating any one of the
following based on the other two: the estimate hazard ratio, the number of
events and the z-statistic. That is, </p>
<p style="text-align: center;"><code class="reqn">\hat{\lambda}=
\exp(z(1+r)/\sqrt{rn})</code>
</p>
 <p style="text-align: center;"><code class="reqn">z=\log(\hat{\lambda})\sqrt{nr}/(1+r)</code>
</p>
 <p style="text-align: center;"><code class="reqn">n=
(z(1+r)/\log(\hat{\lambda}))^2/r.</code>
</p>

<p><code>hrz2n()</code> translates an observed interim hazard ratio and interim
z-value into the number of events required for the Z-value and hazard ratio
to correspond to each other. <code>hrn2z()</code> translates a hazard ratio and
number of events into an approximate corresponding Z-value. <code>zn2hr()</code>
translates a Z-value and number of events into an approximate corresponding
hazard ratio. Each of these functions has a default assumption of an
underlying hazard ratio of 1 which can be changed using the argument
<code>hr0</code>. <code>hrn2z()</code> and <code>zn2hr()</code> also have an argument
<code>hr1</code> which is only used to compute the sign of the computed Z-value in
the case of <code>hrn2z()</code> and whether or not a z-value &gt; 0 corresponds to a
hazard ratio &gt; or &lt; the null hazard ratio <code>hr0</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'nSurvival'
print(x, ...)

nSurvival(
  lambda1 = 1/12,
  lambda2 = 1/24,
  Ts = 24,
  Tr = 12,
  eta = 0,
  ratio = 1,
  alpha = 0.025,
  beta = 0.1,
  sided = 1,
  approx = FALSE,
  type = c("rr", "rd"),
  entry = c("unif", "expo"),
  gamma = NA
)

nEvents(
  hr = 0.6,
  alpha = 0.025,
  beta = 0.1,
  ratio = 1,
  sided = 1,
  hr0 = 1,
  n = 0,
  tbl = FALSE
)

zn2hr(z, n, ratio = 1, hr0 = 1, hr1 = 0.7)

hrn2z(hr, n, ratio = 1, hr0 = 1, hr1 = 0.7)

hrz2n(hr, z, ratio = 1, hr0 = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An object of class "nSurvival" returned by <code>nSurvival()</code>
(optional: used for output; "months" or "years" would be the 'usual'
choices).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Allows additional arguments for <code>print.nSurvival()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda1, lambda2</code></td>
<td>
<p>event hazard rate for placebo and treatment group
respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ts</code></td>
<td>
<p>maximum study duration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Tr</code></td>
<td>
<p>accrual (recruitment) duration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eta</code></td>
<td>
<p>equal dropout hazard rate for both groups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratio</code></td>
<td>
<p>randomization ratio between placebo and treatment group.
Default is balanced design, i.e., randomization ratio is 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>type I error rate. Default is 0.025 since 1-sided testing is
default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>type II error rate. Default is 0.10 (90% power). Not needed for
<code>nEvents()</code> if n is provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sided</code></td>
<td>
<p>one or two-sided test? Default is one-sided test.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>approx</code></td>
<td>
<p>logical. If <code>TRUE</code>, the approximation sample size formula
for risk difference is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>type of sample size calculation: risk ratio (“rr”) or
risk difference (“rd”).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>entry</code></td>
<td>
<p>patient entry type: uniform entry (<code>"unif"</code>) or
exponential entry (<code>"expo"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>
<p>rate parameter for exponential entry. <code>NA</code> if entry type
is <code>"unif"</code> (uniform). A non-zero value is supplied if entry type is
<code>"expo"</code> (exponential).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hr</code></td>
<td>
<p>Hazard ratio. For <code>nEvents</code>, this is the hazard ratio under
the alternative hypothesis (&gt;0).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hr0</code></td>
<td>
<p>Hazard ratio under the null hypothesis (&gt;0, for <code>nEvents</code>,
<code>!= hr</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Number of events. For <code>nEvents</code> may be input to compute power
rather than sample size.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tbl</code></td>
<td>
<p>Indicator of whether or not scalar (vector) or tabular output is
desired for <code>nEvents()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>A z-statistic.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hr1</code></td>
<td>
<p>Hazard ratio under the alternate hypothesis for <code>hrn2z,
zn2hr</code> (&gt;0, <code>!= hr0</code>)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>nSurvival</code> produces a list with the following component
returned: </p>
<table>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>entry</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Sample
size required (computed).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nEvents</code></td>
<td>
<p>Number of events required
(computed).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda1</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda2</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eta</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratio</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sided</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Ts</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Tr</code></td>
<td>
<p>As input.</p>
</td>
</tr>
</table>
<p><code>nEvents</code> produces a scalar or vector of sample sizes (or powers) when
<code>tbl=FALSE</code> or, when <code>tbl=TRUE</code> a data frame of values with the
following columns: </p>
<table>
<tr style="vertical-align: top;">
<td><code>hr</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>If <code>n[1]=0</code> on input
(default), output contains the number of events need to obtain the input
Type I and II error. If <code>n[1]&gt;0</code> on input, the input value is
returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>As input.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>If <code>n[1]=0</code> on input
(default), <code>beta</code> is output as input. Otherwise, this is the computed
Type II error based on the input <code>n</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Power</code></td>
<td>
<p>One minus the
output <code>beta</code>. When <code>tbl=FALSE, n[1]&gt;0</code>, this is the value or
vector of values returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>Standardized effect size
represented by input difference between null and alternative hypothesis
hazard ratios.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratio</code></td>
<td>
<p>Ratio of experimental to control sample size
where 'experimental' is the same as the group with hazard represented in the
numerator of the hazard ratio.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>Estimated standard error for the
observed log(hazard ratio) with the given sample size.</p>
</td>
</tr>
</table>
<p><code>hrz2n</code> outputs a number of events required to approximately have the
input hazard ratio, z-statistic and sample size correspond. <code>hrn2z</code>
outputs an approximate z-statistic corresponding to an input hazard ratio
and number of events. <code>zn2hr</code> outputs an approximate hazard ratio
corresponding to an input z-statistic and number of events.
</p>


<h3>Author(s)</h3>

<p>Shanhong Guan <a href="mailto:shanhong.guan@gmail.com">shanhong.guan@gmail.com</a>, Keaven Anderson
<a href="mailto:keaven_anderson@merck.com">keaven_anderson@merck.com</a>
</p>


<h3>References</h3>

<p>Lachin JM and Foulkes MA (1986), Evaluation of Sample Size and
Power for Analyses of Survival with Allowance for Nonuniform Patient Entry,
Losses to Follow-Up, Noncompliance, and Stratification. <em>Biometrics</em>,
42, 507-519.
</p>
<p>Schoenfeld D (1981), The Asymptotic Properties of Nonparametric Tests for
Comparing Survival Distributions. <em>Biometrika</em>, 68, 316-319.
</p>


<h3>See Also</h3>

<p><code>vignette("gsDesignPackageOverview")</code>, plot.gsDesign,
gsDesign, gsHR
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(ggplot2)

# consider a trial with
# 2 year maximum follow-up
# 6 month uniform enrollment
# Treatment/placebo hazards = 0.1/0.2 per 1 person-year
# drop out hazard 0.1 per 1 person-year
# alpha = 0.025 (1-sided)
# power = 0.9 (default beta=.1)

ss &lt;- nSurvival(
  lambda1 = .2, lambda2 = .1, eta = .1, Ts = 2, Tr = .5,
  sided = 1, alpha = .025
)

#  group sequential translation with default bounds
#  note that delta1 is log hazard ratio; used later in gsBoundSummary summary
x &lt;- gsDesign(
  k = 5, test.type = 2, n.fix = ss$nEvents, nFixSurv = ss$n,
  delta1 = log(ss$lambda2 / ss$lambda1)
)
# boundary plot
plot(x)
# effect size plot
plot(x, plottype = "hr")
# total sample size
x$nSurv
# number of events at analyses
x$n.I
# print the design
x
# overall design summary
cat(summary(x))
# tabular summary of bounds
gsBoundSummary(x, deltaname = "HR", Nname = "Events", logdelta = TRUE)



# approximate number of events required using Schoenfeld's method
# for 2 different hazard ratios
nEvents(hr = c(.5, .6), tbl = TRUE)
# vector output
nEvents(hr = c(.5, .6))

# approximate power using Schoenfeld's method
# given 2 sample sizes and hr=.6
nEvents(hr = .6, n = c(50, 100), tbl = TRUE)
# vector output
nEvents(hr = .6, n = c(50, 100))

# approximate hazard ratio corresponding to 100 events and z-statistic of 2
zn2hr(n = 100, z = 2)
# same when hr0 is 1.1
zn2hr(n = 100, z = 2, hr0 = 1.1)
# same when hr0 is .9 and hr1 is greater than hr0
zn2hr(n = 100, z = 2, hr0 = .9, hr1 = 1)

# approximate number of events corresponding to z-statistic of 2 and
# estimated hazard ratio of .5 (or 2)
hrz2n(hr = .5, z = 2)
hrz2n(hr = 2, z = 2)

# approximate z statistic corresponding to 75 events
# and estimated hazard ratio of .6 (or 1/.6)
# assuming 2-to-1 randomization of experimental to control
hrn2z(hr = .6, n = 75, ratio = 2)
hrn2z(hr = 1 / .6, n = 75, ratio = 2)
</code></pre>


</div>