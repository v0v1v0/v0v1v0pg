<div class="container">

<table style="width: 100%;"><tr>
<td>simData</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate data from a multivariate joint model</h2>

<h3>Description</h3>

<p>Simulate multivariate longitudinal and survival data from a joint model 
specification, with potential mixture of response families. Implementation is similar 
to existing packages (e.g. <code>joineR</code>, <code>joineRML</code>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">simData(
  n = 250,
  ntms = 10,
  fup = 5,
  family = list("gaussian", "gaussian"),
  sigma = list(0.16, 0.16),
  beta = rbind(c(1, 0.1, 0.33, -0.5), c(1, 0.1, 0.33, -0.5)),
  D = NULL,
  gamma = c(0.5, -0.5),
  zeta = c(0.05, -0.3),
  theta = c(-4, 0.2),
  cens.rate = exp(-3.5),
  regular.times = TRUE,
  dof = Inf,
  random.formulas = NULL,
  disp.formulas = NULL,
  return.ranefs = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>the number of subjects</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntms</code></td>
<td>
<p>the number of time points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fup</code></td>
<td>
<p>the maximum follow-up time, such that t = [0, ..., fup] with length <code>ntms</code>. 
In instances where subject <code class="reqn">i</code> <em>doesn't</em> fail before <code>fup</code>, their censoring
time is set as <code>fup + 0.1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>a <code class="reqn">K</code>-<code>list</code> of families, see <strong>details</strong>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>a <code class="reqn">K</code>-<code>list</code> of dispersion parameters corresponding to the order of 
<code>family</code>, and matching <code>disp.formulas</code> specification; see <strong>details</strong>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>a <code class="reqn">K \times 4</code> matrix specifying fixed effects for each <code class="reqn">K</code> parameter, 
in the order (Intercept), time, continuous, binary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>a positive-definite matrix specifying the variance-covariance matrix for the random
effects. If not supplied an identity matrix is assumed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>
<p>a <code class="reqn">K</code>-vector specifying the association parameters for each longitudinal 
outcome.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zeta</code></td>
<td>
<p>a vector of length 2 specifying the coefficients for the baseline covariates in 
the survival sub-model, in the order of continuous and binary.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>parameters to control the failure rate, see <strong>baseline hazard</strong>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cens.rate</code></td>
<td>
<p>parameter for <code>rexp</code> to generate censoring times for each subject.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regular.times</code></td>
<td>
<p>logical, if <code>regular.times = TRUE</code> (the default), then 
<em>every</em> subject will have the same follow-up times defined by 
<code>seq(0, fup, length.out = ntms)</code>. If <code>regular.times = FALSE</code> then follow-up times are
set as random draws from a uniform distribution with maximum <code>fup</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dof</code></td>
<td>
<p>integer, specifies the degrees of freedom of the multivariate t-distribution
used to generate the random effects. If specified, this t-distribution is used. If left
at the default <code>dof=Inf</code> then the random effects are drawn from a multivariate normal
distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random.formulas</code></td>
<td>
<p>allows user to specify if an intercept-and-slope (<code>~ time</code>) or 
intercept-only (<code>~1</code>) random effects structure should be used on a response-by-response
basis. Defaults to an intercept-and-slope for all responses.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>disp.formulas</code></td>
<td>
<p>allows user to specify the dispersion model simulated. Intended use is
to allow swapping between intercept only (the default) and a time-varying one (<code>~ time</code>).
Note that this should be a <code class="reqn">K</code>-<code>list</code> of formula objects, so if only one dispersion 
model is wanted, then an intercept-only should be specified for remaining sub-models. The
corresponding item in list of <code>sigma</code> parameters should be of appropriate size. Defaults
to an intercept-only model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return.ranefs</code></td>
<td>
<p>a logical determining whether the <em>true</em> random effects should be 
returned. This is largely for internal/simulation use. Default <code>return.ranefs = FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>simData</code> simulates data from a multivariate joint model with a mixture of 
families for each <code class="reqn">k=1,\dots,K</code> response. The specification of <code>family</code> changes
requisite dispersion parameter <code>sigma</code>, if applicable. The <code>family</code> list can
(currently) contain: 
</p>

<dl>
<dt><code>"gaussian"</code></dt>
<dd>
<p>Simulated with identity link, corresponding item in <code>sigma</code>
will be the <strong>variance</strong>.</p>
</dd>
<dt><code>"poisson"</code></dt>
<dd>
<p>Simulated with log link, corresponding dispersion in <code>sigma</code> 
can be anything, as it doesn't impact simulation.</p>
</dd>
<dt><code>"binomial"</code></dt>
<dd>
<p>Simulated with logit link, corresponding dispersion in <code>sigma</code> 
can be anything, as it doesn't impact simulation.</p>
</dd>
<dt><code>"negbin"</code></dt>
<dd>
<p>Simulated with a log link, corresponding item in <code>sigma</code> will be
the <strong>overdispersion</strong> defined on the log scale. Simulated variance is 
<code class="reqn">\mu+\mu^2/\varphi</code>.</p>
</dd>
<dt><code>"genpois"</code></dt>
<dd>
<p>Simulated with a log link, corresponding item in <code>sigma</code> will be
the <strong>dispersion</strong>. Values &lt; 0 correspond to under-dispersion, and values &gt; 0 over-
dispersion. See <code>rgenpois</code> for more information. Simulated variance is 
<code class="reqn">(1+\varphi)^2\mu</code>.</p>
</dd>
<dt><code>"Gamma"</code></dt>
<dd>
<p>Simulated with a log link, corresponding item in <code>sigma</code> will be
the <strong>shape</strong> parameter, defined on the log-scale.</p>
</dd>
</dl>
<p>Therefore, for families <code>"negbin"</code>, <code>"Gamma"</code>, <code>"genpois"</code>, the user can
define the dispersion model desired in <code>disp.formulas</code>, which creates a data matrix 
<code class="reqn">W</code>. For the <code>"negbin"</code> and <code>"Gamma"</code> cases, we define 
<code class="reqn">\varphi_i=\exp\{W_i\sigma_i\}</code> (i.e. the exponent of the linear predictor of the 
dispersion model); and for <code>"genpois"</code> the identity of the linear is used.
</p>


<h3>Value</h3>

<p>A list of two <code>data.frame</code>s: One with the full longitudinal data, and another 
with only survival data. If <code>return.ranefs=TRUE</code>, a matrix of the true <code class="reqn">b</code> values is
also returned. By default (i.e. no arguments provided), a bivariate Gaussian set of joint
data is returned.
</p>


<h3>Baseline hazard</h3>

<p>When simulating the survival time, the baseline hazard is a Gompertz distribution controlled 
by <code>theta=c(x,y)</code>:
</p>
<p style="text-align: center;"><code class="reqn">\lambda_0(t) = \exp{x + yt}</code>
</p>

<p>where <code class="reqn">y</code> is the shape parameter, and the scale parameter is <code class="reqn">\exp{x}</code>.
</p>


<h3>Author(s)</h3>

<p>James Murray (<a href="mailto:j.murray7@ncl.ac.uk">j.murray7@ncl.ac.uk</a>).
</p>


<h3>References</h3>

<p>Austin PC. Generating survival times to simulate Cox proportional hazards
models with time-varying covariates. <em>Stat Med.</em> 2012; <strong>31(29)</strong>:
3946-3958.
</p>


<h3>See Also</h3>

<p><code>joint</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># 1) A set of univariate data ------------------------------------------
beta &lt;- c(2.0, 0.33, -0.25, 0.15)
# Note that by default arguments are bivariate, so need to specify the univariate case
univ.data &lt;- simData(beta = beta,    
                     gamma = 0.15, sigma = list(0.2), family = list("gaussian"), 
                     D = diag(c(0.25, 0.05)))
                     
# 2) Univariate data, with failure rate controlled ---------------------
# In reality, many facets contribute to the simulated failure rate, in 
# this example, we'll just atler the baseline hazard via 'theta'.
univ.data.highfail &lt;- simData(beta = beta,
                              gamma = 0.15, sigma = list(0.0), family = list("poisson"),
                              D = diag(c(0.40, 0.08)), theta = c(-2, 0.1))

# 3) Trivariate (K = 3) mixture of families with dispersion parameters -
beta &lt;- do.call(rbind, replicate(3, c(2, -0.1, 0.1, -0.2), simplify = FALSE))
gamma &lt;- c(0.3, -0.3, 0.3)
D &lt;- diag(c(0.25, 0.09, 0.25, 0.05, 0.25, 0.09))
family &lt;- list('gaussian', 'genpois', 'negbin')
sigma &lt;- list(.16, 1.5, log(1.5))
triv.data &lt;- simData(ntms=15, family = family, sigma = sigma, beta = beta, D = D, 
                     gamma = gamma, theta = c(-3, 0.2), zeta = c(0,-.2))

# 4) K = 4 mixture of families with/out dispersion ---------------------
beta &lt;- do.call(rbind, replicate(4, c(2, -0.1, 0.1, -0.2), simplify = FALSE))
gamma &lt;- c(-0.75, 0.3, -0.6, 0.5)
D &lt;- diag(c(0.25, 0.09, 0.25, 0.05, 0.25, 0.09, 0.16, 0.02))
family &lt;- list('gaussian', 'poisson', 'binomial', 'gaussian')
sigma &lt;- list(.16, 0, 0, .05) # 0 can be anything here, as it is ignored internally.
mix.data &lt;- simData(ntms=15, family = family, sigma = sigma, beta = beta, D = D, gamma = gamma,
                    theta = c(-3, 0.2), zeta = c(0,-.2))
                    
# 5) Bivariate joint model with two dispersion models. -----------------
disp.formulas &lt;- list(~time, ~time)          # Two time-varying dispersion models
sigma &lt;- list(c(0.00, -0.10), c(0.10, 0.15)) # specified in form of intercept, slope
D &lt;- diag(c(.25, 0.04, 0.50, 0.10))
disp.data &lt;- simData(family = list("genpois", "negbin"), sigma = sigma, D = D,
                     beta = rbind(c(0, 0.05, -0.15, 0.00), 1 + c(0, 0.25, 0.15, -0.20)),
                     gamma = c(1.5, 1.5),
                     disp.formulas = disp.formulas, fup = 5)            

# 6) Trivariate joint model with mixture of random effects models ------
# It can be hard to e.g. fit a binomial model on an intercept and slope, since e.g.
# glmmTMB might struggle to accurately fit it (singular fits, etc.). To that end, could
# swap the corresponding random effects specification to be an intercept-only.
family &lt;- list("gaussian", "binomial", "gaussian")
# A list of formulae, even though we want to change the second sub-model's specification
# we need to specify the rest of the items, too (same as disp.formulas, sigma).
random.formulas &lt;- list(~time, ~1, ~time)
beta &lt;- rbind(c(2, -0.2, 0.5, -0.25), c(0, 0.5, 1, -1), c(-2, 0.2, -0.5, 0.25))
# NOTE that the specification of RE matrix will need to match.
D &lt;- diag(c(0.25, 0.09, 1, 0.33, 0.05))
# Simulate data, and return REs as a sanity check...
mix.REspec.data &lt;- simData(beta = beta, D = D, family = family,
                           gamma = c(-0.5, 1, 0.5), sigma = list(0.15, 0, 0.15),
                           random.formulas = random.formulas, return.ranefs = TRUE)
</code></pre>


</div>