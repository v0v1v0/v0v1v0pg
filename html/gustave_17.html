<div class="container">

<table style="width: 100%;"><tr>
<td>sum_by</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Efficient by-group (weighted) summation</h2>

<h3>Description</h3>

<p><code>sum_by</code> performs an efficient and optionally weighted 
by-group summation by using linear algebra and the Matrix package 
capabilities. The by-group summation is performed through matrix cross-product
of the <code>y</code> parameter (coerced to a matrix if needed) with a (very) sparse
matrix built up using the <code>by</code> and the (optional) <code>w</code> parameters. 
</p>
<p>Compared to base R, dplyr or data.table alternatives, this implementation 
aims at being easier to use in a matrix-oriented context and can yield 
efficiency gains when the number of columns becomes high.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sum_by(y, by, w = NULL, na_rm = TRUE, keep_sparse = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>A (sparse) vector, a (sparse) matrix or a data.frame. 
The object to perform by-group summation on.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>The factor variable defining the by-groups. Character variables
are coerced to factors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>The optional row weights to be used in the summation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na_rm</code></td>
<td>
<p>Should <code>NA</code> values in <code>y</code> be removed (ie treated as 0 in the summation) ? 
Similar to <code>na.rm</code> argument in <code>sum</code>, but <code>TRUE</code> by default. 
If <code>FALSE</code>, <code>NA</code> values in <code>y</code> produce <code>NA</code> values in the result.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep_sparse</code></td>
<td>
<p>When <code>y</code> is a sparse vector or a sparse matrix, should the result
also be sparse ? <code>FALSE</code> by default. As <code>sparseVector-class</code> does
not have a name attribute, when <code>y</code> is a sparseVector the result does not have any
name (and a warning is cast).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A vector, a matrix or a data.frame depending on the type of <code>y</code>. If <code>y</code> is
sparse and <code>keep_sparse = TRUE</code>, then the result is also sparse (without names
when it is a sparse vector, see keep_sparse argument for details).
</p>


<h3>Author(s)</h3>

<p>Martin Chevalier
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Data generation
set.seed(1)
n &lt;- 100
p &lt;- 10
H &lt;- 3
y &lt;- matrix(rnorm(n*p), ncol = p, dimnames = list(NULL, paste0("var", 1:10)))
y[1, 1] &lt;- NA
by &lt;- letters[sample.int(H, n, replace = TRUE)]
w &lt;- rep(1, n)
w[by == "a"] &lt;- 2

# Standard use
sum_by(y, by)

# Keeping the NAs
sum_by(y, by, na_rm = FALSE)

# With a weight
sum_by(y, by, w = w)

</code></pre>


</div>