<div class="container">

<table style="width: 100%;"><tr>
<td>action_renewal</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Gadget3 renewal actions</h2>

<h3>Description</h3>

<p>Add renewal / initialconditions to a g3 model
</p>


<h3>Usage</h3>

<pre><code class="language-R">g3a_renewal_vonb_recl(
        Linf = g3_parameterized('Linf', value = 1, by_stock = by_stock),
        K = g3_parameterized('K', value = 1, by_stock = by_stock),
        recl = g3_parameterized('recl', by_stock = by_stock),
        recage = g3_parameterized('recage', by_stock = FALSE, optimise = FALSE),
        by_stock = TRUE)

g3a_renewal_vonb_t0(
        Linf = g3_parameterized('Linf', value = 1, by_stock = by_stock),
        K = g3_parameterized('K', value = 1, by_stock = by_stock),
        t0 = g3_parameterized('t0', by_stock = by_stock),
        by_stock = TRUE)

g3a_renewal_initabund(
    scalar = g3_parameterized('init.scalar', value = 1, by_stock = by_stock),
    init = g3_parameterized('init', value = 1, by_stock = by_stock, by_age = TRUE),
    M = g3_parameterized('M', by_stock = by_stock, by_age = TRUE),
    init_F = g3_parameterized('init.F', by_stock = by_stock_f),
    recage = g3_parameterized('recage', by_stock = FALSE, optimise = FALSE),
    proportion_f = ~1,
    by_stock = TRUE,
    by_stock_f = FALSE)

g3a_initialconditions(stock, num_f, wgt_f, run_f = ~cur_time == 0L,
        run_at = g3_action_order$initial)

g3a_initialconditions_normalparam(
        stock,
        factor_f = g3a_renewal_initabund(by_stock = by_stock),
        mean_f = g3a_renewal_vonb_t0(by_stock = by_stock),
        stddev_f = g3_parameterized('init.sd', value = 10,
            by_stock = by_stock, by_age = by_age),
        alpha_f = g3_parameterized('walpha', by_stock = wgt_by_stock),
        beta_f = g3_parameterized('wbeta', by_stock = wgt_by_stock),
        age_offset = quote( cur_step_size ),
        by_stock = TRUE,
        by_age = FALSE,
        wgt_by_stock = TRUE,
        run_f = ~cur_time == 0L,
        run_at = g3_action_order$initial)

g3a_initialconditions_normalcv(
        stock,
        factor_f = g3a_renewal_initabund(by_stock = by_stock),
        mean_f = g3a_renewal_vonb_t0(by_stock = by_stock),
        cv_f = g3_parameterized('lencv', by_stock = by_stock, value = 0.1,
            optimise = FALSE),
        alpha_f = g3_parameterized('walpha', by_stock = wgt_by_stock),
        beta_f = g3_parameterized('wbeta', by_stock = wgt_by_stock),
        age_offset = quote( cur_step_size ),
        by_stock = TRUE,
        by_age = FALSE,
        wgt_by_stock = TRUE,
        run_f = ~cur_time == 0L,
        run_at = g3_action_order$initial)

g3a_renewal(stock, num_f, wgt_f, run_f = ~TRUE,
        run_at = g3_action_order$renewal)

g3a_renewal_normalparam(
        stock,
        factor_f = g3_parameterized('rec',
            by_stock = by_stock,
            by_year = TRUE,
            scale = g3_parameterized(
                name = 'rec.scalar',
                by_stock = by_stock),
            ifmissing = NaN),
        mean_f = g3a_renewal_vonb_t0(by_stock = by_stock),
        stddev_f = g3_parameterized('rec.sd', value = 10, by_stock = by_stock),
        alpha_f = g3_parameterized('walpha', by_stock = wgt_by_stock),
        beta_f = g3_parameterized('wbeta', by_stock = wgt_by_stock),
        by_stock = TRUE,
        wgt_by_stock = TRUE,
        run_age = quote(stock__minage),
        run_projection = FALSE,
        run_step = 1,
        run_f = NULL,
        run_at = g3_action_order$renewal)

g3a_renewal_normalcv(
        stock,
        factor_f = g3_parameterized('rec',
            by_stock = by_stock,
            by_year = TRUE,
            scale = g3_parameterized(
                name = 'rec.scalar',
                by_stock = by_stock),
            ifmissing = NaN),
        mean_f = g3a_renewal_vonb_t0(by_stock = by_stock),
        cv_f = g3_parameterized('lencv', by_stock = by_stock, value = 0.1,
            optimise = FALSE),
        alpha_f = g3_parameterized('walpha', by_stock = wgt_by_stock),
        beta_f = g3_parameterized('wbeta', by_stock = wgt_by_stock),
        by_stock = TRUE,
        wgt_by_stock = TRUE,
        run_age = quote(stock__minage),
        run_projection = FALSE,
        run_step = 1,
        run_f = NULL,
        run_at = g3_action_order$renewal)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>stock</code></td>
<td>

<p>The <code>g3_stock</code> to apply to
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_f</code></td>
<td>

<p>formula that produces a lengthgroup vector of number of individuals for the current age/area/... length group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wgt_f</code></td>
<td>

<p>formula that produces a lenghgroup vector of mean weight for the current age/area/... length group.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_at</code></td>
<td>

<p>Integer order that actions will be run within model, see <code>g3_action_order</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>factor_f,mean_f,stddev_f,alpha_f,beta_f</code></td>
<td>

<p>formula substituted into normalparam calcuations, see below.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cv_f</code></td>
<td>

<p>formula substituted into normalcv calcuations, basically <code>stddev_f = mean_f * cv_f</code>, see below.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>age_offset</code></td>
<td>

<p>Replace <code>age</code> with <code>age - age_offset</code> in <var>mean_f</var>. Used to simulate initialconditions at time "-1".
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_age</code></td>
<td>
<p>Age to run renewals for, used as <code>age == (run_age)</code> into default <var>run_f</var></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_projection</code></td>
<td>
<p>Boolean. Run renewal in projection years? If false adds <code>!cur_year_projection</code> into default <var>run_f</var></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_step</code></td>
<td>
<p>Which step to perform renewal in, or <code>NULL</code> for continuous renewal. Adds <code>cur_step == (run_step)</code> into default <var>run_f</var></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_f</code></td>
<td>

<p>formula specifying a condition for running this action,
For initialconditions defaults to first timestep.
For renewal, the default is a combination of <var>run_age</var>, <var>run_step</var> &amp; <var>run_projection</var>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Linf,K,t0,recl</code></td>
<td>
<p>formula substituted into vonb calcuations, see below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recage</code></td>
<td>
<p>formula substituted into initial abundance and vonb calcuations, see below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>proportion_f,scalar,init,M,init_F</code></td>
<td>
<p>formula substituted into initial abundance calcuations, see below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by_stock,wgt_by_stock,by_stock_f,by_age</code></td>
<td>
<p>Controls how parameters are grouped, see <code>g3_parameterized</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A model can have any number of <code>g3a_renewal_*</code> actions, so long as the
calling arguments are different. For instance, <code>run_f = ~age == 5</code> and
<code>run_f = ~age == 7</code>.
</p>
<p>The <code>g3a_renewal_*</code> actions will define the following stock instance variables for <var>stock</var>:
</p>

<dl>
<dt><var>stock__renewalnum</var></dt>
<dd>
<p>Extra individuals added to the stock</p>
</dd>
<dt><var>stock__renewalwgt</var></dt>
<dd>
<p>Mean weight of added individuals</p>
</dd>
</dl>
<h3>Value</h3>



<h4>g3a_renewal_vonb_recl</h4>

<p>A formula object representing
</p>
<p style="text-align: center;"><code class="reqn"> L_{\infty} * {1 - e^{-1 * \kappa * (a - (a_{0} + \frac{\log(1 - L_{0}/L_{\infty})}{\kappa}  ))}} </code>
</p>


<dl>
<dt><code class="reqn">L_{0}</code></dt>
<dd>
<p>Substituted for <var>recl</var></p>
</dd>
<dt><code class="reqn">L_{\infty}</code></dt>
<dd>
<p>Substituted for <var>Linf</var></p>
</dd>
<dt><code class="reqn">\kappa</code></dt>
<dd>
<p>Substituted for <var>K</var></p>
</dd>
<dt><code class="reqn">a_{0}</code></dt>
<dd>
<p>Substituted for <var>recage</var></p>
</dd>
</dl>
<p><strong>NB:</strong> <code>g3a_initialconditions_normalparam</code> will replace <code class="reqn">a</code> with <code class="reqn">a - \Delta{t}</code>, see <var>age_offset</var>
</p>



<h4>g3a_renewal_vonb_t0</h4>

<p>A formula object representing
</p>
<p style="text-align: center;"><code class="reqn"> L_{\infty} * (1 - e^{-1 * \kappa * (a - t_{0}) }) </code>
</p>


<dl>
<dt><code class="reqn">L_{\infty}</code></dt>
<dd>
<p>Substituted for <var>Linf</var></p>
</dd>
<dt><code class="reqn">\kappa</code></dt>
<dd>
<p>Substituted for <var>K</var></p>
</dd>
<dt><code class="reqn">t_{0}</code></dt>
<dd>
<p>Substituted for <var>t0</var></p>
</dd>
</dl>
<p><strong>NB:</strong> <code>g3a_initialconditions_normalparam</code> will replace <code class="reqn">a</code> with <code class="reqn">a - \Delta{t}</code>, see <var>age_offset</var>
</p>



<h4>g3a_renewal_vonb</h4>

<p>An alias for <code>g3a_renewal_vonb_recl</code>()</p>



<h4>g3a_renewal_initabund</h4>

<p>A formula object representing
</p>
<p style="text-align: center;"><code class="reqn"> scalar * init * e^{-1 * (M + F_{0}) * (a - a_{0}) } * proportion </code>
</p>


<dl>
<dt>scalar</dt>
<dd>
<p>Substituted for <var>scalar</var></p>
</dd>
<dt>init</dt>
<dd>
<p>Substituted for <var>init</var></p>
</dd>
<dt><code class="reqn">M</code></dt>
<dd>
<p>Substituted for <var>M</var></p>
</dd>
<dt><code class="reqn">F_{0}</code></dt>
<dd>
<p>Substituted for <var>init_F</var></p>
</dd>
<dt><code class="reqn">a_{0}</code></dt>
<dd>
<p>Substituted for <var>recage</var></p>
</dd>
<dt>proportion</dt>
<dd>
<p>Substituted for <var>proportion</var></p>
</dd>
</dl>
<h4>g3a_initialconditions / g3a_renewal</h4>

<p>An action (i.e. list of formula objects) that will, for the given <var>stock</var>, iterate over each
area/age/etc. combination, and generate a lengthgroup vector of new individuals and weights using
<var>num_f</var> and <var>wgt_f</var>.
</p>
<p>renewal will add fish to the existing collection, whereas initialconditions will assume the stock is currently empty.
</p>



<h4>g3a_initialconditions_normalparam / g3a_renewal_normalparam</h4>

<p>As g3a_initialconditions / g3a_renewal, but the following formulae are used to calculate num/wgt:
</p>
<p style="text-align: center;"><code class="reqn">n = e^{-(\frac{L - \mu}{\sigma})^2 / 2}</code>
</p>

<p style="text-align: center;"><code class="reqn">N = F 10000 \frac{n}{\sum n}</code>
</p>

<p style="text-align: center;"><code class="reqn">W = \alpha L^{\beta}</code>
</p>


<dl>
<dt><code class="reqn">L</code></dt>
<dd>
<p>Midlength of length groups for current area/age/...</p>
</dd>
<dt><code class="reqn">F</code></dt>
<dd>
<p>Substituted for <var>factor_f</var></p>
</dd>
<dt><code class="reqn">\mu</code></dt>
<dd>
<p>Substituted for <var>mean_f</var></p>
</dd>
<dt><code class="reqn">\sigma</code></dt>
<dd>
<p>Substituted for <var>stddev_f</var></p>
</dd>
<dt><code class="reqn">\alpha</code></dt>
<dd>
<p>Substituted for <var>alpha_f</var></p>
</dd>
<dt><code class="reqn">\beta</code></dt>
<dd>
<p>Substituted for <var>beta_f</var></p>
</dd>
</dl>
<h4>g3a_initialconditions_normalcv / g3a_renewal_normalcv</h4>

<p>As g3a_initialconditions / g3a_renewal, but the following formulae are used to calculate num/wgt:
</p>
<p style="text-align: center;"><code class="reqn">n = e^{-(\frac{L - \mu}{\mu * {CV}})^2 / 2}</code>
</p>

<p style="text-align: center;"><code class="reqn">N = F 10000 \frac{n}{\sum n}</code>
</p>

<p style="text-align: center;"><code class="reqn">W = \alpha L^{\beta}</code>
</p>


<dl>
<dt><code class="reqn">L</code></dt>
<dd>
<p>Midlength of length groups for current area/age/...</p>
</dd>
<dt><code class="reqn">F</code></dt>
<dd>
<p>Substituted for <var>factor_f</var></p>
</dd>
<dt><code class="reqn">\mu</code></dt>
<dd>
<p>Substituted for <var>mean_f</var></p>
</dd>
<dt><code class="reqn">CV</code></dt>
<dd>
<p>Substituted for <var>cv_f</var></p>
</dd>
<dt><code class="reqn">\alpha</code></dt>
<dd>
<p>Substituted for <var>alpha_f</var></p>
</dd>
<dt><code class="reqn">\beta</code></dt>
<dd>
<p>Substituted for <var>beta_f</var></p>
</dd>
</dl>
<h3>See Also</h3>

<p><a href="https://gadget-framework.github.io/gadget2/userguide/chap-stock.html#sec:stockinitial">https://gadget-framework.github.io/gadget2/userguide/chap-stock.html#sec:stockinitial</a>,
<a href="https://gadget-framework.github.io/gadget2/userguide/chap-stock.html#sec:stockrenew">https://gadget-framework.github.io/gadget2/userguide/chap-stock.html#sec:stockrenew</a>,
<code>g3_stock</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
ling_imm &lt;- g3_stock('ling_imm', seq(20, 156, 4)) %&gt;% g3s_age(3, 10)

initialconditions_action &lt;- g3a_initialconditions_normalparam(
    ling_imm,
    by_age = TRUE)  # per-age init.sd parameters
renewal_action &lt;- g3a_renewal_normalparam(
    ling_imm,
    run_step = 2)  # Renewal happens in spring

# To get a single ling_imm.lencv parameter instead of init.sd
initialconditions_action &lt;- g3a_initialconditions_normalcv(
    ling_imm)
renewal_action &lt;- g3a_renewal_normalcv(
    ling_imm,
    run_step = 2)  # Renewal happens in spring

## Plots
par(mar = c(4,2,2,1), cex.main = 1)
curve(g3_eval(g3a_renewal_vonb_t0(Linf = 20, K = 0.8, t0 = 0), age = x),
    0, 10, col = 2, xlab = "age", main = "g3a_renewal_vonb_t0(Linf = 20, K = 0.8..1.4, t0 = 0)")
curve(g3_eval(g3a_renewal_vonb_t0(Linf = 20, K = 1.0, t0 = 0), age = x),
    0, 10, col = 1, add = TRUE)
curve(g3_eval(g3a_renewal_vonb_t0(Linf = 20, K = 1.2, t0 = 0), age = x),
    0, 10, col = 3, add = TRUE)
curve(g3_eval(g3a_renewal_vonb_t0(Linf = 20, K = 1.4, t0 = 0), age = x),
    0, 10, col = 4, add = TRUE)

</code></pre>


</div>