<div class="container">

<table style="width: 100%;"><tr>
<td>gam.random</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Specify a Random Effects Fit in a GAM Formula</h2>

<h3>Description</h3>

<p>A symbolic wrapper for a factor term, to specify a random effect term in a
formula argument to gam
</p>


<h3>Usage</h3>

<pre><code class="language-R">gam.random(f, y, w, df = sum(non.zero), lambda = 0, intercept = TRUE, xeval)

random(f, df = NULL, lambda = 0, intercept = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>factor variable, or expression that evaluates to a factor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a response variable passed to <code>gam.random</code> during backfitting</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>the target equivalent degrees of freedom, used as a smoothing
parameter. The real smoothing parameter (<code>lambda</code> below) is found such
that <code>df=tr(S)</code>, where <code>S</code> is the implicit smoother matrix. Values
for <code>df</code> should be greater than <code>0</code> and less than the number of
levels of <code>f</code>.  If both <code>df</code> and <code>lambda</code> are supplied, the
latter takes precedence. Note that <code>df</code> is not necessarily an integer.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>the non-negative penalty parameter. This is interpreted as a
variance ratio in a mixed effects model - namely the ratio of the noise
variance to the random-effect variance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intercept</code></td>
<td>
<p>if <code>intercept=TRUE</code> (the default) then the estimated
level effects are centered to average zero, otherwise they are left alone.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xeval</code></td>
<td>
<p>If this argument is present, then <code>gam.random</code> produces a
prediction at <code>xeval</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This "smoother" takes a factor as input and returns a shrunken-mean fit.  If
<code>lambda=0</code>, it simply computes the mean of the response at each level
of <code>f</code>. With <code>lambda&gt;0</code>, it returns a shrunken mean, where the
j'th level is shrunk by <code>nj/(nj+lambda)</code>, with <code>nj</code> being the
number of observations (or sum of their weights) at level <code>j</code>. Using
such smoother(s) in gam is formally equivalent to fitting a mixed-effect
model by generalized least squares.
</p>


<h3>Value</h3>

<p><code>random</code> returns the vector <code>f</code>, endowed with a number of
attributes. The vector itself is used in computing the means in backfitting,
while the attributes are needed for the backfitting algorithms
<code>general.wam</code>. Note that <code>random</code> itself does no smoothing; it
simply sets things up for <code>gam</code>.
</p>
<p>One important attribute is named <code>call</code>. For example, <code>random(f,
lambda=2)</code> has a call component <code>gam.random(data[["random(f, lambda =
2)"]], z, w, df = NULL, lambda = 2, intercept = TRUE)</code>. This is an
expression that gets evaluated repeatedly in <code>general.wam</code> (the
backfitting algorithm).
</p>
<p><code>gam.random</code> returns an object with components </p>
<table>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>The
residuals from the smooth fit. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nl.df</code></td>
<td>
<p>the degrees of freedom</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var</code></td>
<td>
<p>the pointwise variance for the fit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>the value of
<code>lambda</code> used in the fit</p>
</td>
</tr>
</table>
<p> When <code>gam.random</code> is evaluated with an
<code>xeval</code> argument, it returns a vector of predictions.
</p>


<h3>Author(s)</h3>

<p>Written by Trevor Hastie, following closely the design in the
"Generalized Additive Models" chapter (Hastie, 1992) in Chambers and Hastie
(1992).
</p>


<h3>References</h3>

<p>Hastie, T. J. (1992) <em>Generalized additive models.</em> Chapter
7 of <em>Statistical Models in S</em> eds J. M. Chambers and T. J. Hastie,
Wadsworth &amp; Brooks/Cole.
</p>
<p>Hastie, T. and Tibshirani, R. (1990) <em>Generalized Additive Models.</em>
London: Chapman and Hall.
</p>
<p>Cantoni, E. and hastie, T. (2002) Degrees-of-freedom tests for smoothing
splines, <em>Biometrika</em> 89(2), 251-263
</p>


<h3>See Also</h3>

<p><code>lo</code>, <code>s</code>, <code>bs</code>,
<code>ns</code>, <code>poly</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# fit a model with a linear term in Age and a random effect in the factor Level
y ~ Age + random(Level, lambda=1)
 
</code></pre>


</div>