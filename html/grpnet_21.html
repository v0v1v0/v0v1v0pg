<div class="container">

<table style="width: 100%;"><tr>
<td>rk.model.matrix</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Construct Design Matrices via Reproducing Kernels
</h2>

<h3>Description</h3>

<p>Creates a design (or model) matrix using the <code>rk</code> function to expand variables via a reproducing kernel basis. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">rk.model.matrix(object, data = environment(object), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>

<p>a <code>formula</code> or <code>terms</code> object describing the fit model
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>

<p>a data frame containing the variables referenced in <code>object</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>additional arguments passed to the <code>rk</code> function, e.g., <code>df</code>, <code>knots</code>, <code>m</code>, etc. Arguments must be passed as a named list, see Examples.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Designed to be a more flexible alternative to the <code>model.matrix</code> function. The <code>rk</code> function is used to construct a marginal basis for each variable that appears in the input <code>object</code>. Tensor product interactions are formed by taking a <code>row.kronecker</code> product of marginal basis matrices. Interactions of any order are supported using standard formulaic conventions, see Note.
</p>


<h3>Value</h3>

<p>The design matrix corresponding to the input formula and data, which has the following attributes:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>assign</code></td>
<td>
<p>an integer vector with an entry for each column in the matrix giving the term in the formula which gave rise to the column</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>term.labels</code></td>
<td>
<p>a character vector containing the labels for each of the terms in the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>a named list giving the knots used for each variable in the formula</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>
<p>a named list giving the penalty order used for each variable in the formula</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>periodic</code></td>
<td>
<p>a named list giving the periodicity used for each variable in the formula</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlev</code></td>
<td>
<p>a named list giving the factor levels used for each variable in the formula</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>For formulas of the form <code>y ~ x + z</code>, the constructed model matrix has the form <code>cbind(rk(x), rk(z))</code>, which simply concatenates the two marginal basis matrices. For formulas of the form <code>y ~ x : z</code>, the constructed model matrix has the form <code>row.kronecker(rk(x), rk(z))</code>, where <code>row.kronecker</code> denotes the row-wise kronecker product. The formula <code>y ~ x * z</code> is a shorthand for <code>y ~ x + z + x : z</code>, which concatenates the two previous results. Unless it is suppressed (using <code>0+</code>), the first column of the basis will be a column of ones named <code>(Intercept)</code>.
</p>


<h3>Author(s)</h3>

<p>Nathaniel E. Helwig &lt;helwig@umn.edu&gt;
</p>


<h3>References</h3>

<p>Helwig, N. E. (2017). Regression with ordered predictors via ordinal smoothing splines. Frontiers in Applied Mathematics and Statistics, 3(15), 1-13. <a href="https://doi.org/10.3389/fams.2017.00015">doi:10.3389/fams.2017.00015</a>
</p>
<p>Helwig, N. E. (2021). Spectrally sparse nonparametric regression via elastic net regularized smoothers. Journal of Computational and Graphical Statistics, 30(1), 182-191. <a href="https://doi.org/10.1080/10618600.2020.1806855">doi:10.1080/10618600.2020.1806855</a>
</p>
<p>Helwig, N. E. (2024). Precise tensor product smoothing via spectral splines. Stats, 7(1), 34-53. <a href="https://doi.org/10.3390/stats7010003">doi:10.3390/stats7010003</a>
</p>


<h3>See Also</h3>

<p>See <code>rk</code> for details on the reproducing kernel basis
</p>


<h3>Examples</h3>

<pre><code class="language-R"># load auto data
data(auto)

# additive effects
x &lt;- rk.model.matrix(mpg ~ ., data = auto)
dim(x)                      # check dimensions
attr(x, "assign")           # check group assignments
attr(x, "term.labels")      # check term labels

# two-way interactions
x &lt;- rk.model.matrix(mpg ~ . * ., data = auto)
dim(x)                      # check dimensions
attr(x, "assign")           # check group assignments
attr(x, "term.labels")      # check term labels

# specify df for horsepower, weight, and acceleration
# note: default df = 5 is used for displacement and model.year
df &lt;- list(horsepower = 6, weight = 7, acceleration = 8)
x &lt;- rk.model.matrix(mpg ~ ., data = auto, df = df)
sapply(attr(x, "knots"), length)   # check df

# specify knots for model.year
# note: default knots are selected for other variables
knots &lt;- list(model.year = c(1970, 1974, 1978, 1982))
x &lt;- rk.model.matrix(mpg ~ ., data = auto, knots = knots)
sapply(attr(x, "knots"), length)   # check df

</code></pre>


</div>