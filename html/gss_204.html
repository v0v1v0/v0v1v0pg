<div class="container">

<table style="width: 100%;"><tr>
<td>sshzd</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimating Hazard Function Using Smoothing Splines</h2>

<h3>Description</h3>

<p>Estimate hazard function using smoothing spline ANOVA models.  The
symbolic model specification via <code>formula</code> follows the same
rules as in <code>lm</code>, but with the response of a special
form.
</p>


<h3>Usage</h3>

<pre><code class="language-R">sshzd(formula, type=NULL, data=list(), alpha=1.4, weights=NULL,
      subset, offset, na.action=na.omit, partial=NULL, id.basis=NULL,
      nbasis=NULL, seed=NULL, random=NULL, prec=1e-7, maxiter=30,
      skip.iter=FALSE)

sshzd1(formula, type=NULL, data=list(), alpha=1.4, weights=NULL,
       subset, na.action=na.omit, rho="marginal", partial=NULL,
       id.basis=NULL, nbasis=NULL, seed=NULL, random=NULL, prec=1e-7,
       maxiter=30, skip.iter=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Symbolic description of the model to be fit, where
the response is of the form <code>Surv(futime,status,start=0)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>List specifying the type of spline for each variable.
See <code>mkterm</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Optional data frame containing the variables in the
model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Parameter defining cross-validation score for smoothing
parameter selection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>Optional vector of counts for duplicated data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>Optional vector specifying a subset of observations
to be used in the fitting process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>Optional offset term with known parameter 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>Function which indicates what should happen when
the data contain NAs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>partial</code></td>
<td>
<p>Optional symbolic description of parametric terms in
partial spline models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id.basis</code></td>
<td>
<p>Index of observations to be used as "knots."</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbasis</code></td>
<td>
<p>Number of "knots" to be used.  Ignored when
<code>id.basis</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Seed to be used for the random generation of "knots."
Ignored when <code>id.basis</code> is specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random</code></td>
<td>
<p>Input for parametric random effects (frailty) in
nonparametric mixed-effect models.  See <code>mkran</code> for
details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prec</code></td>
<td>
<p>Precision requirement for internal iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>Maximum number of iterations allowed for
internal iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>skip.iter</code></td>
<td>
<p>Flag indicating whether to use initial values of
theta and skip theta iteration.  See <code>ssanova</code> for
notes on skipping theta iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rho</code></td>
<td>
<p>Choice of rho function for sshzd1: <code>"marginal"</code> or
<code>"weibull"</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The model specification via <code>formula</code> is for the log hazard.
For example, <code>Suve(t,d)~t*u</code> prescribes a model of the form
</p>
<p style="text-align: center;"><code class="reqn">
	log f(t,u) = C + g_{t}(t) + g_{u}(u) + g_{t,u}(t,u)
    </code>
</p>

<p>with the terms denoted by <code>"1"</code>, <code>"t"</code>, <code>"u"</code>, and
<code>"t:u"</code>.  Replacing <code>t*u</code> by <code>t+u</code> in the
<code>formula</code>, one gets a proportional hazard model with
<code class="reqn">g_{t,u}=0</code>.
</p>
<p><code>sshzd</code> takes standard right-censored lifetime data, with
possible left-truncation and covariates; in
<code>Surv(futime,status,start=0)~...</code>, <code>futime</code> is the  
follow-up time, <code>status</code> is the censoring indicator, and
<code>start</code> is the optional left-truncation time.  The main effect
of <code>futime</code> must appear in the model terms specified via
<code>...</code>.
</p>
<p>Parallel to those in a <code>ssanova</code> object, the model terms
are sums of unpenalized and penalized terms.  Attached to every
penalized term there is a smoothing parameter, and the model
complexity is largely determined by the number of smoothing
parameters.
</p>
<p>The selection of smoothing parameters is through a cross-validation
mechanism described in Gu (2002, Sec. 7.2), with a parameter
<code>alpha</code>; <code>alpha=1</code> is "unbiased" for the minimization of
Kullback-Leibler loss but may yield severe undersmoothing, whereas
larger <code>alpha</code> yields smoother estimates.
</p>
<p>A subset of the observations are selected as "knots."  Unless
specified via <code>id.basis</code> or <code>nbasis</code>, the number of
"knots" <code class="reqn">q</code> is determined by <code class="reqn">max(30,10n^{2/9})</code>, which is
appropriate for the default cubic splines for numerical vectors.
</p>


<h3>Value</h3>

<p><code>sshzd</code> returns a list object of class <code>"sshzd"</code>.
<code>sshzd1</code> returns a list object of class
<code>c("sshzd1","sshzd")</code>.
</p>
<p><code>hzdrate.sshzd</code> can be used to evaluate the estimated
hazard function.  <code>hzdcurve.sshzd</code> can be used to
evaluate hazard curves with fixed covariates.
<code>survexp.sshzd</code> can be used to calculated estimated
expected survival.
</p>
<p>The method <code>project.sshzd</code> can be used to calculate the
Kullback-Leibler projection of <code>"sshzd"</code> objects for model
selection; <code>project.sshzd1</code> can be used to calculate the
square error projection of <code>"sshzd1"</code> objects.
</p>


<h3>Note</h3>

<p>The function <code>Surv(futime,status,start=0)</code> is defined and
parsed inside <code>sshzd</code>, not quite the same as the one in the
<code>survival</code> package.
</p>
<p>Integration on the time axis is done by the 200-point Gauss-Legendre
formula on <code>c(min(start),max(futime))</code>, returned from
<code>gauss.quad</code>.
</p>
<p><code>sshzd1</code> can be up to 50 times faster than <code>sshzd</code>, at the
cost of performance degradation.
</p>
<p>The results may vary from run to run.  For consistency, specify
<code>id.basis</code> or set <code>seed</code>.
</p>


<h3>References</h3>

<p>Du, P. and Gu, C. (2006), Penalized likelihood hazard estimation:
efficient approximation and Bayesian confidence intervals.
<em>Statistics and Probability Letters</em>, <b>76</b>, 244–254.
</p>
<p>Du, P. and Gu, C. (2009), Penalized Pseudo-Likelihood Hazard
Estimation: A Fast Alternative to Penalized Likelihood.
<em>Journal of Statistical Planning and Inference</em>, <b>139</b>,
891–899.
</p>
<p>Du, P. and Ma, S. (2010), Frailty Model with Spline Estimated
Nonparametric Hazard Function, <em>Statistica Sinica</em>, <b>20</b>,
561–580.
</p>
<p>Gu, C. (2013), <em>Smoothing Spline ANOVA Models (2nd Ed)</em>.  New
York: Springer-Verlag.
</p>
<p>Gu, C. (2014), Smoothing Spline ANOVA Models: R Package gss.
<em>Journal of Statistical Software</em>, 58(5), 1-25. URL
http://www.jstatsoft.org/v58/i05/.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Model with interaction
data(gastric)
gastric.fit &lt;- sshzd(Surv(futime,status)~futime*trt,data=gastric)
## exp(-Lambda(600)), exp(-(Lambda(1200)-Lambda(600))), and exp(-Lambda(1200))
survexp.sshzd(gastric.fit,c(600,1200,1200),data.frame(trt=as.factor(1)),c(0,600,0))
## Clean up
## Not run: rm(gastric,gastric.fit)
dev.off()
## End(Not run)

## THE FOLLOWING EXAMPLE IS TIME-CONSUMING
## Proportional hazard model
## Not run: 
data(stan)
stan.fit &lt;- sshzd(Surv(futime,status)~futime+age,data=stan)
## Evaluate fitted hazard
hzdrate.sshzd(stan.fit,data.frame(futime=c(10,20),age=c(20,30)))
## Plot lambda(t,age=20)
tt &lt;- seq(0,60,leng=101)
hh &lt;- hzdcurve.sshzd(stan.fit,tt,data.frame(age=20))
plot(tt,hh,type="l")
## Clean up
rm(stan,stan.fit,tt,hh)
dev.off()

## End(Not run)
</code></pre>


</div>