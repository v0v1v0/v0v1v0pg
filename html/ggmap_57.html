<div class="container">

<table style="width: 100%;"><tr>
<td>qmplot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Quick map plot</h2>

<h3>Description</h3>

<p><code>qmplot()</code> is the ggmap equivalent to the ggplot2 function qplot and allows
for the quick plotting of maps with data/models/etc.
</p>


<h3>Usage</h3>

<pre><code class="language-R">qmplot(
  x,
  y,
  ...,
  data,
  zoom,
  source = "stadia",
  maptype = "stamen_toner_lite",
  extent = "device",
  legend = "right",
  padding = 0.02,
  force = FALSE,
  darken = c(0, "black"),
  mapcolor = "color",
  facets = NULL,
  margins = FALSE,
  geom = "auto",
  stat = list(NULL),
  position = list(NULL),
  xlim = c(NA, NA),
  ylim = c(NA, NA),
  main = NULL,
  f = 0.05,
  xlab = "Longitude",
  ylab = "Latitude"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>longitude values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>latitude values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other aesthetics passed for each layer</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data frame to use (optional).  If not specified, will create one,
extracting vectors from the current environment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zoom</code></td>
<td>
<p>map zoom, see <code>get_map()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>source</code></td>
<td>
<p>map source, see <code>get_map()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maptype</code></td>
<td>
<p>map type, see <code>get_map()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extent</code></td>
<td>
<p>how much of the plot should the map take up? "normal", "panel",
or "device" (default)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>"left", "right" (default), "bottom", "top", "bottomleft",
"bottomright", "topleft", "topright", "none" (used with extent = "device")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>padding</code></td>
<td>
<p>distance from legend to corner of the plot  (used with extent
= "device")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>force</code></td>
<td>
<p>force new map (don't use archived version)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>darken</code></td>
<td>
<p>vector of the form c(number, color), where number is in (0,1)
and color is a character string indicating the color of the darken.  0
indicates no darkening, 1 indicates a black-out.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mapcolor</code></td>
<td>
<p>color ("color") or black-and-white ("bw")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>facets</code></td>
<td>
<p>faceting formula to use.  Picks <code>facet_wrap()</code> or
<code>facet_grid()</code> depending on whether the formula is one sided or two-sided</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>margins</code></td>
<td>
<p>whether or not margins will be displayed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>geom</code></td>
<td>
<p>character vector specifying geom to use.  defaults to "point"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stat</code></td>
<td>
<p>character vector specifying statistics to use</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>position</code></td>
<td>
<p>character vector giving position adjustment to use</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>limits for x axis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>limits for y axis</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>main</code></td>
<td>
<p>character vector or expression for plot title</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>number specifying the fraction by which the range should be extended</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>character vector or expression for x axis label</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>character vector or expression for y axis label</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">
## Not run:  # these are skipped to conserve R check time

qmplot(lon, lat, data = crime)


# only violent crimes
violent_crimes &lt;- subset(crime,
  offense != "auto theft" &amp;
  offense != "theft" &amp;
  offense != "burglary"
)

# rank violent crimes
violent_crimes$offense &lt;- factor(
  violent_crimes$offense,
  levels = c("robbery", "aggravated assault", "rape", "murder")
)

# restrict to downtown
violent_crimes &lt;- subset(violent_crimes,
  -95.39681 &lt;= lon &amp; lon &lt;= -95.34188 &amp;
   29.73631 &lt;= lat &amp; lat &lt;=  29.78400
)

theme_set(theme_bw())

qmplot(lon, lat, data = violent_crimes, colour = offense,
  size = I(3.5), alpha = I(.6), legend = "topleft")

qmplot(lon, lat, data = violent_crimes, geom = c("point","density2d"))
qmplot(lon, lat, data = violent_crimes) + facet_wrap(~ offense)
qmplot(lon, lat, data = violent_crimes, extent = "panel") + facet_wrap(~ offense)
qmplot(lon, lat, data = violent_crimes, extent = "panel", colour = offense, darken = .4) +
  facet_wrap(~ month)




qmplot(long, lat, xend = long + delta_long,
  color = I("red"), yend = lat + delta_lat, data = seals,
  geom = "segment", zoom = 5)

qmplot(long, lat, xend = long + delta_long, maptype = "stamen_watercolor",
  yend = lat + delta_lat, data = seals,
  geom = "segment", zoom = 6)

qmplot(long, lat, xend = long + delta_long, maptype = "stamen_terrain",
  yend = lat + delta_lat, data = seals,
  geom = "segment", zoom = 6)


qmplot(lon, lat, data = wind, size = I(.5), alpha = I(.5)) +
  ggtitle("NOAA Wind Report Sites")

# thin down data set...
s &lt;- seq(1, 227, 8)
thinwind &lt;- subset(wind,
  lon %in% unique(wind$lon)[s] &amp;
  lat %in% unique(wind$lat)[s]
)

# for some reason adding arrows to the following plot bugs
theme_set(theme_bw(18))

qmplot(lon, lat, data = thinwind, geom = "tile", fill = spd, alpha = spd,
    legend = "bottomleft") +
  geom_leg(aes(xend = lon + delta_lon, yend = lat + delta_lat)) +
  scale_fill_gradient2("Wind Speed\nand\nDirection",
    low = "green", mid = scales::muted("green"), high = "red") +
  scale_alpha("Wind Speed\nand\nDirection", range = c(.1, .75)) +
  guides(fill = guide_legend(), alpha = guide_legend())




## kriging
############################################################
# the below examples show kriging based on undeclared packages
# to better comply with CRAN's standards, we remove it from
# executing, but leave the code as a kind of case-study
# they also require the rgdal library


library(lattice)
library(sp)
library(rgdal)

# load in and format the meuse dataset (see bivand, pebesma, and gomez-rubio)
data(meuse)
coordinates(meuse) &lt;- c("x", "y")
proj4string(meuse) &lt;- CRS("+init=epsg:28992")
meuse &lt;- spTransform(meuse, CRS("+proj=longlat +datum=WGS84"))

# plot
plot(meuse)

m &lt;- data.frame(slot(meuse, "coords"), slot(meuse, "data"))
names(m)[1:2] &lt;- c("lon", "lat")

qmplot(lon, lat, data = m)
qmplot(lon, lat, data = m, zoom = 14)


qmplot(lon, lat, data = m, size = zinc,
  zoom = 14, source = "google", maptype = "satellite",
  alpha = I(.75), color = I("green"),
  legend = "topleft", darken = .2
) + scale_size("Zinc (ppm)")








# load in the meuse.grid dataset (looking toward kriging)
library(gstat)
data(meuse.grid)
coordinates(meuse.grid) &lt;- c("x", "y")
proj4string(meuse.grid) &lt;- CRS("+init=epsg:28992")
meuse.grid &lt;- spTransform(meuse.grid, CRS("+proj=longlat +datum=WGS84"))

# plot it
plot(meuse.grid)

mg &lt;- data.frame(slot(meuse.grid, "coords"), slot(meuse.grid, "data"))
names(mg)[1:2] &lt;- c("lon", "lat")

qmplot(lon, lat, data = mg, shape = I(15), zoom = 14, legend = "topleft") +
  geom_point(aes(size = zinc), data = m, color = "green") +
  scale_size("Zinc (ppm)")



# interpolate at unobserved locations (i.e. at meuse.grid points)
# pre-define scale for consistency
scale &lt;- scale_color_gradient("Predicted\nZinc (ppm)",
  low = "green", high = "red", lim = c(100, 1850)
)



# inverse distance weighting
idw &lt;- idw(log(zinc) ~ 1, meuse, meuse.grid, idp = 2.5)
mg$idw &lt;- exp(slot(idw, "data")$var1.pred)

qmplot(lon, lat, data = mg, shape = I(15), color = idw,
  zoom = 14, legend = "topleft", alpha = I(.75), darken = .4
) + scale



# linear regression
lin &lt;- krige(log(zinc) ~ 1, meuse, meuse.grid, degree = 1)
mg$lin &lt;- exp(slot(lin, "data")$var1.pred)

qmplot(lon, lat, data = mg, shape = I(15), color = lin,
  zoom = 14, legend = "topleft", alpha = I(.75), darken = .4
) + scale



# trend surface analysis
tsa &lt;- krige(log(zinc) ~ 1, meuse, meuse.grid, degree = 2)
mg$tsa &lt;- exp(slot(tsa, "data")$var1.pred)

qmplot(lon, lat, data = mg, shape = I(15), color = tsa,
  zoom = 14, legend = "topleft", alpha = I(.75), darken = .4
) + scale



# ordinary kriging
vgram &lt;- variogram(log(zinc) ~ 1, meuse)   # plot(vgram)
vgramFit &lt;- fit.variogram(vgram, vgm(1, "Exp", .2, .1))
ordKrige &lt;- krige(log(zinc) ~ 1, meuse, meuse.grid, vgramFit)
mg$ordKrige &lt;- exp(slot(ordKrige, "data")$var1.pred)

qmplot(lon, lat, data = mg, shape = I(15), color = ordKrige,
  zoom = 14, legend = "topleft", alpha = I(.75), darken = .4
) + scale



# universal kriging
vgram &lt;- variogram(log(zinc) ~ 1, meuse) # plot(vgram)
vgramFit &lt;- fit.variogram(vgram, vgm(1, "Exp", .2, .1))
univKrige &lt;- krige(log(zinc) ~ sqrt(dist), meuse, meuse.grid, vgramFit)
mg$univKrige &lt;- exp(slot(univKrige, "data")$var1.pred)

qmplot(lon, lat, data = mg, shape = I(15), color = univKrige,
  zoom = 14, legend = "topleft", alpha = I(.75), darken = .4
) + scale



# adding observed data layer
qmplot(lon, lat, data = mg, shape = I(15), color = univKrige,
  zoom = 14, legend = "topleft", alpha = I(.75), darken = .4
) +
  geom_point(
    aes(x = lon, y = lat, size = zinc),
    data = m, shape = 1, color = "black"
  ) +
  scale +
  scale_size("Observed\nLog Zinc")







## End(Not run) # end dontrun

</code></pre>


</div>