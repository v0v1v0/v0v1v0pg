<div class="container">

<table style="width: 100%;"><tr>
<td>CompoundAuxVarest</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Variance Estimation under the Compound GB2 Distribution Using Auxiliary Information
</h2>

<h3>Description</h3>

<p>Calculation of variance estimates of the parameters of the compound GB2 distribution and of the estimated compound GB2 indicators under a complex survey design (see package <code>survey</code>).  
</p>


<h3>Usage</h3>

<pre><code class="language-R">scoreU.cavgb2(fac, z, lambda) 
scorez.cavgb2(U,z)
varscore.cavgb2(SC, w=rep(1,dim(SC)[1]))
desvar.cavgb2(data=data, SC=SC, ids=NULL, probs=NULL, strata = NULL, variables = NULL,
fpc=NULL, nest = FALSE, check.strata = !nest, weights=NULL, pps=FALSE, 
variance=c("HT","YG"))
hess.cavgb2(U, P, z, w=rep(1, dim(z)[1]))
vepar.cavgb2(ml, Vsc, hess)
veind.cavgb2(group, vepar, shape1, scale, shape2, shape3, pl0, P, decomp="r")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fac</code></td>
<td>
<p>numeric; a matrix of Gamma factors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>numeric; a matrix of auxiliary variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>numeric; a matrix of parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>U</code></td>
<td>
<p>numeric; a matrix of scores <code class="reqn">U_{k,\ell}</code> (output of the <code>scoreU.cavgb2</code> function).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SC</code></td>
<td>
<p>numeric; scores, output of <code>scorez.cavgb2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>numeric; vector of extrapolation weights. By default <code>w</code> is a vector of 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>dataset containing the design information per unit</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ids, probs, strata, variables, fpc, nest, check.strata, weights, pps, variance</code></td>
<td>
<p>parameters of <code>svydesign</code>.</p>
</td>
</tr>
</table>
<table><tr style="vertical-align: top;">
<td><code>P</code></td>
<td>
<p>numeric; matrix of mixture probabilities (output of <code>pkl.cavgb2</code>).</p>
</td>
</tr></table>
<table>
<tr style="vertical-align: top;">
<td><code>ml</code></td>
<td>
<p>numeric; estimated values of the vector of v's. Output of the <code>ml.cavgb2</code> function (the second element in the list).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Vsc</code></td>
<td>
<p>numeric; 4 by 4 matrix. Variance of the scores <code>SC</code>, computed in <code>varscore.cavgb2</code> or with the design information in <code>desvar.cavgb2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hess</code></td>
<td>
<p>numeric; Hessian (bread) for the sandwich variance estimate (output of <code>hess.cavgb2</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>numeric; a factor variable of the same length as the sample size giving the group membership in the special case when the auxiliary information defines group membership.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vepar</code></td>
<td>
<p>numeric; output of <code>vepar.cavgb2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shape1, scale ,shape2, shape3</code></td>
<td>
<p>numeric; positive parameters of the GB2 distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pl0</code></td>
<td>
<p>numeric; a vector of initial proportions defining the number of components and the weight of each component density in the decomposition. Sums to one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>decomp</code></td>
<td>
<p>string; specifying if the decomposition of the GB2 is done with respect to the right tail ("r") or the left tail ("l") of the distribution.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <code class="reqn">N \times L</code> matrix of fitted mixture probabilities <code>P</code><code class="reqn">=(p_{k,\ell})</code> depends on the <code class="reqn">N \times I</code> matrix <code>z</code> of auxiliary variables. 
<code>P</code> has as many distinct rows as there are distinct rows in <code>z</code>. The <code class="reqn">N \times L</code> matrix  of gamma factors <code>fac</code><code class="reqn">=F</code>, output of <code>fg.cgb2</code> depends on the vector of initial 
probabilities <code class="reqn">p_{0,\ell}</code> only. The <code class="reqn">N \times (L-1)</code> matrix of scores <code>U</code> is defined as </p>
<p style="text-align: center;"><code class="reqn">U(k,\ell)=p_{k,\ell} \left( \frac{F(k,\ell)}{\sum_{j=1}^L p_{k,j}\, F(k,j)} - 1\right).</code>
</p>
 
<p>The linearized scores are the columns of a <code class="reqn">N \times I(L-1)</code> matrix </p>
<p style="text-align: center;"><code class="reqn">SC(k,\,I(\ell-1)+i)= U(k,\ell) \,  z(k,i).</code>
</p>
 
<p>Function <code>varscore.cavgb2</code> calculates the middle term of the sandwich variance estimator, that is the <code class="reqn">(I(L-1) \times I(L-1))</code> estimated variance-covariance matrix of the <code class="reqn">I(L-1)</code>
weighted sums of  the columns of <code class="reqn">SC</code>, without design information. 
<code>desvar.cavgb2</code> calculates the design-based variance-covariance matrix of the <code class="reqn">I(L-1)</code> weighted sums of the columns of <code class="reqn">SC</code>, invoking <code>svydesign</code> and <code>svytotal</code> of package <code>survey</code>. 
<code>hess.cavgb2</code> calculates the Hessian (<code class="reqn">I(L-1) \times I(L-1)</code> matrix of second derivatives of the pseudo-log-likelihood with respect to the parameters). It should be negative definite. 
If not, the maximum likelihood estimates are spurious. <code>vepar.cavgb2</code> calculates the sandwich variance estimate of the vectorized matrix of parameters <code>lambda</code>.
<code>veind.cavgb2</code> calculates estimates, std error, covariance and correlation matrices of the indicators under the compound GB2 with auxiliary variables in the particular 
case where the unique combinations of the auxiliary variables define a small number of groups. Group membership is specified by the vector <code>group</code> of length <code class="reqn">N</code>.
</p>


<h3>Value</h3>

<p><code>scoreU.cavgb2</code> returns a <code class="reqn">N \times (L-1)</code> matrix of scores <code>U</code>. 
<code>scorez.cavgb2</code> returns a <code class="reqn">N \times I(L-1)</code> matrix whose columns are the linearized scores <code>SC</code>. 
<code>varscore.cavgb2</code> returns the variance-covariance estimate of the weighted sums of scores <code>SC</code>, given by weighted cross products. 
<code>desvar.cavgb2</code> returns a list of two elements. The first is the output of svytotal and the second is the design-based variance-covariance matrix of the 
weighted sums of the scores SC. 
<code>hess.cavgb2</code> returns the matrix of second derivatives of the likelihood with respect to the parameters (bread for the sandwich variance estimate). 
<code>vepar.cavgb2</code> returns a list of five elements - [["type"]] with value "parameter", [["estimate"]] estimated parameters, [["stderr"]] corresponding standard errors, [["Vcov"]] variance -covariance matrix and [["Vcor"]] - correlation matrix. 
<code>veind.cavgb2</code> returns a list of five elements: [["type"]] with value "indicator", followed by a list with as many arguments as <code>length(levels(group))</code>. Each argument is itself a list with 5
arguments: [["group"]] group name, [["estimate"]] estimated indicators under the compound GB2, [["stderr"]] corresponding standard errors, [["Vcov"]] variance -covariance matrix and [["Vcor"]] - correlation matrix.
</p>


<h3>Author(s)</h3>

<p>Monique Graf and Desislava Nedyalkova
</p>


<h3>References</h3>

<p>Davison, A. (2003),
<em>Statistical Models</em>.
Cambridge University Press.
</p>
<p>Freedman, D. A. (2006),
On The So-Called "Huber Sandwich Estimator" and "Robust Standard Errors".
<em>The American Statistician</em>, <b>60</b>, 299–302.
</p>
<p>Graf, M., Nedyalkova, D., Muennich, R., Seger, J. and Zins, S. (2011)
AMELI Deliverable 2.1: Parametric Estimation of Income Distributions and
Indicators of Poverty and Social Exclusion.
<em>Technical report</em>, AMELI-Project.
</p>
<p>Pfeffermann, D. and Sverchkov, M. Yu. (2003),
Fitting Generalized Linear Models under Informative Sampling.
In, Skinner, C.J. and Chambers, R.L. (eds.). 
<em>Analysis of Survey Data</em>, chapter 12, 175–195.
Wiley, New York.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Example (following of example in CompoundAuxFit)

# Scores U 
U &lt;- scoreU.cavgb2(facgl, z, lambdafitl)

# Scores multiplied by z
SC &lt;- scorez.cavgb2(U,z)

# Naive variance estimate of sum of scores
(Vsc &lt;- varscore.cavgb2(SC,w=pwa))

# Design based variance of sum of scores
(desv &lt;- desvar.cavgb2(data=ns,SC=SC,id=~hid,strata=~region,weights=~pwa))

# Hessian
hess &lt;- hess.cavgb2(U,pglfitl,z,w=pwa) 

# 1. Sandwich variance-covariance matrix estimate of parameters using Vsc:
Param1 &lt;- vepar.cavgb2(fitcml,Vsc, hess)
Param1

# 2. Sandwich variance-covariance matrix estimate of parameters using 
# the design variance:
Param2 &lt;- vepar.cavgb2(fitcml,desv$Vtheta, hess)
Param2 

# 3. Indicators and conditional variances : takes a long time!
(Indic &lt;- veind.cavgb2(group,Param2 ,agl.fit,bgl.fit,pgl.fit,qgl.fit, 
                       pl0, pglfitl, decomp="l") )

## End(Not run)
</code></pre>


</div>