<div class="container">

<table style="width: 100%;"><tr>
<td>getResidualCov.gllvm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Extract residual covariance matrix from gllvm object</h2>

<h3>Description</h3>

<p>Calculates the residual covariance matrix for gllvm model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'gllvm'
getResidualCov(object, adjust = 1, site.index = NULL, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>an object of class 'gllvm'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adjust</code></td>
<td>
<p>The type of adjustment used for  negative binomial, binomial and normal distribution when computing residual correlation matrix. Options are 0 (no adjustment), 1 (the default adjustment) and 2 (alternative adjustment for NB distribution), see details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>site.index</code></td>
<td>
<p>A site index, vector of length one or 1, that is used in the calculation of a GLLVM with quadratic response model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>not used.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Residual covariance matrix, storing information on species co-occurrence that is not explained by the environmental variables (if included), is calculated using the matrix of latent variables loadings, that is, <code class="reqn">\Theta\Theta'</code>, and the dispersion parameter related to the distribution of choice, is applicable (e.g. in the case of negative-binomial distributed responses).
</p>
<p>When the responses are modelled using the negative binomial distribution, the residual variances for each species must be adjusted for overdispersion. The two possible adjustment terms are <code class="reqn">log(\phi_j + 1)</code> (<code>adjust = 1</code>) and <code class="reqn">\psi^{(1)}(1/\phi_j)</code> (<code>adjust = 2</code>), where <code class="reqn">\psi^{(1)}</code> is the trigamma function.
</p>
<p>The negative binomial model can be written using different parameterizations. 
The residual covariance with <code>adjust = 1</code> can be obtained using the lognormal-Poisson parametrization, that is,
</p>
<p style="text-align: center;"><code class="reqn">Y_{ij} \sim Poisson(\mu_{ij} \lambda_j),</code>
</p>

<p>where <code class="reqn">\lambda_j \sim lognormal(-\sigma^2/2, \sigma^2)</code> and <code class="reqn">\sigma^2 = log(\phi_j + 1)</code> and <code class="reqn">log(\mu_{ij}) = \eta_{ij}</code>. Now <code class="reqn">E[Y_{ij}] = \mu_{ij}</code> and variance <code class="reqn">V(\mu_{ij}) = \mu_{ij} + \mu_{ij}^2 (exp(\sigma^2) - 1) = \mu_{ij} + \mu_{ij}^2 \phi_j</code>, which are the same as for the NB distribution.
Therefore, on linear predictor scale, we have the variance 
</p>
<p style="text-align: center;"><code class="reqn">V(log(\mu_{ij} \lambda_j)) = V(log\mu_{ij}) + V(log\lambda_j) = V(u_i'\theta_j) + \sigma^2 = \theta_j'\theta_j + log(\phi_j + 1).</code>
</p>

<p>which leads to the residual covariance matrix <code class="reqn">\Theta \Theta' + \Psi</code>, where <code class="reqn">\Psi</code> is the diagonal matrix with <code class="reqn">log(\phi_j + 1)</code> as diagonal elements (<code>adjust = 1</code>).
</p>
<p>Or, for a GLLVM where species are a quadratic function of the latent variables, we instead have
</p>
<p style="text-align: center;"><code class="reqn">V(log(\mu_{ij} \lambda_j)) = V(log\mu_{ij}) + V(log\lambda_j) = V(u_i'\theta_j-u_i' D_j u_i) + \sigma^2 </code>
</p>

<p style="text-align: center;"><code class="reqn"> = \theta_j'\theta_j + 2diag(D_j)'diag(D_j)log(\phi_j + 1).</code>
</p>

<p>which leads to the residual covariance matrix <code class="reqn">\Theta \Theta' + 2 \Gamma_j \Gamma_j' + diag(\Phi)</code>, where <code class="reqn">\Gamma_j</code> holds the quadratic coefficients.
Since the quadratic coefficients are constrained to be positive, the residual covariance in the latter case is, given the same coefficients on the linear term, equal or more positive than in the linear case.
</p>
<p>The residual covariance matrix with <code>adjust = 2</code> can be obtained by using Poisson-Gamma parametri-zation
</p>
<p style="text-align: center;"><code class="reqn">Y_{ij} \sim Poisson(\mu_{ij} \lambda_j),</code>
</p>

<p>where <code class="reqn">\lambda_j \sim Gamma(1/\phi_j, 1/\phi_j)</code> and <code class="reqn">\mu_{ij}</code> is as above. The mean and the variance are of similar form as above and we have that
</p>
<p style="text-align: center;"><code class="reqn">V(log(\mu_{ij} \lambda_j)) = V(log\mu_{ij}) + V(log\lambda_j) = \theta_j'\theta_j + \psi^{(1)}(1/\phi_j),</code>
</p>

<p>where <code class="reqn">\psi^{(1)}</code> is the trigamma function.
</p>
<p>In the case of binomial distribution, the adjustment terms (<code>adjust = 1</code>) are 1 for probit link and <code class="reqn">\pi^2/3</code> for logit link.
These are obtained by treating binomial model as latent variable model. Assume
</p>
<p style="text-align: center;"><code class="reqn">Y^*_{ij} = \eta_{ij} + e_{ij},</code>
</p>

<p>where <code class="reqn">e_{ij} \sim N(0, 1)</code> for probit model, and <code class="reqn">e_{ij} \sim logistic(0, 1)</code> for logit model.
Then binary response is defined as <code class="reqn">Y_{ij} = 1</code>, if <code class="reqn">Y^*_{ij} &gt; 0</code> and 0 otherwise.
Now we have that <code class="reqn">\mu_{ij} = P(Y_{ij} = 1) = P(Y^*_{ij} &gt; 0) = P(\eta_{ij} &gt; -e_{ij}) = P(e_{ij} &lt;= \eta_{ij})</code> which leads to probit and logit models.
On linear predictor scale we then have that
</p>
<p style="text-align: center;"><code class="reqn">V(\eta_{ij} + e_{ij}) = V(\eta_{ij}) + V(e_{ij}).</code>
</p>

<p>For the probit model, the residual covariance matrix is then <code class="reqn">\Theta\Theta' + I_m</code>, and for the logit model <code class="reqn">\Theta\Theta' + \pi^2/3 I_m</code>.
Similarly as above, for a GLLVM where species are a quadratic function of the latent variables, the term <code class="reqn">2\Gamma_j\Gamma_j'</code> is added to the residual covariance matrix.
</p>
<p>For normal distribution, we can write
</p>
<p style="text-align: center;"><code class="reqn">Y_{ij} = \eta_{ij} + e_{ij},</code>
</p>

<p>where <code class="reqn">e_{ij} \sim N(0, \phi_j^2)</code> and thus we have that
</p>
<p style="text-align: center;"><code class="reqn">V(\eta_{ij} + e_{ij}) = V(\eta_{ij}) + V(e_{ij}).</code>
</p>

<p>For the gaussian model, the residual covariance matrix is then <code class="reqn">\Theta\Theta' + diag(\Phi^2)</code>.
</p>


<h3>Value</h3>

<p>Function returns following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>cov </code></td>
<td>
<p>residual covariance matrix</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace </code></td>
<td>
<p>trace of the residual covariance matrix, the total variance explained</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.q </code></td>
<td>
<p>trace of the residual covariance matrix per latent variable, variance explained per latent variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.q2 </code></td>
<td>
<p>trace of the squared term of the residual covariance matrix per latent variable, for quadratic responses. Variance explained per latent variable by the quadratic term</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Francis K.C. Hui, Jenni Niku, David I. Warton, Bert van der Veen
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Load a dataset from the mvabund package
data(antTraits)
y &lt;- as.matrix(antTraits$abund)
# Fit gllvm model
fit &lt;- gllvm(y = y, family = poisson())
# residual covariance:
rescov &lt;- getResidualCov(fit)
rescov$cov
# Trace of the covariance matrix
rescov$trace
# Variance explained per latent variable
rescov$var.q

## End(Not run)
</code></pre>


</div>