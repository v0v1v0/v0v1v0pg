<div class="container">

<table style="width: 100%;"><tr>
<td>GaussSuppressionTwoWay</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Two-way iteration variant of <code>GaussSuppressionFromData</code>
</h2>

<h3>Description</h3>

<p>Internally, data is organized in a two-way table.
</p>
<p>Use parameter <code>colVar</code> to choose hierarchies for columns (others will be rows). Iterations start by column by column suppression.
The algorithm utilizes <code>HierarchyCompute2</code>.
</p>
<p>With two-way iterations, larger data can be handled, but there is a residual risk.
The method is a special form of linked-table iteration.
Separately, the rows and columns are protected by <code>GaussSuppression</code> and they have common suppressed cells.
</p>


<h3>Usage</h3>

<pre><code class="language-R">GaussSuppressionTwoWay(
  data,
  dimVar = NULL,
  freqVar = NULL,
  numVar = NULL,
  weightVar = NULL,
  charVar = NULL,
  hierarchies,
  formula = NULL,
  maxN = suppressWarnings(formals(c(primary)[[1]])$maxN),
  protectZeros = suppressWarnings(formals(c(primary)[[1]])$protectZeros),
  secondaryZeros = suppressWarnings(formals(candidates)$secondaryZeros),
  candidates = CandidatesDefault,
  primary = PrimaryDefault,
  forced = NULL,
  hidden = NULL,
  singleton = SingletonDefault,
  singletonMethod = ifelse(secondaryZeros, "anySumNOTprimary", "anySum"),
  printInc = TRUE,
  output = "publish",
  preAggregate = is.null(freqVar),
  colVar = names(hierarchies)[1],
  removeEmpty = TRUE,
  inputInOutput = TRUE,
  candidatesFromTotal = TRUE,
  structuralEmpty = FALSE,
  freqVarNew = rev(make.unique(c(names(data), "freq")))[1],
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Input data as a data frame</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dimVar</code></td>
<td>
<p>The main dimensional variables and additional aggregating variables. This parameter can be  useful when hierarchies and formula are unspecified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freqVar</code></td>
<td>
<p>A single variable holding counts (name or number).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numVar</code></td>
<td>
<p>Other numerical variables to be aggregated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weightVar</code></td>
<td>
<p>weightVar Weights (costs) to be used to order candidates for secondary suppression</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>charVar</code></td>
<td>
<p>Other variables possibly to be used within the supplied functions</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hierarchies</code></td>
<td>
<p>List of hierarchies, which can be converted by <code>AutoHierarchies</code>.
Thus, the variables can also be coded by <code>"rowFactor"</code> or <code>""</code>, which correspond to using the categories in the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A model formula</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxN</code></td>
<td>
<p>Suppression parameter. See <code>GaussSuppressionFromData</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>protectZeros</code></td>
<td>
<p>Suppression parameter. See <code>GaussSuppressionFromData</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>secondaryZeros</code></td>
<td>
<p>Suppression parameter. See <code>GaussSuppressionFromData</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>candidates</code></td>
<td>
<p>GaussSuppression input or a function generating it (see details) Default: <code>CandidatesDefault</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>primary</code></td>
<td>
<p>GaussSuppression input or a function generating it (see details) Default: <code>PrimaryDefault</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>forced</code></td>
<td>
<p>GaussSuppression input or a function generating it (see details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hidden</code></td>
<td>
<p>GaussSuppression input or a function generating it (see details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>singleton</code></td>
<td>
<p>NULL or a function generating GaussSuppression input (logical vector not possible) Default: <code>SingletonDefault</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>singletonMethod</code></td>
<td>
<p><code>GaussSuppression</code> input</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>printInc</code></td>
<td>
<p><code>GaussSuppression</code> input</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>One of <code>"publish"</code> (default), <code>"inner"</code>.
Here "inner" means input data (possibly pre-aggregated).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>preAggregate</code></td>
<td>
<p>When <code>TRUE</code>, the data will be aggregated within the function to an appropriate level.
This is defined by the dimensional variables according to <code>dimVar</code>, <code>hierarchies</code> or <code>formula</code> and in addition <code>charVar</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colVar</code></td>
<td>
<p>Hierarchy variables for the column groups (others in row group).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>removeEmpty</code></td>
<td>
<p>When TRUE (default) empty output corresponding to empty input is removed.
When NULL, removal only within the algorithm (x  matrices) so that such empty outputs are never secondary suppressed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inputInOutput</code></td>
<td>
<p>Logical vector (possibly recycled) for each element of hierarchies.
TRUE means that codes from input are included in output. Values corresponding to <code>"rowFactor"</code> or <code>""</code> are ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>candidatesFromTotal</code></td>
<td>
<p>When TRUE (default), same candidates for all rows and for all columns, computed from row/column totals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>structuralEmpty</code></td>
<td>
<p>See <code>GaussSuppressionFromData</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freqVarNew</code></td>
<td>
<p>Name of new frequency variable generated when input <code>freqVar</code> is NULL and <code>preAggregate</code> is TRUE.
Default is <code>"freq"</code> provided this is not found in <code>names(data)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments to be passed to the supplied functions.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The supplied functions for generating <code>GaussSuppression</code> input behave as in <code>GaussSuppressionFromData</code> with some exceptions.
When <code>candidatesFromTotal</code> is <code>TRUE</code> (default) the candidate function will be run locally once for rows and once for columns. Each time based on column or row totals.
The global x-matrix will only be generated if one of the functions supplied needs it.
Non-NULL singleton can only be supplied as a function. This function will be run locally within the algorithm before each call to <code>GaussSuppression</code>.
</p>
<p>Note that a difference from <code>GaussSuppressionFromData</code> is that parameter <code>removeEmpty</code> is set to <code>TRUE</code> by default.
</p>
<p>Another difference is that duplicated combinations is not allowed. Normally duplicates are avoided by setting <code>preAggregate</code> to <code>TRUE</code>.
When the <code>charVar</code> parameter is used, this can still be a problem. See the examples for a possible workaround.
</p>


<h3>Value</h3>

<p>Aggregated data with suppression information
</p>


<h3>Examples</h3>

<pre><code class="language-R">z3 &lt;- SSBtoolsData("z3")

dimListsA &lt;- SSBtools::FindDimLists(z3[, 1:6])
dimListsB &lt;- SSBtools::FindDimLists(z3[, c(1, 4, 5)])

set.seed(123)
z &lt;- z3[sample(nrow(z3),250),]

## Not run: 
out1 &lt;- GaussSuppressionTwoWay(z, freqVar = "ant", hierarchies = dimListsA, 
                               colVar = c("hovedint"))

## End(Not run)                                
out2 &lt;- GaussSuppressionTwoWay(z, freqVar = "ant", hierarchies = dimListsA, 
                               colVar = c("hovedint", "mnd"))
out3 &lt;- GaussSuppressionTwoWay(z, freqVar = "ant", hierarchies = dimListsB, 
                               colVar = c("region"))
out4 &lt;- GaussSuppressionTwoWay(z, freqVar = "ant", hierarchies = dimListsB, 
                               colVar = c("hovedint", "region"))
                               
# "mnd" not in  hierarchies -&gt; duplicated combinations in input 
# Error when  preAggregate is FALSE: Index method failed. Duplicated combinations?
out5 &lt;- GaussSuppressionTwoWay(z, freqVar = "ant", hierarchies = dimListsA[1:3], 
                               protectZeros = FALSE, colVar = c("hovedint"), preAggregate = TRUE)


# charVar needed -&gt; Still problem when preAggregate is TRUE
# Possible workaround by extra hierarchy 
out6 &lt;- GaussSuppressionTwoWay(z, freqVar = "ant", charVar = "mnd2",
                               hierarchies = c(dimListsA[1:3], mnd2 = "Total"), # include charVar 
                               inputInOutput = c(TRUE, TRUE, FALSE),  # FALSE -&gt; only Total 
                               protectZeros = FALSE, colVar = c("hovedint"),
                               preAggregate = TRUE,  
                               hidden = function(x, data, charVar, ...) 
                                 as.vector((t(x) %*% as.numeric(data[[charVar]] == "M06M12")) == 0))                                
</code></pre>


</div>