<div class="container">

<table style="width: 100%;"><tr>
<td>gestSingle</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>G-Estimation for an End of Study Outcome</h2>

<h3>Description</h3>

<p>Performs g-estimation of a structural nested mean model (SNMM), based on the outcome regression methods described
in Sjolander and Vansteelandt (2016) and Dukes and Vansteelandt (2018). We expect a dataset that holds an end of study outcome that is either binary or continuous,
time-varying and/or baseline confounders, and a time-varying exposure that is either binary, continuous or categorical.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gestSingle(
  data,
  idvar,
  timevar,
  Yn,
  An,
  Cn = NA,
  outcomemodels,
  propensitymodel,
  censoringmodel = NULL,
  type,
  EfmVar = NA,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame in long format containing the data to be analysed. See description for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>idvar</code></td>
<td>
<p>Character string specifying the name of the ID variable in the data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>timevar</code></td>
<td>
<p>Character string specifying the name of the time variable in the data.
Note that timevar must specify time periods as integer values starting from 1 (must not begin at 0).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Yn</code></td>
<td>
<p>Character string specifying the name of the end of study outcome variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>An</code></td>
<td>
<p>Character string specifying the name of the time-varying exposure variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Cn</code></td>
<td>
<p>Optional character string specifying the name of the censoring indicator variable. The variable specified in Cn should be a numeric vector taking values 0 or 1, with 1 indicating censored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcomemodels</code></td>
<td>
<p>a list of formulas or formula objects specifying the outcome models for Yn prior to adjustment by propensity score.
The i'th entry of the list specifies the outcome model for the counterfactuals up to time i. See description for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>propensitymodel</code></td>
<td>
<p>A formula or formula object specifying the propensity score model for An.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censoringmodel</code></td>
<td>
<p>A formula or formula object specifying the censoring model for Cn.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Value from 1-4 specifying SNMM type to fit. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>EfmVar</code></td>
<td>
<p>Character string specifying the name of the effect modifying variable for types 2 or 4.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments, currently not in use.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Given a time-varying exposure variable, <code class="reqn">A_t</code> and time-varying confounders, <code class="reqn">L_t</code> measured over time periods <code class="reqn">t=1,\ldots,T</code>, and an end of study outcome <code class="reqn">Y</code>
measured at time <code class="reqn">T+1</code>, <code>gest</code> estimates the causal parameters <code class="reqn">\psi</code> of a SNMM of the form
</p>
<p style="text-align: center;"><code class="reqn">E(Y(\bar{a}_{t},0)-Y(\bar{a}_{t-1},0)|\bar{a}_{t-1},\bar{l}_{t})=\psi z_ta_t \;\forall\; t=1,\ldots,T</code>
</p>

<p>if Y is continuous or
</p>
<p style="text-align: center;"><code class="reqn">\frac{E(Y(\bar{a}_{t},0)|\bar{a}_{t-1},\bar{l}_{t})}{E(Y(\bar{a}_{t-1},0)|\bar{a}_{t-1},\bar{l}_{t})}=exp(\psi z_ta_t)\;\forall\; t=1,\ldots,T </code>
</p>

<p>if Y is binary. The SNMMs form is defined by the parameter <code class="reqn">z_t</code>, which can be controlled by the input <code>type</code> as follows
</p>

<ul>
<li>
<p><code>type=1</code> sets <code class="reqn">z_t=1</code>. This implies that <code class="reqn">\psi</code> is the effect of exposure at any time t on Y.
</p>
</li>
<li>
<p><code>type=2</code> sets <code class="reqn">z_t=c(1,l_t)</code>, and adds affect modification by <code>EfmVar</code>, which we denote <code class="reqn">L_t</code>.
Now <code class="reqn">\psi=c(\psi_0,\psi_1)</code> where <code class="reqn">\psi_0</code> is the effect of exposure at any time t on Y when <code class="reqn">l_t=0</code> for all t, modified by
<code class="reqn">\psi_1</code> for each unit increase in <code class="reqn">l_t</code> at all times t. Note that effect modification
is currently only supported for binary (written as a numeric 0,1 vector) or continuous confounders.
</p>
</li>
<li> <p><code>type=3</code> allows for time-varying causal effects. It sets <code class="reqn">z_t</code> to a vector of zeros of length T with a 1 in the t'th position. Now <code class="reqn">\psi=c(\psi_1,\ldots,\psi_T)</code>
where <code class="reqn">\psi_t</code> is the effect of <code class="reqn">A_t</code> on Y.
</p>
</li>
<li>
<p><code>type=4</code> allows for a time-varying causal effect that can be modified by <code>EfmVar</code>, denoted <code class="reqn">l_t</code>, that is it allows for both time-varying effects and effect modification. It sets <code class="reqn">z_t</code> to a vector of zeros of length T with <code class="reqn">c(1,l_t)</code> in the t'th position.
Now <code class="reqn">\psi=(\underline{\psi_1},\ldots,\underline{\psi_T})</code> where <code class="reqn">\underline{\psi_t}=c(\psi_{0t},\psi_{1t})</code>. Here <code class="reqn">\psi_{0t}</code> is the effect of exposure at time t on Y when <code class="reqn">l_t=0</code> modified by
<code class="reqn">\psi_{1t}</code> for each unit increase in <code class="reqn">l_t</code>. Note that effect modification
is currently only supported for binary (written as a numeric 0,1 vector) or continuous confounders.
</p>
</li>
</ul>
<p>The data must be in long format, where we assume the convention that each row with <code>time=t</code> contains <code class="reqn">A_t,L_t</code> and <code class="reqn">C_{t+1}</code> and <code class="reqn">Y_{T+1}</code>. Thus the censoring indicator for each row
should indicate that a user is censored AFTER time t. The end of study outcome <code class="reqn">Y_{T+1}</code> should be repeated on each row. If either A or Y are binary, they must be written as numeric vectors taking values either 0 or 1.
The same is true for any covariate that is used for effect modification.<br>
The data must be rectangular with a row entry for every individual for each exposure time 1 up to T. Data rows after censoring should be empty apart from the ID and time variables. This can be done using the function <code>FormatData</code>.<br>
The input outcomemodels should be a list with T elements (the number of exposure times), where element i describes the outcome model for the counterfactuals at time i.
</p>


<h3>Value</h3>

<p>List of the fitted causal parameters of the posited SNMM. These are labeled as follows for each SNMM type, where <code>An</code> is
set to the name of the exposure variable, i is the current time period, and and EfmVar is the effect modifying variable.
</p>
<table>
<tr style="vertical-align: top;">
<td>
<code>type=1</code> </td>
<td>
<p><code>An</code>: The effect of exposure at any time t on outcome. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>type=2</code> </td>
<td>
<p><code>An</code>: The effect of exposure at any time t on outcome, when <code>EfmVar</code> is set to zero.<br><code>An:EfmVar</code>: The effect modification by <code>EfmVar</code>, the additional effect of A on Y for each unit increase in <code>EfmVar</code></p>
</td>
</tr>
</table>
<p>.
</p>
<table>
<tr style="vertical-align: top;">
<td>
<code>type=3</code> </td>
<td>
<p><code>t=i.An</code>: The effect of exposure at time t=i on outcome.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>type=4</code> </td>
<td>
<p><code>t=i.An</code>: The effect of exposure at time t=i on outcome, when <code>EfmVar</code> is set to zero.<br><code>t=i.An:EfmVar</code>: The effect modification by <code>EfmVar</code>, the additional effect of A on Y at time t=i for each unit increase in <code>EfmVar</code>.</p>
</td>
</tr>
</table>
<p>The function also returns a summary of the propensity scores and censoring scores via <code>PropensitySummary</code> and <code>CensoringSummary</code>,
along with <code>Data</code>, holding the original dataset with the propensity and censoring scores as a tibble dataset.
</p>


<h3>References</h3>

<p>Vansteelandt, S., &amp; Sjolander, A. (2016). Revisiting g-estimation of the Effect of a Time-varying Exposure Subject to Time-varying Confounding, Epidemiologic Methods, 5(1), 37-56. &lt;doi:10.1515/em-2015-0005&gt;.
</p>
<p>Dukes, O., &amp; Vansteelandt, S. (2018). A Note on g-Estimation of Causal Risk Ratios, American Journal of Epidemiology, 187(5), 1079â€“1084. &lt;doi:10.1093/aje/kwx347&gt;.
</p>


<h3>Examples</h3>

<pre><code class="language-R">datas &lt;- dataexamples(n = 1000, seed = 123, Censoring = FALSE)
data &lt;- datas$datagest
data &lt;- FormatData(
  data = data, idvar = "id", timevar = "time", An = "A",
  varying = c("Y", "A", "L"), GenerateHistory = TRUE, GenerateHistoryMax = 1
)
idvar &lt;- "id"
timevar &lt;- "time"
Yn &lt;- "Y"
An &lt;- "A"
Cn &lt;- NA
outcomemodels &lt;- list("Y~A+L+U+Lag1A", "Y~A+L+U+Lag1A", "Y~A+L+U+Lag1A")
propensitymodel &lt;- c("A~L+U+as.factor(time)+Lag1A")
censoringmodel &lt;- NULL
EfmVar &lt;- NA
gestSingle(data, idvar, timevar, Yn, An, Cn, outcomemodels, propensitymodel,
censoringmodel = NULL, type = 1, EfmVar)

# Example with censoring
datas &lt;- dataexamples(n = 1000, seed = 123, Censoring = TRUE)
data &lt;- datas$datagest
data &lt;- FormatData(
  data = data, idvar = "id", timevar = "time", An = "A", Cn = "C",
  varying = c("Y", "A", "L"), GenerateHistory = TRUE, GenerateHistoryMax = 1
)
Cn &lt;- "C"
EfmVar &lt;- "L"
outcomemodels &lt;- list("Y~A+L+U+A:L+Lag1A", "Y~A+L+U+A:L+Lag1A", "Y~A+L+U+A:L")
censoringmodel &lt;- c("C~L+U+as.factor(time)")
gestSingle(data, idvar, timevar, Yn, An, Cn, outcomemodels, propensitymodel,
censoringmodel = censoringmodel, type = 2, EfmVar)
</code></pre>


</div>