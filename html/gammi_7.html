<div class="container">

<table style="width: 100%;"><tr>
<td>predict.gammi</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Predict Method for gammi Fits
</h2>

<h3>Description</h3>

<p>Obtain predictions from a fit generalized additive mixed model (gammi) object. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'gammi'
predict(object, 
        newx,
        newdata, 
        se.fit = FALSE,
        type = c("link", "response", "terms"),
        conf.int = FALSE, 
        conf.level = 0.95,
        ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>

<p>Object of class "gammi"
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newx</code></td>
<td>

<p>Matrix of new <code>x</code> scores for prediction (default S3 method). Must have <code class="reqn">p</code> columns arranged in the same order as the <code>x</code> matrix used to fit the model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>

<p>Data frame of new data scores for prediction (S3 "formula" method). Must contain all variables in the <code>formula</code> (and <code>fixed</code> formula if applicable) used to fit the model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.fit</code></td>
<td>

<p>Logical indicating whether standard errors of predictions should be returned.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>

<p>Type of prediction to return: link = linear prediction, response = fitted value, and terms = matrix where each columns contains each term's linear predictor contribution.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.int</code></td>
<td>

<p>Logical indicating whether confidence intervals for predictions should be returned.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>

<p>Scalar between 0 and 1 controlling the confidence level for the interval. Ignored if <code>conf.int = FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Additional arugments (ignored).  
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The default of <code>type = "link"</code> returns the model implied linear predictor corresponding to <code>newx</code> or <code>newdata</code>, i.e., 
</p>
<p style="text-align: center;"><code class="reqn">g(\hat{\boldsymbol\mu}_{\theta (\mathrm{new}) }) = \hat{f}_\theta(\mathbf{X}_\mathrm{new}, \mathbf{Z}_\mathrm{new}) + \mathbf{X}_\mathrm{new}^\top \hat{\boldsymbol\beta}_\theta</code>
</p>

<p>where <code class="reqn">\hat{f}_\theta(\cdot)</code> is the estimated smooth function (with the subscript of <code class="reqn">\theta</code> denoting the dependence on the variance parameters), and <code class="reqn">\hat{\boldsymbol\beta}_\theta</code> are the fixed effect estimates (if applicable). Note that <code class="reqn">\mathbf{X}_\mathrm{new}</code> and <code class="reqn">\mathbf{Z}_\mathrm{new}</code> denote the new data at which the predictions will be formed.
</p>
<p>Using <code>type = "response"</code> returns the predictions on the fitted value scale, i.e.,
</p>
<p style="text-align: center;"><code class="reqn">\hat{\boldsymbol\mu}_{\theta (\mathrm{new})} = g^{-1} \left( \hat{f}_\theta(\mathbf{X}_\mathrm{new}, \mathbf{Z}_\mathrm{new}) + \mathbf{X}_\mathrm{new}^\top \hat{\boldsymbol\beta}_\theta \right)</code>
</p>

<p>where <code class="reqn">g^{-1}(\cdot)</code> denotes the inverse of the chosen link function.
</p>
<p>Using <code>type = "terms"</code> returns a matrix where each column contains the linear predictor contribution for a different model term, i.e., the <code class="reqn">k</code>-th column contains
</p>
<p style="text-align: center;"><code class="reqn">\hat{f}_{\theta k}(\mathbf{X}_\mathrm{new}, \mathbf{Z}_\mathrm{new}) + \mathbf{X}_{\mathrm{new} k }^\top \hat{\boldsymbol\beta}_{\theta k}</code>
</p>

<p>where <code class="reqn">\hat{f}_{\theta k}</code> is the <code class="reqn">k</code>-th additive function, i.e., <code class="reqn">\hat{f}_\theta(\mathbf{X}_\mathrm{new}, \mathbf{Z}_\mathrm{new}) = \sum_{k=1}^K \hat{f}_{\theta k}(\mathbf{X}_\mathrm{new}, \mathbf{Z}_\mathrm{new})</code> and the second term denotes the (optional) fixed-effect contribution for the <code class="reqn">k</code>-th term, i.e., <code class="reqn">\mathbf{X}_\mathrm{new}^\top \hat{\boldsymbol\beta}_\theta = \sum_{k=1}^K \mathbf{X}_{\mathrm{new} k }^\top \hat{\boldsymbol\beta}_{\theta k}</code>
</p>


<h3>Value</h3>

<p>If <code>type = "link"</code> or <code>type = "response"</code>, returns either a vector (of predictions corresponding to the new data) or a data frame that contains the predictions, along with their standard errors and/or confidence interval endpoints (as controlled by <code>se.fit</code> and <code>conf.int</code> arguments).
</p>
<p>If <code>type = "terms"</code>, returns either a matrix (with columns containing predictions for each term) or a list that contains the term-wise predictions, along with their standard errors and/or confidence interval endpoints (as controlled by <code>se.fit</code> and <code>conf.int</code> arguments).
</p>


<h3>Note</h3>

<p>Terms entered through the <code>random</code> argument of the <code>gammi</code> function are <b>not</b> included as a part of predictions.
</p>


<h3>Author(s)</h3>

<p>Nathaniel E. Helwig &lt;helwig@umn.edu&gt;
</p>


<h3>References</h3>

<p>Helwig, N. E. (2024). Precise tensor product smoothing via spectral splines. <em>Stats, 7</em>(1), 34-53, <a href="https://doi.org/10.3390/stats7010003">doi:10.3390/stats7010003</a>
</p>


<h3>See Also</h3>

<p><code>gammi</code> for fitting generalized additive mixed models
</p>
<p><code>plot.gammi</code> for plotting effects from <code>gammi</code> objects
</p>
<p><code>summary.gammi</code> for summarizing results from <code>gammi</code> objects
</p>


<h3>Examples</h3>

<pre><code class="language-R"># mean function
eta &lt;- function(x, z, additive = TRUE){
  mx1 &lt;- cos(2 * pi * (x - pi))
  mx2 &lt;- 30 * (z - 0.6)^5
  mx12 &lt;- 0
  if(!additive) mx12 &lt;- sin(pi * (x - z))
  mx1 + mx2 + mx12
}

# generate mean function
set.seed(1)
n &lt;- 1000
nsub &lt;- 50
x &lt;- runif(n)
z &lt;- runif(n)
fx &lt;- eta(x, z)

# generate random intercepts
subid &lt;- factor(rep(paste0("sub", 1:nsub), n / nsub),
                levels = paste0("sub", 1:nsub))
u &lt;- rnorm(nsub, sd = sqrt(1/2))

# generate responses
y &lt;- fx + u[subid] + rnorm(n, sd = sqrt(1/2))

# fit model via formula method
mod &lt;- gammi(y ~ x + z, random = ~ (1 | subid))
mod

# get fitted values via predict
fit &lt;- predict(mod, newdata = data.frame(x = x, z = z))
max(abs(fit - mod$fitted.values))

# get fitted values with SE and CI
fit &lt;- predict(mod, newdata = data.frame(x = x, z = z), conf.int = TRUE)
head(fit)

# get fitted values with SE and CI for each term
fit &lt;- predict(mod, newdata = data.frame(x = x, z = z), 
               type = "terms", conf.int = TRUE)
str(fit)                                  # list with 4 components
head(sapply(fit, function(x) x[,1]))      # for x effect
head(sapply(fit, function(x) x[,2]))      # for z effect
</code></pre>


</div>