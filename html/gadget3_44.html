<div class="container">

<table style="width: 100%;"><tr>
<td>action_spawn</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Gadget3 spawning action</h2>

<h3>Description</h3>

<p>Add spawning to a g3 model
</p>


<h3>Usage</h3>

<pre><code class="language-R">g3a_spawn_recruitment_fecundity(p0, p1, p2, p3, p4)

g3a_spawn_recruitment_simplessb(mu)

g3a_spawn_recruitment_ricker(mu, lambda)

g3a_spawn_recruitment_bevertonholt(mu, lambda)

g3a_spawn_recruitment_hockeystick(r0, blim)

g3a_spawn(
        stock,
        recruitment_f,
        proportion_f = 1,
        mortality_f = 0,
        weightloss_f = 0,
        output_stocks = list(),
        output_ratios = rep(1 / length(output_stocks), times = length(output_stocks)),
        mean_f = g3a_renewal_vonb_t0(by_stock = by_stock),
        stddev_f = g3_parameterized('rec.sd', value = 10, by_stock = by_stock),
        alpha_f = g3_parameterized('walpha', by_stock = wgt_by_stock),
        beta_f = g3_parameterized('wbeta', by_stock = wgt_by_stock),
        by_stock = TRUE,
        wgt_by_stock = TRUE,
        run_f = ~TRUE,
        run_at = g3_action_order$spawn,
        recruit_at = g3_action_order$renewal)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>p0,p1,p2,p3,p4</code></td>
<td>
<p>Substituted into <code>g3a_spawn_recruitment_fecundity</code> formula, see below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu,lambda,r0,blim</code></td>
<td>
<p>Substituted into <code>g3a_spawn_recruitment_*</code> formula, see below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stock</code></td>
<td>

<p>The mature <code>g3_stock</code> that will spawn in this action.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recruitment_f</code></td>
<td>

<p>A list of formula generated by one of the <code>g3a_spawn_recruitment_*</code> functions, containing
</p>

<dl>
<dt>s</dt>
<dd>
<p>Formula run for each subset of stock</p>
</dd>
<dt>r</dt>
<dd>
<p>Final formula for calculating number of recruits for spawning action</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>proportion_f</code></td>
<td>

<p>formula generated by one of the g3_suitability_* functions, describing
the proportion of stock that will spawn at this timestep.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mortality_f</code></td>
<td>

<p>formula generated by one of the g3_suitability_* functions, describing
the proportion of spawning stock that will die during spawning.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weightloss_f</code></td>
<td>

<p>formula generated by one of the g3_suitability_* functions, describing
the overall weight loss during spawning.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_stocks</code></td>
<td>

<p>List of <code>g3_stock</code>s that will be spawned into.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_ratios</code></td>
<td>

<p>Vector of proportions for how to distribute into <var>output_stocks</var>, summing to 1, default evenly spread.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mean_f,stddev_f,alpha_f,beta_f</code></td>
<td>

<p>formula substituted into stock structure calculations, see g3a_renewal_normalparam for details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_f</code></td>
<td>

<p>formula specifying a condition for running this action, default always runs.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_at</code></td>
<td>

<p>Integer order that spawning actions will be run within model, see <code>g3_action_order</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recruit_at</code></td>
<td>

<p>Integer order that recruitment from spawning will be run within model, see <code>g3_action_order</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by_stock,wgt_by_stock</code></td>
<td>
<p>Controls how parameters are grouped, see <code>g3_parameterized</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>To restrict spawning to a particular step in a year, or a particular area, use <var>run_f</var>.
For example:
</p>

<dl>
<dt><code>cur_step == 1</code></dt>
<dd>
<p>Spawning will happen on first step of every year</p>
</dd>
<dt><code>cur_step == 1 &amp;&amp; cur_year &gt;= 1990</code></dt>
<dd>
<p>Spawning will happen on first step of every year after 1990</p>
</dd>
<dt><code>cur_step == 2 &amp;&amp; area = 1</code></dt>
<dd>
<p>Spawning will happen on second step of every year, in the first area</p>
</dd>
</dl>
<p>The action will define the following stock instance variables for each given <var>stock</var> and <var>output_stock</var>:
</p>

<dl>
<dt><var>stock__spawnprop</var></dt>
<dd>
<p>Proportion of (stock) that are spawning in this spawning event</p>
</dd>
<dt><var>stock__spawningnum</var></dt>
<dd>
<p>Numbers of (stock) that are spawning in this spawning event</p>
</dd>
<dt><var>output_stock__spawnednum</var></dt>
<dd>
<p>Numbers of (output_stock) that will be produced in this spawning event</p>
</dd>
</dl>
<h3>Value</h3>



<h4>g3a_spawn_recruitment_fecundity</h4>

<p>A pair of formula objects:
</p>
<p style="text-align: center;"><code class="reqn"> S = l ^{p_{1}} a^{p_{2}} (p N_{al})^{p_{3}} W_{al}^{p_{4}} </code>
</p>

<p style="text-align: center;"><code class="reqn"> R = p_{0} S </code>
</p>


<dl>
<dt><code class="reqn">N_{al}</code></dt>
<dd>
<p>Number of parent stock</p>
</dd>
<dt><code class="reqn">W_{al}</code></dt>
<dd>
<p>Weight of parent stock</p>
</dd>
<dt><code class="reqn">p</code></dt>
<dd>
<p>Proportion of parent stock spawning, from <var>proportion_f</var></p>
</dd>
<dt><code class="reqn">p_{0..4}</code></dt>
<dd>
<p>Arguments provided to function</p>
</dd>
</dl>
<h4>g3a_spawn_recruitment_simplessb</h4>

<p>A pair of formula objects:
</p>
<p style="text-align: center;"><code class="reqn"> S = N_{al} p  W_{al} </code>
</p>

<p style="text-align: center;"><code class="reqn"> R = \mu S </code>
</p>


<dl>
<dt><code class="reqn">N_{al}</code></dt>
<dd>
<p>Number of parent stock</p>
</dd>
<dt><code class="reqn">W_{al}</code></dt>
<dd>
<p>Weight of parent stock</p>
</dd>
<dt><code class="reqn">p</code></dt>
<dd>
<p>Proportion of parent stock spawning, from <var>proportion_f</var></p>
</dd>
<dt>μ</dt>
<dd>
<p>Argument provided to function</p>
</dd>
</dl>
<h4>g3a_spawn_recruitment_ricker</h4>

<p>A pair of formula objects:
</p>
<p style="text-align: center;"><code class="reqn"> S = N_{al} p  W_{al} </code>
</p>

<p style="text-align: center;"><code class="reqn"> R = \mu S e^{-\lambda S} </code>
</p>


<dl>
<dt><code class="reqn">N_{al}</code></dt>
<dd>
<p>Number of parent stock</p>
</dd>
<dt><code class="reqn">W_{al}</code></dt>
<dd>
<p>Weight of parent stock</p>
</dd>
<dt><code class="reqn">p</code></dt>
<dd>
<p>Proportion of parent stock spawning, from <var>proportion_f</var></p>
</dd>
<dt>μ</dt>
<dd>
<p>Argument provided to function</p>
</dd>
<dt>λ</dt>
<dd>
<p>Argument provided to function</p>
</dd>
</dl>
<h4>g3a_spawn_recruitment_bevertonholt</h4>

<p>A pair of formula objects:
</p>
<p style="text-align: center;"><code class="reqn"> S = N_{al} p  W_{al} </code>
</p>

<p style="text-align: center;"><code class="reqn"> R = \frac{\mu S}{\lambda + S} </code>
</p>


<dl>
<dt><code class="reqn">N_{al}</code></dt>
<dd>
<p>Number of parent stock</p>
</dd>
<dt><code class="reqn">W_{al}</code></dt>
<dd>
<p>Weight of parent stock</p>
</dd>
<dt><code class="reqn">p</code></dt>
<dd>
<p>Proportion of parent stock spawning, from <var>proportion_f</var></p>
</dd>
<dt>μ</dt>
<dd>
<p>Argument provided to function</p>
</dd>
<dt>λ</dt>
<dd>
<p>Argument provided to function</p>
</dd>
</dl>
<h4>g3a_spawn_recruitment_hockeystick</h4>

<p>A pair of formula objects:
</p>
<p style="text-align: center;"><code class="reqn"> S = N_{al} p  W_{al} </code>
</p>

<p style="text-align: center;"><code class="reqn"> R = R_0 \min{( S / B_{lim}, 1)} </code>
</p>


<dl>
<dt><code class="reqn">N_{al}</code></dt>
<dd>
<p>Number of parent stock</p>
</dd>
<dt><code class="reqn">W_{al}</code></dt>
<dd>
<p>Weight of parent stock</p>
</dd>
<dt><code class="reqn">p</code></dt>
<dd>
<p>Proportion of parent stock spawning, from <var>proportion_f</var></p>
</dd>
<dt><code class="reqn">R_0</code></dt>
<dd>
<p>Argument <code>r0</code> provided to function</p>
</dd>
<dt><code class="reqn">B_{lim}</code></dt>
<dd>
<p>Argument <code>blim</code> provided to function</p>
</dd>
</dl>
<p><strong>NB:</strong> This formula is differentiable, despite using <code>min()</code> in the
definition above.
</p>



<h4>g3a_spawn</h4>

<p>An action (i.e. list of formula objects) that will, for the given <var>stock</var>...</p>

<ol>
<li>
<p>Use <var>proportion_f</var> to calculate the total parent <var>stock</var> that will spawn
</p>
</li>
<li>
<p>Use <var>recruitment_f</var> to derive the total newly spawned stock
</p>
</li>
<li>
<p>Apply <var>weightloss_f</var> and <var>mortality_f</var> to the parent <var>stock</var>
</p>
</li>
</ol>
<p> ... then, at recruitment stage ... </p>

<ol><li>
<p>Recruit evenly into <var>output_stocks</var>, using <var>mean_f</var>, <var>stddev_f</var>, <var>alpha_f</var>, <var>beta_f</var>
as-per g3a_renewal_normalparam
</p>
</li></ol>
<h3>See Also</h3>

<p><a href="https://gadget-framework.github.io/gadget2/userguide/chap-stock.html#sec:stocknatmort">https://gadget-framework.github.io/gadget2/userguide/chap-stock.html#sec:stocknatmort</a>,
<code>g3a_naturalmortality</code>,
<code>g3_stock</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
ling_imm &lt;- g3_stock('ling_imm', seq(20, 156, 4)) %&gt;% g3s_age(3, 10)
ling_mat &lt;- g3_stock('ling_mat', seq(20, 156, 4)) %&gt;% g3s_age(3, 10)

spawn_action &lt;- g3a_spawn(
    # Spawn from ling_mat
    ling_mat,
    # Use Ricker Recruitment Function to calculate # of recruits from total biomass
    recruitment_f = g3a_spawn_recruitment_ricker(
        g3_parameterized("ricker.mu"),
        g3_parameterized("ricker.lambda")),
    # Proportion of ling_mat spawning exponential relationship based on length
    proportion_f = g3_suitability_exponentiall50(
        alpha = g3_parameterized("spawn.prop.alpha", scale = -1),
        l50 = g3_parameterized("spawn.prop.l50")),
    # Proportion of ling_mat dying during spawning linear relationship to length
    mortality_f = g3_suitability_straightline(
        alpha = g3_parameterized("spawn.mort.alpha"),
        beta = g3_parameterized("spawn.mort.beta")),
    # Weightloss of ling_mat during spawning a constant
    weightloss_f = g3_parameterized("spawn.weightloss"),
    # Spawn into ling_imm
    output_stocks = list(ling_imm),
    # Spawned stock structure, as-per g3a_renewal_normalparam()
    mean_f = 50,
    stddev_f = 0.9,
    alpha_f = 1,
    beta_f = 1,
    # Spawning should happen on the first step of every year
    run_f = ~cur_step==1)
</code></pre>


</div>