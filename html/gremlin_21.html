<div class="container">

<table style="width: 100%;"><tr>
<td>gremlin</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Mixed-effect modeling functions.</h2>

<h3>Description</h3>

<p>Fit and setup functions for linear mixed-effect model (Gaussian responses).
</p>


<h3>Usage</h3>

<pre><code class="language-R">gremlin(
  formula,
  random = NULL,
  rcov = ~units,
  data = NULL,
  ginverse = NULL,
  Gstart = NULL,
  Rstart = NULL,
  Bp = NULL,
  Gcon = NULL,
  Rcon = NULL,
  maxit = 20,
  algit = NULL,
  vit = 1,
  v = 1,
  control = gremlinControl(),
  ...
)

gremlinR(
  formula,
  random = NULL,
  rcov = ~units,
  data = NULL,
  ginverse = NULL,
  Gstart = NULL,
  Rstart = NULL,
  Bp = NULL,
  Gcon = NULL,
  Rcon = NULL,
  maxit = 20,
  algit = NULL,
  vit = 1,
  v = 1,
  control = gremlinControl(),
  ...
)

## S3 method for class 'gremlin'
getCall(x, ...)

## S3 method for class 'gremlin'
update(object, ...)

gremlinSetup(
  formula,
  random = NULL,
  rcov = ~units,
  data = NULL,
  ginverse = NULL,
  Gstart = NULL,
  Rstart = NULL,
  Bp = NULL,
  Gcon = NULL,
  Rcon = NULL,
  maxit = 20,
  algit = NULL,
  vit = 1,
  v = 1,
  control = gremlinControl(),
  ...
)

## S3 method for class 'gremlin'
is(x)

## S3 method for class 'grMod'
is(x)

mkModMats(
  formula,
  random = NULL,
  rcov = ~units,
  data = NULL,
  subset = NULL,
  ginverse = NULL,
  na.action = na.pass,
  offset = NULL,
  contrasts = NULL,
  Xsparse = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>A <code>formula</code> for the response variable(s) and fixed effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random</code></td>
<td>
<p>A <code>formula</code> for the random effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rcov</code></td>
<td>
<p>A <code>formula</code> for the residual covariance structure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <code>data.frame</code> in which to look for the terms in
<code>formula</code>, <code>random</code>, and <code>rcov</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ginverse</code></td>
<td>
<p>A <code>list</code> of (preferably sparse) inverse matrices that
are proportional to the covariance structure of the random effects.
The name of each element in the list should match a column in <code>data</code>
that is associated with a random term. All levels of the random term should
appear as <code>rownames</code> for the matrices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Gstart</code></td>
<td>
<p>A <code>list</code> of matrices with starting (co)variance values for
the G-structure or random effects terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Rstart</code></td>
<td>
<p>A <code>list</code> of matrices with starting (co)variance values for
the R-structure or residual terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Bp</code></td>
<td>
<p>A prior specification for fixed effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Gcon, Rcon</code></td>
<td>
<p>A <code>list</code> of matrices with constraint codes for the
G-structure/random effects or R-structure/residual effects terms,
respectively. Must be a <code>character</code> of either <code>"F"</code> for fixed,
<code>"P"</code> for positive, or <code>"U"</code> for unbounded.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>An <code>integer</code> specifying the maximum number of likelihood
iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>algit</code></td>
<td>
<p>A <code>character</code> vector of length 1 or more or an expression
to be evaluated that specifies the algorithm to use for proposing
(co)variances in the next likelihood iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vit</code></td>
<td>
<p>An <code>integer</code> value specifying the verbosity of screen output
on each iteration. A value of zero gives no iteration specific output and
larger values increase the amount of information printed on the screen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>v</code></td>
<td>
<p>An <code>integer</code> value specifying the verbosity of screen output
regarding the model fitting process. A value of zero gives no details and
larger values increase the amount of information printed on the screen.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>A <code>list</code> returned by <code>gremlinControl</code> containing
specific named values from that function. See <code>gremlinControl</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to be passed to control the model fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x, object</code></td>
<td>
<p>An object of class <code>gremlin</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>An expression for the subset of <code>data</code> to use.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>What to do with NAs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>Should an offset be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrasts</code></td>
<td>
<p>Specify the type of contrasts for the fixed effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Xsparse</code></td>
<td>
<p>Should sparse matrices be used for the fixed effects design
matrix.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>list</code> containing an object of class <code>grMod</code> and, if a 
model was fit (<code>gremlin</code> or <code>gremlinR</code>) then an object containing
details of the REML iterations (object <code>itMat</code>). An object of class
<code>grMod</code> contains:
</p>

<dl>
<dt>call </dt>
<dd>
<p>The model <code>call</code>.</p>
</dd>
<dt>modMats </dt>
<dd>
<p>A <code>list</code> of the model matrices used to construct the
mixed model equations.</p>
</dd>
<dt>y </dt>
<dd>
<p>The response vector.</p>
</dd>
<dt>ny </dt>
<dd>
<p>The number of responses.</p>
</dd>
<dt>ncy </dt>
<dd>
<p>The number of columns of the original response.</p>
</dd>
<dt>X </dt>
<dd>
<p> The fixed effects design matrix.</p>
</dd>
<dt>nb </dt>
<dd>
<p>The number of columns in X.</p>
</dd>
<dt>Zr </dt>
<dd>
<p>The residual design matrix.</p>
</dd>
<dt>Zg </dt>
<dd>
<p>A list of the design matrices for each random term.</p>
</dd>
<dt>nG </dt>
<dd>
<p>The number of parameters in the G structure.</p>
</dd>
<dt>listGeninv </dt>
<dd>
<p>A list of generalized inverse matrices.</p>
</dd>
<dt>logDetG </dt>
<dd>
<p>The log-determinants of the generalized inverse 
matrices - necessary to calculate the log-likelihood.</p>
</dd>
<dt>rfxIncContrib2loglik </dt>
<dd>
<p>A <code>numeric</code> value containing the sum
of the log determinants of the random effects that do not change between
log-likelihood iterations (i.e., the part of the log determinants of 
(co)variance matrices to be estimated that have been factored out).</p>
</dd>
<dt>ndgeninv </dt>
<dd>
<p>A <code>logical</code> indicating which terms in the random
formula have generalized inverses associated with them (non-diagonal 
matrices in the Kronecker product.</p>
</dd>
<dt>dimsZg, nminffx, rfxlvls, nminfrfx </dt>
<dd>
<p><code>Numeric</code> vectors or scalars
describing the numbers of random effects or some function of random and
fixed effects.</p>
</dd>
<dt>conv, bounds </dt>
<dd>
<p>(Co)variance component constraints and boundaries
of the allowable parameter space for each component.</p>
</dd>
<dt>thetav </dt>
<dd>
<p>A <code>vector</code> of the (co)variance parameters to
be estimated by REML withe the attribute “skel” giving the
skeleton to recreate a list of <code>matrices</code> from this vector.</p>
</dd>
<dt>thetaG, thetaR </dt>
<dd>
<p><code>Vectors</code> indexing the random and residual
(co)variances, respectively, in a list of (co)variance matrices (i.e.,
<code>theta</code>).</p>
</dd>
<dt>nu </dt>
<dd>
<p>A <code>list</code> of transformed (co)variance matrices
to be fit by REML. If a residual variance has been factored out of the
mixed model equations, <code>nu</code> contains the ‘lambda’
parameterization with expresses the (co)variance components as ratios
of variance parameters with the residual variance. The ‘nu’ scale
(co)variances are the ones actually fit by REML.</p>
</dd>
<dt>sigma2e </dt>
<dd>
<p>The estimate of the factored out residual variance from
the mixed model equations (i.e., the ‘lambda’ scale)
<code class="reqn">\sigma^{2}_{e}</code>.</p>
</dd>
<dt>p </dt>
<dd>
<p>An <code>integer</code> for the total number of (co)variances to be
estimated.</p>
</dd>
<dt>lambda </dt>
<dd>
<p>A <code>logical</code> indicating whether the ‘lambda’
scale parameterization has been used.</p>
</dd>
<dt>uni </dt>
<dd>
<p>A <code>logical</code> to indicate if the model is univariate or not.</p>
</dd>
<dt>W, tWW, RHS, Bpinv </dt>
<dd>
<p>Sparse matrices of class <code>Matrix</code> that 
form the mixed model equations and do not change between iterations of
REML. These are the column binded ‘X’ and ‘Z’ design
matrices for fixed and random effects, the cross-product of <code>W</code>,
the Right-Hand Side of the mixed model equations, and the inverse of
the fixed effect prior matrix (zeroes on the diagonal if no priors have
been specified). Note, these may be <code>NULL</code> if <code>lambda=FALSE</code>,
because the <code>NULL</code> objects are not used or do change between
REML iterations.</p>
</dd>
<dt>sLc </dt>
<dd>
<p>A <code>Matrix</code> containing the symbolic Cholesky factorization
of the coefficient matrix of the Mixed Model Equations.</p>
</dd>
<dt>sln </dt>
<dd>
<p>A one column <code>matrix</code> of solutions in the mixed model
equations.</p>
</dd>
<dt>Cinv_ii </dt>
<dd>
<p>A one column <code>matrix</code> of variances for the solutions
to the mixed model equations. These are obtained from the diagonal of
the inverse Coefficient matrix in the mixed model equations. If lambda
is <code>TRUE</code> then these are on the lambda scale and must be
multiplied by <code>sigma2e</code> to be converted to the original data scale.</p>
</dd>
<dt>r </dt>
<dd>
<p>A one column <code>matrix</code> of residual deviations, response minus
the values expected based on the solutions, corresponding to the order
in <code>modMats$y</code>.</p>
</dd> 
<dt>AI </dt>
<dd>
<p>A <code>matrix</code> of values containing the Average Information
matrix, or second partial derivatives of the likelihood with respect to
the transformed (co)variance components (‘nu’). The inverse of
this matrix gives the sampling (co)variances of these transformed
(co)variance components.</p>
</dd>
<dt>dLdnu </dt>
<dd>
<p>A single column <code>matrix</code> of first derivatives of
the transformed (co)variance parameters (‘nu’) with respect to
the log-Likelihood.</p>
</dd>
<dt>maxit </dt>
<dd>
<p>See the parameter described above.</p>
</dd>
<dt>algit </dt>
<dd>
<p>A <code>character</code> vector of REML algorithms to use in each
iteration.</p>
</dd>
<dt>vit </dt>
<dd>
<p>See the parameter described above.</p>
</dd>
<dt>v </dt>
<dd>
<p>See the parameter described above.</p>
</dd>
<dt>cctol </dt>
<dd>
<p>A <code>numeric</code> vector of convergence criteria thresholds.
See <code>gremlinControl</code> for more details.</p>
</dd>
<dt>ezero, einf </dt>
<dd>
<p><code>numeric</code> values for the effective numbers to
use as “zero” and maximum negative or positive numbers. Values
less than <code>ezero</code> are treated as zero and fixed to this value.
Values less than <code>-1*einf</code> or greater than <code>einf</code> are
restricted to these values. See <code>gremlinControl</code> for more
details.</p>
</dd>
<dt>step </dt>
<dd>
<p>A <code>numeric</code> value indicating the step-reduction to use.
See <code>gremlinControl</code> for more details.</p>
</dd>
<dt>itMat </dt>
<dd>
<p>A <code>matrix</code> of details about each iteration. Rows
indicate each REML iteration (rownames reflect the REML algorithm used)
and columns contain:
</p>

<dl>
<dt>nu, theta</dt>
<dd>
<p>(Co)variance parameters.</p>
</dd>
<dt>sigma2e </dt>
<dd>
<p>See ‘sigma2e’ described above.</p>
</dd>
<dt>tyPy, logDetC </dt>
<dd>
<p>Estimates for two these two components of the
log of the REML likelihoods. These are obtained from Cholesky
factorization of the coefficient matrix of the mixed model equations.</p>
</dd>
<dt>loglik </dt>
<dd>
<p>The REML log-likelihood.</p>
</dd>
<dt>itTime </dt>
<dd>
<p>Time elapsed for each REML iteration.</p>
</dd>
</dl>
</dd>
</dl>
<h3>Functions</h3>


<ul><li> <p><code>mkModMats</code>: Generates model matrices.
</p>
</li></ul>
<h3>Author(s)</h3>

<p><a href="mailto:matthewwolak@gmail.com">matthewwolak@gmail.com</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">  grSire &lt;- gremlin(WWG11 ~ sex, random = ~ sire, data = Mrode11)
  # Now drop sire random effects and use the `anova` method to compare models
  grLM &lt;- update(grSire, random = ~ 1)  #&lt;-- use `~1` to drop all random effects
    anova(grSire, grLM)

  # Modular functions
  ## get model matrices for a mixed model
  mM11 &lt;- mkModMats(WWG11 ~ sex - 1, random = ~ sire, data = Mrode11)

  ## setup model, but do not evaluate the log-likelihood
  grSetup &lt;- gremlinSetup(WWG11 ~ sex - 1, random = ~ sire, data = Mrode11)
  ## maximize the restricted maximum likelihood
  grOut &lt;- remlIt(grSetup)
  summary(grOut)

## Not run: 
  # Following the example from Mrode 2005, chapter 11.
  library(nadiv)  #&lt;-- to construct inverse of the numerator relatedness matrix
  Ainv &lt;- makeAinv(Mrode11[, 1:3])$Ainv

  gr11lmm &lt;- gremlin(WWG11 ~ sex - 1,
random = ~ calf,
data = Mrode11,
ginverse = list(calf = Ainv),
Gstart = matrix(0.2), Rstart = matrix(0.4),  #&lt;-- specify starting values
maxit = 15,    #&lt;-- maximum iterations
     v = 2, vit = 1,  #&lt;-- moderate screen output (`v`) every iteration (`vit`)
     algit = "AI")  #&lt;-- only use Average Information algorithm iterations
  summary(gr11lmm)

  # Compare the model to a Linear Model with no random effects
  ## Use `update()` to update the model
  gr11lm &lt;- update(gr11lmm, random = ~ 1)  #&lt;-- `~1`=drop all random effects
  summary(gr11lm)

  # Do analysis of variance between the two models
  ## See AIC or evaluate likelihood ratio against a Chi-squared distribution
  anova(gr11lm, gr11lmm)

## End(Not run)
</code></pre>


</div>