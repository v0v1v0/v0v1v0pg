<div class="container">

<table style="width: 100%;"><tr>
<td>project_matrix</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Project matrix after optimization</h2>

<h3>Description</h3>

<p>After the MAP permutation was found with <code>find_MAP()</code>,
use this permutation to approximate the covariance matrix
with bigger statistical confidence.
</p>


<h3>Usage</h3>

<pre><code class="language-R">project_matrix(S, perm, precomputed_equal_indices = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>A square matrix to be projected.
The empirical covariance matrix.
(See the <code>S</code> parameter in the <code>gips()</code> function).
When it is not positive semi-definite,
it shows a warning of a class <code>not_positive_semi_definite_matrix</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perm</code></td>
<td>
<p>A permutation to be projected on.
An object of a <code>gips</code> class,
a <code>gips_perm</code> class, or anything that can be used
as the <code>x</code> argument in the <code>gips_perm()</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>precomputed_equal_indices</code></td>
<td>
<p>This parameter is for internal use only.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Project matrix on the space of symmetrical matrices invariant
by a cyclic group generated by <code>perm</code>.
This implements the formal
<a href="https://arxiv.org/abs/2004.03503">Definition 3 from references</a>.
</p>
<p>When <code>S</code> is the sample covariance matrix (output of <code>cov()</code> function, see
examples), then <code>S</code> is the <strong>unbiased estimator</strong> of the covariance matrix.
However, the <strong>maximum likelihood estimator</strong> of the covariance matrix is
<code>S*(n-1)/(n)</code>, unless n &lt; p, when the
<strong>maximum likelihood estimator does not exist</strong>. For more information, see
<a href="https://en.wikipedia.org/wiki/Estimation_of_covariance_matrices">Wikipedia - Estimation of covariance matrices</a>.
</p>
<p>The maximum likelihood estimator differs when one knows the covariance
matrix is <strong>invariant under some permutation</strong>. This estimator will
be symmetric AND have some values repeated (see examples and
<a href="https://arxiv.org/abs/2004.03503">Corollary 12 from references</a>).
</p>
<p>The estimator will be invariant under the given permutation. Also, it
will <strong>need fewer observations</strong> for the maximum likelihood estimator to
exist (see <strong>Project Matrix - Equation (6)</strong> section in
<code>vignette("Theory", package = "gips")</code> or in its
<a href="https://przechoj.github.io/gips/articles/Theory.html">pkgdown page</a>).
For some permutations, even <code class="reqn">n = 2</code> could be enough.
The minimal number of observations needed are named <code>n0</code> and
can be calculated by <code>summary.gips()</code>.
</p>
<p>For more details, see the <strong>Project Matrix - Equation (6)</strong>
section in <code>vignette("Theory", package = "gips")</code> or in its
<a href="https://przechoj.github.io/gips/articles/Theory.html">pkgdown page</a>.
</p>


<h3>Value</h3>

<p>Returns the matrix <code>S</code> projected on the space of symmetrical matrices invariant
by a cyclic group generated by <code>perm</code>. See Details for more.
</p>


<h3>See Also</h3>


<ul>
<li> <p><a href="https://en.wikipedia.org/wiki/Estimation_of_covariance_matrices">Wikipedia - Estimation of covariance matrices</a>
</p>
</li>
<li> <p><strong>Project Matrix - Equation (6)</strong> section of
<code>vignette("Theory", package = "gips")</code> or its
<a href="https://przechoj.github.io/gips/articles/Theory.html">pkgdown page</a> -
A place to learn more about the math
behind the <code>gips</code> package and see
more examples of <code>project_matrix()</code>.
</p>
</li>
<li> <p><code>find_MAP()</code> - The function that finds
the Maximum A Posteriori (MAP) Estimator
for a given <code>gips</code> object.
After the MAP Estimator is found, the matrix
<code>S</code> can be projected on this permutation,
creating the MAP Estimator of the covariance matrix
(see examples).
</p>
</li>
<li> <p><code>gips_perm()</code> - Constructor for the <code>perm</code> parameter.
</p>
</li>
<li> <p><code>plot.gips()</code> - For <code>plot(g, type = "MLE")</code>,
the <code>project_matrix()</code> is called (see examples).
</p>
</li>
<li> <p><code>summary.gips()</code> - Can calculate the <code>n0</code>, the minimal
number of observations, so that the projected matrix
will be the MLE estimator of the covariance matrix.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">p &lt;- 6
my_perm &lt;- "(14)(23)" # permutation (1,4)(2,3)(5)(6)
number_of_observations &lt;- 10
X &lt;- matrix(rnorm(p * number_of_observations), number_of_observations, p)
S &lt;- cov(X)
projected_S &lt;- project_matrix(S, perm = my_perm)
projected_S
# The value in [1,1] is the same as in [4,4]; also, [2,2] and [3,3];
  # also [1,2] and [3,4]; also, [1,5] and [4,5]; and so on

# Plot the projected matrix:
g &lt;- gips(S, number_of_observations, perm = my_perm)
plot(g, type = "MLE")

# Find the MAP Estimator of covariance
g_MAP &lt;- find_MAP(g, max_iter = 10, show_progress_bar = FALSE, optimizer = "Metropolis_Hastings")
S_MAP &lt;- project_matrix(attr(g, "S"), perm = g_MAP)
S_MAP
plot(g_MAP, type = "heatmap")
</code></pre>


</div>