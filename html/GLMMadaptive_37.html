<div class="container">

<table style="width: 100%;"><tr>
<td>negative.binomial</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Family function for Negative Binomial Mixed Models
</h2>

<h3>Description</h3>

<p>Specifies the information required to fit a Negative Binomial generalized linear mixed 
model, using <code>mixed_model()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">negative.binomial()
</code></pre>


<h3>Note</h3>

<p>Currently only the log-link is implemented.</p>


<h3>Author(s)</h3>

<p>Dimitris Rizopoulos <a href="mailto:d.rizopoulos@erasmusmc.nl">d.rizopoulos@erasmusmc.nl</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# simulate some data
set.seed(102)
dd &lt;- expand.grid(f1 = factor(1:3), f2 = LETTERS[1:2], g = 1:30, rep = 1:15,
                  KEEP.OUT.ATTRS = FALSE)
mu &lt;- 5 * (-4 + with(dd, as.integer(f1) + 4 * as.numeric(f2)))
dd$y &lt;- rnbinom(nrow(dd), mu = mu, size = 0.5)

gm1 &lt;-  mixed_model(fixed = y ~ f1 * f2, random = ~ 1 | g, data = dd, 
                    family = negative.binomial())

summary(gm1)

# We do a likelihood ratio test with the Poisson mixed model
gm0 &lt;- mixed_model(fixed = y ~ f1 * f2, random = ~ 1 | g, data = dd, 
                    family = poisson())
                    
anova(gm0, gm1)

# Define a cutom-made family function to be used with mixed_model()
# the required components are 'family', 'link', 'linkfun', 'linkinv' and 'log_dens';
# the extra functions 'score_eta_fun' and 'score_phis_fun' can be skipped and will 
# internally approximated using numeric derivatives (though it is better that you provide
# them).
my_negBinom &lt;- function (link = "log") {
    stats &lt;- make.link(link)
    log_dens &lt;- function (y, eta, mu_fun, phis, eta_zi) {
        # the log density function
        phis &lt;- exp(phis)
        mu &lt;- mu_fun(eta)
        log_mu_phis &lt;- log(mu + phis)
        comp1 &lt;- lgamma(y + phis) - lgamma(phis) - lgamma(y + 1)
        comp2 &lt;- phis * log(phis) - phis * log_mu_phis
        comp3 &lt;- y * log(mu) - y * log_mu_phis
        out &lt;- comp1 + comp2 + comp3
        attr(out, "mu_y") &lt;- mu
        out
    }
    score_eta_fun &lt;- function (y, mu, phis, eta_zi) {
        # the derivative of the log density w.r.t. mu
        phis &lt;- exp(phis)
        mu_phis &lt;- mu + phis
        comp2 &lt;- - phis / mu_phis
        comp3 &lt;- y / mu - y / mu_phis
        # the derivative of mu w.r.t. eta (this depends on the chosen link function)
        mu.eta &lt;- mu
        (comp2 + comp3) * mu.eta
    }
    score_phis_fun &lt;- function (y, mu, phis, eta_zi) {
        # the derivative of the log density w.r.t. phis
        phis &lt;- exp(phis)
        mu_phis &lt;- mu + phis
        comp1 &lt;- digamma(y + phis) - digamma(phis)
        comp2 &lt;- log(phis) + 1 - log(mu_phis) - phis / mu_phis
        comp3 &lt;- - y / mu_phis
        comp1 + comp2 + comp3
    }
    structure(list(family = "user Neg Binom", link = stats$name, linkfun = stats$linkfun,
                   linkinv = stats$linkinv, log_dens = log_dens,
                   score_eta_fun = score_eta_fun,
                   score_phis_fun = score_phis_fun),
              class = "family")
}

fm &lt;-  mixed_model(fixed = y ~ f1 * f2, random = ~ 1 | g, data = dd, 
                   family = my_negBinom(), n_phis = 1, 
                   initial_values = list("betas" = poisson()))

summary(fm)

</code></pre>


</div>