<div class="container">

<table style="width: 100%;"><tr>
<td>fmt_chem</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Format chemical formulas</h2>

<h3>Description</h3>

<p><code>fmt_chem()</code> lets you format chemical formulas or even chemical
reactions in the table body. Often the input text will be in a common form
representing single compounds (like <code>"C2H4O"</code>, for acetaldehyde) but chemical
reactions can be used (e.g., <code style="white-space: pre;">⁠2CH3OH -&gt; CH3OCH3 + H2O"⁠</code>). So long as the
text within the targeted cells conforms to <strong>gt</strong>'s specialized chemistry
notation, the appropriate conversions will occur. Details pertaining to
chemistry notation can be found in the section entitled
<em>How to use <strong>gt</strong>'s chemistry notation</em>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fmt_chem(data, columns = everything(), rows = everything())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p><em>The gt table data object</em>
</p>
<p><code style="white-space: pre;">⁠obj:&lt;gt_tbl&gt;⁠</code> // <strong>required</strong>
</p>
<p>This is the <strong>gt</strong> table object that is commonly created through use of the
<code>gt()</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>columns</code></td>
<td>
<p><em>Columns to target</em>
</p>
<p><code>&lt;column-targeting expression&gt;</code> // <em>default:</em> <code>everything()</code>
</p>
<p>Can either be a series of column names provided in <code>c()</code>, a vector of
column indices, or a select helper function (e.g. <code>starts_with()</code>,
<code>ends_with()</code>, <code>contains()</code>, <code>matches()</code>, <code>num_range()</code> and <code>everything()</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rows</code></td>
<td>
<p><em>Rows to target</em>
</p>
<p><code>&lt;row-targeting expression&gt;</code> // <em>default:</em> <code>everything()</code>
</p>
<p>In conjunction with <code>columns</code>, we can specify which of their rows should
undergo formatting. The default <code>everything()</code> results in all rows in
<code>columns</code> being formatted. Alternatively, we can supply a vector of row
captions within <code>c()</code>, a vector of row indices, or a select helper
function (e.g. <code>starts_with()</code>, <code>ends_with()</code>, <code>contains()</code>, <code>matches()</code>,
<code>num_range()</code>, and <code>everything()</code>). We can also use expressions to filter
down to the rows we need (e.g., <code style="white-space: pre;">⁠[colname_1] &gt; 100 &amp; [colname_2] &lt; 50⁠</code>).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>gt_tbl</code>.
</p>


<h3>How to use <strong>gt</strong>'s chemistry notation</h3>

<p>The chemistry notation involves a shorthand of writing chemical formulas and
chemical reactions, if needed. It should feel familiar in its basic usage and
the more advanced typesetting tries to limit the amount of syntax needed.
It's always best to show examples on usage:
</p>

<ul>
<li> <p><code>"CH3O2"</code> and <code>"(NH4)2S"</code> will render with subscripted numerals
</p>
</li>
<li>
<p> Charges can be expressed with terminating <code>"+"</code> or <code>"-"</code>, as in <code>"H+"</code> and
<code>"[AgCl2]-"</code>; if any charges involve the use of a number, the following
incantations could be used: <code>"CrO4^2-"</code>, <code>"Fe^n+"</code>, <code>"Y^99+"</code>, <code>"Y^{99+}"</code>
(the final two forms produce equivalent output)
</p>
</li>
<li>
<p> Stoichiometric values can be included with whole values prepending formulas
(e.g.,  <code>"2H2O2"</code>) or by setting them off with a space, like this:
<code>"2 H2O2"</code>, <code>"0.5 H2O"</code>, <code>"1/2 H2O"</code>, <code>"(1/2) H2O"</code>
</p>
</li>
<li>
<p> Certain standalone, lowercase letters or combinations thereof will be
automatically stylized to fit conventions; <code>"NO_x"</code> and <code>"x Na(NH4)HPO4"</code>
will have italicized 'x' characters and you can always italicize letters
by surrounding with <code>"*"</code> (as in <code>"*n* H2O"</code> or <code>"*n*-C5H12"</code>)
</p>
</li>
<li>
<p> Chemical isotopes can be rendered using either of these two constructions
preceding an element: <code>"^{227}_{90}Th"</code> or <code>"^227_90Th"</code>; nuclides can
be represented in a similar manner, here are two examples:
<code>"^{0}_{-1}n^{-}"</code>, <code>"^0_-1n-"</code>
</p>
</li>
<li>
<p> Chemical reactions can use <code>"+"</code> signs and a variety of reaction arrows:
(1) <code>"A -&gt; B"</code>, (2) <code>"A &lt;- B"</code>, (3) <code>"A &lt;-&gt; B"</code>, (4) <code>"A &lt;--&gt; B"</code>, (5)
<code>"A &lt;=&gt; B"</code>, (6) <code>"A &lt;=&gt;&gt; B"</code>, or (7) <code>"A &lt;&lt;=&gt; B"</code>
</p>
</li>
<li>
<p> Center dots (useful in addition compounds) can be added by using a single
<code>"."</code> or <code>"*"</code> character, surrounded by spaces; here are two equivalent
examples <code>"KCr(SO4)2 . 12 H2O"</code> and <code>"KCr(SO4)2 * 12 H2O"</code>
</p>
</li>
<li>
<p> Single and double bonds can be shown by inserting a <code>"-"</code> or <code>"="</code> between
adjacent characters (i.e., these shouldn't be at the beginning or end of
the markup); two examples: <code>"C6H5-CHO"</code>, <code>"CH3CH=CH2"</code>
</p>
</li>
<li>
<p> as with units notation, Greek letters can be inserted by surrounding the
letter name with <code>":"</code>; here's an example that describes the delta value
of carbon-13: <code>":delta: ^13C"</code>
</p>
</li>
</ul>
<h3>Examples</h3>

<p>Let's use the <code>reactions</code> dataset and create a new <strong>gt</strong> table. The table
will be filtered down to only a few rows and columns. The column
<code>cmpd_formula</code> contains chemical formulas and the formatting of those will be
performed by <code>fmt_chem()</code>. Certain column labels with chemical names
(<code>o3_k298</code> and <code>no3_k298</code>) can be handled within <code>cols_label()</code> by using
surrounding the text with <code>"{{%"</code>/<code>"%}}"</code>.
</p>
<div class="sourceCode r"><pre>reactions |&gt;
  dplyr::filter(cmpd_type == "terminal monoalkene") |&gt;
  dplyr::filter(grepl("^1-", cmpd_name)) |&gt;
  dplyr::select(cmpd_name, cmpd_formula, ends_with("k298")) |&gt;
  gt() |&gt;
  tab_header(title = "Gas-phase reactions of selected terminal alkenes") |&gt;
  tab_spanner(
    label = "Reaction Rate Constant at 298 K",
    columns = ends_with("k298")
  ) |&gt;
  fmt_chem(columns = cmpd_formula) |&gt;
  fmt_scientific() |&gt;
  sub_missing() |&gt;
  cols_label(
    cmpd_name = "Alkene",
    cmpd_formula = "Formula",
    OH_k298 = "OH",
    O3_k298 = "{{%O3%}}",
    NO3_k298 = "{{%NO3%}}",
    Cl_k298 = "Cl"
  ) |&gt;
  opt_align_table_header(align = "left")
</pre></div>

<img src="https://raw.githubusercontent.com/rstudio/gt/master/images/man_fmt_chem_1.png" alt="This image of a table was generated from the first code example in the `fmt_chem()` help file." style="width:100%;"><p>Taking just a few rows from the <code>photolysis</code> dataset, let's create a new
<strong>gt</strong> table. The <code>cmpd_formula</code> and <code>products</code> columns both contain text in
chemistry notation (the first has compounds, and the second column has the
products of photolysis reactions). These columns will be formatted by
<code>fmt_chem()</code>. The compound formulas will be merged with the compound
names with <code>cols_merge()</code>.
</p>
<div class="sourceCode r"><pre>photolysis |&gt;
  dplyr::filter(cmpd_name %in% c(
    "hydrogen peroxide", "nitrous acid",
    "nitric acid", "acetaldehyde",
    "methyl peroxide", "methyl nitrate",
    "ethyl nitrate", "isopropyl nitrate"
  )) |&gt;
  dplyr::select(-c(l, m, n, quantum_yield, type)) |&gt;
  gt() |&gt;
  tab_header(title = "Photolysis pathways of selected VOCs") |&gt;
  fmt_chem(columns = c(cmpd_formula, products)) |&gt;
  cols_nanoplot(
    columns = sigma_298_cm2,
    columns_x_vals = wavelength_nm,
    expand_x = c(200, 400),
    new_col_name = "cross_section",
    new_col_label = "Absorption Cross Section",
    options = nanoplot_options(
      show_data_points = FALSE,
      data_line_stroke_width = 4,
      data_line_stroke_color = "black",
      show_data_area = FALSE
    )
  ) |&gt;
  cols_merge(
    columns = c(cmpd_name, cmpd_formula),
    pattern = "{1}, {2}"
  ) |&gt;
  cols_label(
    cmpd_name = "Compound",
    products = "Products"
  ) |&gt;
  opt_align_table_header(align = "left")
</pre></div>

<img src="https://raw.githubusercontent.com/rstudio/gt/master/images/man_fmt_chem_2.png" alt="This image of a table was generated from the second code example in the `fmt_chem()` help file." style="width:100%;"><p><code>fmt_chem()</code> can handle the typesetting of nuclide notation.
Let's take a subset of columns and rows from the <code>nuclides</code> dataset and
make a new <strong>gt</strong> table. The contents of the <code>nuclide</code> column contains
isotopes of hydrogen and carbon and this is placed in the table stub. Using
<code>fmt_chem()</code> makes it so that the subscripted and superscripted values are
properly formatted to the convention of formatting nuclides.
</p>
<div class="sourceCode r"><pre>nuclides |&gt;
  dplyr::filter(element %in% c("H", "C")) |&gt;
  dplyr::mutate(nuclide = gsub("[0-9]+$", "", nuclide)) |&gt;
  dplyr::select(nuclide, atomic_mass, half_life, decay_1, is_stable) |&gt;
  gt(rowname_col = "nuclide") |&gt;
  tab_header(title = "Isotopes of Hydrogen and Carbon") |&gt;
  tab_stubhead(label = "Isotope") |&gt;
  fmt_chem(columns = nuclide) |&gt;
  fmt_scientific(columns = half_life) |&gt;
  fmt_number(
    columns = atomic_mass,
    decimals = 4,
    scale_by = 1 / 1e6
  ) |&gt;
  sub_missing(
    columns = half_life,
    rows = is_stable,
    missing_text = md("**STABLE**")
  ) |&gt;
  sub_missing(columns = half_life, rows = !is_stable) |&gt;
  sub_missing(columns = decay_1) |&gt;
  data_color(
    columns = decay_1,
    target_columns = c(atomic_mass, half_life, decay_1),
    palette = "LaCroixColoR::PassionFruit",
    na_color = "white"
  ) |&gt;
  cols_label_with(fn = function(x) tools::toTitleCase(gsub("_", " ", x))) |&gt;
  cols_label(decay_1 = "Decay Mode") |&gt;
  cols_width(
    stub() ~ px(70),
    c(atomic_mass, half_life, decay_1) ~ px(120)
  ) |&gt;
  cols_hide(columns = c(is_stable)) |&gt;
  cols_align(align = "center", columns = decay_1) |&gt;
  opt_align_table_header(align = "left") |&gt;
  opt_vertical_padding(scale = 0.5)
</pre></div>

<img src="https://raw.githubusercontent.com/rstudio/gt/master/images/man_fmt_chem_3.png" alt="This image of a table was generated from the third code example in the `fmt_chem()` help file." style="width:100%;"><h3>Function ID</h3>

<p>3-20
</p>


<h3>Function Introduced</h3>

<p><code>v0.11.0</code> (July 9, 2024)
</p>


<h3>See Also</h3>

<p>Other data formatting functions: 
<code>data_color()</code>,
<code>fmt()</code>,
<code>fmt_auto()</code>,
<code>fmt_bins()</code>,
<code>fmt_bytes()</code>,
<code>fmt_country()</code>,
<code>fmt_currency()</code>,
<code>fmt_date()</code>,
<code>fmt_datetime()</code>,
<code>fmt_duration()</code>,
<code>fmt_email()</code>,
<code>fmt_engineering()</code>,
<code>fmt_flag()</code>,
<code>fmt_fraction()</code>,
<code>fmt_icon()</code>,
<code>fmt_image()</code>,
<code>fmt_index()</code>,
<code>fmt_integer()</code>,
<code>fmt_markdown()</code>,
<code>fmt_number()</code>,
<code>fmt_partsper()</code>,
<code>fmt_passthrough()</code>,
<code>fmt_percent()</code>,
<code>fmt_roman()</code>,
<code>fmt_scientific()</code>,
<code>fmt_spelled_num()</code>,
<code>fmt_tf()</code>,
<code>fmt_time()</code>,
<code>fmt_units()</code>,
<code>fmt_url()</code>,
<code>sub_large_vals()</code>,
<code>sub_missing()</code>,
<code>sub_small_vals()</code>,
<code>sub_values()</code>,
<code>sub_zero()</code>
</p>


</div>