<div class="container">

<table style="width: 100%;"><tr>
<td>fitRolling</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function to Fit Rolling Regression in gamlss</h2>

<h3>Description</h3>

<p>Rolling regression is common in time series analysis when one step ahead forecasts is required. The function <code>fitRolling()</code> works as follows: A model is fitted first to the whole data set using <code>gamlss()</code>. Then the function <code>fitRolling()</code> can be used. The function uses a fixed size rolling widow  i.e.  365 days. The model is refitted repeatedly for the different windows over time (like a local regression in smoothing).  Each time one step ahead forecast of distribution parameters are saved together with the prediction global deviance. The result is presented as a matrix  with time as rows and parameters and the prediction deviance as columns.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fitRolling(obj, data, window = 365, as.time = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>obj</code></td>
<td>
<p>a gamlss fitted model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>the original data of the fitted model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>window</code></td>
<td>
<p>the number of observation to include in the window (typically this will be a year)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as.time</code></td>
<td>
<p>if a column indicating time exist in the data set this can be specified here</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If the total observations are <code>N</code> and the window size <code>n</code> then we will need <code>N-n</code> different fits. The parallelization of the fits is achieved using the function <code>foreach()</code> from the package <span class="pkg">foreach</span>.  
</p>


<h3>Value</h3>

<p>Returns a matrix containing as columns the one ahead prediction parameters of the distribution as well as the  prediction global deviance.</p>


<h3>Note</h3>

<p>Do not forget to use <code>registerDoParallel(cores = NUMBER)</code> or
<code>cl &lt;- makeCluster(NUMBER)</code> and 
<code>registerDoParallel(cl)</code>
before calling the function <code>fitRolling()</code> and <code>closeAllConnections()</code> after the fits. Where <code>NUMBER</code> depends on the machine used. 
</p>


<h3>Author(s)</h3>

<p>Mikis Stasinopoulos, <a href="mailto:d.stasinopoulos@londonmet.ac.uk">d.stasinopoulos@londonmet.ac.uk</a>
</p>


<h3>References</h3>

<p>Rigby, R. A. and  Stasinopoulos D. M. (2005). Generalized additive models for location, scale and shape, (with discussion), 
<em>Appl. Statist.</em>, <b>54</b>, part 3, pp 507-554.
</p>
<p>Rigby, R. A., Stasinopoulos, D. M.,  Heller, G. Z.,  and De Bastiani, F. (2019)
<em>Distributions for modeling location, scale, and shape: Using GAMLSS in R</em>, Chapman and Hall/CRC, <a href="https://doi.org/10.1201/9780429298547">doi:10.1201/9780429298547</a>. An older version can be found in <a href="https://www.gamlss.com/">https://www.gamlss.com/</a>.
</p>
<p>Stasinopoulos D. M. Rigby R.A. (2007) Generalized additive models for location scale and shape (GAMLSS) in R.
<em>Journal of Statistical Software</em>, Vol. <b>23</b>, Issue 7, Dec 2007, <a href="https://doi.org/10.18637/jss.v023.i07">doi:10.18637/jss.v023.i07</a>.
</p>
<p>Stasinopoulos D. M., Rigby R.A., Heller G., Voudouris V., and De Bastiani F., (2017)
<em>Flexible Regression and Smoothing: Using GAMLSS in R</em>,  Chapman and Hall/CRC.  <a href="https://doi.org/10.1201/b21973">doi:10.1201/b21973</a>
</p>
<p>Stasinopoulos, M. D., Rigby, R. A., and De Bastiani F., (2018) GAMLSS: a distributional regression approach, <em>Statistical Modelling</em>, Vol. <b>18</b>, 
pp, 248-273, SAGE Publications Sage India: New Delhi, India. <a href="https://doi.org/10.1177/1471082X18759144">doi:10.1177/1471082X18759144</a>
</p>
<p>(see also <a href="https://www.gamlss.com/">https://www.gamlss.com/</a>).
</p>


<h3>See Also</h3>

 <p><code>gamlss</code></p>


<h3>Examples</h3>

<pre><code class="language-R">
# fitting the aids data 45 observations
m1 &lt;- gamlss(formula = y ~ pb(x) + qrt, family = NBI, data = aids) 
# get rolling regression with a window of 30
# there are 45-40=15 fits to do
# declaring cores (not needed for small data like this)
registerDoParallel(cores = 2)
FF &lt;- fitRolling(m1, data=aids, window=30)
FF
stopImplicitCluster()
# check the first prediction
m30_1 &lt;-update(m1, data=aids[1:30,])
predictAll(m30_1, newdata=aids[31,],output="matrix")
FF[1,]
# plot all the data 
plot(y~x, data=aids, xlim=c(0,45), ylim=c(0, 700), col=gray(.8))
# the first 30 observations
points(y~x, data=aids[1:30,], xlim=c(0,45))
# One step ahead forecasts
lines(FF[,"mu"]~as.numeric(rownames(FF)), col="red")
lines(fitted(m1)~aids$x, col="blue")

</code></pre>


</div>