<div class="container">

<table style="width: 100%;"><tr>
<td>gmSQL</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Provide an R representation of SQL</h2>

<h3>Description</h3>

<p>gmSQL provides an R representation of SQL, which can be used to
construct a complex hierachy of joins and select statements. 
</p>


<h3>Usage</h3>

<pre><code class="language-R">gmSQL(.,expr=substitute(.),env=SQLenv)
gmSQL2SQL(expr,env=SQL2SQLenv)
gmSQLTable(table,as=tick(table))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>.</code></td>
<td>
<p>For <code>gmSQL</code> an unquote expression to be interpreted as
the R representation of SQL described under details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expr</code></td>
<td>
<p>The quoted version of such an expression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env</code></td>
<td>
<p>The environment holding the variables used in the expression.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>table</code></td>
<td>
<p>a character string giving the name of the SQL table
denoted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>as</code></td>
<td>
<p>the alias of the table in the SQL expression</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>These commands allow to construct a representation of a small subset
of SQL statements by R language objects. The following (derived) table
value statements are supported
</p>

<ul>
<li>
<p>join(x,y,on=NULL)Represent the <code>x JOIN y ON on</code>.
</p>
</li>
<li>
<p>leftjoin(x,y,on=NULL)Represent the <code>x LEFT OUTER JOIN y ON on</code>.
</p>
</li>
<li>
<p>select(what=NULL,from=NULL,where=NULL,as=tick())
Represents <code>(SELECT w1=v1,... FROM from WHERE where) AS as</code>, where
what is a named list of the form <code>list(w1=v1,...)</code>. If any of
the terms is NULL it is logically omitted.

</p>
</li>
<li>
<p>table(table,as)Represents <code>table AS as</code> in a FROM
clause.
</p>
</li>
<li>
<p>table$nameRepresents <code>tableAlias.name</code> anywhere in an
SQL expression e.g. in <code>what</code> and <code>where</code> clauses of a <code>SELECT</code>.
</p>
</li>
<li>
<p>Call(fun,...)Represents <code>fun(...)</code> in SQL expressions.
</p>
</li>
<li>
<p>x==yRepresents <code>x=y</code> in SQL expressions.
</p>
</li>
<li>
<p>x!=yRepresents <code>x!=y</code> in SQL expressions.
</p>
</li>
<li>
<p>x&lt;yRepresents <code>x&lt;y</code> in SQL expressions.
</p>
</li>
<li>
<p>x&gt;yRepresents <code>x&gt;y</code> in SQL expressions.
</p>
</li>
<li>
<p>x&lt;=yRepresents <code>x&lt;=y</code> in SQL expressions.
</p>
</li>
<li>
<p>x&gt;=yRepresents <code>x&gt;=y</code> in SQL expressions.
</p>
</li>
<li>
<p>between(x,y,z)Represents <code>x BETWEEN y AND z</code> in SQL expressions.
</p>
</li>
<li>
<p>x+yRepresents <code>x+y</code> in SQL expressions.
</p>
</li>
<li>
<p>x-yRepresents <code>x-y</code> in SQL expressions.
</p>
</li>
<li>
<p>x*yRepresents <code>x*y</code> in SQL expressions.
</p>
</li>
<li>
<p>x/yRepresents <code>x/y</code> in SQL expressions.
</p>
</li>
<li>
<p>in(x,y)Represents <code>x IN y</code> in SQL expressions.
</p>
</li>
<li>
<p>"x %in% y"Substitute for in(x,y).
</p>
</li>
<li>
<p>&amp;Represents <code>x AND y</code> in SQL expressions.
</p>
</li>
<li>
<p>|Represents <code>x OR y</code> in SQL expressions.
</p>
</li>
<li>
<p>!Represents <code>NOT x</code> in SQL expressions.
</p>
</li>
<li>
<p>ifelse(x,y,z)Represents <code>IF x THEN y ELSE z</code> in SQL
expressions.
</p>
</li>
<li>
<p>.(x)Evaluates its argument in env, i.e. it is used to quote
calculation, which should be executed in R rather than SQL.
</p>
</li>
<li>
<p>x %&lt;&lt;% yRepresents <code>x &lt;&lt; y</code> in SQL expressions (Left shift).
</p>
</li>
<li>
<p>x %&gt;&gt;% yRepresents <code>x &gt;&gt; y</code> in SQL expressions (Right
shift).
</p>
</li>
<li>
<p>xor(x,y)Represents <code>x XOR y</code> in SQL expressions.
</p>
</li>
<li>
<p>x%&amp;%yRepresents <code>x &amp; y</code> in SQL expressions (bitwise and).
</p>
</li>
<li>
<p>x%|%yRepresents <code>x | y</code> in SQL expressions (bitwise
or).
</p>
</li>
<li>
<p>x%&lt;==&gt;%yRepresents <code>x&lt;=&gt;y</code> in SQL expressions (null
safe equality).
</p>
</li>
<li>
<p>x%%yRepresents <code>x % y</code> in SQL expressions
(remainder).
</p>
</li>
<li>
<p>x&amp;&amp;yRepresents <code>x &amp;&amp; y</code> in SQL expressions
(logical AND).
</p>
</li>
<li>
<p>x||yRepresents <code>x || y</code> in SQL expressions
(logical OR).
</p>
</li>
<li>
<p>c(...)Represents <code>(...)</code> in SQL expressions.
</p>
</li>
<li>
<p>sum(x)Represents <code>SUM(x)</code> in SQL expressions (sum of values).
</p>
</li>
<li>
<p>avg(x)Represents  <code>AVG(x)</code> in SQl expressions (average of values).
</p>
</li>
<li>
<p>min(...)Represents <code>MIN(...)</code> in SQL expressions (minimum of values).
</p>
</li>
<li>
<p>max(...)Represents <code>MAX(...)</code> in SQL expressions (maximum of values).
</p>
</li>
<li>
<p>count(x)Represents <code>COUNT(x)</code> in SQL expressions.
</p>
</li>
</ul>
<p>Special environments <code>SQLenv</code> and <code>SQL2SQLenv</code> are used in order to prevent code injection. 
</p>


<h3>Value</h3>

<p>For gmSQL and gmSQLTable, a call representing the intended SQL
expression as R expression. For gmSQL2SQL a character string holding
the corresponding SQL expression. 
</p>


<h3>Author(s)</h3>

<p>K. Gerald van den Boogaart, S. Matos Camacho</p>


<h3>References</h3>

<p><a href="http://dev.mysql.com/doc/refman/5.7/en">http://dev.mysql.com/doc/refman/5.7/en</a>
</p>


<h3>See Also</h3>

<p><code>dbSendQuery</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">tabA &lt;- gmSQLTable("A")
tabB &lt;- gmSQLTable("B")
ennv &lt;- new.env(parent=SQLenv)
assign("tabA", tabA, ennv)
assign("tabB", tabB, ennv)
AB &lt;- gmSQL(join(tabA,tabB,on=tabA$id==tabB$refID), env=ennv)
AB
gmSQL2SQL(tabA)
gmSQL2SQL(tabB)
gmSQL2SQL(AB)
legalvalues &lt;- 1:3
assign("AB", AB, ennv)
assign("legalvalues", legalvalues, ennv)
sAB &lt;- gmSQL(select(what=list(x=1,y=tabA$y*tabB$y),
                    from=AB,
                    where=Call("log",tabB$othervalue)&lt;=17 &amp;&amp;
                          IN(tabA$inte,c(legalvalues)),
                    as=NULL), env=ennv)

cat(gmSQL2SQL(sAB))

</code></pre>


</div>