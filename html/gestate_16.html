<div class="container">

<table style="width: 100%;"><tr>
<td>event_prediction_prior</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Event prediction using patient-level survival data, prior data and a recruitment RCurve</h2>

<h3>Description</h3>

<p>This performs event prediction with a Weibull distribution integrating (weighted) prior data .<br>
Where relevant prior data is available, this function can increase the precision of curve fitting, particularly in cases where there is low data maturity.<br>
This function uses the fit_tte_data_prior function to fit a Weibull distribution to the provided survival data by including weighted prior patient-level data.<br>
An event Curve object is created, which is then used in the same way as that from the frequentist approach in event_prediction.<br>
It consequently operates very similarly to event_prediction in terms of inputs, outputs and methods. Consult its documentation for aspects unrelated to the prior approach.<br>
If a patient-level prior data set is not available, use the create_tte_prior function to create an artificial one from a distribution.
Note that this may cause a small amount of over-precision; this may be minimised by deriving the prior data using a different distribution or specifying down-weighting.<br>
Prior data can be down-weighted using the priorweight variable. Some degree of down-weighting is generally recommended to reflect differences with prior trials.<br>
Column names and the censoring parity in the prior data set are by default the same as those specified for the main data set, but may be manually changed to be different.<br></p>


<h3>Usage</h3>

<pre><code class="language-R">event_prediction_prior(
  data,
  Time = "Time",
  Event = "Event",
  censoringOne = FALSE,
  priordata,
  priorTime = Time,
  priorEvent = Event,
  priorcensoringOne = censoringOne,
  priorweight = 1,
  type = c("Weibull"),
  rcurve,
  max_time = 100,
  dcurve = Blank(),
  CI = NULL,
  PI = 0.95,
  condition = NULL,
  cond_Events = NULL,
  cond_NatRisk = NULL,
  cond_Time = NULL,
  units = c("Days", "Months"),
  init = NULL,
  discountHR = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>The dataframe object containing the patient-level survival data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Time</code></td>
<td>
<p>The column name for the times in the 'data' set. Default is "Time"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Event</code></td>
<td>
<p>The column name for the events column (i.e. the binary variable denoting events vs censorings) in the 'data' set. Default is "Event"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>censoringOne</code></td>
<td>
<p>Specify whether in the 'data' set censoring is denoted by a one (TRUE) or zero (FALSE). Default=FALSE (censorings denoted by 0, events by 1)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priordata</code></td>
<td>
<p>The dataframe object containing the patient-level survival data for the prior</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorTime</code></td>
<td>
<p>The column name for the times in the 'priordata' set. Default= Value specified for Time</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorEvent</code></td>
<td>
<p>The column name for the events column (i.e. the binary variable denoting events vs censorings) in the 'priordata' set. Default= Value specified for Event</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorcensoringOne</code></td>
<td>
<p>Specify whether in the 'priordata' set censoring is denoted by a one (TRUE) or zero (FALSE). Default= Value specified for censoringOne</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorweight</code></td>
<td>
<p>The weight that should be allocated to each patient's data in the prior data, typically between 0 and 1. 0 implies prior data is ignored, 1 that prior patient data is given full weight, i.e. prior patients are exchangeable with observed patients. Default = 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>Type of event curve to fit. Default is "Automatic", fitting both Weibull and Log-normal curves.
Alternatively accepts "Weibull", "Lognormal" or "Exponential" to force the type.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rcurve</code></td>
<td>
<p>Observed and/or expected recruitment distribution as an RCurve object. This should typically be of PieceR type (piecewise linear recruitment).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_time</code></td>
<td>
<p>Maximum time to predict events up to.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dcurve</code></td>
<td>
<p>Dropout/censoring distribution as a Curve object. This is Blank() by default, i.e. no dropout.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CI</code></td>
<td>
<p>DEPRECATED As of version 1.4.0 this argument has been renamed to 'PI'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PI</code></td>
<td>
<p>Number between 0 and 1 for the size of prediction interval to calculate. As of 1.4.0 this replaces the 'CI' argument. Default is 0.95 (95 percent prediction interval).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>condition</code></td>
<td>
<p>DEPRECATED This argument has been removed as of version 1.4.0. Specifying a value for 'cond_Events' will now enable conditioned predictions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cond_Events</code></td>
<td>
<p>Number of observed events at the conditioning time to condition on. If NULL, no conditioned event prediction will be performed. Default=NULL (no conditioning).
Note that if the discountHR option is used to predict adjusted event numbers, it would be possible to condition on either observed or adjusted events, but the observed number is required by this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cond_NatRisk</code></td>
<td>
<p>Number of patients at risk to condition on. Default=NULL.
By default, the program will estimate the number at risk assuming no censoring. It is highly recommended to specify this if conditioning.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cond_Time</code></td>
<td>
<p>Time, in months, to condition on. A non-negative integer less than max_time is required if conditioning is requested, i.e. cond_Events is non-NULL. Not required otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>units</code></td>
<td>
<p>Units that the KM-curve is specified in. Accepts "Days", "Months". Default="Days".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init</code></td>
<td>
<p>Vector of starting values for parameter values; useful if survreg experiences convergence issues. Default=NULL (no values specified)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>discountHR</code></td>
<td>
<p>Hazard ratio for discounting events e.g. used to predict adjudicated events from unadjudicated data where patients remain 'at risk' after an event is adjudicated not to have occurred.
Values below 1 indicate fewer events will occur than predicted by the curve-fitting.
When a discountHR is user-specified (i.e. not 1), conditioning event numbers need to be specified in terms of observed values, and not adjusted ones.
Note that changing this argument is only allowed if type="Weibull" since log-normal curves are not compatible with proportional hazards.
If patients become not at risk following a failed adjudication (i.e. removed from study), do not use this argument and instead adjust the output event numbers by the required factor.
Default=1 (No discounting for adjudication)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a list object with the prediction ecurve (after adjustments for unit, discountHR), dcurve, rcurve, required PI, original fitted ecurve parameters (before adjustments)
and a summary table with one row per month up to max_time containing the following columns:
</p>

<ul>
<li>
<p>"Assessment_Time"Time of assessment.
</p>
</li>
<li>
<p>"Patients"Number of patients recruited by the assessment time.
</p>
</li>
<li>
<p>"Predicted_Events"Number of events unconditionally predicted at the assessment time.
</p>
</li>
<li>
<p>"SE_Fitting"SE of the estimate of the fitted mean. Note that this corresponds to the accuracy of the estimate of the underlying parameter, not future observed event numbers.
</p>
</li>
<li>
<p>"SE_Prediction"SE of event prediction.
</p>
</li>
<li>
<p>"Prediction_Lower"Lower bound of X percent interval of unconditional event prediction, where X is the 'PI' argument. This PI is based on the quantiles of the beta-binomial distribution and so is discrete and asymmetric.
</p>
</li>
<li>
<p>"Prediction_Upper"Upper bound of X percent interval of unconditional event prediction, where X is the 'PI' argument. This PI is based on the quantiles of the beta-binomial distribution and so is discrete and asymmetric.
</p>
</li>
<li>
<p>"Conditioned_Events"Number of events conditionally predicted at the assessment time (Column present only if conditioning specified).
</p>
</li>
<li>
<p>"Cond_SE_Fitting"SE of the estimate of the fitted conditional mean. Note that this corresponds to the accuracy of the estimate of the underlying parameter, not future observed event numbers (Column present only if conditioning specified).
</p>
</li>
<li>
<p>"Cond_SE_Prediction"SE of the conditional event prediction (Column present only if conditioning specified).
</p>
</li>
<li>
<p>"Cond_Prediction_Lower"Lower bound of X percent interval of conditional event prediction, where X is the 'PI' argument. This PI is based on the quantiles of the beta-binomial distribution and so is discrete and asymmetric.
</p>
</li>
<li>
<p>"Cond_Prediction_Upper"Upper bound of X percent interval of conditional event prediction, where X is the 'PI' argument. This PI is based on the quantiles of the beta-binomial distribution and so is discrete and asymmetric.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>James Bell
</p>


<h3>References</h3>

<p>Bell J, unpublished work.
</p>


<h3>Examples</h3>

<pre><code class="language-R">recruit &lt;- PieceR(matrix(c(rep(1,12),10,15,25,30,45,60,55,50,65,60,55,30),ncol=2),1)
trial_short &lt;- simulate_trials(active_ecurve=Weibull(50,0.8),control_ecurve=Weibull(50,0.8),
rcurve=recruit, assess=10,iterations=1,seed=12345,detailed_output=TRUE,Event="Event",
censoringOne=FALSE)
example_prior &lt;- create_tte_prior(curve=Weibull(alpha=100,beta=0.8),duration=20,events=50)

predictions &lt;- event_prediction_prior(data=trial_short, priordata=example_prior,
type="Weibull", rcurve=recruit, max_time=60, cond_Events=49, cond_NatRisk=451,
cond_Time=10, units="Months")
</code></pre>


</div>