<div class="container">

<table style="width: 100%;"><tr>
<td>imputation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Imputation of missing cells in two-way data sets</h2>

<h3>Description</h3>

<p>Missing values are not allowed by the AMMI or GGE methods. This function
provides several methods to impute missing observations in data from
multi-environment trials and to subsequently adjust the mentioned methods.
</p>


<h3>Usage</h3>

<pre><code class="language-R">imputation(
  Data,
  genotype = "gen",
  environment = "env",
  response = "yield",
  rep = NULL,
  type = "EM-AMMI",
  nPC = 2,
  initial.values = NA,
  precision = 0.01,
  maxiter = 1000,
  change.factor = 1,
  simplified.model = FALSE,
  scale = TRUE,
  method = "EM",
  row.w = NULL,
  coeff.ridge = 1,
  seed = NULL,
  nb.init = 1,
  Winf = 0.8,
  Wsup = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Data</code></td>
<td>
<p>dataframe containing genotypes, environments, repetitions (if any)
and the phenotypic trait of interest. Other variables that will not be used
in the analysis can be present.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>genotype</code></td>
<td>
<p>column name containing genotypes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>environment</code></td>
<td>
<p>column name containing environments.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>response</code></td>
<td>
<p>column name containing the phenotypic trait.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rep</code></td>
<td>
<p>column name containing replications. If this argument is NULL,
there are no replications available in the data. Defaults to NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>imputation method. Either "EM-AMMI",
"Gabriel","WGabriel","EM-PCA". Defaults to "EM-AMMI".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nPC</code></td>
<td>
<p>number of components used to predict the missing values.
Default to 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial.values</code></td>
<td>
<p>initial values of the missing cells. It can be a single
value or a vector of length equal to the number of missing cells (starting
from the missing values in the first column). If omitted, the initial values
will be obtained by the main effects from the corresponding model, that is,
by the grand mean of the observed data increased (or decreased) by row and
column main effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>precision</code></td>
<td>
<p>threshold for assessing convergence.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>maximum number of iteration for the algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>change.factor</code></td>
<td>
<p>When 'change.factor' is equal to 1, the previous
approximation is changed with the new values of missing cells (standard
EM-AMMI algorithm). However, when 'change.factor' less than 1, then the new
approximations are computed and the values of missing cells are changed in
the direction of this new approximation but the change is smaller. It could
be useful if the changes are cyclic and thus convergence could not be
reached. Usually, this argument should not affect the final outcome (that
is, the imputed values) as compared to the default value of 'change.factor'
= 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simplified.model</code></td>
<td>
<p>the AMMI model contains the general mean, effects of
rows, columns and interaction terms. So the EM-AMMI algorithm in step 2
calculates the current effects of rows and columns; these effects change
from iteration to iteration because the empty (at the outset) cells in each
iteration are filled with different values. In step 3 EM-AMMI uses those
effects to re-estimate cells marked as missed (as default,
simplified.model=FALSE). It is, however, possible that this procedure will
not converge. Thus the user is offered a simplified EM-AMMI procedure that
calculates the general mean and effects of rows and columns only in the
first iteration and in next iterations uses these values
(simplified.model=TRUE). In this simplified procedure the initial values
affect the outcome (whilst EM-AMMI results usually do not depend on initial
values). For the simplified procedure the number of iterations to
convergence is usually smaller and, furthermore, convergence will be reached
even in some cases where the regular procedure fails. If the regular
procedure does not converge for the standard initial values, the simplified
model can be used to determine a better set of initial values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>boolean. By default TRUE leading to a same weight for each
variable</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>"Regularized" by default or "EM"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>row.w</code></td>
<td>
<p>row weights (by default, a vector of 1 for uniform row weights)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coeff.ridge</code></td>
<td>
<p>1 by default to perform the regularized imputePCA
algorithm; useful only if method="Regularized". Other regularization terms
can be implemented by setting the value to less than 1 in order to
regularized less (to get closer to the results of the EM method</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>integer, by default seed = NULL implies that missing values are
initially imputed by the mean of each variable. Other values leads to a
random initialization</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nb.init</code></td>
<td>
<p>integer corresponding to the number of random initializations;
the first initialization is the initialization with the mean imputation</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Winf</code></td>
<td>
<p>peso inferior</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Wsup</code></td>
<td>
<p>peso superior</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Often, multi-environment experiments are unbalanced because several genotypes
are not tested in some environments. Several methodologies have been proposed
in order to solve this lack of balance caused by missing values, some of which
are included in this function:
</p>

<ul>
<li>
<p> EM-AMMI: an iterative scheme built round the above procedure is used to
obtain AMMI imputations from the EM algorithm. The additive parameters are
initially set by computing the grand mean, genotype means and environment
means obtained from the observed data. The residuals for the observed cells
are initialized as the cell mean minus the genotype mean minus the environment
mean plus the grand mean, and interactions for the missing positions are
initially set to zero. The initial multiplicative parameters are obtained from
the SVD of this matrix of residuals, and the missing values are filled by the
appropriate AMMI estimates. In subsequent iterations, the usual AMMI procedure
is applied to the completed matrix and the missing values are updated by the
corresponding AMMI estimates. The arguments used for this method
are:initial.values, precision, maxiter, change.factor and simplified.model
</p>
</li>
<li>
<p> Gabriel: combines regression and lower-rank approximation using SVD.
This method initially replaces the missing cells by arbitrary values, and
subsequently the imputations are refined through an iterative scheme that
defines a partition of the matrix for each missing value in turn and uses a
linear regression of columns (or rows) to obtain the new imputation. The
arguments used for this method is only the dataframe.
</p>
</li>
<li>
<p> WGabriel: is a a modification of Gabriel method that uses weights chosen
by cross-validation. The arguments used for this method are Winf and Wsup.
</p>
</li>
<li>
<p> EM-PCA: impute the missing entries of a mixed data using the iterative
PCA algorithm. The algorithm first consists imputing missing values with
initial values. The second step of the iterative PCA algorithm is to perform
PCA on the completed dataset to estimate the parameters. Then, it imputes the
missing values with the reconstruction formulae of order nPC (the fitted
matrix computed with nPC components for the scores and loadings). These steps
of estimation of the parameters via PCA and imputation of the missing values
using the fitted matrix are iterate until convergence. The arguments used for
this methods are: nPC, scale, method, row.w, coeff.ridge, precision, seed,
nb.init and maxiter
</p>
</li>
</ul>
<h3>Value</h3>

<p>imputed data matrix
</p>


<h3>References</h3>

<p>Paderewski, J. (2013). <em>An R function for imputation of missing
cells in two-way data sets by EM-AMMI algorithm</em>. Communications in Biometry
and Crop Science 8, 60–69.
</p>
<p>Julie Josse, Francois Husson (2016). missMDA: A Package for
Handling Missing Values in Multivariate Data Analysis. Journal of
Statistical Software 70, 1-31.
</p>
<p>Arciniegas-Alarcón S., García-Peña M., Dias C.T.S., Krzanowski
W.J. (2010). <em>An alternative methodology for imputing missing data in
trials with genotype-by-environment interaction</em>. Biometrical Letters 47,
1–14.
</p>
<p>Arciniegas-Alarcón S., García-Peña M., Krzanowski W.J., Dias
C.T.S. (2014). <em>An alternative methodology for imputing missing data in
trials with genotype-byenvironment interaction: some new aspects.</em>
Biometrical Letters 51, 75-88.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(geneticae)
# Data without replications
library(agridat)
data(yan.winterwheat)

# generating missing values
yan.winterwheat[1,3]&lt;-NA
yan.winterwheat[3,3]&lt;-NA
yan.winterwheat[2,3]&lt;-NA

imputation(yan.winterwheat, genotype = "gen", environment = "env",
           response = "yield", type = "EM-AMMI")

# Data with replications
data(plrv)
plrv[1,3] &lt;- NA
plrv[3,3] &lt;- NA
plrv[2,3] &lt;- NA
imputation(plrv, genotype = "Genotype", environment = "Locality",
           response = "Yield", rep = "Rep", type = "EM-AMMI")

</code></pre>


</div>