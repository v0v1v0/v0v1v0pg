<div class="container">

<table style="width: 100%;"><tr>
<td>haRmonics</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Harmonic analysis for time series</h2>

<h3>Description</h3>

<p>Fits harmonic regression models, that is, computes amplitudes and phase angles 
in the typical harmonic regression framework. When <code>method=harmR</code> the ordinary
least squares method is used, when <code>method=wls_harmR</code> then, weighted least squares
are employed. Based on these estimates a harmonic regression function is fitted. 
Also fits <code>hants</code>, a popular iterative algorithm that computes amplitudes and phase angles in the 
harmonic regression framework. As part of the iterative algorithm, observations
are being excluded from the design matrix of the regression model if the distance
between them and the fitted curve exceeds the value of the parameter <code>fitErrorTol</code>.
<code>hants</code> is based on implementations with the same name written in Fortran 
and Matlab computer languages.
</p>


<h3>Usage</h3>

<pre><code class="language-R">haRmonics(
  y,
  method = c("harmR", "wls_harmR", "hants"),
  sigma = NULL,
  ts = 1:length(y),
  lenPeriod = length(y),
  numFreq,
  HiLo = c("Hi", "Lo"),
  low,
  high,
  fitErrorTol,
  degreeOverDeter,
  delta
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>numeric vector containing time series on which harmonic 
regression will be fitted. Missing values are not allowed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>character specifying algorithm to apply: <code>harmR</code> (default),
<code>wls_harmR</code> (heteroscedastic model) or <code>hants</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>numeric vector of length <code>lenPeriod</code> containing variance estimates.
Default set <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ts</code></td>
<td>
<p>numeric vector of <code>length(y)</code> with the sampling
points for <code>y</code>. Default is <code class="reqn">ts[i] = i, i=1,\ldots, 
\code{length(y)}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lenPeriod</code></td>
<td>
<p>numeric giving the length of the base period, reported in 
samples, e.g. days, dekads, months, years, etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numFreq</code></td>
<td>
<p>numeric indicating the total number of frequencies to be 
used in harmonic regression. For technical reasons, <code>2*numFreq+1</code>
must be lesser than <code>length(y)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>HiLo</code></td>
<td>
<p>character indicating whether high or low outliers must be rejected
when <code>method=hants</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>low</code></td>
<td>
<p>numeric giving minimum valid value of fitted harmonic regression 
function when <code>method=hants</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>high</code></td>
<td>
<p>numeric giving maximum valid value of fitted harmonic regression
function when <code>method=hants</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitErrorTol</code></td>
<td>
<p>numeric giving maximum allowed distance between observations and fitted
curve; if difference between a given observation and its fitted value 
exceeds <code>fitErrorTol</code> then this observation will not be included
in the fitting procedure in the next iteration of the algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>degreeOverDeter</code></td>
<td>
<p>numeric; iteration stops when number of observations equals
number of observations for curve fitting plus <code>degreeOverDeter</code>;
the latter in turns is by definition <code>length(y)</code> minus
<code>min(2 * numFreq+1, length(y))</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>numeric (positive) giving a (small) regularization parameter to prevent 
non-invertible hat matrix (see <b>Details</b>), probably caused by high
amplitudes.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Methods <code>harmR</code> and <code>wls_harmR</code> do not allow missing values 
and utilize parameters <code>y</code>, <code>lenPeriod</code>, <code>numFreq</code> and <code>delta</code> 
only. 
</p>
<p>Method <code>hants</code> utilizes all the parameters presented above. This method 
does not allow missing values. Missing values in <code>y</code> must be substituted by values 
considerably out of observations range.
</p>


<h3>Value</h3>

<p>A list containing:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>a.coef</code></td>
<td>
<p>a numeric vector with estimates of cosine coefficients</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b.coef</code></td>
<td>
<p>a numeric vector with estimates of sine coefficients</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>amplitude</code></td>
<td>
<p>a numeric vector with amplitude estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phase</code></td>
<td>
<p>a numeric vector with phase estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitted</code></td>
<td>
<p>a numeric vector with fitted values via harmonic regression.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p><code>lenBasePeriod</code> was used until version 0.1.3, this argument has been
replaced by <code>lenPeriod</code>.
</p>


<h3>References</h3>

<p>Roerink, G.J., Menenti, M., Verhoef, W. (2000).
<em>Reconstructing cloudfree NDVI composites using Fourier analysis of time series</em>, 
Int. J. Remote Sensing, <b>21(9)</b>, 1911–1917.
</p>
<p>Jakubauskas, M., Legates, D., Kastens, J. (2001).
<em>Harmonic analysis of time-series AVHRR NDVI data</em>,
Photogrammetric Engineering and Remote Sensing, <b>67(4)</b>, 461–470.
</p>
<p>The Matlab implementation of HANTS can be found 
<a href="https://nl.mathworks.com/matlabcentral/fileexchange/38841-matlab-implementation-of-harmonic-analysis-of-time-series-hants">here</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">y &lt;- c(5, 2, 5, 10, 12, 18, 20, 23, 27, 30, 40, 60, 66,
70, 90, 120, 160, 190, 105, 210, 104, 200, 90, 170,
50, 120, 80, 60, 50, 40, 30, 28, 24, 20, 15, 10)
# -------------------------------------------------------------------------- 
fit_harmR &lt;- haRmonics(y = y, numFreq = 3, delta = 0.1)
fitLow_hants &lt;- haRmonics(y = y, method = "hants", numFreq = 3, HiLo = "Lo", 
                         low = 0, high = 255, fitErrorTol = 5, degreeOverDeter = 1, 
                         delta = 0.1)
fitHigh_hants &lt;- haRmonics(y = y, method = "hants", numFreq = 3, HiLo = "Hi", 
                          low = 0, high = 255, fitErrorTol = 5, degreeOverDeter = 1, 
                          delta = 0.1)
plot(y, pch = 16, main = "haRmonics fitting")
lines(fit_harmR$fitted ,lty = 4, col = "green")
lines(fitLow_hants$fitted, lty = 4, col = "red")
lines(fitHigh_hants$fitted, lty = 2, col = "blue")
# -------------------------------------------------------------------------- 
# Substituting missing value by a number outside observations range
# -------------------------------------------------------------------------- 
y1 &lt;- y
y1[20] &lt;- -10

fitLow_hants_missing &lt;- haRmonics(y = y1, method = "hants", numFreq = 3, HiLo = "Lo", 
                                 low = 0, high = 255, fitErrorTol = 5, degreeOverDeter = 1, 
                                 delta = 0.1)
fitHigh_hants_missing &lt;- haRmonics(y = y1, method = "hants", numFreq = 3, HiLo = "Hi", 
                                  low = 0, high = 255, fitErrorTol = 5, degreeOverDeter = 1, 
                                  delta = 0.1)
fit_harmR_missing &lt;- haRmonics(y = y1, numFreq = 3, delta = 0.1)

plot(y1, pch = 16, main = "haRmonics fitting (missing values)", ylim = c(-1,210))
lines(fitLow_hants_missing$fitted, lty = 4, col = "red")
lines(fitHigh_hants_missing$fitted, lty = 2, col = "blue")
lines(fit_harmR_missing$fitted, lty = 4, col = "green")

</code></pre>


</div>