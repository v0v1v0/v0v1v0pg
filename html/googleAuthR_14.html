<div class="container">

<table style="width: 100%;"><tr>
<td>gar_batch_walk</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Walk data through batches</h2>

<h3>Description</h3>

<p>Convenience function for walking through data in batches
</p>


<h3>Usage</h3>

<pre><code class="language-R">gar_batch_walk(
  f,
  walk_vector,
  gar_pars = NULL,
  gar_paths = NULL,
  the_body = NULL,
  pars_walk = NULL,
  path_walk = NULL,
  body_walk = NULL,
  batch_size = 10,
  batch_function = NULL,
  data_frame_output = TRUE,
  ...,
  batch_endpoint = getOption("googleAuthR.batch_endpoint", default =
    "https://www.googleapis.com/batch")
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>f</code></td>
<td>
<p>a function from <code>gar_api_generator</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>walk_vector</code></td>
<td>
<p>a vector of the parameter or path to change</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gar_pars</code></td>
<td>
<p>a list of parameter arguments for f</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gar_paths</code></td>
<td>
<p>a list of path arguments for f</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>the_body</code></td>
<td>
<p>a list of body arguments for f</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pars_walk</code></td>
<td>
<p>a character vector of the parameter(s) to modify for each walk of f</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path_walk</code></td>
<td>
<p>a character vector of the path(s) to modify for each walk of f</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>body_walk</code></td>
<td>
<p>a character vector of the body(s) to modify for each walk of f</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>batch_size</code></td>
<td>
<p>size of each request to Google /batch API</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>batch_function</code></td>
<td>
<p>a function that will act on the result list of each batch API call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data_frame_output</code></td>
<td>
<p>if the list of lists are dataframes, you can bind them all by setting to TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to the data parse function of f</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>batch_endpoint</code></td>
<td>
<p>the batch API endpoint to send</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>You can modify more than one parameter or path arg, 
but it must be the same walked vector e.g. <code>start = end = x</code>
</p>
<p>Many Google APIs have <code>batch_size</code> limits greater than 10, 1000 is common.
</p>
<p>The 'f' function needs to be a 'gar_api_generator()' function that uses one of 'path_args', 'pars_args' or 'body_args' to construct the URL (rather than say using 'sprintf()' to create the API URL). 
</p>
<p>You don't need to set the headers in the Google docs for batching API functions - those are done for you.
</p>
<p>The argument 'walk_vector' needs to be a vector of the values of the arguments to walk over, which you indicate will walk over the pars/path or body arguments on the function via on of the '*_walk' arguments e.g. if walking over id=1, id=2, for a path argument then it would be 'path_walk="id"' and 'walk_vector=c(1,2,3,4)'
</p>
<p>The 'gar_*' parameter is required to pass intended for other arguments to the function 'f' you may need to pass through.
</p>
<p>'gar_batch_walk()' only supports changing one value at a time, for one or multiple arguments (I think only changing the 'start-date', 'end-date' example would be the case when you walk through more than one per call)
</p>
<p>'batch_size' should be over 1 for batching to be of any benefit at all
</p>
<p>The 'batch_function' argument gives you a way to operate on the parsed output of each call
</p>


<h3>Value</h3>

<p><strong>if data_frame_output is FALSE</strong>: A list of lists.  
Outer list the length of number of batches required, inner lists the results from the calls
</p>
<p><strong>if data_frame_output is TRUE</strong>: The list of lists will attempt to rbind all the results
</p>


<h3>See Also</h3>

<p>Other batch functions: 
<code>gar_batch()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
                               

# get a webproperty per account 
getAccountInfo &lt;- gar_api_generator(
  "https://www.googleapis.com/analytics/v3/management/accounts",
  "GET", data_parse_function = function(x) unique(x$items$id))

getWebpropertyInfo &lt;- gar_api_generator(
  "https://www.googleapis.com/analytics/v3/management/", # don't use sprintf to construct this
  "GET",
  path_args = list(accounts = "default", webproperties = ""),
  data_parse_function = function(x) x$items)

walkData &lt;- function(){

  # here due to R lazy evaluation  
  accs &lt;- getAccountInfo()
  gar_batch_walk(getWebpropertyInfo, 
                 walk_vector = accs,
                 gar_paths = list("webproperties" = ""),
                 path_walk = "accounts",
                 batch_size = 100, data_frame_output = FALSE)
                 }
                 
# do the walk
walkData()

# to walk body data, be careful to modify a top level body name:
changed_emails &lt;- lapply(email, function(x){userRef = list(email = x)})

batched &lt;- gar_batch_walk(users, 
                       walk_vector = changed_emails, 
                       the_body = list(
                           permissions = list(
                             local = list(permissions)
                           ),
                           userRef = list(
                             email = email[[1]]
                         )
                        ),
                        body_walk = "userRef",
                        batch_size = 300,
                        data_frame_output = FALSE)

## End(Not run)



</code></pre>


</div>