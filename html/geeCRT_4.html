<div class="container">

<table style="width: 100%;"><tr>
<td>geemaee</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>GEE and Matrix-adjusted Estimating Equations (MAEE) for Estimating the Marginal Mean and Correlation Parameters in CRTs</h2>

<h3>Description</h3>

<p>geemaee implements the GEE and matrix-adjusted estimating equations (MAEE) for analyzing cluster randomized trials (CRTs). It supports estimation and inference for the
marginal mean and intraclass correlation parameters within the population-averaged modeling framework. With suitable choice of the design matrices, the function can be used to analyze
parallel, crossover and stepped wedge cluster randomized trials. The program also offers bias-corrected intraclass correlation estimates, as well as bias-corrected sandwich variances for both the marginal mean and correlation parameters.
The technical details of the GEE and MAEE approach are provided in Preisser (2008) and Li et al. (2018, 2019).
</p>


<h3>Usage</h3>

<pre><code class="language-R">geemaee(
  y,
  X,
  id,
  Z,
  family,
  link = NULL,
  maxiter = 500,
  epsilon = 0.001,
  printrange = TRUE,
  alpadj = FALSE,
  shrink = "ALPHA",
  makevone = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>a vector specifying the outcome variable across all clusters</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>design matrix for the marginal mean model, including the intercept</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>a vector specifying cluster identifier</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>design matrix for the correlation model, should be all pairs j &lt; k for each cluster</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>See corresponding documentation to <code>glm</code>. The current version supports <code>'continuous'</code>, <code>'binomial'</code>, <code>'poisson'</code> and <code>'quasipoisson'</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>link</code></td>
<td>
<p>a specification for the model link function name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxiter</code></td>
<td>
<p>maximum number of iterations for Fisher scoring updates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>epsilon</code></td>
<td>
<p>tolerance for convergence. The default is 0.001</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>printrange</code></td>
<td>
<p>print details of range violations. The default is <code>TRUE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpadj</code></td>
<td>
<p>if <code>TRUE</code>, performs bias adjustment for the correlation estimating equations. The default is <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shrink</code></td>
<td>
<p>method to tune step sizes in case of non-convergence including <code>'THETA'</code> or <code>'ALPHA'</code>. The default is <code>'ALPHA'</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>makevone</code></td>
<td>
<p>if <code>TRUE</code>, it assumes unit variances for the correlation parameters in the correlation estimating equations. The default is <code>TRUE</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>outbeta</code> estimates of marginal mean model parameters and standard errors with different finite-sample bias corrections.
The current version supports model-based standard error (MB), the sandwich standard error (BC0) extending Liang and Zeger (1986),
the sandwich standard errors (BC1) extending Kauermann and Carroll (2001), the sandwich standard errors (BC2) extending Mancl and DeRouen (2001),
and the sandwich standard errors (BC3) extending the Fay and Graubard (2001). A summary of
these bias-corrections can also be found in Lu et al. (2007), and Li et al. (2018).
</p>
<p><code>outalpha</code> estimates of intraclass correlation parameters and standard errors with different finite-sample bias corrections.
The current version supports the sandwich standard error (BC0) extending Zhao and Prentice (2001),
the sandwich standard errors (BC1) extending Kauermann and Carroll (2001), the sandwich standard errors (BC2) extending
Mancl and DeRouen (2001), and the sandwich standard errors (BC3) extending the Fay and Graubard (2001). A summary of
these bias-corrections can also be found in Preisser et al. (2008).
</p>
<p><code>beta</code> a vector of estimates for marginal mean model parameters
</p>
<p><code>alpha</code> a vector of estimates of correlation parameters
</p>
<p><code>MB</code> model-based covariance estimate for the marginal mean model parameters
</p>
<p><code>BC0</code> robust sandwich covariance estimate of the marginal mean model and correlation parameters
</p>
<p><code>BC1</code> robust sandwich covariance estimate of the marginal mean model and correlation parameters with the
Kauermann and Carroll (2001) correction
</p>
<p><code>BC2</code> robust sandwich covariance estimate of the marginal mean model and correlation parameters with the
Mancl and DeRouen (2001) correction
</p>
<p><code>BC3</code> robust sandwich covariance estimate of the marginal mean model and correlation parameters with the
Fay and Graubard (2001) correction
</p>
<p><code>niter</code> number of iterations used in the Fisher scoring updates for model fitting
</p>


<h3>Author(s)</h3>

<p>Hengshi Yu &lt;hengshi@umich.edu&gt;, Fan Li &lt;fan.f.li@yale.edu&gt;, Paul Rathouz &lt;paul.rathouz@austin.utexas.edu&gt;, Elizabeth L. Turner &lt;liz.turner@duke.edu&gt;, John Preisser &lt;jpreisse@bios.unc.edu&gt;
</p>


<h3>References</h3>

<p>Liang, K. Y., Zeger, S. L. (1986). Longitudinal data analysis using generalized linear models. Biometrika, 73(1), 13-22.
</p>
<p>Prentice, R. L. (1988). Correlated binary regression with covariates specific to each binary observation. Biometrics, 1033-1048.
</p>
<p>Zhao, L. P., Prentice, R. L. (1990). Correlated binary regression using a quadratic exponential model. Biometrika, 77(3), 642-648.
</p>
<p>Prentice, R. L., Zhao, L. P. (1991). Estimating equations for parameters in means and covariances of multivariate discrete and continuous responses. Biometrics, 825-839.
</p>
<p>Sharples, K., Breslow, N. (1992). Regression analysis of correlated binary data: some small sample results for the estimating equation approach. Journal of Statistical Computation and Simulation, 42(1-2), 1-20.
</p>
<p>Mancl, L. A., DeRouen, T. A. (2001). A covariance estimator for GEE with improved small sample properties. Biometrics, 57(1), 126-134.
</p>
<p>Kauermann, G., Carroll, R. J. (2001). A note on the efficiency of sandwich covariance matrix estimation. Journal of the American Statistical Association, 96(456), 1387-1396.
</p>
<p>Fay, M. P., Graubard, B. I. (2001). Small sample adjustments for Wald type tests using sandwich estimators. Biometrics, 57(4), 1198-1206.
</p>
<p>Lu, B., Preisser, J. S., Qaqish, B. F., Suchindran, C., Bangdiwala, S. I., Wolfson, M. (2007). A comparison of two bias corrected covariance estimators for generalized estimating equations. Biometrics, 63(3), 935-941.
</p>
<p>Preisser, J. S., Lu, B., Qaqish, B. F. (2008). Finite sample adjustments in estimating equations and covariance estimators for intracluster correlations. Statistics in Medicine, 27(27), 5764-5785.
</p>
<p>Li, F., Turner, E. L., Preisser, J. S. (2018). Sample size determination for GEE analyses of stepped wedge cluster randomized trials. Biometrics, 74(4), 1450-1458.
</p>
<p>Li, F., Forbes, A. B., Turner, E. L., Preisser, J. S. (2019). Power and sample size requirements for GEE analyses of cluster randomized crossover trials. Statistics in Medicine, 38(4), 636-649.
</p>
<p>Li, F. (2020). Design and analysis considerations for cohort stepped wedge cluster randomized trials with a decay correlation structure. Statistics in Medicine, 39(4), 438-455.
</p>
<p>Li, F., Yu, H., Rathouz, P. J., Turner, E. L., &amp; Preisser, J. S. (2022). Marginal modeling of cluster-period means and intraclass correlations in stepped wedge designs with binary outcomes. Biostatistics, 23(3), 772-788.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Simulated SW-CRT examples

#################################################################
### function to create the design matrix for correlation parameters
### under the nested exchangeable correlation structure
#################################################################
createzCrossSec &lt;- function(m) {
  Z &lt;- NULL
  n &lt;- dim(m)[1]
  for (i in 1:n) {
    alpha_0 &lt;- 1
    alpha_1 &lt;- 2
    n_i &lt;- c(m[i, ])
    n_length &lt;- length(n_i)
    POS &lt;- matrix(alpha_1, sum(n_i), sum(n_i))
    loc1 &lt;- 0
    loc2 &lt;- 0
    for (s in 1:n_length) {
      n_t &lt;- n_i[s]
      loc1 &lt;- loc2 + 1
      loc2 &lt;- loc1 + n_t - 1
      for (k in loc1:loc2) {
        for (j in loc1:loc2) {
          if (k != j) {
            POS[k, j] &lt;- alpha_0
          } else {
            POS[k, j] &lt;- 0
          }
        }
      }
    }
    zrow &lt;- diag(2)
    z_c &lt;- NULL
    for (j in 1:(sum(n_i) - 1)) {
      for (k in (j + 1):sum(n_i)) {
        z_c &lt;- rbind(z_c, zrow[POS[j, k], ])
      }
    }
    Z &lt;- rbind(Z, z_c)
  }
  return(Z)
}

########################################################################
### Example 1): simulated SW-CRT with smaller cluster-period sizes (5~10)
########################################################################

sampleSWCRT &lt;- sampleSWCRTSmall

###############################################################
### Individual-level id, period, outcome, and design matrix ###
###############################################################

id &lt;- sampleSWCRT$id
period &lt;- sampleSWCRT$period
X &lt;- as.matrix(sampleSWCRT[, c("period1", "period2", "period3", "period4", "treatment")])

m &lt;- as.matrix(table(id, period))
n &lt;- dim(m)[1]
t &lt;- dim(m)[2]
### design matrix for correlation parameters
Z &lt;- createzCrossSec(m)

################################################################
### (1) Matrix-adjusted estimating equations and GEE
### on continous outcome with nested exchangeable correlation structure
################################################################

est_maee_ind_con &lt;- geemaee(
  y = sampleSWCRT$y_con, X = X, id = id,
  Z = Z, family = "continuous",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = TRUE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_maee_ind_con)


est_uee_ind_con &lt;- geemaee(
  y = sampleSWCRT$y_con, X = X, id = id,
  Z = Z, family = "continuous",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = FALSE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_uee_ind_con)


###############################################################
### (2) Matrix-adjusted estimating equations and GEE
### on binary outcome with nested exchangeable correlation structure
###############################################################

est_maee_ind_bin &lt;- geemaee(
  y = sampleSWCRT$y_bin, X = X, id = id,
  Z = Z, family = "binomial",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = TRUE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_maee_ind_bin)


### GEE
est_uee_ind_bin &lt;- geemaee(
  y = sampleSWCRT$y_bin, X = X, id = id,
  Z = Z, family = "binomial",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = FALSE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_uee_ind_bin)

###############################################################
### (3) Matrix-adjusted estimating equations and GEE
### on count outcome with nested exchangeable correlation structure
### using Poisson distribution
###############################################################
### MAEE
est_maee_ind_cnt_poisson = geemaee(
  y = sampleSWCRT$y_bin,
  X = X, id = id, Z = Z,
  family = "poisson",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = TRUE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_maee_ind_cnt_poisson)


### GEE
est_uee_ind_cnt_poisson = geemaee(
  y = sampleSWCRT$y_bin,
  X = X, id = id, Z = Z,
  family = "poisson",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = FALSE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_uee_ind_cnt_poisson)


###############################################################
### (4) Matrix-adjusted estimating equations and GEE
### on count outcome with nested exchangeable correlation structure
### using Quasi-Poisson distribution
###############################################################
### MAEE
est_maee_ind_cnt_quasipoisson = geemaee(
  y = sampleSWCRT$y_bin,
  X = X, id = id, Z = Z,
  family = "quasipoisson",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = TRUE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_maee_ind_cnt_quasipoisson)


### GEE
est_uee_ind_cnt_quasipoisson = geemaee(
  y = sampleSWCRT$y_bin,
  X = X, id = id, Z = Z,
  family = "quasipoisson",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = FALSE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_uee_ind_cnt_quasipoisson)


## This will elapse longer.
########################################################################
### Example 2): simulated SW-CRT with larger cluster-period sizes (20~30)
########################################################################

sampleSWCRT &lt;- sampleSWCRTLarge

###############################################################
### Individual-level id, period, outcome, and design matrix ###
###############################################################

id &lt;- sampleSWCRT$id
period &lt;- sampleSWCRT$period
X &lt;- as.matrix(sampleSWCRT[, c("period1", "period2", "period3", "period4", "period5", "treatment")])

m &lt;- as.matrix(table(id, period))
n &lt;- dim(m)[1]
t &lt;- dim(m)[2]
### design matrix for correlation parameters
Z &lt;- createzCrossSec(m)

################################################################
### (1) Matrix-adjusted estimating equations and GEE
### on continous outcome with nested exchangeable correlation structure
################################################################

### MAEE
est_maee_ind_con &lt;- geemaee(
  y = sampleSWCRT$y_con, X = X, id = id,
  Z = Z, family = "continuous",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = TRUE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_maee_ind_con)


### GEE
est_uee_ind_con &lt;- geemaee(
  y = sampleSWCRT$y_con, X = X, id = id,
  Z = Z, family = "continuous",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = FALSE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_uee_ind_con)

###############################################################
### (2) Matrix-adjusted estimating equations and GEE
### on binary outcome with nested exchangeable correlation structure
###############################################################

### MAEE
est_maee_ind_bin &lt;- geemaee(
  y = sampleSWCRT$y_bin, X = X, id = id,
  Z = Z, family = "binomial",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = TRUE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_maee_ind_bin)


### GEE
est_uee_ind_bin &lt;- geemaee(
  y = sampleSWCRT$y_bin, X = X, id = id,
  Z = Z, family = "binomial",
  maxiter = 500, epsilon = 0.001,
  printrange = TRUE, alpadj = FALSE,
  shrink = "ALPHA", makevone = FALSE
)
print(est_uee_ind_bin)


</code></pre>


</div>