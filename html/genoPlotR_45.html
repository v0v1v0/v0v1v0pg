<div class="container">

<table style="width: 100%;"><tr>
<td>seg_plot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
seg_plot class and class functions
</h2>

<h3>Description</h3>

<p>An seg_plot is an object to plot data associated to a <code>dna_seg</code>
object. It is a <code>list</code> with mandatory and optional arguments. The
main arguments are <code>func</code>, which is a function returning a
<code>grob</code> or a <code>gList</code>, and <code>args</code>, which
are arguments to be passed to this function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">seg_plot(func,
         args = NULL,
         xargs = c("x", "x0", "x1", "x2", "v"),
         yargs = c("y", "y0", "y1", "y2", "h"),
         ylim = NULL)
as.seg_plot(seg_plot)
is.seg_plot(seg_plot)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>func</code></td>
<td>

<p>Mandatory, with no defaults. A function that returns a <code>grob</code>
object. See <code>grid</code> documentation to find ready-made
functions. User-defined functions work too.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>args</code></td>
<td>

<p>A list, <code>NULL</code> by default. The arguments that will be passed to
the function. It is recommended that all arguments are named.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xargs</code></td>
<td>

<p>A vector giving the names of which of the arguments in <code>args</code>
are defining the x-axis. Used, among others, by the function
<code>trim.seg_plot</code>. By default, gives the most common
x-defining arguments of the <code>grid</code> functions (x, x0, x1, x2, v). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yargs</code></td>
<td>

<p>A vector giving the names of which of the arguments in <code>args</code>
are defining the y-axis. Used when plotting the graphs to define
a sensible <code>ylim</code> if not defined. By default, gives the most common
y-defining arguments of the <code>grid</code> functions (y, y0, y1, y2, h). 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>

<p>A numeric vector of length 2, defining the range of the plot when
drawn with <code>plot_gene_map</code>. Derived from <code>yargs</code> if
not set.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seg_plot</code></td>
<td>

<p>In <code>as.seg_plot</code>, a <code>list</code> object to convert to
<code>seg_plot</code>. See details below.
</p>
<p>In <code>is.seg_plot</code>, an object to test.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A <code>seg_plot</code> object is an object describing how to plot data
associated to a <code>dna_seg</code>. It is a list composed of a function,
arguments to pass to this function, two arguments to define which of
those define x and y, and an eventual <code>ylim</code> to limit the
plotting to a certain range when plotting.
</p>
<p>The function <code>func</code> should return a <code>grob</code> object, or a
<code>gList</code> list of <code>grob</code>s. The predefined functions of
<code>grid</code>, such as <code>linesGrob</code>, <code>pointsGrob</code>,
<code>segmentsGrob</code>, <code>textGrob</code> or <code>polygonGrob</code> can be
used, or user-defined functions can be defined.
</p>
<p>The arguments in <code>args</code> should correspond to arguments passed to
<code>func</code>. For example, if <code>func = pointsGrob</code>, <code>args</code>
could contain the elements <code>x = 10:1</code>, <code>y = 1:10</code>. It will
often also contain a <code>gp</code> element, the result of a call to the
<code>gpar</code> function, to control graphical aspects of the plot
such as color, fill, line width and style, fonts, etc.
</p>


<h3>Value</h3>

<p><code>seg_plot</code> and <code>as.seg_plot</code> return a <code>seg_plot</code> object.
<code>is.seg_plot</code> returns a logical.
</p>


<h3>Author(s)</h3>

<p>Lionel Guy
</p>


<h3>See Also</h3>

<p><code>plot_gene_map</code>, <code>trim.seg_plot</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Using the existing pointsGrob
x &lt;- 1:20
y &lt;- rnorm(20)
sp &lt;- seg_plot(func=pointsGrob, args=list(x=x, y=y,
                                  gp=gpar(col=1:20, cex=1:3)))
is.seg_plot(sp)
## Function seg_plot(...) is identical to as.seg_plot(list(...))
sp2 &lt;- as.seg_plot(list(func=pointsGrob, args=list(x=x, y=y,
                                           gp=gpar(col=1:20, cex=1:3))))
identical(sp, sp2)
## For the show, plot the obtained result
grb &lt;- do.call(sp$func, sp$args)
## Trim the seg_plot
sp_trim &lt;- trim(sp, c(3, 10))
## Changing color and function "on the fly"
sp_trim$args$gp$col &lt;- "blue"
sp_trim$func &lt;- linesGrob
grb_trim &lt;- do.call(sp_trim$func, sp_trim$args)
## Now plot
plot.new()
pushViewport(viewport(xscale=c(0,21), yscale=c(-4,4)))
grid.draw(grb)
grid.draw(grb_trim)

## Using home-made function
triangleGrob &lt;- function(start, end, strand, col, ...) {
  x &lt;- c(start, (start+end)/2, end)
  y1 &lt;- 0.5 + 0.4*strand
  y &lt;- c(y1, rep(0.5, length(y1)), y1)
  polygonGrob(x, y, gp=gpar(col=col), default.units="native",
              id=rep(1:7, 3))
}
start &lt;- seq(1, 19, by=3)+rnorm(7)/3
end &lt;- start + 1 + rnorm(7)
strand &lt;- sign(rnorm(7))
sp_tr &lt;- seg_plot(func=triangleGrob,
                  args=list(start=start, end=end, strand=strand,
                    col=1:length(start)), xargs=c("start", "end"))
grb_tr &lt;- do.call(sp_tr$func, sp_tr$args)
plot.new()
pushViewport(viewport(xscale=c(1,22), yscale=c(-2,2)))
grid.draw(grb_tr)
## Trim
sp_tr_trim &lt;- trim(sp_tr, xlim=c(5, 15))
str(sp_tr_trim)
## If the correct xargs are not indicated, trimming won't work
sp_tr$xargs &lt;- c("x")
sp_tr_trim2 &lt;- trim(sp_tr, xlim=c(5, 15))
identical(sp_tr_trim, sp_tr_trim2)

y1 &lt;- convertY(grobY(grb_tr, "south"), "native")
y2 &lt;- convertY(grobY(grb_tr, "north"), "native")
heightDetails(grb)
grb

## Applying it to plot_gene_maps
data(three_genes)

## Build data to plot
xs &lt;- lapply(dna_segs, range)
colors &lt;- c("red", "blue", "green")

seg_plots &lt;- list()
for (i in 1:length(xs)){
  x &lt;- seq(xs[[i]][1], xs[[i]][2], length=20)
  seg_plots[[i]] &lt;- seg_plot(func=pointsGrob,
                             args=list(x=x, y=rnorm(20)+2*i,
                               default.units="native", pch=3,
                               gp=gpar(col=colors[i], cex=0.5)))
}
plot_gene_map(dna_segs, comparisons,
              seg_plots=seg_plots,
              seg_plot_height=0.5,
              seg_plot_height_unit="inches",
              dna_seg_scale=TRUE)

## A more complicated example
data(barto)
tree &lt;- newick2phylog("(BB:2.5,(BG:1.8,(BH:1,BQ:0.8):1.9):3);")
## Showing several subsegments per genome
xlims2 &lt;- list(c(1445000, 1415000, 1380000, 1412000),
               c(  10000,   45000,   50000,   83000, 90000, 120000),
               c(  15000,   36000,   90000,  120000, 74000,  98000),
               c(   5000,    82000))

## Adding fake data in 1kb windows
seg_plots &lt;- lapply(barto$dna_segs, function(ds){
  x &lt;- seq(1, range(ds)[2], by=1000)
  y &lt;- jitter(seq(100, 300, length=length(x)), amount=50)
  seg_plot(func=linesGrob, args=list(x=x, y=y, gp=gpar(col=grey(0.3), lty=2)))
})
plot_gene_map(barto$dna_segs, barto$comparisons, tree=tree,
              seg_plots=seg_plots,
              seg_plot_height=0.5,
              seg_plot_height_unit="inches",
              xlims=xlims2,
              limit_to_longest_dna_seg=FALSE,
              dna_seg_scale=TRUE,
              main="Random plots for the same segment in 4 Bartonella genomes")

</code></pre>


</div>