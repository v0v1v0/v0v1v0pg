<div class="container">

<table style="width: 100%;"><tr>
<td>gbm.step.sd</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function to assess optimal no of boosting trees using k-fold cross validation</h2>

<h3>Description</h3>

<p>SD fork of dismo's gbm.step to add evaluation metrics like d.squared and rmse. J. Leathwick and
J. Elith - 19th September 2005, version 2.9. Function to assess optimal no of boosting trees
using k-fold cross validation. Implements the cross-validation procedure described on page 215 of
Hastie T, Tibshirani R, Friedman JH (2001) The Elements of Statistical Learning: Data Mining,
Inference, and Prediction Springer-Verlag, New York.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gbm.step.sd(
  data,
  gbm.x,
  gbm.y,
  offset = NULL,
  fold.vector = NULL,
  tree.complexity = 1,
  learning.rate = 0.01,
  bag.fraction = 0.75,
  site.weights = rep(1, nrow(data)),
  var.monotone = rep(0, length(gbm.x)),
  n.folds = 10,
  prev.stratify = TRUE,
  family = "bernoulli",
  n.trees = 50,
  step.size = n.trees,
  max.trees = 10000,
  tolerance.method = "auto",
  tolerance = 0.001,
  plot.main = TRUE,
  plot.folds = FALSE,
  verbose = TRUE,
  silent = FALSE,
  keep.fold.models = FALSE,
  keep.fold.vector = FALSE,
  keep.fold.fit = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>The input dataframe.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gbm.x</code></td>
<td>
<p>The predictors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gbm.y</code></td>
<td>
<p>The response.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>Allows an offset to be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fold.vector</code></td>
<td>
<p>Allows a fold vector to be read in for CV with offsets,.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tree.complexity</code></td>
<td>
<p>Sets the complexity of individual trees.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>learning.rate</code></td>
<td>
<p>Sets the weight applied to inidivudal trees.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bag.fraction</code></td>
<td>
<p>Sets the proportion of observations used in selecting variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>site.weights</code></td>
<td>
<p>Allows varying weighting for sites.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.monotone</code></td>
<td>
<p>Restricts responses to individual predictors to monotone.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.folds</code></td>
<td>
<p>Number of folds.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prev.stratify</code></td>
<td>
<p>Prevalence stratify the folds - only for p/a data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>Family - bernoulli (=binomial), poisson, laplace or gaussian.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.trees</code></td>
<td>
<p>Number of initial trees to fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>step.size</code></td>
<td>
<p>Numbers of trees to add at each cycle.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.trees</code></td>
<td>
<p>Max number of trees to fit before stopping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance.method</code></td>
<td>
<p>Method to use in deciding to stop - "fixed" or "auto".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance</code></td>
<td>
<p>Tolerance value to use - if method == fixed is absolute, if auto is multiplier * total mean deviance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.main</code></td>
<td>
<p>Plot hold-out deviance curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.folds</code></td>
<td>
<p>Plot the individual folds as well.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Control amount of screen reporting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>silent</code></td>
<td>
<p>To allow running with no output for simplifying model).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.fold.models</code></td>
<td>
<p>Keep the fold models from cross valiation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.fold.vector</code></td>
<td>
<p>Allows the vector defining fold membership to be kept.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.fold.fit</code></td>
<td>
<p>Allows the predicted values for observations from CV to be kept.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Allows for any additional plotting parameters.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Divides the data into 10 subsets, with stratification by prevalence if required for pa data then
fits a gbm model of increasing complexity along the sequence from n.trees to n.trees + (n.steps *
step.size) calculating the residual deviance at each step along the way after each fold
processed, calculates the average holdout residual deviance and its standard error then
identifies the optimal number of trees as that at which the holdout deviance is minimised and
fits a model with this number of trees, returning it as a gbm model along with additional
information from the cv selection process.
</p>
<p>D squared is 1 - (cv.dev / total.deviance). Abeare thesis: For each of the
fitted models, the pseudo-R2, or D2, or Explained Deviance, was calculated
for comparison, where: D2 = 1 â€“ (residual deviance/total deviance).
</p>
<p>requires gbm library from Cran
requires roc and calibration scripts of J Elith
requires calc.deviance script of J Elith/J Leathwick
</p>


<h3>Value</h3>

<p>GBM models using gbm as the engine.
</p>


</div>