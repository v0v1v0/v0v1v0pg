<div class="container">

<table style="width: 100%;"><tr>
<td>gma</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2> Granger Mediation Analysis of Time Series
</h2>

<h3>Description</h3>

<p> This function performs Granger Mediation Analysis (GMA) for time series data.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gma(dat, model.type = c("single", "twolevel"), method = c("HL", "TS", "HL-TS"), 
  delta = NULL, p = 1, single.var.asmp = TRUE, sens.plot = FALSE, 
  sens.delta = seq(-1, 1, by = 0.01), legend.pos = "topright", 
  xlab = expression(delta), ylab = expression(hat(AB)), cex.lab = 1, 
  cex.axis = 1, lgd.cex = 1, lgd.pt.cex = 1, plot.delta0 = TRUE, 
  interval = c(-0.9, 0.9), tol = 1e-04, max.itr = 500, conf.level = 0.95, 
  error.indep = TRUE, error.var.equal = FALSE, 
  Sigma.update = TRUE, var.constraint = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>
<p> a data frame or a list of data. When it is a data frame, it contains <code>Z</code> as the treatment/exposure assignment, <code>M</code> as the mediator and <code>R</code> as the interested outcome and <code>model.type</code> should be "single". <code>Z</code>, <code>M</code> and <code>R</code> are all in one column. When it is a list, the list length is the number of subjects. For a two-level dataset, each list contains one data frame with <code>Z</code>, <code>M</code> and <code>R</code>, and <code>model.type</code> should be "twolevel".
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model.type</code></td>
<td>
<p> a character of model type, "single" for single level model, "twolevel" for two-level model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p> a character of method that is used for the two-level GMA model. When <code>delta</code> is given, the method can be either "HL" (full likelihood) or "TS" (two-stage); when <code>delta</code> is not given, the method can be "HL", "TS" or "HL-TS". The "HL-TS" method estimates <code>delta</code> by the "HL" method first and uses the "TS" method to estimate the rest parameters.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p> a number gives the correlation between the Gaussian white noise processes. Default value is <code>NULL</code>. When <code>model.type = "single"</code>, the default will be <code>0</code>. For two-level model, if <code>delta = NULL</code>, the value of <code>delta</code> will be estimated.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p> a number gives the order of the vector autoregressive model. Default value is <code>1</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>single.var.asmp</code></td>
<td>
<p> a logic value indicates if in the single level model, the asymptotic variance will be used. Default value is <code>TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sens.plot</code></td>
<td>
<p> a logic value. Default is <code>FALSE</code>. This is used only for single level model. When <code>sens.plot = TRUE</code>, the sensitivity analysis will be performed and plotted.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sens.delta</code></td>
<td>
<p> a sequence of <code>delta</code> values under which the sensitivity analysis is performed. Default is a sequence from -1 to 1 with increment 0.01. The elements with absolute value 1 will be excluded from the analysis.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend.pos</code></td>
<td>
<p> a character indicates the location of the legend when <code>sens.plot = TRUE</code>. This is used for single level model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p> a title for <code>x</code> axis in the sensitivity plot.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p> a title for <code>y</code> axis in the sensitivity plot.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.lab</code></td>
<td>
<p> the magnification to be used for <code>x</code> and <code>y</code> labels relative to the current setting of <code>cex</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.axis</code></td>
<td>
<p> the magnification to be used for axis annotation relative to the current setting of <code>cex</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lgd.cex</code></td>
<td>
<p> the magnification to be used for legend relative to the current setting of <code>cex</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lgd.pt.cex</code></td>
<td>
<p> the magnification to be used for the points in legend relative to the current setting of <code>cex</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.delta0</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>. When <code>plot.delta0 = TRUE</code>, the estimates when <code class="reqn">\delta = 0</code> is plotted.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interval</code></td>
<td>
<p> a vector of length two indicates the searching interval when estimating <code>delta</code>. Default is (-0.9,0.9).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p> a number indicates the tolerance of convergence for the "HL" method. Default is <code>1e-4</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max.itr</code></td>
<td>
<p> an integer indicates the maximum number of iteration for the "HL" method. Default is 500.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf.level</code></td>
<td>
<p> a number indicates the significance level of the confidence intervals. Default is 0.95.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error.indep</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>. This is used for <code>model.type = "twolevel"</code>. When <code>error.indep = TRUE</code>, the error terms in the linear models for <code class="reqn">A</code>, <code class="reqn">B</code> and <code class="reqn">C</code> are independent.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error.var.equal</code></td>
<td>
<p> a logic value. Default is <code>FALSE</code>. This is used for <code>model.type = "twolevel"</code>. When <code>error.var.equal = TRUE</code>, the variances of the error terms in the linear models for <code class="reqn">A</code>, <code class="reqn">B</code> and <code class="reqn">C</code> are assumed to be identical.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma.update</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>, and the estimated variances of the Gaussian white noise processes in the single level model will be updated in each iteration when running a two-level GMA model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.constraint</code></td>
<td>
<p> a logic value. Default is <code>TRUE</code>, and an interval constraint is added on the variance components in the higher level regression model of the two-level GMA model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p> additional arguments to be passed.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p> The single level GMA model is
</p>
<p style="text-align: center;"><code class="reqn">M_{t}=Z_{t}A+E_{1t},</code>
</p>

<p style="text-align: center;"><code class="reqn">R_{t}=Z_{t}C+M_{t}B+E_{2t},</code>
</p>

<p>and for stochastic processes <code class="reqn">(E_{1t},E_{2t})</code>,
</p>
<p style="text-align: center;"><code class="reqn">E_{1t}=\sum_{j=1}^{p}\omega_{11_{j}}E_{1,t-j}+\sum_{j=1}^{p}\omega_{21_{j}}E_{2,t-j}+\epsilon_{1t},</code>
</p>

<p style="text-align: center;"><code class="reqn">E_{2t}=\sum_{j=1}^{p}\omega_{12_{j}}E_{1,t-j}+\sum_{j=1}^{p}\omega_{22_{j}}E_{2,t-j}+\epsilon_{2t}.</code>
</p>

<p>A correlation between the Gaussian white noise <code class="reqn">(\epsilon_{1t},\epsilon_{2t})</code> is assumed to be <code class="reqn">\delta</code>. The coefficients, as well as the transition matrix, are estimated by maximizing the conditional log-likelihood function. The confidence intervals of the coefficients are calculated based on the asymptotic joint distribution. The variance of <code class="reqn">AB</code> estimator based on either the product method or the difference method is obtained from the Delta method. Under this single level model, <code class="reqn">\delta</code> is not identifiable. Sensitivity analysis for the indirect effect (<code class="reqn">AB</code>) can be used to assess the deviation of the findings from assuming <code class="reqn">\delta = 0</code>, when the independence assumption is violated.
</p>
<p>The two-level GMA model is introduced to estimate <code class="reqn">\delta</code> from data without sensitivity analysis. It addresses the individual variation issue for datasets with hierarchically nested structure. For simplicity, we refer to the two levels of data by time series and subjects. Under the two-level GMA model, the data consists of <code class="reqn">N</code> independent subjects and a time series of length <code class="reqn">n_{i}</code>. The single level GMA model is first applied on the time series from a single subject. The coefficients then follow a linear model. Here we enforce the assumption that <code class="reqn">\delta</code> is a constant across subjects. The parameters are estimated through a full likelihood or a two-stage method.
</p>


<h3>Value</h3>

<p> When <code>model.type = "single"</code>,
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Coefficients</code></td>
<td>
<p>point estimate of the coefficients, as well as the corresponding standard error and confidence interval. The indirect effect is estimated by both the produce (<code>ABp</code>) and the difference (<code>ABd</code>) methods.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>point estimate of the causal coefficients in matrix form.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma</code></td>
<td>
<p>estimate covariance matrix of the Gaussian white noise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>the <code class="reqn">\delta</code> value used to estimate the rest parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W</code></td>
<td>
<p>estimate of the transition matrix in the VAR(p) model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LL</code></td>
<td>
<p>the conditional log-likelihood value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>the CPU time used, see <code>system.time</code>.</p>
</td>
</tr>
</table>
<p>When <code>model.type = "twolevel"</code>
</p>
<table>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>the specified or estimated value of correlation parameter <code class="reqn">\delta</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Coefficients</code></td>
<td>
<p>the estimated population level effect in the regression models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Lambda</code></td>
<td>
<p>the estimated covariance matrix of the model errors in the higher level coefficient regression models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Sigma</code></td>
<td>
<p>the estimated variances of <code class="reqn">\epsilon_{1t}</code> and <code class="reqn">\epsilon_{2t}</code> for each subject.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W</code></td>
<td>
<p>the estimated population level transition matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>HL</code></td>
<td>
<p>the value of full likelihood.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convergence</code></td>
<td>
<p>the logic value indicating if the method converges.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>var.constraint</code></td>
<td>
<p>the interval constraints used for the variances in the higher level coefficient regression models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>the CPU time used, see <code>system.time</code>.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p> Yi Zhao, Brown University, <a href="mailto:zhaoyi1026@gmail.com">zhaoyi1026@gmail.com</a>;
Xi Luo, Brown University, <a href="mailto:xi.rossi.luo@gmail.com">xi.rossi.luo@gmail.com</a>.
</p>


<h3>References</h3>

<p>Zhao, Y., &amp; Luo, X. (2017). <em>Granger Mediation Analysis of Multiple Time Series with an Application to fMRI.</em> arXiv preprint arXiv:1709.05328.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Example with simulated data

##############################################################################
# Single level GMA model
# Data was generated with 500 time points.
# The correlation between Gaussian white noise is 0.5.
data(env.single)
data.SL&lt;-get("data1",env.single)

## Example 1: Given delta is 0.5.
gma(data.SL,model.type="single",delta=0.5)
# $Coefficients
#          Estimate         SE         LB         UB
# A     0.519090451 0.06048910  0.4005340  0.6376469
# C     0.487396067 0.12650909  0.2394428  0.7353493
# B    -0.951262962 0.07693595 -1.1020547 -0.8004713
# C2   -0.006395453 0.12125003 -0.2440411  0.2312502
# AB.p -0.493791520 0.07004222 -0.6310717 -0.3565113
# AB.d -0.493791520 0.17523161 -0.8372392 -0.1503439

## Example 2: Assume the white noise are independent.
gma(data.SL,model.type="single",delta=0)
# $Coefficients
#          Estimate         SE          LB         UB
# A     0.519090451 0.06048910  0.40053400 0.63764690
# C    -0.027668910 0.11136493 -0.24594015 0.19060234
# B     0.040982178 0.07693595 -0.10980952 0.19177387
# C2   -0.006395453 0.12125003 -0.24404115 0.23125024
# AB.p  0.021273457 0.04001358 -0.05715172 0.09969864
# AB.d  0.021273457 0.16463207 -0.30139946 0.34394638

## Example 3: Sensitivity analysis (given delta is 0.5)
# We comment out the example due to the computation time.
# gma(data.SL,model.type="single",delta=0.5,sens.plot=TRUE)
##############################################################################

##############################################################################
# Two-level GMA model
# Data was generated with 50 subjects.
# The correlation between white noise in the single level model is 0.5.
# The time series is generate from a VAR(1) model.
# We comment out our examples due to the computation time.
data(env.two)
data.TL&lt;-get("data2",env.two)

## Example 1: Correlation is unknown and to be estimated.
# Assume errors in the coefficients model are independent.
# Add an interval constraint on the variance components.

# "HL" method
# gma(data.TL,model.type="twolevel",method="HL",p=1)
# $delta
# [1] 0.5176206
# 
# $Coefficients
#           Estimate
# A        0.5587349
# C        0.7129338
# B       -1.0453097
# C2       0.1213349
# AB.prod -0.5840510
# AB.diff -0.5915989
# 
# $time
#   user  system elapsed 
# 12.285   0.381  12.684 

# "TS" method
# gma(data.TL,model.type="twolevel",method="TS",p=1)
# $delta
# [1] 0.4993492
# 
# $Coefficients
#           Estimate
# A        0.5569101
# C        0.6799228
# B       -0.9940383
# C2       0.1213349
# AB.prod -0.5535900
# AB.diff -0.5585879
# 
# $time
#  user  system elapsed 
# 7.745   0.175   7.934 

## Example 2: Given the correlation is 0.5.
# Assume errors in the coefficients model are independent.
# Add an interval constraint on the variance components.

# "HL" method
# gma(data.TL,model.type="twolevel",method="HL",delta=0.5,p=1)
# $delta
# [1] 0.5
# 
# $Coefficients
#           Estimate
# A        0.5586761
# C        0.6881703
# B       -0.9997898
# C2       0.1213349
# AB.prod -0.5585587
# AB.diff -0.5668355
# 
# $time
#  user  system elapsed 
# 0.889   0.023   0.913
##############################################################################
</code></pre>


</div>