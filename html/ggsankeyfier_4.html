<div class="container">

<table style="width: 100%;"><tr>
<td>ecosystem_services</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Data on risks to supply ecosystem services</h2>

<h3>Description</h3>

<p>Data indicating a risk resulting from anthropological activities to the
marine ecosystem and its capacity to supply services.
This data set serves (aggregated from Piet <em>et al.</em> (submitted)) as an example
to illustrate the package's features.
</p>


<h3>Format</h3>

<p><code>ecosystem_services</code> is  a <code>data.frame</code> with
3421 rows and 8 columns.
The columns are:
</p>

<ul>
<li> <p><code>activity_type</code>: Type of activities that pose a risk
</p>
</li>
<li> <p><code>activity_realm</code>: Aggregation of activity types
</p>
</li>
<li> <p><code>pressure_cat</code>: Category of pressures exerted by the activities and
eventually pose a risk to the ecosystem.
</p>
</li>
<li> <p><code>biotic_group</code>: Biotic groups affected by the pressures.
</p>
</li>
<li> <p><code>biotic_realm</code>: Aggregation of biotic groups
</p>
</li>
<li> <p><code>service_division</code>: Division of ecosystem services that are
provided by the biotic groups and affected by the activities.
</p>
</li>
<li> <p><code>service_section</code>: Aggregation of service divisions.
</p>
</li>
<li> <p><code>RCSES</code>: 'Risk to Capacity to Supply Ecosystem Services'.
A numerical score reflecting the amount of risk for the ecosystem to
supply specific services. For more details see Piet et al. (submitted)
</p>
</li>
</ul>
<p>This <code>data.frame</code> is in a wide oriented format, typical for most common
applications. Each row in the <code>data.frame</code> represents a unique pathway where each
<code>activity_tpe</code> poses a risk to an ecosystem <code>sevice_division</code>, via a
<code>pressure_cat</code> and <code>biotic_group</code>. Each column either contains information on
a specific stage or the overall quantifier (in this case <code>RCSES</code>).
</p>
<p>In its present form it is not suitable to directly plot as a Sankey diagram.
For that purpose it needs to be pivoted with <code>pivot_stages_longer()</code>. Two
different variants are prepared with this function: <code>ecosystem_services_pivot1</code>
and <code>ecosystem_services_pivot2</code>.
</p>
<p>The latter pivot contains <code>service_section</code> as an extra feature which can be used
for additional decoration of a Sankey diagram. It is therefore more detailed than
the first alternative.
</p>
<p><code>ecosystem_services_pivot1</code> is  a <code>data.frame</code> with
112 rows and 5
columns. Columns are:
</p>

<ul>
<li> <p><code>RCSES</code>: See above at <code>ecosystem_services</code>.
</p>
</li>
<li> <p><code>edge_id</code>: Unique numerical identifier for each edge in a Sankey diagram.
</p>
</li>
<li> <p><code>connector</code>: One of <code>'from'</code> or <code>'to'</code>, indicating whether we are looking
at the start or the end of an edge.
</p>
</li>
<li> <p><code>node</code>: A collection of <code>activity_realm</code>, <code>pressure_cat</code>, <code>biotic_realm</code> and
<code>service_section</code> values from the <code>ecosystem_services</code> <code>data.frame</code>.
</p>
</li>
<li> <p><code>stage</code>: Stages in a Sankey diagram formed by the columns <code>activity_realm</code>,
<code>pressure_cat</code>, <code>biotic_realm</code> and <code>service_section</code> from the
<code>ecosystem_services</code> <code>data.frame</code>.
</p>
</li>
</ul>
<p><code>ecosystem_services_pivot1</code> is created from <code>ecosystem_services</code> using
<code>pivot_stages_longer()</code> and can be used directly in a Sankey diagram (using
<code>geom_sankeynode()</code> and <code>geom_sankeyedge()</code>)
</p>
<p><code>ecosystem_services_pivot2</code> is  a <code>data.frame</code> with
252 rows and 6.
It is the same as <code>ecosystem_services_pivot1</code> with the exception of a distinct
extra column <code>service_division</code> which allows for more detailed aesthetics in
a Sankey diagram.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries, Gerjan Piet, Jacob Bentley, Ruud Jongbloed, Anne Grundlehner, Jacqueline Tamis
</p>


<h3>References</h3>

<p>Piet GJ, Bentley J, Jongbloed RH, Grundlehner A, Tamis JE, De Vries P
(submitted) A Cumulative Impact Assessment on the North Sea Capacity to
Supply Ecosystem Services. <a href="https://doi.org/10.2139/ssrn.4450241">doi:10.2139/ssrn.4450241</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("ecosystem_services")
library(ggplot2)

if (requireNamespace("stringr")) {
  library(stringr)

  pos &lt;- position_sankey(v_space = "auto", align = "justify")
  pos_text &lt;- position_sankey(v_space = "auto", align = "justify", nudge_x = 0.1)

  ## A simplified version of the Sankey diagram as published by Piet _et al._ (submitted)
  ggplot(ecosystem_services |&gt;
           pivot_stages_longer(
             c("activity_type", "pressure_cat", "biotic_group", "service_section"),
             "RCSES"),
         aes(x = stage, y = RCSES, group = node, connector = connector, edge_id = edge_id)) +
    geom_sankeyedge(aes(fill = RCSES), position = pos) +
    geom_sankeynode(position = pos) +
    geom_text(aes(label = str_wrap(node, 20)), position = pos_text, stat = "sankeynode",
              hjust = 0, cex = 2) +
    scale_fill_viridis_c(option = "turbo", trans = "sqrt") +
    theme_minimal()
}
</code></pre>


</div>