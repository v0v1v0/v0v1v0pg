<div class="container">

<table style="width: 100%;"><tr>
<td>grade_this</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Grade a student's submission using custom logic</h2>

<h3>Description</h3>

<p><code>grade_this()</code> allows instructors to write custom logic to evaluate, grade
and give feedback to students. To use <code>grade_this()</code>, call it directly in
your <code style="white-space: pre;">⁠*-check⁠</code> chunk:
</p>
<div class="sourceCode"><pre>```{r example-check}
grade_this({
  # custom checking code appears here
  if (identical(.result, .solution)) {
    pass("Great work!")
  }
  fail("Try again!")
})
```
</pre></div>
<p><code>grade_this()</code> makes available a number of objects based on the exercise and
the student's submission that can be used to evaluate the student's submitted
code. See <code>?"grade_this-objects"</code> for more information about these objects.
</p>
<p>As the instructor, you are free to use any logic to determine a student's
grade as long as a <code>graded()</code> object is signaled. The check code can also
contain <span class="pkg">testthat</span> expectation code. Failed <span class="pkg">testthat</span> expectations
will be turned into <code>fail()</code>ed grades with the corresponding message.
</p>
<p>A final grade is signaled from <code>grade_this()</code> using the <code>graded()</code> helper
functions, which include <code>pass()</code>, <code>fail()</code>, among others. <code>grade_this()</code>
uses condition handling to short-circuit further evaluation when a grade is
reached. This means that you may also signal a failing grade using any of the
<code style="white-space: pre;">⁠expect_*()⁠</code> functions from <span class="pkg">testthat</span>, other functions designed to work
with <span class="pkg">testthat</span>, such as <span class="pkg">checkmate</span>, or standard R errors via
<code>stop()</code>. Learn more about this behavior in <code>graded()</code> in the section
<strong>Return a grade immediately</strong>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">grade_this(
  expr,
  ...,
  maybe_code_feedback = getOption("gradethis.maybe_code_feedback", TRUE)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>expr</code></td>
<td>
<p>The grade-checking expression to be evaluated. This expression
must either signal a grade via <code>pass()</code> or <code>fail()</code> functions or their
sibling functions.
</p>
<p>By default, errors in this expression are converted to "internal problem"
grades that mask the error for the user. If your grading logic relies on
unit-test-styled functions, such as those from <span class="pkg">testthat</span>, you can use
<code>fail_if_error()</code> to convert errors into <code>fail()</code> grades.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Ignored</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maybe_code_feedback</code></td>
<td>
<p>Should <code>maybe_code_feedback()</code> provide code
feedback when used in a <code>graded()</code> message? The default value can be set
with <code>gradethis_setup()</code>.
</p>
<p>Typically, <code>maybe_code_feedback()</code> is called in the default <code>fail()</code>
message (the default can be customized the <code>fail</code> argument of
<code>gradethis_setup()</code>). If the <code>maybe_code_feedback</code> argument is <code>FALSE</code>,
<code>maybe_code_feedback()</code> returns an empty string.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a function whose first parameter will be an environment
containing objects specific to the exercise and submission (see <strong>Available
variables</strong>). For local testing, you can create a version of the expected
environment for a mock exercise submission with <code>mock_this_exercise()</code>.
Calling the returned function on the exercise-checking environment will
evaluate the grade-checking <code>expr</code> and return a final grade via <code>graded()</code>.
</p>


<h3>See Also</h3>

<p><code>grade_this_code()</code>, <code>mock_this_exercise()</code>, <code>gradethis_demo()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># For an interactive example run: gradethis_demo()

# Suppose we have an exercise that prompts students to calculate the
# average height of Loblolly pine trees using the `Loblolly` data set.
# We might write an exercise `-check` chunk like the one below.
#
# Since grade_this() returns a function, we'll save the result of this
# "chunk" as `grader()`, which can be called on an exercise submission
# to evaluate the student's code, which we'll simulate with
# `mock_this_exercise()`.

grader &lt;-
  # ```{r example-check}
  grade_this({
    if (length(.result) != 1) {
      fail("I expected a single value instead of {length(.result)} values.")
    }

    if (is.na(.result)) {
      fail("I expected a number, but your code returned a missing value.")
    }

    avg_height &lt;- mean(Loblolly$height)
    if (identical(.result, avg_height)) {
      pass("Great work! The average height is {round(avg_height, 2)}.")
    }

    # Always end grade_this() with a default grade.
    # By default fail() will also give code feedback,
    # if a solution is available.
    fail()
  })
# ```

# Simulate an incorrect answer: too many values...
grader(mock_this_exercise(.user_code = Loblolly$height[1:2]))

# This student submission returns a missing value...
grader(mock_this_exercise(mean(Loblolly$Seed)))
# This student submission isn't caught by any specific tests,
# the final grade is determined by the default (last) value in grade_this()
grader(mock_this_exercise(mean(Loblolly$age)))

# If you have a *-solution chunk,
# fail() without arguments gives code feedback...
grader(
  mock_this_exercise(
    .user_code = mean(Loblolly$age),
    .solution_code = mean(Loblolly$height)
  )
)

# Finally, the "student" gets the correct answer!
grader(mock_this_exercise(mean(Loblolly$height)))
</code></pre>


</div>