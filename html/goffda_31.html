<div class="container">

<table style="width: 100%;"><tr>
<td>sim-frmfr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Sampling functional regression models with functional responses</h2>

<h3>Description</h3>

<p>Simulation of a Functional Regression Model with Functional
Response (FRMFR) comprised of an additive mix of a linear and nonlinear
terms:
</p>
<p style="text-align: center;"><code class="reqn">Y(t) = \int_a^b X(s) \beta(s,t) ds + \Delta(X)(t) + \varepsilon(t),</code>
</p>

<p>where <code class="reqn">X</code> is a random variable in the Hilbert space of
square-integrable functions in <code class="reqn">[a, b]</code>, <code class="reqn">L^2([a, b])</code>,
<code class="reqn">\beta</code> is the bivariate kernel of the FRMFR,
<code class="reqn">\varepsilon</code> is a random variable in <code class="reqn">L^2([c, d])</code>,
and <code class="reqn">\Delta(X)</code> is a nonlinear term.
</p>
<p>In particular, the scenarios considered in García-Portugués et al. (2021)
can be easily simulated.
</p>


<h3>Usage</h3>

<pre><code class="language-R">r_frm_fr(n, scenario = 3, X_fdata = NULL, error_fdata = NULL,
  beta = NULL, s = seq(0, 1, l = 101), t = seq(0, 1, l = 101),
  std_error = 0.15, nonlinear = NULL, concurrent = FALSE,
  int_rule = "trapezoid", n_fpc = 50, verbose = FALSE, ...)

nl_dev(X_fdata, t = seq(0, 1, l = 101), nonlinear = NULL,
  int_rule = "trapezoid", equispaced = equispaced, verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>sample size, only required when <code>scenario</code> is given.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scenario</code></td>
<td>
<p>an index from <code>1</code> to <code>3</code> (default) denoting
one of the scenarios (S1, S2 or S3) simulated in
García-Portugués et al. (2021) (see details below). If
<code>scenario = NULL</code>, <code>X_fdata</code>, <code>error_fdata</code>, and <code>beta</code>
have to be provided. Otherwise, <code>X_fdata</code>, <code>error_fdata</code>, and
<code>beta</code> will be ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X_fdata</code></td>
<td>
<p>sample of functional covariates <code class="reqn">X(s)</code> as
<code>fdata</code> objects of length <code>n</code>, with <code class="reqn">s</code> in
<code class="reqn">[a, b]</code>. Defaults to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error_fdata</code></td>
<td>
<p>sample of functional errors <code class="reqn">\varepsilon(t)</code> as
<code>fdata</code> objects of length <code>n</code>, with <code class="reqn">t</code> in
<code class="reqn">[c, d]</code>. If <code>concurrent = TRUE</code>, <code>X_fdata</code> and
<code>error_fdata</code> must be valued in the same grid. Defaults to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>matrix containing the values <code class="reqn">\beta(s, t)</code>, for each grid
point <code class="reqn">s</code> in <code class="reqn">[a, b]</code> and <code class="reqn">t</code> in <code class="reqn">[c, d]</code>. If
<code>concurrent = TRUE</code> (see details below), a row/column vector
must be introduced, valued in the same grid as <code>error_fdata</code>.
If <code>beta = NULL</code> (default), <code>scenario != NULL</code> is required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>s, t</code></td>
<td>
<p>grid points. If <code>X_fdata</code>, <code>error_fdata</code> and
<code>beta</code> are provided, <code>s</code> and <code>t</code> are ignored. Default to
<code>s = seq(0, 1, l = 101)</code> and <code>t = seq(0, 1, l = 101)</code>,
respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std_error</code></td>
<td>
<p>standard deviation of the random variables
involved in the generation of the functional error <code>error_fdata</code>.
Defaults to <code>0.15</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nonlinear</code></td>
<td>
<p>nonlinear term. Either a character string (<code>"exp"</code>,
<code>"quadratic"</code> or <code>"sin"</code>) or an <code>fdata</code>
object of length <code>n</code>, valued in the same grid as <code>error_fdata</code>.
If <code>nonlinear = NULL</code> (default), the nonlinear part is set to zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>concurrent</code></td>
<td>
<p>flag to consider a concurrent FLRFR (degenerate case).
Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>int_rule</code></td>
<td>
<p>quadrature rule for approximating the definite
unidimensional integral: trapezoidal rule (<code>int_rule = "trapezoid"</code>)
and extended Simpson rule (<code>int_rule = "Simpson"</code>) are available.
Defaults to <code>"trapezoid"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_fpc</code></td>
<td>
<p>number of components to be considered for the generation of
functional variables. Defaults to <code>50</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>flag to display information about the sampling procedure.
Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further parameters passed to
<code>r_cm2013_flmfr</code>,
<code>r_gof2021_flmfr</code> and<br><code>r_ik2018_flmfr</code>, depending on the
chosen <code>scenario</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>equispaced</code></td>
<td>
<p>flag to indicate if <code>X_fdata$data</code> is valued in
an equispaced grid or not. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>


<ul>
<li>
<p><code>r_frm_fr</code> samples the above regression model,
where the nonlinear term <code class="reqn">\Delta(X)</code> is computed by <code>nl_dev</code>.
Functional covariates, errors, and <code class="reqn">\beta</code> are generated
automatically from the scenarios in García-Portugués et al. (2021) when
<code>scenario != NULL</code> (see the documentation of
<code>r_gof2021_flmfr</code>). If <code>scenario = NULL</code>,
covariates, errors and <code class="reqn">\beta</code> must be provided.
</p>
<p>When <code>concurrent = TRUE</code>, the concurrent FRMFR
</p>
<p style="text-align: center;"><code class="reqn">Y(t) = X(t) \beta(t) +
  \Delta(X)(t) + \varepsilon(t)</code>
</p>

<p>is considered.
</p>
</li>
<li>
<p><code>nl_dev</code> computes a nonlinear deviation
<code class="reqn">\Delta(X)</code>:
<code class="reqn">\exp(\sqrt{X(a + (t - c) ((b - a) / (d - c)))})</code>
(for <code>"exp"</code>),
<code class="reqn">(X^2 (a + (t - c) ((b - a) / (d - c))) - 1)</code>
(<code>"quadratic"</code>) or
<code class="reqn">(\sin(2\pi t) - \cos(2 \pi t)) \| X \|^2</code>
(<code>"sin"</code>). Also, <code class="reqn">\Delta(X)</code> can be manually set as an
<code>fdata</code> object of length <code>n</code> and valued in
the same grid as <code>error_fdata</code>.
</p>
</li>
</ul>
<h3>Value</h3>

<p>A list with the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>X_fdata</code></td>
<td>
<p>functional covariates, an
<code>fdata</code> object of length <code>n</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Y_fdata</code></td>
<td>
<p>functional responses, an
<code>fdata</code> object of length <code>n</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>error_fdata</code></td>
<td>
<p>functional errors, an
<code>fdata</code> object of length <code>n</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>either the matrix with <code class="reqn">\beta(s, t)</code> evaluated at
the <code>argvals</code> of <code>X_fdata</code> and <code>Y_fdata</code> (if
<code>concurrent = FALSE</code>) or a vector with <code class="reqn">\beta(t)</code>
evaluated at the <code>argvals</code> of <code>X_fdata</code> (if
<code>concurrent = TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nl_dev</code></td>
<td>
<p>nonlinear term, an <code>fdata</code>
object of length <code>n</code>.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Javier Álvarez-Liébana.
</p>


<h3>References</h3>

<p>García-Portugués, E., Álvarez-Liébana, J., Álvarez-Pérez, G. and
Gonzalez-Manteiga, W. (2021). A goodness-of-fit test for the functional
linear model with functional response. <em>Scandinavian Journal of
Statistics</em>, 48(2):502–528. <a href="https://doi.org/10.1111/sjos.12486">doi:10.1111/sjos.12486</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Generate samples for the three scenarios

# Equispaced grids and Simpson's rule

s &lt;- seq(0, 1, l = 101)
samp &lt;- list()
old_par &lt;- par(mfrow = c(3, 5))
for (i in 1:3) {
  samp[[i]] &lt;- r_frm_fr(n = 100, scenario = i, s = s, t = s,
                        int_rule = "Simpson")
  plot(samp[[i]]$X_fdata)
  plot(samp[[i]]$error_fdata)
  plot(samp[[i]]$Y_fdata)
  plot(samp[[i]]$nl_dev)
  image(x = s, y = s, z = samp[[i]]$beta, col = viridisLite::viridis(20))
}
par(old_par)

## Linear term as a concurrent model

# The grids must be have the same number of grid points for a given
# nonlinear term and a given beta function

s &lt;- seq(1, 2, l = 101)
t &lt;- seq(0, 1, l = 101)
samp_c_1 &lt;- r_frm_fr(n = 100, scenario = 3, beta = sin(t) - exp(t),
                     s = s, t = t, nonlinear = fda.usc::fdata(mdata =
                       t(matrix(rep(sin(t), 100), nrow = length(t))),
                       argvals = t),
                     concurrent = TRUE)
old_par &lt;- par(mfrow = c(3, 2))
plot(samp_c_1$X_fdata)
plot(samp_c_1$error_fdata)
plot(samp_c_1$Y_fdata)
plot(samp_c_1$nl_dev)
plot(samp_c_1$beta)
par(old_par)

## Sample for given X_fdata, error_fdata, and beta

# Non equispaced grids with sinusoidal nonlinear term and intensity 0.5
s &lt;- c(seq(0, 0.5, l = 50), seq(0.51, 1, l = 101))
t &lt;- seq(2, 4, len = 151)
X_fdata &lt;- r_ou(n = 100, t = s, alpha = 2, sigma = 4, x0 = 1:100)
error_fdata &lt;- r_ou(n = 100, t = t, alpha = 1, sigma = 1, x0 = 1:100)
beta &lt;- r_gof2021_flmfr(n = 100, s = s, t = t)$beta
samp_Xeps &lt;- r_frm_fr(scenario = NULL, X_fdata = X_fdata,
                      error_fdata = error_fdata, beta = beta,
                      nonlinear = "exp", int_rule = "trapezoid")
old_par &lt;- par(mfrow = c(3, 2))
plot(samp_Xeps$X_fdata)
plot(samp_Xeps$error_fdata)
plot(samp_Xeps$Y_fdata)
plot(samp_Xeps$nl_dev)
image(x = s, y = t, z = beta, col = viridisLite::viridis(20))
par(old_par)
</code></pre>


</div>