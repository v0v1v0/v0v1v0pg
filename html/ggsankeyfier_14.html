<div class="container">

<table style="width: 100%;"><tr>
<td>pivot_stages_longer</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Pivot wide data to long for plotting as Sankey</h2>

<h3>Description</h3>

<p>Pivot data from a wide to a long format suitable for plotting Sankey diagrams.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pivot_stages_longer(
  data,
  stages_from,
  values_from,
  additional_aes_from,
  invert_nodes = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <code>data.frame</code> (or an object inheriting the <code>data.frame</code> class),
which needs to be pivoted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stages_from</code></td>
<td>
<p>A <code>vector</code> of column names, which represent the stages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>values_from</code></td>
<td>
<p>A <code>vector</code> of column names, which contains <code>numeric</code> values
that represent the size of the edges in Sankey diagrams. When there are multiple
values for a single edge, they are summed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>additional_aes_from</code></td>
<td>
<p>A <code>vector</code> of column names of data that you want to
use to decorate elements in your Sankey diagram. This argument is optional. See also
<code>vignette("data_management")</code> and <code>vignette("decorating")</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>invert_nodes</code></td>
<td>
<p>When pivoting information from <code>stages_from</code>, its data is
converted into a <code>factor</code>. Set <code>invert_nodes</code> to <code>TRUE</code> if you want to invert the
order of the levels of the <code>factor</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Typically, data to be displayed as a Sankey, is collected and stored in a
wide format, where each stage (i.e., x-axis of a Sankey diagram) is in a
column. The <code>ggplot2</code> philosophy requires the data to be in a long format,
such that diagram decorations (aesthetics) can be mapped to specific
columns.
</p>
<p>This function pivots wide data in an appropriate long format, by indicating
which columns contain the stages, and in which order they should appear in
the Sankey.
</p>
<p>For more details see <code>vignette("data_management")</code>
</p>


<h3>Value</h3>

<p>Returns a dplyr::tibble with all the selected columns from <code>data</code> pivoted.
The stages will be listed in the column named <code>stage</code> and nodes in the column named
<code>node</code>. The result will contain two new columns: a column named <code>connector</code> indicating
whether the row in the <code>tibble</code> reflects the source of an edge (value <code>'from'</code>) or
destination of an edge (value <code>'to'</code>); and a column named <code>edge_id</code>, containing a
unique identifier for each edge. The <code>edge_id</code> is required for the plotting routine
in order to identify which edge source should be connected with which edge destination.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class="language-R">data("ecosystem_services")

ecosystem_services_p1 &lt;-
  pivot_stages_longer(
    data        = ecosystem_services,
    stages_from = c("activity_type", "pressure_cat",
                    "biotic_group", "service_division"),
    values_from = "RCSES")

## suppose we want to decorate our Sankey
## with information on the 'section' of the services:
ecosystem_services_p2 &lt;-
  pivot_stages_longer(
    data        = ecosystem_services,
    stages_from = c("activity_type", "pressure_cat",
                    "biotic_group", "service_division"),
    values_from = "RCSES",
    additional_aes_from = "service_section")

</code></pre>


</div>