<div class="container">

<table style="width: 100%;"><tr>
<td>GeomSankeysegment</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Sankey edges (flows)</h2>

<h3>Description</h3>

<p><code>geom_sankeysegment()</code> draws a straight line between two connected nodes,
<code>geom_sankeyedge()</code> draws a ribbon between nodes following a Bezier curved path.
If you combine the edges with <code>geom_sankeynode()</code>, make sure that both use the
same <code>position</code> object.
</p>


<h3>Usage</h3>

<pre><code class="language-R">GeomSankeysegment

geom_sankeysegment(
  mapping = NULL,
  data = NULL,
  stat = "sankeyedge",
  position = "sankey",
  na.rm = FALSE,
  show.legend = NA,
  order = c("ascending", "descending", "as_is"),
  width = "auto",
  align = c("bottom", "top", "center", "justify"),
  h_space = "auto",
  v_space = 0,
  nudge_x = 0,
  nudge_y = 0,
  split_nodes = FALSE,
  split_tol = 0.001,
  direction = c("forward", "backward"),
  inherit.aes = TRUE,
  ...
)

GeomSankeyedge

geom_sankeyedge(
  mapping = NULL,
  data = NULL,
  stat = "sankeyedge",
  position = "sankey",
  na.rm = FALSE,
  show.legend = NA,
  slope = 0.5,
  ncp = 100,
  width = "auto",
  align = c("bottom", "top", "center", "justify"),
  order = c("ascending", "descending", "as_is"),
  h_space = "auto",
  v_space = 0,
  nudge_x = 0,
  nudge_y = 0,
  split_nodes = FALSE,
  split_tol = 0.001,
  direction = c("forward", "backward"),
  inherit.aes = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code>aes()</code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code>ggplot()</code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code>fortify()</code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stat</code></td>
<td>
<p>The statistical transformation to use on the data for this
layer, either as a <code>ggproto</code> <code>Geom</code> subclass or as a string naming the
stat stripped of the <code>stat_</code> prefix (e.g. <code>"count"</code> rather than
<code>"stat_count"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>position</code></td>
<td>
<p>Position adjustment, either as a string naming the adjustment
(e.g. <code>"jitter"</code> to use <code>position_jitter</code>), or the result of a call to a
position adjustment function. Use the latter if you need to change the
settings of the adjustment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>If <code>FALSE</code>, the default, missing values are removed with
a warning. If <code>TRUE</code>, missing values are silently removed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.legend</code></td>
<td>
<p>logical. Should this layer be included in the legends?
<code>NA</code>, the default, includes if any aesthetics are mapped.
<code>FALSE</code> never includes, and <code>TRUE</code> always includes.
It can also be a named logical vector to finely select the aesthetics to
display.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>A <code>character</code> indicating the method to be used for the order of stacking
nodes and edges in a plot.
Should be one of: <code>ascending</code> (default), sorts nodes and edges from large to small
(largest on top); <code>descending</code> sorts nodes and edges from small to large (smallest
on top); <code>as_is</code> will leave the order of nodes and edges as they are in <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>width</code></td>
<td>
<p>Width of the node (<code>numeric</code>). When <code>split_nodes</code> is set to <code>TRUE</code>
each part of the split node will have half this width. Use <code>"auto"</code> to automatically
determine a suitable width.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>align</code></td>
<td>
<p>A <code>character</code> that indicates how the nodes across the stages are aligned.
It can be any of <code>"top"</code>, <code>"bottom"</code>, <code>"center"</code> or <code>"justify"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h_space</code></td>
<td>
<p>Horizontal space between split nodes (<code>numeric</code>). This argument is
ignored when <code>split_nodes == FALSE</code>. Use <code>"auto"</code> to automatically position split nodes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>v_space</code></td>
<td>
<p>Vertical space between nodes (<code>numeric</code>). When set to zero (<code>0</code>),
the Sankey diagram becomes an alluvial plot. Use <code>"auto"</code> to automatically determine
a suitable vertical space.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nudge_x, nudge_y</code></td>
<td>
<p>Horizontal and vertical adjustment to nudge items by. Can
be useful for offsetting labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split_nodes</code></td>
<td>
<p>A <code>logical</code> value indicating whether the source and destination nodes
should be depicted as separate boxes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>split_tol</code></td>
<td>
<p>When the relative node size (resulting source and destination edges)
differs more than this fraction, the node will be displayed as two separate bars.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>direction</code></td>
<td>
<p>One of <code>"forward"</code> (default) or <code>"backward"</code>. When set to <code>"backward"</code>
the direction of the edges will be inverted. In most cases this
parameter won't affect the plot. It can be helpful when you want to decorate the
end of an edge (instead of the start; see examples).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code>borders()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments passed on to <code>layer()</code>. These are
often aesthetics, used to set an aesthetic to a fixed value, like
<code>colour = "red"</code> or <code>size = 3</code>. They may also be parameters
to the paired geom/stat.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>slope</code></td>
<td>
<p>Slope parameter (<code>numeric</code>) for the Bezier curves used to depict the edges.
Any value between 0 and 1 will work nicely. Other non-zero values will also work.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncp</code></td>
<td>
<p>Number of control points on the Bezier curve that forms the edge. Larger
numbers will result in smoother curves, but cost more computational time. Default is
100.</p>
</td>
</tr>
</table>
<h3>Format</h3>

<p>An object of class <code>GeomSankeysegment</code> (inherits from <code>GeomSegment</code>, <code>Geom</code>, <code>ggproto</code>, <code>gg</code>) of length 4.
</p>
<p>An object of class <code>GeomSankeyedge</code> (inherits from <code>GeomSankeysegment</code>, <code>GeomSegment</code>, <code>Geom</code>, <code>ggproto</code>, <code>gg</code>) of length 7.
</p>


<h3>Details</h3>

<p>This <code>ggplot2</code> layer connects between paired nodes via a Bezier curve. The width
of the curve is determined by its <code>y</code> aesthetic. It will be attempted to keep the
width of the curve constant along its curved path, for the targeted graphics device.
When the aspect ratio of the graphics device is altered after the plot is generated,
the aspect ratio maybe off. In that case render the plot again.
</p>


<h3>Value</h3>

<p>Returns a <code>ggplot2::layer()</code> which can be added to a <code>ggplot2::ggplot()</code>
</p>


<h3>Aesthetics</h3>

<p><code>geom_sankeysegment()</code> and <code>geom_sankeyedge()</code> understand the following
aesthetics (required aesthetics are in bold)
</p>
<p><img src="../help/figures/important_aspects.svg" alt="Important aspects"></p>

<ul>
<li> <p><strong><code>x</code></strong>: Works for variables on a discrete scale. Might work for continuous variables
but is not guaranteed. This variable is used to distinguish between stages in the
Sankey diagram on the x axis.
</p>
</li>
<li> <p><strong><code>y</code></strong>: A continuous variable representing the width of the edges in a Sankey
diagram.
</p>
</li>
<li> <p><strong><code>group</code></strong>: A discrete variable used for grouping edges to nodes in each stage.
Essentially it is an identifier for the nodes.
</p>
</li>
<li> <p><strong><code>connector</code></strong>: Indicates which side of an edge is reflected by the corresponding
record. Should be one of <code>"from"</code> or <code>"to"</code>.
</p>
</li>
<li> <p><strong><code>edge_id</code></strong>: A unique identifier value for each edge. This identifier is used
to link specific <code>"from"</code> and <code>"to"</code> records in an edge (flow).
</p>
</li>
<li>
<p> fill: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li>
<p> colour: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li>
<p> linetype: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li>
<p> linewidth: see <code>vignette("ggplot2-specs", "ggplot2")</code>
</p>
</li>
<li>
<p> alpha: A variable to control the opacity of an element.
</p>
</li>
</ul>
<ul><li>
<p> waist: A variable to control the width of an edge in between
two nodes. Small values will create a hour glass shape, whereas large values will
produce an apple shape.
</p>
</li></ul>
<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(ggplot2)
data("ecosystem_services")

ggplot(ecosystem_services_pivot1, aes(x = stage, y = RCSES, group = node,
                    connector = connector, edge_id = edge_id,
                    fill = node)) +
  geom_sankeynode(v_space = "auto") +
  geom_sankeyedge(v_space = "auto")
</code></pre>


</div>