<div class="container">

<table style="width: 100%;"><tr>
<td>ch5</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Code for Chapter 5: Smoothers</h2>

<h3>Description</h3>

<p>R code from Chapter 5 of the second edition of ‘Generalized Additive Models: An Introduction with R’ is in the examples section below.
</p>


<h3>Author(s)</h3>

<p>Simon Wood &lt;simon@r-project.org&gt;
</p>
<p>Maintainer: Simon Wood &lt;simon@r-project.org&gt;
</p>


<h3>References</h3>

<p>Wood, S.N. (2017) <em>Generalized Additive Models: An Introduction with R</em>, CRC
</p>


<h3>See Also</h3>

<p><code>mgcv</code>, <code>ch5.solutions</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(gamair); library(mgcv)

## 5.3.3 P-splines

bspline &lt;- function(x,k,i,m=2)
# evaluate ith b-spline basis function of order m at the values
# in x, given knot locations in k
{ if (m==-1) # base of recursion
  { res &lt;- as.numeric(x&lt;k[i+1]&amp;x&gt;=k[i])
  } else     # construct from call to lower order basis
  { z0 &lt;- (x-k[i])/(k[i+m+1]-k[i])
    z1 &lt;- (k[i+m+2]-x)/(k[i+m+2]-k[i+1])
    res &lt;- z0*bspline(x,k,i,m-1)+ z1*bspline(x,k,i+1,m-1)
  }
  res
} ## bspline

k&lt;-6                              # example basis dimension
P &lt;- diff(diag(k),differences=1)  # sqrt of penalty matrix
S &lt;- t(P)%*%P 

## 5.3.6 SCOP-splines
x &lt;- 0:200/200
set.seed(32)
y &lt;- binomial()$linkinv((x-.5)*10) + rnorm(length(x))*.1
plot(x,y)
k &lt;- 7
ssp &lt;- s(x,bs="ps",k=k); ssp$mono &lt;- 1
sm &lt;- smoothCon(ssp,data.frame(x))[[1]]
X &lt;- sm$X; XX &lt;- crossprod(X); sp &lt;- .005
gamma &lt;- rep(0,k); S &lt;- sm$S[[1]]
for (i in 1:20) {
  gt &lt;- c(gamma[1],exp(gamma[2:k]))
  dg &lt;- c(1,gt[2:k]) 
  g &lt;- -dg*(t(X)%*%(y-X%*%gt)) + sp*S%*%gamma
  H &lt;- dg*t(dg*XX)
  gamma &lt;- gamma - solve(H+sp*S,g)
}
lines(x,X%*%gt)

</code></pre>


</div>