<div class="container">

<table style="width: 100%;"><tr>
<td>tbl_custom_summary</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a table of summary statistics using a custom summary function</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a><br>
The <code>tbl_custom_summary()</code> function calculates descriptive statistics for
continuous, categorical, and dichotomous variables.
This function is similar to <code>tbl_summary()</code> but allows you to provide
a custom function in charge of computing the statistics (see Details).
</p>


<h3>Usage</h3>

<pre><code class="language-R">tbl_custom_summary(
  data,
  by = NULL,
  label = NULL,
  stat_fns,
  statistic,
  digits = NULL,
  type = NULL,
  value = NULL,
  missing = c("ifany", "no", "always"),
  missing_text = "Unknown",
  missing_stat = "{N_miss}",
  include = everything(),
  overall_row = FALSE,
  overall_row_last = FALSE,
  overall_row_label = "Overall"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>(<code>data.frame</code>)<br> A data frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by</code></td>
<td>
<p>(<code>tidy-select</code>)<br>
A single column from <code>data</code>. Summary statistics will be stratified by this variable.
Default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label</code></td>
<td>
<p>(<code>formula-list-selector</code>)<br>
Used to override default labels in summary table, e.g. <code>list(age = "Age, years")</code>.
The default for each variable is the column label attribute, <code>attr(., 'label')</code>.
If no label has been set, the column name is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stat_fns</code></td>
<td>
<p>(<code>formula-list-selector</code>)<br>
Specifies the function to be used to compute the statistics
(see below for details and examples).
You can also use dedicated helpers such as <code>ratio_summary()</code>
or <code>proportion_summary()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>statistic</code></td>
<td>
<p>(<code>formula-list-selector</code>)<br>
Specifies summary statistics to display for each variable.  The default is
<code>list(all_continuous() ~ "{median} ({p25}, {p75})", all_categorical() ~ "{n} ({p}%)")</code>.
See below for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>(<code>formula-list-selector</code>)<br>
Specifies how summary statistics are rounded. Values may be either integer(s)
or function(s). If not specified, default formatting is assigned
via <code>assign_summary_digits()</code>. See below for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>(<code>formula-list-selector</code>)<br>
Specifies the summary type. Accepted value are
<code>c("continuous", "continuous2", "categorical", "dichotomous")</code>.
If not specified, default type is assigned via
<code>assign_summary_type()</code>. See below for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>value</code></td>
<td>
<p>(<code>formula-list-selector</code>)<br>
Specifies the level of a variable to display on a single row.
The gtsummary type selectors, e.g. <code>all_dichotomous()</code>, cannot be used
with this argument. Default is <code>NULL</code>. See below for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>missing, missing_text, missing_stat</code></td>
<td>
<p>Arguments dictating how and if missing values are presented:
</p>

<ul>
<li> <p><code>missing</code>: must be one of <code>c("ifany", "no", "always")</code>
</p>
</li>
<li> <p><code>missing_text</code>: string indicating text shown on missing row. Default is <code>"Unknown"</code>
</p>
</li>
<li> <p><code>missing_stat</code>: statistic to show on missing row. Default is <code>"{N_miss}"</code>.
Possible values are <code>N_miss</code>, <code>N_obs</code>, <code>N_nonmiss</code>, <code>p_miss</code>, <code>p_nonmiss</code>.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>include</code></td>
<td>
<p>(<code>tidy-select</code>)<br>
Variables to include in the summary table. Default is <code>everything()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overall_row</code></td>
<td>
<p>(scalar <code>logical</code>)<br>
Logical indicator to display an overall row. Default is
<code>FALSE</code>. Use <code>add_overall()</code> to add an overall column.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overall_row_last</code></td>
<td>
<p>(scalar <code>logical</code>)<br>
Logical indicator to display overall row last in
table. Default is <code>FALSE</code>, which will display overall row first.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overall_row_label</code></td>
<td>
<p>(<code>string</code>)<br>
String indicating the overall row label. Default is <code>"Overall"</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A <code>tbl_custom_summary</code> object
</p>


<h3>Similarities with <code>tbl_summary()</code>
</h3>

<p>Please refer to the help file of <code>tbl_summary()</code> regarding the use of select
helpers, and arguments <code>include</code>, <code>by</code>, <code>type</code>, <code>value</code>, <code>digits</code>, <code>missing</code> and
<code>missing_text</code>.
</p>


<h3>
<code>stat_fns</code> argument</h3>

<p>The <code>stat_fns</code> argument specify the custom function(s) to be used for computing
the summary statistics. For example, <code>stat_fns = everything() ~ foo</code>.
</p>
<p>Each function may take the following arguments:
<code>foo(data, full_data, variable, by, type, ...)</code>
</p>

<ul>
<li> <p><code style="white-space: pre;">⁠data=⁠</code> is the input data frame passed to <code>tbl_custom_summary()</code>, subset
according to the level of <code>by</code> or <code>variable</code> if any, excluding <code>NA</code>
values of the current <code>variable</code>
</p>
</li>
<li> <p><code style="white-space: pre;">⁠full_data=⁠</code> is the full input data frame passed to <code>tbl_custom_summary()</code>
</p>
</li>
<li> <p><code style="white-space: pre;">⁠variable=⁠</code> is a string indicating the variable to perform the
calculation on
</p>
</li>
<li> <p><code style="white-space: pre;">⁠by=⁠</code> is a string indicating the by variable from <code style="white-space: pre;">⁠tbl_custom_summary=⁠</code>,
if present
</p>
</li>
<li> <p><code style="white-space: pre;">⁠type=⁠</code> is a string indicating the type of variable
(continuous, categorical, ...)
</p>
</li>
<li> <p><code style="white-space: pre;">⁠stat_display=⁠</code> a string indicating the statistic to display (for the
<code>statistic</code> argument, for that variable)
</p>
</li>
</ul>
<p>The user-defined does not need to utilize each of these inputs. It's
encouraged the user-defined function accept <code>...</code> as each of the arguments
<em>will</em> be passed to the function, even if not all inputs are utilized by
the user's function, e.g. <code>foo(data, ...)</code> (see examples).
</p>
<p>The user-defined function should return a one row <code>dplyr::tibble()</code> with
one column per summary statistics (see examples).
</p>


<h3>statistic argument</h3>

<p>The statistic argument specifies the statistics presented in the table. The
input is a list of formulas that specify the statistics to report. For example,
<code>statistic = list(age ~ "{mean} ({sd})")</code>.
A statistic name that appears between curly brackets
will be replaced with the numeric statistic (see <code>glue::glue()</code>).
All the statistics indicated in the statistic argument should be returned
by the functions defined in the <code>stat_fns</code> argument.
</p>
<p>When the summary type is <code>"continuous2"</code>, pass a vector of statistics. Each element
of the vector will result in a separate row in the summary table.
</p>
<p>For both categorical and continuous variables, statistics on the number of
missing and non-missing observations and their proportions are also available
to display.
</p>

<ul>
<li> <p><code>{N_obs}</code> total number of observations
</p>
</li>
<li> <p><code>{N_miss}</code> number of missing observations
</p>
</li>
<li> <p><code>{N_nonmiss}</code> number of non-missing observations
</p>
</li>
<li> <p><code>{p_miss}</code> percentage of observations missing
</p>
</li>
<li> <p><code>{p_nonmiss}</code> percentage of observations not missing
</p>
</li>
</ul>
<p>Note that for categorical variables, <code>{N_obs}</code>, <code>{N_miss}</code> and <code>{N_nonmiss}</code> refer
to the total number, number missing and number non missing observations
in the denominator, not at each level of the categorical variable.
</p>
<p>It is recommended to use <code>modify_footnote()</code> to properly describe the
displayed statistics (see examples).
</p>


<h3>Caution</h3>

<p>The returned table is compatible with all <code>gtsummary</code> features applicable
to a <code>tbl_summary</code> object, like <code>add_overall()</code>, <code>modify_footnote()</code> or
<code>bold_labels()</code>.
</p>
<p>However, some of them could be inappropriate in such case. In particular,
<code>add_p()</code> do not take into account the type of displayed statistics and
always return the p-value of a comparison test of the current variable
according to the <code>by</code> groups, which may be incorrect if the displayed
statistics refer to a third variable.
</p>


<h3>Author(s)</h3>

<p>Joseph Larmarange
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Example 1 ----------------------------------
my_stats &lt;- function(data, ...) {
  marker_sum &lt;- sum(data$marker, na.rm = TRUE)
  mean_age &lt;- mean(data$age, na.rm = TRUE)
  dplyr::tibble(
    marker_sum = marker_sum,
    mean_age = mean_age
  )
}

my_stats(trial)

trial |&gt;
  tbl_custom_summary(
    include = c("stage", "grade"),
    by = "trt",
    stat_fns = everything() ~ my_stats,
    statistic = everything() ~ "A: {mean_age} - S: {marker_sum}",
    digits = everything() ~ c(1, 0),
    overall_row = TRUE,
    overall_row_label = "All stages &amp; grades"
  ) |&gt;
  add_overall(last = TRUE) |&gt;
  modify_footnote(
    all_stat_cols() ~ "A: mean age - S: sum of marker"
  ) |&gt;
  bold_labels()

# Example 2 ----------------------------------
# Use `data[[variable]]` to access the current variable
mean_ci &lt;- function(data, variable, ...) {
  test &lt;- t.test(data[[variable]])
  dplyr::tibble(
    mean = test$estimate,
    conf.low = test$conf.int[1],
    conf.high = test$conf.int[2]
  )
}

trial |&gt;
  tbl_custom_summary(
    include = c("marker", "ttdeath"),
    by = "trt",
    stat_fns = ~ mean_ci,
    statistic = ~ "{mean} [{conf.low}; {conf.high}]"
  ) |&gt;
  add_overall(last = TRUE) |&gt;
  modify_footnote(
    all_stat_cols() ~ "mean [95% CI]"
  )

# Example 3 ----------------------------------
# Use `full_data` to access the full datasets
# Returned statistic can also be a character
diff_to_great_mean &lt;- function(data, full_data, ...) {
  mean &lt;- mean(data$marker, na.rm = TRUE)
  great_mean &lt;- mean(full_data$marker, na.rm = TRUE)
  diff &lt;- mean - great_mean
  dplyr::tibble(
    mean = mean,
    great_mean = great_mean,
    diff = diff,
    level = ifelse(diff &gt; 0, "high", "low")
  )
}

trial |&gt;
  tbl_custom_summary(
    include = c("grade", "stage"),
    by = "trt",
    stat_fns = ~ diff_to_great_mean,
    statistic = ~ "{mean} ({level}, diff: {diff})",
    overall_row = TRUE
  ) |&gt;
  bold_labels()
</code></pre>


</div>