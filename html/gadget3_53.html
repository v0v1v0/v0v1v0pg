<div class="container">

<table style="width: 100%;"><tr>
<td>likelihood_bounds_penalty</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Gadget3 likelihood bounds_penalty action</h2>

<h3>Description</h3>

<p>Add a liklihood penalty for parameters leaving the bounds set in parameter_template
</p>


<h3>Usage</h3>

<pre><code class="language-R">g3l_bounds_penalty(
        actions_or_parameter_template,
        weight = 1,
        run_at = g3_action_order$likelihood)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>actions_or_parameter_template</code></td>
<td>

<p>Either:
</p>
<p>A list of actions, to extract parameters from and to add bounds to.
</p>
<p>A parameter template generated by <code>g3_to_tmb</code>, with <var>optimise</var>, <var>lower</var>, <var>upper</var> populated,
bounds for the parameters will be hard-coded.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight</code></td>
<td>

<p>Weighting applied to this likelihood component.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_at</code></td>
<td>

<p>Integer order that actions will be run within model, see <code>g3_action_order</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Whilst lower/upper can be passed to <code>optim</code>, not all methods can use them.
Adding <code>g3l_bounds_penalty</code> OTOH can be used with any method.
</p>


<h3>Value</h3>



<h4>g3l_bounds_penalty</h4>

<p>An action (i.e. list of formula objects) that will...
If a <var>actions</var> list is supplied, add a large number to likelihood when any parameter is outside bounds.
Bounds are updated whenever <code>g3_tmb_adfun</code> is run.
</p>
<p>If a <var>parameter_template</var> is supplied, add a large number to likelihood when outside the bounds in the template.
The bounds are baked into the model at this point.
</p>



<h3>Examples</h3>

<pre><code class="language-R">
anch &lt;- g3_stock('anch', seq(20, 156, 4)) %&gt;% g3s_age(3, 10)
actions &lt;- list(
  g3a_time(1990, 1994),
  g3a_growmature(anch, g3a_grow_impl_bbinom(
    maxlengthgroupgrowth = 38L)),
  g3a_naturalmortality(anch),
  g3a_initialconditions_normalparam(anch),
  g3a_renewal_normalparam(anch,
    run_step = NULL),
  g3a_age(anch),
  NULL)

# Generate code with bounds added
model_code &lt;- g3_to_tmb(c(actions, list(g3l_bounds_penalty(actions))))

attr(model_code, "parameter_template") %&gt;%
  # Set lower / upper bounds for initial conditions
  g3_init_val("*.init.#", 10, lower = 0.001, upper = 200) %&gt;%
  identity() -&gt; params.in

# The objective function produced by g3_tmb_adfun() will honour the bounds
# above, without having to pass them to stats::optim()
</code></pre>


</div>