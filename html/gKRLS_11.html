<div class="container">

<table style="width: 100%;"><tr>
<td>legacy_marginal_effect</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Analytical Average Marginal Effects</h2>

<h3>Description</h3>

<p>This function is consider "legacy" and may be removed in future
updates. It calculates the (average) marginal effect and standard error by
taking the analytical derivative of the conditional expectation function
and only works in limited scenarios.
</p>


<h3>Usage</h3>

<pre><code class="language-R">legacy_marginal_effect(model, data = NULL, variables = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>A model estimated using functions from <code>mgcv</code> (e.g., <code>gam</code> or <code>bam</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame that is used to calculate the marginal effect or set
to <code>NULL</code> which will employ the data used when estimating the model.
The default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variables</code></td>
<td>
<p>A character vector that specifies the variables for which to
calculate effects. The default, <code>NULL</code>, calculates effects for all
variables.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is designed to provide comparability with the original
<code>KRLS</code> package, but is rather limited in the scenarios where it can be
applied (e.g., limited families, limited specifications of linear
predictions, limited numbers of smooth/penalized terms, etc.)
</p>
<p>Because of these restrictions, users should rely on
<code>calculate_effects</code> as this function may be removed in future updates.
A numerical approximation to the derivative found analytically in this
function is provided in calculate_effects.
</p>


<h3>Value</h3>

<p>The function returns a list that contains the following elements:
</p>

<ul>
<li>
<p>"ME_pointwise":  The marginal effects for each observation.
</p>
</li>
<li>
<p>"ME_pointwise_var":  The variance for each pointwise marginal effect
in "ME_pointwise".
</p>
</li>
<li>
<p>"AME_pointwise":  The average marginal effect, i.e. the column
averages of "ME_pointwise".
</p>
</li>
<li>
<p>"AME_pointwise_var":  The variance of each average marginal effect.
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">set.seed(321)
n &lt;- 100
x1 &lt;- rnorm(n)
x2 &lt;- rnorm(n)
x3 &lt;- rnorm(n)
state &lt;- sample(letters, n, replace = TRUE)
y &lt;- 0.3 * x1 + 0.4 * x2 + 0.5 * x3 + rnorm(n)
data &lt;- data.frame(y, x1, x2, x3, state)

# A gKRLS model
fit_gKRLS &lt;- mgcv::gam(y ~ s(x1, x2, x3, bs = "gKRLS"), data = data)
# calculate marginal effect using derivative
legacy_marginal_effect(fit_gKRLS)

</code></pre>


</div>