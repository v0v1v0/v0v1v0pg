<div class="container">

<table style="width: 100%;"><tr>
<td>ggkmrisktable</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a Kaplan-Meier plot with risk table</h2>

<h3>Description</h3>

<p>Produces a km plot with a facettable risk table in ggplot2
</p>


<h3>Usage</h3>

<pre><code class="language-R">ggkmrisktable(
  data = lung_long,
  time = "time",
  status = "DV",
  endpoint = "Endpoint",
  groupvar1 = "Endpoint",
  groupvar2 = "expname",
  groupvar3 = "none",
  exposure_metrics = c("age", "ph.karno"),
  exposure_metric_split = c("median", "tertile", "quartile", "none"),
  exposure_metric_soc_value = -99,
  exposure_metric_plac_value = 0,
  color_fill = "exptile",
  linetype = "exptile",
  xlab = "Time of follow_up",
  ylab = "Overall survival probability",
  nrisk_table_plot = TRUE,
  nrisk_table_variables = c("n.risk", "pct.risk", "n.event", "cum.n.event", "n.censor"),
  nrisk_table_breaktimeby = NULL,
  nrisk_table_textsize = 4,
  nrisk_position_scaler = 0.2,
  nrisk_position_dodge = 0.2,
  nrisk_offset = 0,
  nrisk_filterout0 = FALSE,
  km_logrank_pvalue = FALSE,
  km_logrank_pvalue_pos = c("left", "right"),
  km_trans = c("identity", "event", "cumhaz", "cloglog"),
  km_ticks = TRUE,
  km_band = TRUE,
  km_conf_int = 0.95,
  km_conf_type = c("log", "plain", "log", "log-log", "logit", "none"),
  km_conf_lower = c("usual", "peto", "modified"),
  km_median = c("none", "median", "medianci", "table"),
  km_median_table_pos = c("left", "right"),
  km_median_table_order = c("default", "reverse"),
  km_yaxis_position = c("left", "right"),
  facet_formula = NULL,
  facet_ncol = NULL,
  facet_strip_position = c("top", "top", "top", "top"),
  theme_certara = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data to use with multiple endpoints stacked into time, status, endpoint name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>name of the column holding the time to event information default to <code>time</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>status</code></td>
<td>
<p>name of the column holding the event information default to <code>DV</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>endpoint</code></td>
<td>
<p>name of the column holding the name/key of the endpoint default to <code>Endpoint</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groupvar1</code></td>
<td>
<p>name of the column to group by, default <code>Endpoint</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groupvar2</code></td>
<td>
<p>name of the column to group by in addition to groupvar1, default <code>expname</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>groupvar3</code></td>
<td>
<p>name of the column to group by in addition to groupvar1 and groupvar2, default "none"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exposure_metrics</code></td>
<td>
<p>name(s) of the column(s) to be stacked into <code>expname</code> <code>exptile</code> and split into <code>exposure_metric_split</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exposure_metric_split</code></td>
<td>
<p>one of "median", "tertile", "quartile", "none"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exposure_metric_soc_value</code></td>
<td>
<p>special exposure code for standard of care default -99</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exposure_metric_plac_value</code></td>
<td>
<p>special exposure code for placebo default 0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color_fill</code></td>
<td>
<p>name of the column to be used for color/fill default to <code>exptile</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linetype</code></td>
<td>
<p>name of the column to be used for linetype default to <code>exptile</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>text to be used as x axis label</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>text to be used as y axis label</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrisk_table_plot</code></td>
<td>
<p>TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrisk_table_variables</code></td>
<td>
<p>one or more from: "n.risk", "pct.risk", "n.event, "cum.n.event, "n.censor"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrisk_table_breaktimeby</code></td>
<td>
<p>NULL</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrisk_table_textsize</code></td>
<td>
<p>4</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrisk_position_scaler</code></td>
<td>
<p>0.2</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrisk_position_dodge</code></td>
<td>
<p>0.2, negative values will reverse the order</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrisk_offset</code></td>
<td>
<p>0</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrisk_filterout0</code></td>
<td>
<p>FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_logrank_pvalue</code></td>
<td>
<p>FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_logrank_pvalue_pos</code></td>
<td>
<p>"left" or "right"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_trans</code></td>
<td>
<p>one of "identity","event","cumhaz","cloglog"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_ticks</code></td>
<td>
<p>TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_band</code></td>
<td>
<p>TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_conf_int</code></td>
<td>
<p>0.95</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_conf_type</code></td>
<td>
<p>default one of "log", "plain", "log-log", "logit", "none"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_conf_lower</code></td>
<td>
<p>one of "usual", "peto", "modified"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_median</code></td>
<td>
<p>add median survival information one of "none", "median", "medianci", "table"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_median_table_pos</code></td>
<td>
<p>when table is chosen where to put it  "left" or "right</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_median_table_order</code></td>
<td>
<p>when table is chosen the order of the entries "default" or "reverse"</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>km_yaxis_position</code></td>
<td>
<p>where to put y axis on "left" or "right</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>facet_formula</code></td>
<td>
<p>facet formula to be used otherwise ~ groupvar1 + groupvar2 + groupvar3</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>facet_ncol</code></td>
<td>
<p>NULL if not specified the automatic waiver will be used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>facet_strip_position</code></td>
<td>
<p>position in sequence for the variable used in faceting default to c("top","top","top","top")</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theme_certara</code></td>
<td>
<p>apply certara colors and format for strips and default colour/fill</p>
</td>
</tr>
</table>
<h3>Examples</h3>

<pre><code class="language-R">library(tidyr)
# Example 1
lung_long &lt;-  survival::lung |&gt;
 dplyr::mutate(status = ifelse(status==1,0,1)) |&gt;
 tidyr::gather(Endpoint,DV,status) |&gt;
 dplyr::filter(!is.na(ph.karno))|&gt;
 dplyr::filter(!is.na(pat.karno))|&gt;
 dplyr::filter(!is.na(ph.ecog))
lung_long$ph.ecog &lt;- ifelse(lung_long$ph.ecog&gt;1,2,lung_long$ph.ecog)
lung_long$ph.ecog &lt;- as.factor(lung_long$ph.ecog )
lung_long$ph.ecog &lt;- as.factor(lung_long$ph.ecog )
lung_long$facetdum &lt;- "(all)"

ggkmrisktable(data = lung_long, time= "time", status ="DV",
             exposure_metrics =c("age","ph.karno"),
             exposure_metric_split = "tertile",
             color_fill = "exptile",
             linetype = "expname",
             groupvar1 = "Endpoint",
             groupvar2 = "exptile",
             xlab = "Time of follow_up",
             ylab ="Overall survival probability",
             nrisk_table_variables = c("n.risk","n.event"),
             km_median = "medianci",
             km_band = FALSE,
             nrisk_table_breaktimeby = 200,
             facet_ncol = 3)
#Example 2
ggkmrisktable(data = lung_long, time= "time", status ="DV",
             exposure_metrics =c("age","ph.karno"),
             exposure_metric_split = "quartile",
             color_fill = "exptile",
             linetype = "none",
             groupvar1 = "Endpoint",
             groupvar2 = "exptile",
             xlab = "Time of follow_up",
             ylab ="Overall survival probability",
             nrisk_table_variables = c("cum.n.event","pct.risk","n.censor"),
             km_median = "medianci",
             km_band = TRUE,
             km_trans = "event",
             nrisk_table_breaktimeby = 200,
             facet_ncol = 3,
             facet_formula = ~expname)
## Not run: 
#Example 3
ggkmrisktable(data = lung_long, time = "time", status = "DV",
             exposure_metrics =c("ph.karno","pat.karno"),
             exposure_metric_split = "median",
             color_fill = "exptile",
             linetype = "exptile",
             groupvar1 = "Endpoint",
             groupvar2 = "expname",
             xlab = "Time of follow_up",
             ylab ="Overall survival probability",
             nrisk_table_variables = c("n.event"),
             km_trans = "event",
             km_median = "table",
             km_median_table_pos = "right",
             km_logrank_pvalue = TRUE,
             km_band = TRUE,
             nrisk_table_breaktimeby = 200,
             facet_ncol = 3,
             facet_formula = ~expname)
#Example 4
ggkmrisktable(data=lung_long,
             exposure_metrics = c("ph.karno","age"),
             exposure_metric_split = "median",
             time = "time",
             status ="DV",
             color_fill = "ph.ecog",
             linetype = "ph.ecog",
             groupvar1 = "Endpoint",
             groupvar2 = "expname",
             groupvar3 = "exptile",
             nrisk_filterout0 = FALSE,
             nrisk_table_breaktimeby = 200,
             km_logrank_pvalue = TRUE,
             km_median = "table",
             km_median_table_pos = "left",
             facet_formula = ~expname+exptile)
#Example 5

ggkmrisktable(data=lung_long,
             exposure_metrics = c("ph.karno","age"),
             exposure_metric_split = "none",
              color_fill = "facetdum",
             linetype = "none",
             nrisk_table_variables = c("n.risk", "pct.risk", "n.event", "cum.n.event", "n.censor"),
              km_median = "table",
              nrisk_position_scaler = 0.1
             )             
             

## End(Not run)
</code></pre>


</div>