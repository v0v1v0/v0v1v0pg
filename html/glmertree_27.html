<div class="container">

<table style="width: 100%;"><tr>
<td>betamertree</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Beta Mixed-Effects Regression Trees</h2>

<h3>Description</h3>

<p>Model-based recursive partitioning based on mixed-effects beta
regression.
</p>


<h3>Usage</h3>

<pre><code class="language-R">betamertree(formula, data, family = NULL, weights = NULL, cluster = NULL, 
  ranefstart = NULL, offset = NULL, REML = TRUE, joint = TRUE, 
  abstol = 0.001, maxit = 100, dfsplit = TRUE, verbose = FALSE, 
  plot = FALSE, glmmTMB.control = glmmTMB::glmmTMBControl(), ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>formula specifying the response variable and a three-part
right-hand-side describing the regressors, random effects, and
partitioning variables, respectively. For details see below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>data.frame to be used for estimating the model tree.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>currently not used. The default beta distribution parameterization 
of package <code>betareg</code> is used, see also <code>?glmmTMB::beta_family.</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>numeric. An optional numeric vector of weights. Can be a 
name of a column in data or a vector of length <code>nrow(data)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>currently not used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranefstart</code></td>
<td>
<p>currently not used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>optional numeric vector to be included in the linear predictor 
with a coeffcient of one. Note that <code>offset</code> can be a name of a column 
in <code>data</code> or a a numeric vector of length <code>nrow(data)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>joint</code></td>
<td>
<p>currently not used. Fixed effects from the tree are
always (re-)estimated jointly along with the random effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>abstol</code></td>
<td>
<p>numeric. The convergence criterion used for estimation of the model.
When the difference in log-likelihoods of the random-effects model from two
consecutive iterations is smaller than <code>abstol</code>, estimation of the
model tree has converged.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>numeric. The maximum number of iterations to be performed in
estimation of the model tree.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dfsplit</code></td>
<td>
<p>logical or numeric. <code>as.integer(dfsplit)</code> is the
degrees of freedom per selected split employed when extracting
the log-likelihood.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Should the log-likelihood value of the estimated
random-effects model be printed for every iteration of the estimation?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>Should the tree be plotted at every iteration of the estimation?
Note that selecting this option slows down execution of the function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>REML</code></td>
<td>
<p>logical scalar. Should the fixed-effects estimates be chosen to 
optimize the REML criterion (as opposed to the log-likelihood)? Will be 
passed to funtion <code>glmmTMB()</code>. See <code>glmmTMB</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>glmmTMB.control</code></td>
<td>
<p>list. An optional list with control
parameters to be passed to <code>glmmTMB()</code>.
See <code>glmmTMBControl</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to be passed to <code>lmtree()</code> or <code>glmtree()</code>.
See <code>mob_control</code> documentation for details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function betamertree aims to learn a tree where each terminal node is associated with
different fixed-effects regression coefficients, while adjusting for global 
random effects (such as a random intercept). It is a generalization of the ideas
underlying function <code>glmertree</code>, to allow for detection of 
subgroups with different fixed-effects parameter estimates, keeping the 
random effects constant throughout the tree (i.e., random effects are
estimated globally). The estimation algorithm iterates between (1) estimation 
of the tree given an offset of random effects, and (2) estimation of the 
random effects given the tree structure. See Fokkema et al. (2018) for 
a detailed description.
</p>
<p>Where <code>glmertree</code> uses function <code>glmtree</code> from package partykit to 
find the subgroups, and function <code>glmer</code> from package lme4 to estimate
the mixed-effects model, <code>betamertree</code> uses function <code>betatree</code> from
package betareg to find the subgroups, and function <code>glmmTMB</code> from 
package package glmmTMB to estimate the mixed-effects model. 
</p>
<p>The code is experimental and will change in future versions.
</p>


<h3>Value</h3>

<p>The function returns a list with the following objects:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>tree</code></td>
<td>
<p>The final <code>betatree</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>glmmTMB</code></td>
<td>
<p>The final <code>glmmTMB</code> random-effects model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranef</code></td>
<td>
<p>The corresponding random effects of <code>glmmTMB</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varcorr</code></td>
<td>
<p>The corresponding <code>VarCorr(glmmTMB)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>variance</code></td>
<td>
<p>The corresponding <code>attr(VarCorr(glmmTMB), "sc")^2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>The dataset specified with the <code>data</code> argument
including added auxiliary variables <code>.ranef</code> and <code>.tree</code>
from the last iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loglik</code></td>
<td>
<p>The log-likelihood value of the last iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iterations</code></td>
<td>
<p>The number of iterations used to estimate the <code>betamertree</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxit</code></td>
<td>
<p>The maximum number of iterations specified with the <code>maxit</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ranefstart</code></td>
<td>
<p>The random effects used as an offset, as specified with
the <code>ranefstart</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>The formula as specified with the <code>formula</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>randomformula</code></td>
<td>
<p>The formula as specified with the <code>randomformula</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>abstol</code></td>
<td>
<p>The prespecified value for the change in log-likelihood to evaluate
convergence, as specified with the <code>abstol</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mob.control</code></td>
<td>
<p>A list containing control parameters passed to
<code>betatree()</code>, as specified with ....</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>glmmTMB.control</code></td>
<td>
<p>A list containing control parameters passed to
<code>glmmTMB()</code>, as specified in the <code>control</code> argument of
function <code>glmmTMB</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>joint</code></td>
<td>
<p>Whether the fixed effects from the tree were (re-)estimated jointly along 
with the random effects, specified with the <code>joint</code> argument.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Fokkema M, Smits N, Zeileis A, Hothorn T, Kelderman H (2018).
“Detecting Treatment-Subgroup Interactions in Clustered Data
with Generalized Linear Mixed-Effects Model Trees”. Behavior Research 
Methods, 50(5), 2016-2034. <a href="https://doi.org/10.3758/s13428-017-0971-x">doi:10.3758/s13428-017-0971-x</a>
</p>
<p>Fokkema M, Edbrooke-Childs J &amp; Wolpert M (2021). “Generalized linear mixed-model 
(GLMM) trees: A flexible decision-tree method for multilevel and longitudinal data.” 
Psychotherapy Research, 31(3), 329-341. <a href="https://doi.org/10.1080/10503307.2020.1785037">doi:10.1080/10503307.2020.1785037</a>
</p>
<p>Fokkema M &amp; Zeileis A (2024). Subgroup detection in linear growth curve models with 
generalized linear mixed model (GLMM) trees. Behavior Research Methods. 
<a href="https://doi.org/10.3758/s13428-024-02389-1">doi:10.3758/s13428-024-02389-1</a>
</p>


<h3>See Also</h3>

<p><code>glmmTMB</code>, 
<code>betatree</code></p>


<h3>Examples</h3>

<pre><code class="language-R">
if (require("betareg") &amp;&amp; require("glmmTMB")) {
## load example data
data("ReadingSkills", package = "betareg")
## add random noise (not associated with reading scores)
set.seed(1071)
ReadingSkills$x1 &lt;- rnorm(nrow(ReadingSkills))
ReadingSkills$x2 &lt;- runif(nrow(ReadingSkills))
ReadingSkills$x3 &lt;- factor(rnorm(nrow(ReadingSkills)) &gt; 0)
ReadingSkills$gr &lt;- factor(rep(letters[1:5], length.out = nrow(ReadingSkills))) 

## Fit beta mixed-effects regression tree 
betamer_form &lt;- accuracy ~ iq | gr | dyslexia + x1 + x2 + x3
bmertree &lt;- betamertree(betamer_form, data = ReadingSkills, minsize = 10)
VarCorr(bmertree)
ranef(bmertree)
fixef(bmertree)
coef(bmertree)
plot(bmertree)
predict(bmertree, newdata = ReadingSkills[1:5,])
predict(bmertree) ## see ?predict.glmmmTMB for other arguments that can be passed
residuals(bmertree) ## see ?residuals.glmmmTMB for other arguments that can be passed
}

</code></pre>


</div>