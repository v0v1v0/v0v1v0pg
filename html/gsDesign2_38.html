<div class="container">

<table style="width: 100%;"><tr>
<td>gs_power_ahr</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Group sequential design power using average hazard ratio under
non-proportional hazards</h2>

<h3>Description</h3>

<p>Group sequential design power using average hazard ratio under
non-proportional hazards.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gs_power_ahr(
  enroll_rate = define_enroll_rate(duration = c(2, 2, 10), rate = c(3, 6, 9)),
  fail_rate = define_fail_rate(duration = c(3, 100), fail_rate = log(2)/c(9, 18), hr =
    c(0.9, 0.6), dropout_rate = rep(0.001, 2)),
  event = c(30, 40, 50),
  analysis_time = NULL,
  upper = gs_b,
  upar = gsDesign(k = length(event), test.type = 1, n.I = event, maxn.IPlan = max(event),
    sfu = sfLDOF, sfupar = NULL)$upper$bound,
  lower = gs_b,
  lpar = c(qnorm(0.1), rep(-Inf, 2)),
  test_lower = TRUE,
  test_upper = TRUE,
  ratio = 1,
  binding = FALSE,
  info_scale = c("h0_h1_info", "h0_info", "h1_info"),
  r = 18,
  tol = 1e-06,
  interval = c(0.01, 1000)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>enroll_rate</code></td>
<td>
<p>An <code>enroll_rate</code> data frame with or without stratum
created by <code>define_enroll_rate()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fail_rate</code></td>
<td>
<p>Failure and dropout rates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event</code></td>
<td>
<p>Targeted event at each analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>analysis_time</code></td>
<td>
<p>Minimum time of analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper</code></td>
<td>
<p>Function to compute upper bound.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upar</code></td>
<td>
<p>Parameters passed to <code>upper</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower</code></td>
<td>
<p>Function to compute lower bound.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lpar</code></td>
<td>
<p>Parameters passed to <code>lower</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_lower</code></td>
<td>
<p>Indicator of which analyses should include an lower bound;
single value of <code>TRUE</code> (default) indicates all analyses;
single value of <code>FALSE</code> indicated no lower bound;
otherwise, a logical vector of the same length as <code>info</code> should indicate
which analyses will have a lower bound.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_upper</code></td>
<td>
<p>Indicator of which analyses should include an upper
(efficacy) bound; single value of <code>TRUE</code> (default) indicates all analyses;
otherwise, a logical vector of the same length as <code>info</code> should
indicate which analyses will have an efficacy bound.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratio</code></td>
<td>
<p>Experimental:Control randomization ratio (not yet implemented).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binding</code></td>
<td>
<p>Indicator of whether futility bound is binding;
default of <code>FALSE</code> is recommended.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>info_scale</code></td>
<td>
<p>Information scale for calculation. Options are:
</p>

<ul>
<li> <p><code>"h0_h1_info"</code> (default): variance under both null and alternative hypotheses is used.
</p>
</li>
<li> <p><code>"h0_info"</code>: variance under null hypothesis is used.
</p>
</li>
<li> <p><code>"h1_info"</code>: variance under alternative hypothesis is used.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>Integer value controlling grid for numerical integration as in
Jennison and Turnbull (2000); default is 18, range is 1 to 80.
Larger values provide larger number of grid points and greater accuracy.
Normally, <code>r</code> will not be changed by the user.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>Tolerance parameter for boundary convergence (on Z-scale).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>interval</code></td>
<td>
<p>An interval that is presumed to include the time at which
expected event count is equal to targeted event.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Bound satisfy input upper bound specification in
<code>upper</code>, <code>upar</code>, and lower bound specification in <code>lower</code>, <code>lpar</code>.
<code>ahr()</code> computes statistical information at targeted event times.
The <code>expected_time()</code> function is used to get events and average HR at
targeted <code>analysis_time</code>.
</p>


<h3>Value</h3>

<p>A tibble with columns <code>Analysis</code>, <code>Bound</code>, <code>Z</code>, <code>Probability</code>,
<code>theta</code>, <code>Time</code>, <code>AHR</code>, <code>Events</code>.
Contains a row for each analysis and each bound.
</p>


<h3>Specification</h3>


<p>The contents of this section are shown in PDF user manual only.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(gsDesign2)
library(dplyr)

# Example 1 ----
# The default output of `gs_power_ahr()` is driven by events,
# i.e., `event = c(30, 40, 50)`, `analysis_time = NULL`

gs_power_ahr()

# Example 2 ----
# 2-sided symmetric O'Brien-Fleming spending bound, driven by analysis time,
# i.e., `event = NULL`, `analysis_time = c(12, 24, 36)`

gs_power_ahr(
  analysis_time = c(12, 24, 36),
  event = NULL,
  binding = TRUE,
  upper = gs_spending_bound,
  upar = list(sf = gsDesign::sfLDOF, total_spend = 0.025, param = NULL, timing = NULL),
  lower = gs_spending_bound,
  lpar = list(sf = gsDesign::sfLDOF, total_spend = 0.025, param = NULL, timing = NULL)
)

# Example 3 ----
# 2-sided symmetric O'Brien-Fleming spending bound, driven by event,
# i.e., `event = c(20, 50, 70)`, `analysis_time = NULL`

gs_power_ahr(
  analysis_time = NULL,
  event = c(20, 50, 70),
  binding = TRUE,
  upper = gs_spending_bound,
  upar = list(sf = gsDesign::sfLDOF, total_spend = 0.025, param = NULL, timing = NULL),
  lower = gs_spending_bound,
  lpar = list(sf = gsDesign::sfLDOF, total_spend = 0.025, param = NULL, timing = NULL)
)

# Example 4 ----
# 2-sided symmetric O'Brien-Fleming spending bound,
# driven by both `event` and `analysis_time`, i.e.,
# both `event` and `analysis_time` are not `NULL`,
# then the analysis will driven by the maximal one, i.e.,
# Time = max(analysis_time, calculated Time for targeted event)
# Events = max(events, calculated events for targeted analysis_time)

gs_power_ahr(
  analysis_time = c(12, 24, 36),
  event = c(30, 40, 50),
  binding = TRUE,
  upper = gs_spending_bound,
  upar = list(sf = gsDesign::sfLDOF, total_spend = 0.025, param = NULL, timing = NULL),
  lower = gs_spending_bound,
  lpar = list(sf = gsDesign::sfLDOF, total_spend = 0.025, param = NULL, timing = NULL)
)

</code></pre>


</div>