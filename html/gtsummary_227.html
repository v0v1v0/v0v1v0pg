<div class="container">

<table style="width: 100%;"><tr>
<td>tbl_strata</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Stratified gtsummary tables</h2>

<h3>Description</h3>

<p><a href="https://lifecycle.r-lib.org/articles/stages.html#maturing"><img src="../help/figures/lifecycle-maturing.svg" alt="[Maturing]"></a><br>
Build a stratified gtsummary table. Any gtsummary table that accepts
a data frame as its first argument can be stratified.
</p>

<ul>
<li>
<p> In <code>tbl_strata()</code>, the stratified or subset data frame is passed to the
function in <code style="white-space: pre;">⁠.tbl_fun=⁠</code>, e.g. <code>purrr::map(data, .tbl_fun)</code>.
</p>
</li>
<li>
<p> In <code>tbl_strata2()</code>, both the stratified data frame and the strata level
are passed to <code style="white-space: pre;">⁠.tbl_fun=⁠</code>, e.g. <code>purrr::map2(data, strata, .tbl_fun)</code>
</p>
</li>
</ul>
<h3>Usage</h3>

<pre><code class="language-R">tbl_strata(
  data,
  strata,
  .tbl_fun,
  ...,
  .sep = ", ",
  .combine_with = c("tbl_merge", "tbl_stack"),
  .combine_args = NULL,
  .header = ifelse(.combine_with == "tbl_merge", "**{strata}**", "{strata}"),
  .stack_group_header = NULL,
  .quiet = NULL
)

tbl_strata2(
  data,
  strata,
  .tbl_fun,
  ...,
  .sep = ", ",
  .combine_with = c("tbl_merge", "tbl_stack"),
  .combine_args = NULL,
  .header = ifelse(.combine_with == "tbl_merge", "**{strata}**", "{strata}"),
  .stack_group_header = NULL,
  .quiet = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>(<code>data.frame</code>, <code>survey.design</code>)<br>
a data frame or survey object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>strata</code></td>
<td>
<p>(<code>tidy-select</code>)<br>
character vector or tidy-selector of columns in data to stratify results by</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.tbl_fun</code></td>
<td>
<p>(<code>function</code>)
A function or formula. If a <em>function</em>, it is used as is.
If a formula, e.g. <code>~ .x %&gt;% tbl_summary() %&gt;% add_p()</code>, it is converted to a function.
The stratified data frame is passed to this function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed on to the <code>.tbl_fun</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.sep</code></td>
<td>
<p>(<code>string</code>)<br>
when more than one stratifying variable is passed, this string is
used to separate the levels in the spanning header. Default is <code>", "</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.combine_with</code></td>
<td>
<p>(<code>string</code>)<br>
One of <code>c("tbl_merge", "tbl_stack")</code>. Names the function
used to combine the stratified tables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.combine_args</code></td>
<td>
<p>(named <code>list</code>)<br>
named list of arguments that are passed to function specified in <code>.combine_with</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.header</code></td>
<td>
<p>(<code>string</code>)<br>
String indicating the headers that will be placed.
Default is <code>"**{strata}**"</code> when <code>.combine_with = "tbl_merge"</code> and
<code>"{strata}"</code> when <code>.combine_with = "tbl_stack"</code>. Items placed in
curly brackets will be evaluated according to <code>glue::glue()</code> syntax.
- <code>strata</code> stratum levels
- <code>n</code> N within stratum
- <code>N</code> Overall N
</p>
<p>The evaluated value of <code>.header</code> is also available within <code>tbl_strata2(.tbl_fun)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.stack_group_header</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>.quiet</code></td>
<td>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated"><img src="../help/figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a></p>
</td>
</tr>
</table>
<h3>Tips</h3>


<ul><li> <p><code>tbl_summary()</code>
</p>

<ul>
<li>
<p> The number of digits continuous variables are rounded to is determined
separately within each stratum of the data frame. Set the <code style="white-space: pre;">⁠digits=⁠</code>
argument to ensure continuous variables are rounded to the same number
of decimal places.
</p>
</li>
<li>
<p> If some levels of a categorical variable are unobserved within a
stratum, convert the variable to a factor to ensure all levels appear in
each stratum's summary table.
</p>
</li>
</ul>
</li></ul>
<h3>Author(s)</h3>

<p>Daniel D. Sjoberg
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Example 1 ----------------------------------
trial |&gt;
  select(age, grade, stage, trt) |&gt;
  mutate(grade = paste("Grade", grade)) |&gt;
  tbl_strata(
    strata = grade,
    .tbl_fun =
      ~ .x |&gt;
        tbl_summary(by = trt, missing = "no") |&gt;
        add_n(),
    .header = "**{strata}**, N = {n}"
  )

# Example 2 ----------------------------------
trial |&gt;
  select(grade, response) |&gt;
  mutate(grade = paste("Grade", grade)) |&gt;
  tbl_strata2(
    strata = grade,
    .tbl_fun =
      ~ .x %&gt;%
        tbl_summary(
          label = list(response = .y),
          missing = "no",
          statistic = response ~ "{p}%"
        ) |&gt;
        add_ci(pattern = "{stat} ({ci})") |&gt;
        modify_header(stat_0 = "**Rate (95% CI)**") |&gt;
        modify_footnote(stat_0 = NA),
    .combine_with = "tbl_stack",
    .combine_args = list(group_header = NULL),
    .quiet = TRUE
  ) |&gt;
  modify_caption("**Response Rate by Grade**")
</code></pre>


</div>