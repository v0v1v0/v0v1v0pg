<div class="container">

<table style="width: 100%;"><tr>
<td>stat_compare</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add Mean Comparison for Groups to a ggplot</h2>

<h3>Description</h3>

<p>Add group mean comparisons to a ggplot. The comparisons can be performed using the t-test, Wilcoxon rank-sum test, one-way ANOVA, or Kruskal-Wallis test.
</p>


<h3>Usage</h3>

<pre><code class="language-R">stat_compare(
  mapping = NULL,
  data = NULL,
  position = "identity",
  ...,
  nudge = 0,
  start = NULL,
  breaks = NULL,
  labels = NULL,
  cutoff = NULL,
  method = NULL,
  ref_group = NULL,
  tip_length = 0.02,
  parametric = FALSE,
  correction = "none",
  panel_indep = FALSE,
  method_args = NULL,
  comparisons = NULL,
  step_increase = 0.1,
  inherit.aes = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>mapping</code></td>
<td>
<p>Set of aesthetic mappings created by <code>aes()</code>. If specified and
<code>inherit.aes = TRUE</code> (the default), it is combined with the default mapping
at the top level of the plot. You must supply <code>mapping</code> if there is no plot
mapping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>The data to be displayed in this layer. There are three
options:
</p>
<p>If <code>NULL</code>, the default, the data is inherited from the plot
data as specified in the call to <code>ggplot()</code>.
</p>
<p>A <code>data.frame</code>, or other object, will override the plot
data. All objects will be fortified to produce a data frame. See
<code>fortify()</code> for which variables will be created.
</p>
<p>A <code>function</code> will be called with a single argument,
the plot data. The return value must be a <code>data.frame</code>, and
will be used as the layer data. A <code>function</code> can be created
from a <code>formula</code> (e.g. <code>~ head(.x, 10)</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>position</code></td>
<td>
<p>A position adjustment to use on the data for this layer. This
can be used in various ways, including to prevent overplotting and
improving the display. The <code>position</code> argument accepts the following:
</p>

<ul>
<li>
<p> The result of calling a position function, such as <code>position_jitter()</code>.
This method allows for passing extra arguments to the position.
</p>
</li>
<li>
<p> A string naming the position adjustment. To give the position as a
string, strip the function name of the <code>position_</code> prefix. For example,
to use <code>position_jitter()</code>, give the position as <code>"jitter"</code>.
</p>
</li>
<li>
<p> For more information and other ways to specify the position, see the
layer position documentation.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments passed on to <code>geom_bracket()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nudge</code></td>
<td>
<p><code>numeric</code>, the nudge of start position in fraction of scale range.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p><code>numeric</code>, the bracket start position. Defaults to the maximum value of <code>y</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks</code></td>
<td>
<p><code>numeric</code>, the breaks for p-value labels, like c(0, 0.001, 0.01, 0.05, 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p><code>character</code>, the labels for p-value breaks, like c("<em><strong>", "</strong>", "</em>", "ns").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff</code></td>
<td>
<p><code>numeric</code>, the cutoff for p-value, labels above this value will be removed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p><code>function</code>, the method for the test; it should support formula interface and return a list with components <code>p.value</code> and <code>method</code> (name).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ref_group</code></td>
<td>
<p><code>character</code>, the reference group for comparison. other groups will be compared to this group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tip_length</code></td>
<td>
<p><code>numeric</code>, the length of the bracket tips in fraction of scale range.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parametric</code></td>
<td>
<p><code>logical</code>, whether to use parametric test (t-test, One-way ANOVA) or non-parametric test (Wilcoxon rank sum test, Kruskal-Wallis test). Applicable only when <code>method</code> is NULL.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correction</code></td>
<td>
<p><code>character</code>, the method for p-value adjustment; options include p.adjust.methods with "<code>none</code>" as the default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>panel_indep</code></td>
<td>
<p><code>logical</code>, whether to correct the p-value only at the panel level. If <code>FALSE</code>, the p-value will be corrected at the layer level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method_args</code></td>
<td>
<p><code>list</code>, additional arguments to be passed to the test method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comparisons</code></td>
<td>
<p><code>list</code>, a list of comparisons to be made. Each element should contain two groups to be compared.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>step_increase</code></td>
<td>
<p><code>numeric</code>, the step increase in fraction of scale range for every additional comparison, in order to avoid overlapping brackets.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inherit.aes</code></td>
<td>
<p>If <code>FALSE</code>, overrides the default aesthetics,
rather than combining with them. This is most useful for helper functions
that define both data and aesthetics and shouldn't inherit behaviour from
the default plot specification, e.g. <code>borders()</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Usually you do not need to specify the test method, you only need to tell <code>stat_compare()</code> whether you want to perform a parametric test or a nonparametric test, and <code>stat_compare()</code> will automatically choose the appropriate test method based on your data.
For comparisons between two groups, the p-value is calculated by t-test (parametric) or Wilcoxon rank sum test (nonparametric). For comparisons among more than two groups, the p-value is calculated by One-way ANOVA (parametric) or Kruskal-Wallis test (nonparametric).
</p>


<h3>Value</h3>

<p><code>LayerInstance</code>, a layer that can be added to a ggplot.
</p>


<h3>Aesthetics</h3>


<ul><li>
<p> required: <code>x</code>, <code>y</code>
</p>
</li></ul>
<h3>Computed variables</h3>


<ul>
<li> <p><strong><code>p</code></strong>: p-value of the test.
</p>
</li>
<li> <p><strong><code>q</code></strong>: adjusted p-value of the test.
</p>
</li>
<li> <p><strong><code>label</code></strong>: the label of the bracket.
</p>
</li>
<li> <p><strong><code>method</code></strong>: the method name of the test.
</p>
</li>
<li> <p><strong><code>xmin</code></strong>, <strong><code>xmax</code></strong>, <strong><code>ymin</code></strong>, <strong><code>ymax</code></strong>: the position of the bracket.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>HMU-WH
</p>


<h3>Examples</h3>

<pre><code class="language-R">
p &lt;- ggplot(mpg, aes(class, displ, color = class)) +
  geom_boxplot(show.legend = FALSE) +
  theme_test()

# Global comparison: Each x has only one group.
p + stat_compare()
# If you just want to display text, you can set parameters "bracket" to FALSE.
p + stat_compare(bracket = FALSE)
# If you want to display the test method, you can do this.
p + stat_compare(aes(label = after_stat(sprintf("%s: %s", method, label))))

# Comparison between two groups: specify a reference group.
p + stat_compare(ref_group = "minivan")
# If you only want to display the p-value less or equal to 0.01, you can do this.
p + stat_compare(ref_group = "minivan", cutoff = 0.01)
# if you want to display the significance level, you can do this.
p + stat_compare(ref_group = "minivan", breaks = c(0, 0.001, 0.01, 0.05, 1))

# Comparison between two groups: specify the comparison group.
p + stat_compare(tip_length = 0.05,
                 step_increase = 0,
                 comparisons = list(c("compact", "midsize"), c("pickup", "suv")),
                 arrow = grid::arrow(type = "closed", length = unit(0.1, "inches")))
                 # Yeah, this supports adding arrows.

# Within-group (grouped by the x-axis) population comparison.
ggplot(mpg, aes(drv, displ, fill = class)) +
  geom_boxplot() +
  stat_compare() +
  stat_compare(aes(group = drv), nudge = 0.1, color = "gray") + # add global comparison
  theme_test()

# Better adaptation to faceting.
ggplot(mpg, aes(drv, displ)) +
  geom_boxplot() +
  stat_compare(comparisons = combn(unique(mpg$drv), 2, simplify = FALSE)) +
  facet_grid(cols = vars(class), scales = "free") +
  theme_test()

# P-value correction
p &lt;- ggplot(mpg, aes(class, displ)) +
  geom_boxplot() +
  facet_grid(cols = vars(cyl), scales = "free") +
  theme_test()
# Layer-level P-value correction
p + stat_compare(ref_group = 1, correction = "fdr")
# Panel-level P-value correction
p + stat_compare(ref_group = 1, correction = "fdr", panel_indep = TRUE)

</code></pre>


</div>