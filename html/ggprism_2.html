<div class="container">

<table style="width: 100%;"><tr>
<td>add_pvalue</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Add p-values to a ggplot</h2>

<h3>Description</h3>

<p>Add p-values with or without brackets to a ggplot.
</p>
<p>See <a href="https://csdaw.github.io/ggprism/articles/pvalues.html">here</a>
or the examples section below for examples of how to use.
</p>
<p><code>add_pvalue</code> is a refactored version of
<code>stat_pvalue_manual</code> from
<a href="https://github.com/kassambara/ggpubr">kassambara/ggpubr</a>, altered to
have less dependencies, and more flexibility with input format and
aesthetics. Any examples using <code>stat_pvalue_manual</code> found on
<a href="https://www.datanovia.com/en/?s=p-value&amp;search-type=default">Datanovia</a>
will also work with <code>add_pvalue</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">add_pvalue(
  data,
  label = NULL,
  xmin = "group1",
  xmax = "group2",
  x = NULL,
  y.position = "y.position",
  parse = FALSE,
  label.size = 3.2,
  colour = NULL,
  color = NULL,
  tip.length = 0.03,
  bracket.size = 0.6,
  bracket.colour = NULL,
  bracket.color = NULL,
  bracket.shorten = 0,
  bracket.nudge.y = 0,
  step.increase = 0,
  step.group.by = NULL,
  remove.bracket = FALSE,
  coord.flip = FALSE,
  position = "identity",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A <code>data.frame</code> with the statistics to plot. Default format
has the following columns: <code>group1 | group2 | p.adj | y.position | etc</code>.
<code>group1</code> and <code>group2</code> are the two groups that were compared.
<code>p.adj</code> is the adjusted p-value. <code>y.position</code> is the y coordinate
that specifies where on the plot the p-value should go. The column names
can differ from the default as long as their are specified when calling
the function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label</code></td>
<td>
<p><code>string</code>. Name of column in <code>data</code> that
contains the text to plot (e.g. <code>label = "p.adj"</code>).
Can also be an expression that can be formatted by
<code>glue</code> (e.g. <code>label = "p = {p.adj}"</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmin</code></td>
<td>
<p><code>string</code>. Name of column in <code>data</code>  that
contains the position of the left side of the brackets.
Default is <code>"group1"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xmax</code></td>
<td>
<p>Optional. <code>string</code>. Name of column in <code>data</code> that
contains the position of the right side of the brackets.
Default is <code>"group2"</code>. If <code>NULL</code>, the p-values are plotted as
text only.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p><code>string</code> or <code>numeric</code>. x coordinate of the p-value text.
Only use when plotting p-value as text only (no brackets).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y.position</code></td>
<td>
<p><code>string</code>. Name of column in
<code>data</code> containing the y coordinates (<code>numeric</code>) of each p-value to
be plotted. Can also be a single number to plot all p-values at the same
height or a <code>numeric</code> vector that will override <code>data</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parse</code></td>
<td>
<p><code>logical</code>. Default is <code>FALSE</code>. If <code>TRUE</code> the text labels will
be parsed into expressions and displayed as described in <code>?plotmath</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label.size</code></td>
<td>
<p><code>numeric</code>. Size of text.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colour, color</code></td>
<td>
<p><code>string</code>. Colour of text.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tip.length</code></td>
<td>
<p><code>numeric</code> vector. Length of bracket tips.
Use <code>0</code> to remove tips.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bracket.size</code></td>
<td>
<p><code>numeric</code>. Line width of bracket.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bracket.colour, bracket.color</code></td>
<td>
<p><code>string</code>. Colour of bracket. Default is
<code>NULL</code> which causes brackets to inherit the colour of the text.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bracket.shorten</code></td>
<td>
<p><code>numeric</code>. Shortens the brackets slightly to
allow them to be plotted side-by-side at the same y position.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bracket.nudge.y</code></td>
<td>
<p><code>numeric</code>. Changes the y position of
p-values. Useful for slightly adjusting p-values if the text is cut off.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>step.increase</code></td>
<td>
<p><code>numeric</code>. Changes the space between brackets.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>step.group.by</code></td>
<td>
<p><code>string</code>. Variable to group brackets by.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>remove.bracket</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code> all brackets are
removed and p-value is shown as text only.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coord.flip</code></td>
<td>
<p><code>logical</code>. If <code>TRUE</code> p-values are rotated by
90 degrees. Should be used with <code>coord_flip</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>position</code></td>
<td>
<p><code>string</code> or call to position function such as
<code>position_dodge</code>. Typically used for adjusting x
position of p-values to be in line with dodged data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional aesthetics or arguments passed to
<code>layer</code>. See below for allowed values.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>Returns a <em>layer</em> ggproto object with either <code>geom = GeomBracket</code> or
<code>geom = GeomText</code>.
</p>


<h3>Allowed ... values</h3>

<p><code>add_pvalue</code> understands the following additional aesthetics or arguments:
</p>

<dl>
<dt><code>fontface</code></dt>
<dd>
<p><code>string</code>. Fontface of text (e.g. <code>"bold"</code>).</p>
</dd>
<dt><code>fontfamily</code></dt>
<dd>
<p><code>string</code>. Fontfamily of text (e.g. <code>"Arial"</code>).</p>
</dd>
<dt><code>hjust</code></dt>
<dd>
<p><code>numeric</code>. Horizontal justification of text.</p>
</dd>
<dt><code>vjust</code></dt>
<dd>
<p><code>numeric</code>. Vertical justification of text.</p>
</dd>
<dt><code>alpha</code></dt>
<dd>
<p><code>numeric</code>. Transparency of text and/or brackets.</p>
</dd>
<dt><code>linetype</code></dt>
<dd>
<p><code>string</code> or <code>numeric</code>. Linetype of brackets
(e.g. <code>"dashed"</code>).</p>
</dd>
<dt><code>lineend</code></dt>
<dd>
<p><code>string</code>. Lineend of brackets (e.g. <code>"butt"</code>).</p>
</dd>
<dt><code>na.rm</code></dt>
<dd>
<p><code>logical</code>. If <code>FALSE</code> (default), removes
missing values with a warning. If <code>TRUE</code> silently removes missing
values.</p>
</dd>
<dt><code>show.legend</code></dt>
<dd>
<p><code>logical</code>. Should this layer be included in
the legends? If <code>NA</code> (default), include if any aesthetics are mapped.
If <code>FALSE</code>, never include or if <code>TRUE</code>, always include. It can
also be a named <code>logical</code> vector to finely select the aesthetics to
display.</p>
</dd>
<dt><code>inherit.aes</code></dt>
<dd>
<p><code>logical</code>. If <code>FALSE</code>, overrides the
default aesthetics, rather than combining with them.</p>
</dd>
</dl>
<h3>Examples</h3>

<pre><code class="language-R">library(ggplot2)

## we will use the ToothGrowth dataset for all examples
tg &lt;- ToothGrowth
tg$dose &lt;- as.factor(tg$dose)
tg$group &lt;- factor(rep(c("grp1", "grp2"), 30))

## p-value bracket comparing two means
# p-value table (its best to use these column names)
two.means &lt;- tibble::tribble(
  ~group1, ~group2, ~p,     ~y.position,
  "OJ",    "VC",    0.0606, 36
)

# boxplot (or another geom...)
ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  add_pvalue(two.means)

# if your table has special column names you will need to specify them
two.means &lt;- tibble::tribble(
  ~apple, ~banana, ~my.pval, ~some.y.position,
  "OJ",    "VC",    0.0606,  36
)

ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  add_pvalue(
    two.means,
    xmin = "apple",
    xmax = "banana",
    label = "my.pval",
    y.position = "some.y.position"
  )

## you can make the label a glue expression
two.means &lt;- tibble::tribble(
  ~group1, ~group2, ~p,     ~y.position,
  "OJ",    "VC",    0.0606, 36
)

ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  add_pvalue(two.means, label = "p = {p}")

## you can change aesthetics of the bracket and label
ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  add_pvalue(
    two.means,
    label = "p = {p}",
    colour = "red", # label
    label.size = 6, # label
    fontface = "bold", # label
    fontfamily = "serif", # label
    angle = 45, # label
    bracket.colour = "blue", # bracket
    bracket.size = 1, # bracket
    linetype = "dashed", # bracket
    lineend = "round" # bracket
  )

## you can change the tip length of the bracket
# make them longer
ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  add_pvalue(two.means, tip.length = 0.1)

# make them disappear
ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  add_pvalue(two.means, tip.length = 0)

# make one side longer than the other
ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  add_pvalue(two.means, tip.length = c(0.1, 0))

## p-value brackets with comparisons to a reference sample
each.vs.ref &lt;- tibble::tribble(
  ~group1, ~group2, ~p.adj,   ~y.position,
  "0.5",   "1",     8.80e-14, 35,
  "0.5",   "2",     1.27e-7,  38
)

ggplot(tg, aes(x = dose, y = len)) +
  geom_boxplot(aes(fill = dose)) +
  add_pvalue(each.vs.ref)

## p-value brackets with pairwise comparisons
pairwise &lt;- tibble::tribble(
  ~group1, ~group2,  ~p.signif, ~y.position,
  "0.5",   "1",      "****",    38,
  "0.5",   "2",      "****",    36,
  "1",     "2",      "****",    38
)

# you can shorten the length of brackets that are close together
ggplot(tg, aes(x = dose, y = len)) +
  geom_boxplot(aes(fill = dose)) +
  add_pvalue(
    pairwise,
    bracket.shorten = c(0.05, 0, 0.05)
  )

# you can nudge brackets that are not quite in the correct y position
# instead of changing the p-value table
ggplot(tg, aes(x = dose, y = len)) +
  geom_boxplot(aes(fill = dose)) +
  add_pvalue(
    pairwise,
    bracket.shorten = c(0.05, 0, 0.05),
    bracket.nudge.y = c(0.5, 0, 0.5)
  )

## p-value brackets with pairwise comparisons of grouped data
pairwise.grouped &lt;- tibble::tribble(
  ~group1, ~group2, ~p.adj,  ~y.position, ~supp,
  "0.5",   "1",     2.63e-4, 33.5,        "OJ",
  "0.5",   "2",     3.96e-6, 37.6,        "OJ",
  "1",     "2",     1.18e-1, 41.6,        "OJ",
  "0.5",   "1",     2.04e-6, 36.5,        "VC",
  "0.5",   "2",     1.40e-7, 40.6,        "VC",
  "1",     "2",     2.75e-4, 44.6,        "VC"
)

# use step.increase to change the spacing between different brackets in the
# groups specified by step.group.by
ggplot(tg, aes(x = dose, y = len)) +
  geom_boxplot(aes(fill = supp)) +
  add_pvalue(
    pairwise.grouped,
    colour = "supp",
    tip.length = 0,
    step.group.by = "supp",
    step.increase = 0.03
  )

## p-value (brackets) with single facet variable
two.means.grouped1 &lt;- tibble::tribble(
  ~group1, ~group2, ~p.adj,  ~y.position, ~dose,
  "OJ",    "VC",    0.0127,  24,          "0.5",
  "OJ",    "VC",    0.00312, 30,          "1",
  "OJ",    "VC",    0.964,   36.5,        "2"
)

ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  facet_wrap(~ dose, scales = "free") +
  add_pvalue(two.means.grouped1) # table must have dose column

## p-value (brackets) with single facet variable and multiple brackets per facet
pairwise.grouped &lt;- tibble::tribble(
  ~group1, ~group2, ~p.adj,  ~y.position, ~supp,
  "0.5",   "1",     2.63e-4, 33.5,        "OJ",
  "0.5",   "2",     3.96e-6, 37.6,        "OJ",
  "1",     "2",     1.18e-1, 41.6,        "OJ",
  "0.5",   "1",     2.04e-6, 36.5,        "VC",
  "0.5",   "2",     1.40e-7, 40.6,        "VC",
  "1",     "2",     2.75e-4, 44.6,        "VC"
)

ggplot(tg, aes(x = dose, y = len)) +
  geom_boxplot(aes(fill = supp)) +
  facet_wrap(~ supp) +
  add_pvalue(pairwise.grouped)

## p-value (brackets) with two facet variables
two.means.grouped2 &lt;- tibble::tribble(
  ~group1, ~group2, ~p.signif, ~y.position, ~group, ~dose,
  "OJ",    "VC",    "*",       21,          "grp1", "0.5",
  "OJ",    "VC",    "**",      30,          "grp2", "1"
)

ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  facet_wrap(group ~ dose) +
  add_pvalue(two.means.grouped2) # table must have dose and group column

## p-value (text only) comparing two means
two.means &lt;- tibble::tribble(
  ~group1, ~group2, ~p,     ~y.position,
  "OJ",    "VC",    0.0606, 36
)

ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  add_pvalue(two.means, remove.bracket = TRUE, x = 1.5)

## p-value (text only) with coord_flip, override y.position, change angle
ggplot(tg, aes(x = supp, y = len)) +
  geom_boxplot() +
  add_pvalue(
    two.means,
    remove.bracket = TRUE,
    x = 1.5,
    y.position = 32,
    angle = 45
  ) +
  coord_flip()

## p-value (text only) comparing to the null
one.mean &lt;- tibble::tribble(
  ~group1, ~group2,      ~p.signif, ~y.position, ~dose,
  "1",     "null model", "****",    35,          "0.5",
  "1",     "null model", "****",    35,          "1",
  "1",     "null model", "****",    35,          "2"
)

ggplot(tg, aes(x = dose, y = len)) +
  geom_boxplot(aes(fill = dose)) +
  add_pvalue(one.mean, x = "dose")

## p-value (text only) with comparisons to a base mean
each.vs.basemean &lt;- tibble::tribble(
  ~group1, ~group2, ~p.adj, ~y.position,
  "all",   "0.5",   "****", 35,
  "all",   "1",     "ns",   35,
  "all",   "2",     "****", 35
)

ggplot(tg, aes(x = dose, y = len)) +
  geom_boxplot(aes(fill = dose)) +
  add_pvalue(each.vs.basemean)

## p-value (text only) with comparison to reference sample
each.vs.ref &lt;- tibble::tribble(
  ~group1, ~group2, ~p.adj,   ~y.position,
  "0.5",   "1",     8.80e-14, 35,
  "0.5",   "2",     1.27e-7,  38
)

ggplot(tg, aes(x = dose, y = len)) +
  geom_boxplot(aes(fill = dose)) +
  add_pvalue(each.vs.ref, coord.flip = TRUE, remove.bracket = TRUE)

## p-value (text only) with a grouping variable
two.means.grouped1 &lt;- tibble::tribble(
  ~group1, ~group2, ~p.adj,  ~y.position, ~dose,
  "OJ",    "VC",    0.0127,  24,          "0.5",
  "OJ",    "VC",    0.00312, 30,          "1",
  "OJ",    "VC",    0.964,   36.5,        "2"
)

ggplot(tg, aes(x = dose, y = len)) +
  geom_boxplot(aes(fill = supp)) +
  add_pvalue(two.means.grouped1, x = "dose")
</code></pre>


</div>