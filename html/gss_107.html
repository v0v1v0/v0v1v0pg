<div class="container">

<table style="width: 100%;"><tr>
<td>mkran</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Generating Random Effects in Mixed-Effect Models
</h2>

<h3>Description</h3>

<p>Generate entries representing random effects in mixed-effect models.
</p>


<h3>Usage</h3>

<pre><code class="language-R">mkran(formula, data)
mkran1(ran1, ran2)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Symbolic description of the random effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data frame containing the variables in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ran1</code></td>
<td>
<p>Random effects in the form of the value of <code>mkran</code></p>
</td>
</tr>
</table>
<p>.
</p>
<table><tr style="vertical-align: top;">
<td><code>ran2</code></td>
<td>
<p>Random effects in the form of the value of <code>mkran</code></p>
</td>
</tr></table>
<p>.
</p>


<h3>Details</h3>

<p><code>mkran</code> generates random effect terms from simple grouping
variables, for use in nonparametric mixed-effect models as described
in Gu and Ma (2005a, b).  The syntax of the formula resembles that
of similar utilities for linear and nonlinear mixed-effect models,
as described in Pinheiro and Bates (2000).
</p>
<p>Currently, <code>mkran</code> takes only two kinds of basic formulas,
<code>~1|grp2</code> or <code>~grp1|grp2</code>.  Both <code>grp1</code> and
<code>grp2</code> should be factors, and for the second formula, the
levels of <code>grp2</code> should be nested under those of <code>grp1</code>.
</p>
<p>The Z matrix is determined by <code>grp2</code>.  When observations are
ordered according to the levels of <code>grp2</code>, the Z matrix is
block diagonal of 1 vectors.
</p>
<p>The Sigma matrix is diagonal.  For <code>~1|grp2</code>, it has one tuning
parameter.  For <code>~grp1|grp2</code>, the number of parameters equals
the number of levels of <code>grp1</code>, with each parameter shared by
the <code>grp2</code> levels nested under the same <code>grp1</code> level.
</p>
<p><code>mkran1</code> adds together two independent random effects, and can
be used recursively to add more than two terms.  The arguments are
of the form of the value of <code>mkran</code> or <code>mkran1</code>, which may
or may not be created by <code>mkran</code> or <code>mkran1</code>.
</p>
<p>Multiple terms of random effects can also be specified via the likes
of <code>mkran(~1|grp1+1|grp2,data)</code>, which is equivalent to
<code>mkran1(mkran(~1|grp1,data),mkran(~1|grp2,data))</code>.
</p>


<h3>Value</h3>

<p>A list of three elements.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>Z matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>Sigma matrix to be evaluated through
<code>sigma$fun(para,sigma$env)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init</code></td>
<td>
<p>Initial parameter values.</p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>One may pass a formula or a list to the argument <code>random</code> in
calls to <code>ssanova</code> or<code>gssanova</code> to fit
nonparametric mixed-effect models.  A formula will be converted to a
list using <code>mkran</code>.  A list should be of the same form as the
value of <code>mkran</code>.
</p>


<h3>References</h3>

<p>Gu, C. and Ma, P. (2005), Optimal smoothing in nonparametric
mixed-effect models.  <em>The Annals of Statistics</em>, <b>33</b>,
1357–1379.
</p>
<p>Gu, C. and Ma, P. (2005), Generalized nonparametric mixed-effect
models: computation and smoothing parameter selection.
<em>Journal of Computational and Graphical Statistics</em>, <b>14</b>,
485–504.
</p>
<p>Pinheiro and Bates (2000), <em>Mixed-Effects Models in S and
S-PLUS</em>.  New York: Springer-Verlag.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Toy data
test &lt;- data.frame(grp=as.factor(rep(1:2,c(2,3))))
## First formula
ran.test &lt;- mkran(~1|grp,test)
ran.test$z
ran.test$sigma$fun(2,ran.test$sigma$env) # diag(10^(-2),2)
## Second formula
ran.test &lt;- mkran(~grp|grp,test)
ran.test$z
ran.test$sigma$fun(c(1,2),ran.test$sigma$env) # diag(10^(-1),10^(-2))
## Clean up
## Not run: rm(test,ran.test)
</code></pre>


</div>