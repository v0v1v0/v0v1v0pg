<div class="container">

<table style="width: 100%;"><tr>
<td>seq_paf</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculation of sequential PAF taking into account risk factor sequencing</h2>

<h3>Description</h3>

<p>Calculation of sequential PAF taking into account risk factor sequencing
</p>


<h3>Usage</h3>

<pre><code class="language-R">seq_paf(
  data,
  model_list,
  parent_list,
  node_vec,
  prev = NULL,
  riskfactor_vec = NULL,
  ci = FALSE,
  boot_rep = 50,
  ci_type = c("norm"),
  ci_level = 0.95,
  nsim = 1,
  weight_vec = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data frame. A dataframe containing variables used for fitting the models.  Must contain all variables used in fitting</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_list</code></td>
<td>
<p>List.  A list of fitted model objects corresponding for the outcome variables in node_vec, with parents as described in parent_vec. Linear (lm), logistic (glm) and ordinal (polr) objects are allowed. This list must be in the same order as node_vec and parent_list.  Non-linear effects should be specified via ns(x, df=y), where ns is the natural spline function from the splines library.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parent_list</code></td>
<td>
<p>A list.  The ith element is the vector of variable names that are direct causes of ith variable in node_vec</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>node_vec</code></td>
<td>
<p>A vector corresponding to the nodes in the Bayesian network.  This must be specified from root to leaves - that is ancestors in the causal graph for a particular node are positioned before their descendants.  If this condition is false the function will return an error.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prev</code></td>
<td>
<p>prevalence of the disease (default is NULL)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>riskfactor_vec</code></td>
<td>
<p>A character vector of riskfactors.  Sequential PAF is calculated for the risk factor specified in the last position of the vector, conditional on the other risk factors</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci</code></td>
<td>
<p>Logical. If TRUE, a bootstrap confidence interval is computed along with a point estimate (default FALSE).  If ci=FALSE, only a point estimate is produced.  A simulation procedure (sampling permutations and also simulating the effects of eliminating risk factors over the descendant nodes in a Bayesian network) is required to produce the point estimates.  The point estimate will change on repeated runs of the function.  The margin of error of the point estimate is given when ci=FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot_rep</code></td>
<td>
<p>Integer.  Number of bootstrap replications (Only necessary to specify if ci=TRUE).  Note that at least 50 replicates are recommended to achieve stable estimates of standard error.  In the examples below, values of boot_rep less than 50 are sometimes used to limit run time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci_type</code></td>
<td>
<p>Character.  Default norm.  A vector specifying the types of confidence interval desired.  "norm", "basic", "perc" and "bca" are the available methods</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci_level</code></td>
<td>
<p>Numeric.  Confidence level.  Default 0.95</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>
<p>Numeric.  Number of independent simulations of the dataset.  Default of 1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weight_vec</code></td>
<td>
<p>An optional vector of inverse sampling weights (note with survey data, the variance may not be calculated correctly if sampling isn't independent).  Note that this vector will be ignored if prev is specified, and the weights will be calibrated so that the weighted sample prevalence of disease equals prev.  This argument can be ignored if data has a column weights with correctly calibrated weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>A logical indicator for whether extended output is produced when ci=TRUE, default TRUE</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A numeric estimate of sequential PAF (if ci=FALSE), or else a saf object, giving estimates and confidence limits of sequential PAF (if ci=TRUE)
</p>


<h3>References</h3>

<p>Ferguson, J., O’Connell, M. and O’Donnell, M., 2020. Revisiting sequential attributable fractions. Archives of Public Health, 78(1), pp.1-9.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(splines)
library(survival)
library(parallel)
options(boot.parallel="snow")
options(boot.ncpus=2)
# The above could be set to the number of available cores on the machine

# Simulated data on occupational and environmental exposure to
# chronic cough from Eide, 1995
# First specify the causal graph, in terms of the parents of each node.
# Then put into a list.
parent_urban.rural &lt;- c()
parent_smoking.category &lt;- c("urban.rural")
parent_occupational.exposure &lt;- c("urban.rural")
parent_y &lt;- c("urban.rural","smoking.category","occupational.exposure")
parent_list &lt;- list(parent_urban.rural, parent_smoking.category,
 parent_occupational.exposure, parent_y)
# also specify nodes of graph, in order from root to leaves
node_vec &lt;- c("urban.rural","smoking.category","occupational.exposure", "y")
# specify a model list according to parent_list
# here we use the auxillary function 'automatic fit'
model_list=automatic_fit(data=Hordaland_data, parent_list=parent_list,
node_vec=node_vec, prev=.09)
# sequential PAF for occupational exposure conditional on elimination of urban.rural
# Including weight column in data
# necessary if Bootstrapping CIs
seq_paf(data=model_list[[length(model_list)]]$data,
model_list=model_list, parent_list=parent_list,
 node_vec=node_vec, prev=.09, riskfactor_vec = c("urban.rural",
 "occupational.exposure"),ci=FALSE)

# More complicated example (slower to run)
parent_exercise &lt;- c("education")
parent_diet &lt;- c("education")
parent_smoking &lt;- c("education")
parent_alcohol &lt;- c("education")
parent_stress &lt;- c("education")
parent_high_blood_pressure &lt;- c("education","exercise","diet","smoking","alcohol",
"stress")
parent_lipids &lt;- c("education","exercise","diet","smoking","alcohol","stress")
parent_waist_hip_ratio &lt;- c("education","exercise","diet","smoking",
"alcohol","stress")
parent_early_stage_heart_disease &lt;- c("education","exercise","diet",
"smoking","alcohol","stress","lipids","waist_hip_ratio","high_blood_pressure")
parent_diabetes &lt;- c("education","exercise","diet","smoking","alcohol",
"stress","lipids","waist_hip_ratio","high_blood_pressure")
parent_case &lt;- c("education","exercise","diet","smoking","alcohol",
"stress","lipids","waist_hip_ratio","high_blood_pressure",
"early_stage_heart_disease","diabetes")
parent_list &lt;- list(parent_exercise,parent_diet,parent_smoking,parent_alcohol,
parent_stress,parent_high_blood_pressure,parent_lipids,parent_waist_hip_ratio,
parent_early_stage_heart_disease,parent_diabetes,parent_case)
node_vec=c("exercise","diet","smoking","alcohol","stress","high_blood_pressure",
"lipids","waist_hip_ratio","early_stage_heart_disease","diabetes","case")
model_list=automatic_fit(data=stroke_reduced, parent_list=parent_list,
node_vec=node_vec, prev=.0035,common="region*ns(age,df=5)+sex*ns(age,df=5)",
 spline_nodes = c("waist_hip_ratio","lipids","diet"))
# calculate sequential PAF for stress, conditional on smoking
# and blood pressure being eliminated from the population
seqpaf &lt;- seq_paf(data=stroke_reduced, model_list=model_list, parent_list=
parent_list, node_vec=node_vec, prev=.0035, riskfactor_vec = c("high_blood_pressure",
"smoking","stress"),ci=TRUE,boot_rep=10)

</code></pre>


</div>