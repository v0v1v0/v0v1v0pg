<div class="container">

<table style="width: 100%;"><tr>
<td>pkm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit pk searcher efficiency models.</h2>

<h3>Description</h3>

<p>Searcher efficiency is modeled as a function of the number of
times a carcass has been missed in previous searches and any number of
covariates. Format and usage parallel that of common <code>R</code> functions
<code>lm</code>, <code>glm</code>, and <code>gam</code>. However, the input data
(<code>data</code>) is structured differently to accommodate the
multiple-search searcher efficiency trials (see Details), and model
formulas may be entered for both <code>p</code> (akin to an intercept) and
<code>k</code> (akin to a slope).
</p>


<h3>Usage</h3>

<pre><code class="language-R">pkm(
  formula_p,
  formula_k = NULL,
  data,
  obsCol = NULL,
  kFixed = NULL,
  allCombos = FALSE,
  sizeCol = NULL,
  CL = 0.9,
  kInit = 0.7,
  quiet = FALSE,
  ...
)

pkm0(
  formula_p,
  formula_k = NULL,
  data,
  obsCol = NULL,
  kFixed = NULL,
  kInit = 0.7,
  CL = 0.9,
  quiet = FALSE
)

pkmSet(
  formula_p,
  formula_k = NULL,
  data,
  obsCol = NULL,
  kFixed = NULL,
  kInit = 0.7,
  CL = 0.9,
  quiet = FALSE
)

pkmSize(
  formula_p,
  formula_k = NULL,
  data,
  kFixed = NULL,
  obsCol = NULL,
  sizeCol = NULL,
  allCombos = FALSE,
  kInit = 0.7,
  CL = 0.9,
  quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula_p</code></td>
<td>
<p>Formula for p; an object of class <code>formula</code>
(or one that can be coerced to that class): a symbolic description of
the model to be fitted. Details of model specification are given under
"Details".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula_k</code></td>
<td>
<p>Formula for k; an object of class <code>formula</code>
(or one that can be coerced to that class): a symbolic description of the
model to be fitted. Details of model specification are given under
"Details".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data frame with results from searcher efficiency trials and any
covariates included in <code>formula_p</code> or <code>formula_k</code> (required).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>obsCol</code></td>
<td>
<p>Vector of names of columns in <code>data</code> where results
for each search occasion are stored (optional). If <code>obsCol</code> is not
provided, <code>pkm</code> uses as <code>obsCol</code> all columns with names that
begin with an <code>"s"</code> or <code>"S"</code> and end with a number, e.g., "s1",
"s2", "s3", etc. This option is included as a convenience for the user,
but care must be taken that other data are not stored in columns with
names matching that pattern. Alternatively, <code>obsCol</code> may be
entered as a vector of names, like <code>c("s1", "s2", "s3")</code>,
<code>paste0("s", 1:3)</code>, or <code>c("initialSearch", "anotherSearch",
"lastSearch")</code>. The columns must be in chronological order, that is, it is
assumed that the first column is for the first search after carcass arrival,
the second column is for the second search, etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kFixed</code></td>
<td>
<p>Parameter for user-specified <code>k</code> value (optional). If a
value is provided, <code>formula_k</code> is ignored and the model is fit under
the assumption that the <code>k</code> parameter is fixed and known to be
<code>kFixed</code> <code class="reqn">\in [0, 1]</code>. If a <code>sizeCol</code> is provided, <code>kFixed</code>
may either be <code>NULL</code>, a single number in [0, 1], or a vector with
<code>kFixed</code> values for two or more of the carcass size classes. For
example, if there are three sizes (<code>S</code>, <code>M</code>, and <code>L</code>),
<code>kFixed</code> could be <code>c(S = 0.3, M = 0.8, L = 1.0)</code> to assign fixed
<code>k</code> values to each size. To fit <code>k</code> for size <code>S</code> and to assign
values of 0.8 and 1.0 to sizes <code>M</code> and <code>L</code>, resp., use
<code>kFixed = c(S = 0.3, M = 0.8, L = 1.0)</code>. If there are more than one size
classes and <code>kFixed</code> is a scalar, then all size classes are assigned the
same <code>kFixed</code> value (unless <code>kFixed</code> is named, e.g.,
<code>kFixed = c(S = 0.5)</code>, in which case only the named size is assigned the
<code>kFixed</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>allCombos</code></td>
<td>
<p>logical. If <code>allCombos = FALSE</code>, then the single model
expressed by <code>formula_p</code> and <code>formula_k</code> is fit using a call to
<code>pkm0</code>. If <code>allCombos = TRUE</code>, a full set of <code>pkm</code>
submodels derived from combinations of the given covariates for <code>p</code>
and <code>k</code> is fit. For example, submodels of <code>formula_p = p ~ A * B</code>
would be <code>p ~ A * B</code>, <code>p ~ A + B</code>, <code>p ~ A</code>, <code>p ~ B</code>,
and <code>p ~ 1</code>. Models for each pairing of a <code>p</code> submodel with a
<code>k</code> submodel are fit via <code>pkmSet</code>, which fits each model
combination using successive calls to <code>pkm0</code>, which fits a
single model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sizeCol</code></td>
<td>
<p>character string. The name of the column in <code>data</code> that
gives the carcass class of the carcasses in the field trials. If
<code>sizeCol = NULL</code>, then models are not segregated by size. If a
<code>sizeCol</code> is provided, then separate models are fit for the <code>data</code>
subsetted by <code>sizeCol</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>CL</code></td>
<td>
<p>numeric value in (0, 1). confidence level</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kInit</code></td>
<td>
<p>numeric value in (0, 1). Initial value used for numerical
optimization of <code>k</code>. Default is <code>kInit = 0.7</code>. It is rarely
(if ever) necessary to use an alternative initial value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>Logical indicator of whether or not to print messsages</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments passed to subfunctions</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The probability of finding a carcass that is present at the time of
search is <code>p</code> on the first search after carcass arrival and is
assumed to decrease by a factor of <code>k</code> each time the carcass is
missed in searches. Both <code>p</code> and <code>k</code> may depend on covariates
such as ground cover, season, species, etc., and a separate model format
(<code>formula_p</code> and <code>formula_k</code>) may be entered for each. The
models are entered as they would be in the familiar <code>lm</code> or
<code>glm</code> functions in R. For example, <code>p</code> might vary with
<code>A</code> and <code>B</code>, while <code>k</code> varies
only with <code>A</code>. A user might then enter <code>p ~ A + B</code>
for <code>formula_p</code> and <code>k ~ A</code> for
<code>formula_k</code>. Other R conventions for defining formulas may also be
used, with <code>A:B</code> for the interaction between covariates
A and B and <code>A * B</code> as short-hand for <code>A + B + A:B</code>.
</p>
<p>Search trial <code>data</code> must be entered in a data frame with data in
each row giving the fate of a single carcass in the field trials. There
must be a column for each search occassion, with 0, 1, or NA depending on
whether the carcass was missed, found, or not available (typically
because it was found and removed on a previous search, had been earlier
removed by  scavengers, or was not searched for) on the given search
occasion. Additional columns with values for categorical covariates
(e.g., visibility = E, M, or D) may also be included.
</p>
<p>When all trial carcasses are either found on the first search or
are missed on the first search after carcass placement, pkm effects a
necessary adjustment to the for accuracy; otherwise, the model would not be
able to determine the uncertainty and would substantially over-estimate the
variance of the parameter estimates, giving <code class="reqn">\hat{p}</code> essentially equal
to 0 or 1 with approximately equal probability. The adjustment is to fit the
model on an adjusted data set with duplicated copies of the original data
(<code>2n</code> observations) but with one carcass having the opposite fate of the
others. For example, in field trials with very high searcher efficiency and
<code>n = 10</code> carcasses, all of which are found in the first search after
carcass placement, the original data set would have a carcass observation
column consisting of 1s (<code>rep(1, 10)</code>). The adjusted data set would
have an observation column consisting of <code>2n - 1</code> 1s and one 0. In this
case, the point estimate of <code>p</code> is <code>1/(2n)</code> with distribution that
closely resembling the Bayesian posterior distributions of <code>p</code> with a
uniform or a Jeffreys prior. The adjustment is applied on a cellwise basis
in full cell models (e.g., 1, A, B, A * B). In the additive model with two
predictors (A + B), the adjustment is made only when a full level of
covariate A or B is all 0s or 1s.
</p>


<h3>Value</h3>

<p>an object of an object of class <code>pkm</code>, <code>pkmSet</code>,
<code>pkmSize</code>, or <code>pkmSetSize</code>.
</p>

<dl>
<dt><code>pkm0()</code></dt>
<dd>
<p>returns a <code>pkm</code> object, which is a description
of a single, fitted pk model. Due to the large number and complexity of
components of a<code>pkm</code> model, only a subset of them is printed
automatically; the rest can be viewed/accessed via the <code>$</code> operator
if desired. These are described in detail in the '<code>pkm</code> Components'
section.</p>
</dd>
<dt><code>pkmSet()</code></dt>
<dd>
<p>returns a list of <code>pkm</code> objects, one for each
of the submodels, as described with parameter <code>allCombos = TRUE</code>.</p>
</dd>
<dt><code>pkmSize()</code></dt>
<dd>
<p>returns a list of <code>pkmSet</code> objects (one for
each 'size') if <code>allCombos = T</code>, or a list of <code>pkm</code> objects (one
for each 'size') if <code>allCombos = T</code></p>
</dd>
<dt><code>pkm</code></dt>
<dd>
<p>returns a <code>pkm</code>, <code>pkmSet</code>, <code>pkmSize</code>, or
<code>pkmSetSize</code> object:
</p>

<ul>
<li> <p><code>pkm</code> object if <code>allCombos = FALSE, sizeCol = NULL</code>
</p>
</li>
<li> <p><code>pkmSet</code> object if <code>allCombos = TRUE, sizeCol = NULL</code>
</p>
</li>
<li> <p><code>pkmSize</code> object if <code>allCombos = FALSE, sizeCol != NULL</code>
</p>
</li>
<li> <p><code>pkmSetSize</code> object if <code>allCombos = TRUE, sizeCol != NULL</code>
</p>
</li>
</ul>
</dd>
</dl>
<h3>
<code>pkm</code> Components</h3>

<p>The following components of a <code>pkm</code> object are displayed automatically:
</p>

<dl>
<dt><code>call</code></dt>
<dd>
<p>the function call to fit the model</p>
</dd>
<dt><code>formula_p</code></dt>
<dd>
<p>the model formula for the <code>p</code> parameter</p>
</dd>
<dt><code>formula_k</code></dt>
<dd>
<p>the model formula for the <code>k</code> parameter</p>
</dd>
<dt><code>predictors</code></dt>
<dd>
<p>list of covariates of <code>p</code> and/or <code>k</code></p>
</dd>
<dt><code>AICc</code></dt>
<dd>
<p>the AIC value as corrected for small sample size</p>
</dd>
<dt><code>convergence</code></dt>
<dd>
<p>convergence status of the numerical optimization
to find the maximum likelihood estimates of <code>p</code> and <code>k</code>. A
value of <code>0</code> indicates that the model was fit successfully. For
help in deciphering other values, see <code>optim</code>.</p>
</dd>
<dt><code>cell_pk</code></dt>
<dd>
<p>summary statistics for estimated cellwise estimates
of <code>p</code> and <code>k</code>, including the number of carcasses in each cell,
medians and upper &amp; lower bounds on CIs for each parameter, indexed by
cell (or combination of covariate levels).</p>
</dd>
</dl>
<p>The following components are not printed automatically but can be accessed
via the <code>$</code> operator:
</p>

<dl>
<dt><code>data</code></dt>
<dd>
<p>the data used to fit the model</p>
</dd>
<dt><code>data0</code></dt>
<dd>
<p><code>$data</code> with NA rows removed</p>
</dd>
<dt><code>betahat_p, betahat_k</code></dt>
<dd>
<p>parameter estimates for the terms in the
regression model for for <code>p</code> and <code>k</code> (logit scale). If <code>k</code>
is fixed or not provided, then <code>betahat_k</code> is not calculated.</p>
</dd>
<dt><code>varbeta</code></dt>
<dd>
<p>the variance-covariance matrix of the estimators
for <code>c(betahat_p, betahat_k)</code>.</p>
</dd>
<dt><code>cellMM_p, cellMM_k</code></dt>
<dd>
<p>cellwise model (design) matrices for
covariate structures of <code>p_formula</code> and <code>k_formula</code></p>
</dd>
<dt><code>levels_p, levels_k</code></dt>
<dd>
<p>all levels of each covariate of <code>p</code>
and <code>k</code></p>
</dd>
<dt><code>nbeta_p, nbeta_k</code></dt>
<dd>
<p>number of parameters to fit the <code>p</code>
and <code>k</code> models</p>
</dd>
<dt><code>cells</code></dt>
<dd>
<p>cell structure of the pk-model, i.e., combinations of
all levels for each covariate of <code>p</code> and <code>k</code>. For example, if
<code>covar1</code> has levels <code>"a"</code>, <code>"b"</code>, and <code>"c"</code>, and
<code>covar2</code> has levels <code>"X"</code> and <code>"Y"</code>, then the cells
would consist of <code>a.X</code>, <code>a.Y</code>, <code>b.X</code>, <code>b.Y</code>,
<code>c.X</code>, and <code>c.Y</code>.</p>
</dd>
<dt><code>ncell</code></dt>
<dd>
<p>total number of cells</p>
</dd>
<dt><code>predictors_k, predictors_p</code></dt>
<dd>
<p>covariates of <code>p</code> and <code>k</code></p>
</dd>
<dt><code>observations</code></dt>
<dd>
<p>observations used to fit the model</p>
</dd>
<dt><code>kFixed</code></dt>
<dd>
<p>the input <code>kFixed</code></p>
</dd>
<dt><code>AIC</code></dt>
<dd>
<p>the
<a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">AIC</a>
value for the fitted model</p>
</dd>
<dt><code>carcCells</code></dt>
<dd>
<p>the cell to which each carcass belongs</p>
</dd>
<dt><code>CL</code></dt>
<dd>
<p>the input <code>CL</code></p>
</dd>
<dt><code>loglik</code></dt>
<dd>
<p>the log-liklihood for the maximum likelihood estimate</p>
</dd>
<dt><code>pOnly</code></dt>
<dd>
<p>a logical value telling whether <code>k</code> is included in
the model. <code>pOnly = TRUE</code> if and only if <code>length(obsCol) == 1)</code>
and <code>kFixed = NULL</code></p>
</dd>
</dl>
<p>.
</p>
<dl>
<dt><code>data_adj</code></dt>
<dd>
<p><code>data0</code> as adjusted for the 2n fix to accommodate
scenarios in which all trial carcasses are either found or all are not
found on the first search occasion (uncommon)</p>
</dd>
<dt><code>fixBadCells</code></dt>
<dd>
<p>vector giving the names of cells adjusted for the
2n fix</p>
</dd>
</dl>
<h3>Advanced</h3>

<p><code>pkmSize</code> may also be used to fit a single model for each carcass class if
<code>allCombos = FALSE</code>. To do so, <code>formula_p</code> and <code>formula_k</code>
must be a named list of formulas with names matching the sizes listed in
<code>unique(data[, sizeCol])</code>. The return value is then a list of
<code>pkm</code> objects, one for each size.
</p>


<h3>See Also</h3>

<p><code>rpk</code>, <code>qpk</code>, <code>aicc</code>,
<code>plot.pkm</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"> head(data(wind_RP))
 mod1 &lt;- pkm(formula_p = p ~ Season, formula_k = k ~ 1, data = wind_RP$SE)
 class(mod1)
 mod2 &lt;- pkm(formula_p = p ~ Season, formula_k = k ~ 1, data = wind_RP$SE,
   allCombos = TRUE)
 class(mod2)
 names(mod2)
 class(mod2[[1]])
 mod3 &lt;- pkm(formula_p = p ~ Season, formula_k = k ~ 1, data = wind_RP$SE,
   allCombos = TRUE, sizeCol = "Size")
 class(mod3)
 names(mod3)
 class(mod3[[1]])
 class(mod3[[1]][[1]])

</code></pre>


</div>