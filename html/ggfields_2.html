<div class="container">

<table style="width: 100%;"><tr>
<td>angle_correction</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate correction for angle in the plot coordinate system</h2>

<h3>Description</h3>

<p>The angle of a vector may be distorted when your plot uses a different
coordinate system than the one for which the angle is specified. If <code>data</code>
is a simple feature object (sf), the angle will be corrected
for the displayed coordinate reference system (crs). When
the crs is missing, an aspect ratio of 1 is assumed. For any other data,
the angle is corrected for the aspect ratio in the plot.
</p>


<h3>Usage</h3>

<pre><code class="language-R">angle_correction(data, panel_params, coord)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>fortified data used in a <code>geom_fields()</code>. Should at least contain <code>numeric</code> columns <code>x</code>, <code>y</code> and
<code>angle</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>panel_params</code></td>
<td>
<p>panel parameters as returned by GeomFields$setup_params()</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coord</code></td>
<td>
<p>A coord object.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is used by default by <code>geom_fields()</code>. For more details on
why this correction is required and how to customize corrections please see
<code>vignette("angle_correction")</code>.
</p>


<h3>Value</h3>

<p>A <code>data.frame</code> with an additional <code>angle_correction</code> column. The corrected angle is given
by <code>angle_correction + angle</code>.
</p>


<h3>Author(s)</h3>

<p>Pepijn de Vries
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Create a data.frame with some xy-coordinates and all angles pointing North (0 degrees)
d &lt;-
  data.frame(
    x = seq(1, 2, 0.1),
    y = seq(50, 51, 0.1),
    angle = 0
  ) |&gt;
  sf::st_as_sf(coords = c("x", "y"), crs = 4326, remove = FALSE)

## Create a mockup of ggplot params. Normally this is handled automatically by ggplot2
params_mockup &lt;-
  c(
    ggplot2::ggplot() + geom_fields(),
    list(
      x_range = range(d$x),
      y_range = range(d$y),
      crs = sf::st_crs(4326),
      default_crs = 4326
    )
  )

## When plotting as lon-lat, the angle correction will be zero
angle_correction(d, params_mockup, ggplot2::coord_sf(default_crs = 4326))

## Transform to UTM zone 31N in meters
d2 &lt;- d |&gt; sf::st_transform(32631)

## Again get parameter mockup values
params_mockup2 &lt;-
  c(
    ggplot2::ggplot() + geom_fields(),
      list(
        x_range = range(sf::st_coordinates(d2)[,1]),
        y_range = range(sf::st_coordinates(d2)[,1]),
        crs = sf::st_crs(32631),
        default_crs = 4326
      )
    )
## in UTM projection in this area (which is slightly tilted) the correction is
## larger than zero
angle_correction(d2, params_mockup2,
                 ggplot2::coord_sf(crs = 32631, default_crs = 4326))
</code></pre>


</div>