<div class="container">

<table style="width: 100%;"><tr>
<td>cr_buildstep_r</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Run an R script in a Cloud Build R step</h2>

<h3>Description</h3>

<p>Helper to run R code within build steps, from either an existing local R file or within the source of the build.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cr_buildstep_r(
  r,
  name = "r-base",
  r_source = c("local", "runtime"),
  prefix = "rocker/",
  escape_dollar = TRUE,
  rscript_args = NULL,
  r_cmd = c("Rscript", "R"),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>R code to run or a file containing R code ending with .R, or the gs:// location on Cloud Storage of the R file you want to run</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>The docker image that will run the R code, usually from rocker-project.org</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_source</code></td>
<td>
<p>Whether the R code will be from a runtime file within the source or at build time copying over from a local R file in your session</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prefix</code></td>
<td>
<p>prefixed to name - set to "" to suppress.  Will be suppressed if <code>name</code> starts with gcr.io or <code>*-docker.pkg.dev</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>escape_dollar</code></td>
<td>
<p>Default TRUE.  This will turn <code>$</code> into <code>$$</code> within the script to avoid them being recognised as Cloud Build variables.  Turn this off if you want that behaviour (e.g. <code>my_project="$PROJECT_ID"</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rscript_args</code></td>
<td>
<p>Optional arguments for the R script run by <code>Rscript</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r_cmd</code></td>
<td>
<p>should 'Rscript' be run or 'R'?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments passed to cr_buildstep</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If <code>r_source="runtime"</code> then <code>r</code> should be the location of that file within the source or <code>image</code> that will be run by the R code from <code>image</code>
</p>
<p>If <code>r_source="local"</code> then it will copy over from a character string or local file into the build step directly.
</p>
<p>If the R code location starts with <code>gs://</code> then an extra buildstep will be added that will download the R script from that location then run it as per <code>r_source="runtime"</code>.  This will consequently override your setting of <code>r_source</code>
</p>


<h3>See Also</h3>

<p>Other Cloud Buildsteps: 
<code>cr_buildstep_bash()</code>,
<code>cr_buildstep_decrypt()</code>,
<code>cr_buildstep_df()</code>,
<code>cr_buildstep_docker()</code>,
<code>cr_buildstep_edit()</code>,
<code>cr_buildstep_extract()</code>,
<code>cr_buildstep_gcloud()</code>,
<code>cr_buildstep_gitsetup()</code>,
<code>cr_buildstep_mailgun()</code>,
<code>cr_buildstep_nginx_setup()</code>,
<code>cr_buildstep_packagetests()</code>,
<code>cr_buildstep_pkgdown()</code>,
<code>cr_buildstep_run()</code>,
<code>cr_buildstep_secret()</code>,
<code>cr_buildstep_slack()</code>,
<code>cr_buildstep_targets()</code>,
<code>cr_buildstep()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">cr_project_set("my-project")
cr_bucket_set("my-bucket")

# create an R buildstep inline
cr_buildstep_r(c("paste('1+1=', 1+1)", "sessionInfo()"))
## Not run: 

# create an R buildstep from a local file
cr_buildstep_r("my-r-file.R")

# create an R buildstep from a file within the source of the Build
cr_buildstep_r("inst/schedule/schedule.R", r_source = "runtime")

# create an R buildstep with Rscript arguments and use a large
# machine with 32 cores

## create storage source
storage_source &lt;- cr_build_upload_gcs(
  "my-r-script.R"
)
## create the buildstep with the R script
step1 &lt;- cr_buildstep_r("deploy/my-r-script.R",
  r_source = "runtime",
  rscript_args = c("args_1=&lt;args1&gt;", "args_2=&lt;args_2&gt;")
)

## run the script on Cloud Build
cr_build(
  cr_build_yaml(
    steps = step1
  ),
  source = storage_source,
  options = list(machineType = "E2_HIGHCPU_32")
)

## End(Not run)
# use a different Rocker image e.g. rocker/verse
cr_buildstep_r(c(
  "library(dplyr)",
  "mtcars %&gt;% select(mpg)",
  "sessionInfo()"
),
name = "verse"
)

# use your own R image with custom R
my_r &lt;- c("devtools::install()", "pkgdown::build_site()")
br &lt;- cr_buildstep_r(my_r, name = "gcr.io/gcer-public/packagetools:latest")
</code></pre>


</div>