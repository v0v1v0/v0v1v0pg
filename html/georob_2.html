<div class="container">

<table style="width: 100%;"><tr>
<td>georobModelBuilding</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>S3 Methods for Stepwise Building Fixed-Effects Models for Class <code>georob</code>
</h2>

<h3>Description</h3>

<p>This page documents the methods <code>deviance</code>,
<code>logLik</code>, <code>extractAIC</code>, <code>add1</code>, <code>drop1</code>,
<code>step</code> and <code>waldtest</code> for the class <code>georob</code>.  The package
<code>georob</code> provides a generic <code>step</code> function and a default
method which is identical with the (non-generic) function
<code>step</code>.</p>


<h3>Usage</h3>

<pre><code class="language-R">
## S3 method for class 'georob'
deviance(object, warn = TRUE, REML = FALSE, ...)

## S3 method for class 'georob'
logLik(object, warn = TRUE, REML = FALSE, ...)

## S3 method for class 'georob'
extractAIC(fit, scale = 0, k = 2, ...)

## S3 method for class 'georob'
add1(object, scope, scale = 0, test = c("none", "Chisq"), k = 2,
    trace = FALSE, fixed = TRUE, use.fitted.param = TRUE, verbose = 0,
    ncores = 1, ...)

## S3 method for class 'georob'
drop1(object, scope, scale = 0, test = c("none", "Chisq"), k = 2,
    trace = FALSE, fixed = TRUE, use.fitted.param = TRUE, verbose = 0,
    ncores = 1, ...)

step(object, ...)

## Default S3 method:
step(object, scope, scale = 0,
    direction = c("both", "backward", "forward"), trace = 1,
    keep = NULL, steps = 1000, k = 2, ...)

## S3 method for class 'georob'
step(object, scope, scale = 0,
    direction = c("both", "backward", "forward"), trace = 1,
    keep = NULL, steps = 1000, k = 2,
    fixed.add1.drop1 = TRUE, fixed.step = fixed.add1.drop1,
    use.fitted.param = TRUE, verbose = 0, ncores = 1, ...)

## S3 method for class 'georob'
waldtest(object, ..., vcov = NULL, test = c("F", "Chisq"),
    name = NULL)

</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object, fit</code></td>
<td>
<p>an object of class <code>georob</code>, see
<code>georobObject</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>direction</code></td>
<td>
<p>a character keyword with the mode of stepwise search,
see <code>step</code>.  </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed,fixed.add1.drop1</code></td>
<td>
<p>a logical scalar controlling whether the
variogram parameters are <em>not</em> adjusted when <code>add</code>ing or
<code>drop</code>ping model terms by <code>add1</code> and <code>drop1</code> (default
<code>TRUE</code>), see <em>Details</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.step</code></td>
<td>
<p>a logical scalar controlling whether the variogram
parameters are <em>not</em> adjusted after having called <code>add1</code> and
<code>drop1</code> in <code>step</code> (default <code>TRUE</code>), see <em>Details</em>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>a numeric specifying the 'weight' of the equivalent degrees of
freedom (=: edf) part in the AIC formula, see
<code>extractAIC</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep</code></td>
<td>
<p>a filter function whose input is a fitted model object and the
associated <code>AIC</code> statistic, and whose output is arbitrary,
see <code>step</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>name</code></td>
<td>
<p>a function for extracting a suitable name/description from a
fitted model object.  By default the name is queried by calling
<code>formula</code>, see
<code>waldtest</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>an integer specifying the number of cores used for
parallelized execution of <code>add1</code> and <code>drop1</code>.  If larger than
one then the minimum of <code>ncores</code>, <code>parallel::detectCores()</code>
and the number of terms to be added or dropped determines the number of
cores that is actually used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>REML</code></td>
<td>
<p>a logical scalar controlling whether the restricted log-likelihood
should be extracted (default <code>TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>a numeric, currently not used, see
<code>extractAIC</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scope</code></td>
<td>
<p>defines the range of models examined in the stepwise search.
This should be either a single formula, or a list containing
components <code>upper</code> and <code>lower</code>, both formulae,
see <code>step</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>steps</code></td>
<td>
<p>a numeric with the maximum number of steps to be considered
(default is 1000), see <code>step</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test</code></td>
<td>
<p>a character keyword specifying whether to compute the large
sample Chi-squared statistic (with asymptotic Chi-squared distribution)
or the finite sample F statistic (with approximate F distribution), see
<code>waldtest</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>a numeric.  If positive, information is printed during the
running of <code>step</code>, see <code>step</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.fitted.param</code></td>
<td>
<p>a logical scalar controlling whether fitted
values of <code>param</code> (and <code>aniso</code> are used as initial values
when variogram parameters are fitted afresh for <code>add</code>ing and
<code>drop</code>ping terms from the model (default <code>TRUE</code>).  If equal
to <code>FALSE</code> then the initial values in <code>object[["call"]]</code> are
used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vcov</code></td>
<td>
<p>a function for estimating the covariance matrix of the
regression coefficients, see <code>waldtest</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a positive integer controlling logging of diagnostic
messages to the console during model fitting, see <code>georob</code>
(default <code>0</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn</code></td>
<td>
<p>a logical scalar controlling whether warnings should be
suppressed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments passed to methods (see in particular
<code>waldtest.default</code>).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For a non-robust fit the  function <code>deviance</code> returns the residual deviance
</p>
<p style="text-align: center;"><code class="reqn">(\boldsymbol{Y} - \boldsymbol{X} \widehat{\boldsymbol{\beta}})^{\mathrm{T}}
    (\widehat{\tau}^2 \boldsymbol{I} +
    \boldsymbol{\Gamma}_{\widehat{\theta}})^{-1}
    (\boldsymbol{Y} - \boldsymbol{X} \widehat{\boldsymbol{\beta}})
    </code>
</p>

<p>(see <code>georobPackage</code> for an explanation of the notation).
For a robust fit the deviance is not defined. The function then computes with a warning
the deviance of an equivalent Gaussian model with heteroscedastic nugget
<code class="reqn">\tau^2/\boldsymbol{w}</code> where <code class="reqn">\boldsymbol{w}</code> are
the “robustness weights” <code>rweights</code>, see <code>georobObject</code>.
</p>
<p><code>logLik</code> returns the maximized (restricted) log-likelihood.  For
a robust fit, the log-likelihood is not defined.  The function then
computes the (restricted) log-likelihood of an equivalent Gaussian model with
heteroscedastic nugget (see above).
</p>
<p>The methods <code>extractAIC</code>, <code>add1</code>, <code>drop1</code> and <code>step</code>
are used for stepwise model building. <br> If <code>fixed=TRUE</code> or
<code>fixed.add1.drop1=TRUE</code> (default) then the variogram parameters are
kept fixed at the values of <code>object</code>.  For
<code>fixed=FALSE</code> or <code>fixed.add1.drop1=FALSE</code> the variogram
parameters are fitted afresh for each model tested by <code>add1</code> and
<code>drop1</code>.  Then either the variogram parameters in
<code>object$initial.objects</code> (<code>use.fitted.param=FALSE</code>) or the
fitted parameters of <code>object</code> (<code>use.fitted.param=TRUE</code>) are
used as initial values.  For <code>fixed.step=TRUE</code> the variogram
parameters are <em>not</em> fitted afresh by <code>step</code> after the calls to
<code>drop1</code> and <code>add1</code> have been completed, unlike for
<code>fixed.step=FALSE</code> where the parameters are estimated afresh for
the new model that minimized AIC (BIC) in the previous step.
</p>
<p>In addition, the functions of the <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> package <span class="pkg">multcomp</span> can be used
to test general linear hypotheses about the fixed effects of the model.
</p>


<h3>Value</h3>

<p>The method <code>deviance.georob</code> returns the deviance of the fitted
spatial linear model with the attributes <code>log.det.covmat</code>
containing the logarithm of the determinant of the covariance matrix
<code class="reqn">
    \tau^2 \boldsymbol{I} + \boldsymbol{\Gamma}_\theta
  </code>
of the observations and optionally
<code>log.det.xticovmatx</code> with the logarithm of the determinant of
<code class="reqn">
    \boldsymbol{X}^\mathrm{T} (\tau^2
    \boldsymbol{I} + \boldsymbol{\Gamma}_\theta)^{-1} \boldsymbol{X}
  </code>, when <code>REML = true</code>,
see <em>Details</em> above.
</p>
<p>The method <code>logLik.georob</code> returns an object of class <code>logLik</code>
with the maximized (restricted) log-likelihood, see <em>Details</em> above
and <code>logLik</code>.
</p>
<p>The method <code>extractAIC.georob</code> returns a numeric vector of length 2
with the first and second elements giving the equivalent degrees of
freedom and the (generalized) Akaike Information Criterion for the fitted
model <code>fit</code>.
</p>
<p>The methods <code>add1.georob</code> and <code>drop1.georob</code> return objects of
class <code>anova</code> which are <code>data.frame</code>s summarizing the
differences in fit between models.  In addition to the customary
variables <code>Df</code> and <code>AIC</code> the output contains a logical variable
<code>Converged</code> which signals (non-)convergence when fitting the
respective sub-model.
</p>
<p>The generic function <code>step</code> returns the stepwise selected model plus
optionally some additional attributes depending on the method.
</p>
<p>The methods <code>step.default</code> and <code>step.georob</code> return the
stepwise-selected model with up to two additional components
(<code>anova</code>, <code>keep</code>), see <code>step</code> for details.
</p>
<p>The method <code>waldtest.georob</code> returns an object of class <code>anova</code>
which contains the residual degrees of freedom, the difference in degrees
of freedom, Wald statistic (either "Chisq" or "F") and corresponding
<var>p</var>-value.
</p>


<h3>Author(s)</h3>

<p>Andreas Papritz <a href="mailto:papritz@retired.ethz.ch">papritz@retired.ethz.ch</a>.
</p>


<h3>See Also</h3>

<p><code>georobPackage</code> for a description of the model and a brief summary of the algorithms;
</p>
<p><code>georob</code> for (robust) fitting of spatial linear models;
</p>
<p><code>georobObject</code> for a description of the class <code>georob</code>;
</p>
<p><code>profilelogLik</code> for computing profiles of Gaussian likelihoods;
</p>
<p><code>plot.georob</code> for display of RE(ML) variogram estimates;
</p>
<p><code>control.georob</code> for controlling the behaviour of <code>georob</code>;
</p>

<p><code>cv.georob</code> for assessing the goodness of a fit by <code>georob</code>;
</p>
<p><code>georobMethods</code> for further methods for the class <code>georob</code>;
</p>
<p><code>predict.georob</code> for computing robust Kriging predictions;

</p>
<p><code>lgnpp</code> for unbiased back-transformation of Kriging prediction
of log-transformed data;
</p>
<p><code>georobSimulation</code> for simulating realizations of a Gaussian process
from model fitted by <code>georob</code>; and finally
</p>
<p><code>sample.variogram</code> and <code>fit.variogram.model</code>
for robust estimation and modelling of sample variograms.
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(meuse)

## Gaussian REML fit
r.logzn.reml &lt;- georob(log(zinc) ~ sqrt(dist), data = meuse, locations = ~ x + y,
    variogram.model = "RMexp",
    param = c(variance = 0.15, nugget = 0.05, scale = 200),
    tuning.psi = 1000)
summary(r.logzn.reml, correlation = TRUE)

deviance(r.logzn.reml)
logLik(r.logzn.reml)

waldtest(r.logzn.reml, .~. + ffreq)

step(r.logzn.reml, ~ sqrt(dist) + ffreq + soil)

## robust REML fit
if(interactive()){
  ## example is run only in interactive session because cpu times exceeds 5 s

  r.logzn.rob &lt;- update(r.logzn.reml, tuning.psi = 1)

  deviance(r.logzn.rob)
  logLik(r.logzn.rob)
  logLik(r.logzn.rob, REML=TRUE)

  step(r.logzn.rob, ~ sqrt(dist) + ffreq + soil, fixed.step=FALSE, trace=2)
}
</code></pre>


</div>