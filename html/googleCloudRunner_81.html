<div class="container">

<table style="width: 100%;"><tr>
<td>cr_plumber_pubsub</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plumber - Pub/Sub parser</h2>

<h3>Description</h3>

<p>A function to use in plumber scripts to accept Pub/Sub messages
</p>


<h3>Usage</h3>

<pre><code class="language-R">cr_plumber_pubsub(message = NULL, pass_f = function(x) x)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>message</code></td>
<td>
<p>The pubsub message</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pass_f</code></td>
<td>
<p>An R function that will work with the data parsed out of the pubsub <code>message$data</code> field.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is intended to be used within plumb API scripts.  It needs to be annotated with a <code>@post</code> URL route and a <code>@param message The pubsub message</code> as per the plumber documentation.
</p>
<p><code>pass_f</code> should be a function you create that accepts one argument, the data from the pubsub <code>message$data</code> field.  It is unencoded for you.  Make sure the function returns a 200 response otherwise pub/sub will keep resending the message!  <code>return(TRUE)</code> is adequate.
</p>
<p>The Docker container for the API will need to include <code>googleCloudRunner</code> installed in its R environment to run this function.  This is available in the public <code>gcr.io/gcer-public/cloudrunner</code> image.
</p>
<p>Use cr_pubsub to test this function once deployed.
</p>


<h3>See Also</h3>

<p><a href="https://cloud.google.com/run/docs/tutorials/pubsub">Google Pub/Sub tutorial for Cloud Run</a>.  You can set up Pub/Sub messages from Google Cloud Storage buckets via gcs_create_pubsub
</p>
<p>Other Cloud Run functions: 
<code>cr_jwt_create()</code>,
<code>cr_run_email()</code>,
<code>cr_run_get()</code>,
<code>cr_run_list()</code>,
<code>cr_run_schedule_http()</code>,
<code>cr_run()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 

# within a plumber api.R script:

# example function echos back pubsub message
pub &lt;- function(x) {
  paste("Echo:", x)
}

#' Recieve pub/sub message
#' @post /pubsub #nolint
#' @param message a pub/sub message
function(message = NULL) {
  googleCloudRunner::cr_plumber_pubsub(message, pub)
}

## End(Not run)
</code></pre>


</div>