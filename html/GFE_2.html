<div class="container">

<table style="width: 100%;"><tr>
<td>estGF</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Gross Flows estimation</h2>

<h3>Description</h3>

<p>Gross Flows under complex electoral surveys.
</p>


<h3>Usage</h3>

<pre><code class="language-R">estGF(
  sampleBase = NULL,
  niter = 100,
  model = NULL,
  colWeights = NULL,
  nonrft = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sampleBase</code></td>
<td>
<p>An object of class "data.frame" containing the information of electoral candidates. The data must contain the samplings weights.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>niter</code></td>
<td>
<p>The number of iterations for the <code class="reqn">\eta_{i}</code> and <code class="reqn">p_{ij}</code> model parameters within the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>A character indicating the model to be used in estimating estimated gross flows. The models available are: "I","II","III","IV" (see also "Details").</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colWeights</code></td>
<td>
<p>The column name containing the sampling weights to be used in the fitting process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nonrft</code></td>
<td>
<p>A logical value indicating a non response for first time.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The population size <code class="reqn">N</code> must satisfy the condition:
</p>
<p style="text-align: center;"><code class="reqn"> N = \sum_{j}\sum_{i} N_{ij} + \sum_{j} C_{j} + \sum_{i} R_{i} + M</code>
</p>

<p>where, <code class="reqn">N_{ij}</code> is the amount of people interviewed who have classification <code class="reqn">i</code> at first time and classification <code class="reqn">j</code> at second time, <code class="reqn">R_{i}</code> is the amount of people who did not respond at second time, but did at first time, <code class="reqn">C_{j}</code> is the amount of people who did not respond at first time, but they did at second time and <code class="reqn">M</code> is the number of people who did not respond at any time or could not be reached.
Let <code class="reqn">\eta_{i}</code> the initial probability that a person has classification <code class="reqn">i</code> in the first time, and let <code class="reqn">p_{ij}</code> the vote transition probability for the cell <code class="reqn">(i,j)</code>, where <code class="reqn">\sum_{i} \eta_{i} = 1</code> and <code class="reqn">\sum_{j} p_{ij} = 1</code>.
Thus, four possibles models for the gross flows are given by:
</p>

<ol>
<li> <p><b>Model I:</b> This model assumes that a person's initial probability of being classified as <code class="reqn">i</code> at first time is the same for everyone, that is, <code class="reqn">\psi(i,j) = \psi</code>. Besides, transition probabilities between respond and non response not depend of the classification <code class="reqn">(i,j)</code>, that is <code class="reqn">\rho_{MM}(i,j) = \rho_{MM}</code> and <code class="reqn">\rho_{RR}(i,j) = \rho_{RR}</code>.
</p>
</li>
<li> <p><b>Model II:</b> Unlike 'Model I', this model assumes that person initial probability that person has classification <code class="reqn">(i,j)</code>, only depends of his classification at first time, that is <code class="reqn">\psi(i,j) = \psi(i)</code>.
</p>
</li>
<li> <p><b>Model III:</b> Unlike 'Model I', this model assumes that transition probabilities between response and non response only depends of probability classification at first time, that is <code class="reqn">\rho_{MM}(i,j) = \rho_{MM}(i)</code> and <code class="reqn">\rho_{RR}(i,j) = \rho_{RR}(i)</code>.
</p>
</li>
<li> <p><b>Model IV:</b> Unlike 'Model I', this model assumes that transition probabilities between response and non response only depends of probability classification at second time, that is <code class="reqn">\rho_{MM}(i,j) = \rho_{MM}(j)</code> and <code class="reqn">\rho_{RR}(i,j) = \rho_{RR}(j)</code>.
</p>
</li>
</ol>
<h3>Value</h3>

<p><code>estGF</code> returns a list containing:
</p>

<ol>
<li> <p><b>Est.CIV:</b> a data.frame containing the gross flows estimation.
</p>
</li>
<li> <p><b>Params.Model:</b> a list that contains the <code class="reqn">\hat{\eta}_{i}</code>, <code class="reqn">\hat{p}_{ij}</code>, <code class="reqn">\hat{\psi}(i,j)</code>, <code class="reqn">\hat{\rho}_{RR}(i,j)</code>, <code class="reqn">\hat{\rho}_{MM}(i,j)</code> parameters for the estimated model.
</p>
</li>
<li> <p><b>Sam.Est:</b> a list containing the sampling estimators <code class="reqn">\hat{N}_{ij}</code>, <code class="reqn">\hat{R}_{i}</code>, <code class="reqn">\hat{C}_{j}</code>, <code class="reqn">\hat{M}</code>, <code class="reqn">\hat{N}</code>.
</p>
</li>
</ol>
<h3>References</h3>

<p>Stasny, E. (1987), ‘Some markov-chain models for nonresponse in estimating gross’, <em>Journal of Oficial Statistics</em> <b>3</b>, pp. 359-373. <br>
Sarndal, C.-E., Swensson, B. &amp; Wretman, J. (1992), <em>Model Assisted Survey Sampling</em>, Springer-Verlag, New York, USA. <br>
Gutierrez, A., Trujillo, L. &amp; Silva, N. (2014), ‘The estimation of gross ows in complex surveys with random nonresponse’, <em>Survey Methodology</em> <b>40</b>(2), pp. 285-321.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(TeachingSampling)
library(data.table)
# Colombia's electoral candidates in 2014
candidates_t0 &lt;- c("Clara","Enrique","Santos","Martha","Zuluaga","WhiteVote", "NoVote")
candidates_t1 &lt;- c("Santos","Zuluaga","WhiteVote", "NoVote")

N &lt;- 100000
nCanT0 &lt;- length(candidates_t0)
nCanT1 &lt;- length(candidates_t1)
# Initial probabilities
eta &lt;- matrix(c(0.10, 0.10, 0.20, 0.17, 0.28, 0.1, 0.05),
				byrow = TRUE, nrow = nCanT0)
# Transition probabilities
P &lt;- matrix(c(0.10, 0.60, 0.15, 0.15,
				 0.30, 0.10, 0.25,0.35,
				 0.34, 0.25, 0.16, 0.25,
				 0.25,0.05, 0.35,0.35,
				 0.10, 0.25, 0.45,0.20,
				 0.12, 0.36, 0.22, 0.30,
				 0.10,0.15, 0.30,0.45),
		byrow = TRUE, nrow = nCanT0)
citaMod &lt;- matrix(, ncol = nCanT1, nrow = nCanT0)
row.names(citaMod) &lt;- candidates_t0
colnames(citaMod) &lt;- candidates_t1

for(ii in 1:nCanT0){
		citaMod[ii,] &lt;- c(rmultinom(1, size = N * eta[ii,], prob = P[ii,]))
}

# # Model I
psiI   &lt;- 0.9
rhoRRI &lt;- 0.9
rhoMMI &lt;- 0.5

citaModI &lt;- matrix(nrow = nCanT0 + 1, ncol = nCanT1 + 1)
rownames(citaModI) &lt;- c(candidates_t0, "Non_Resp")
colnames(citaModI) &lt;- c(candidates_t1, "Non_Resp")
citaModI[1:nCanT0, 1:nCanT1] &lt;- P * c(eta) * rhoRRI * psiI
citaModI[(nCanT0 + 1), (nCanT1 + 1)] &lt;- rhoMMI * (1-psiI)
citaModI[1:nCanT0, (nCanT1 + 1)] &lt;- (1-rhoRRI) * psiI * rowSums(P * c(eta))
citaModI[(nCanT0 + 1), 1:nCanT1 ] &lt;- (1-rhoMMI) * (1-psiI) * colSums(P * c(eta))
citaModI &lt;- round_preserve_sum(citaModI * N)
DBcitaModI &lt;- createBase(citaModI)

# Creating auxiliary information
DBcitaModI[,AuxVar := rnorm(nrow(DBcitaModI), mean = 45, sd = 10)]

# Selects a sample with unequal probabilities
res &lt;- S.piPS(n = 3200, as.data.frame(DBcitaModI)[,"AuxVar"])
sam &lt;- res[,1]
pik &lt;- res[,2]
DBcitaModISam &lt;- copy(DBcitaModI[sam,])
DBcitaModISam[,Pik := pik]

# Gross Flows estimation
estima &lt;- estGF(sampleBase = DBcitaModISam, niter = 500, model = "I", colWeights = "Pik")
estima
</code></pre>


</div>