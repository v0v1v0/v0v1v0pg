<div class="container">

<table style="width: 100%;"><tr>
<td>phenoRegressor.SVR</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Support Vector Regression using package e1071</h2>

<h3>Description</h3>

<p>This is a wrapper around several functions from <code>e1071</code> package (as such, it won't work if
e1071 package is not installed).
This function implements Support Vector Regressions, meaning that the data points are projected in
a transformed higher dimensional space where linear regression is possible.<br><br><code>phenoRegressor.SVR</code> can operate in three modes: run, train and tune.<br>
In <strong>run</strong> mode you need to pass the function an already tuned/trained SVR model, typically
obtained either directly from e1071 functions (e.g. from svm, best.svm and so forth)
or from a previous run of <code>phenoRegressor.SVR</code> in a different mode. The passed model is applied
to the passed dataset and predictions are returned.<br>
In <strong>train</strong> mode a SVR model will be trained on the passed dataset using the passed hyper
parameters. The trained model will then be used for predictions.<br>
In <strong>tune</strong> mode you need to pass one or more sets of hyperparameters. The best combination of
hyperparameters will be selected through crossvalidation. The best performing SVR model will be used
for final predictions. This mode can be very slow.<br><br>
There is no distinction between regular covariates (genotypes) and extra
covariates (fixed effects) in Support Vector Regression. If extra covariates are passed, they are
put together with genotypes, side by side. Same thing happens with covariances matrix. This
can bring to the scientifically questionable but technically correct situation of regressing
on a big matrix made of SNP genotypes, covariances and other covariates, all collated side by side.
The function makes no distinction, and it's up to the user understand what is correct in each
specific experiment.<br></p>


<h3>Usage</h3>

<pre><code class="language-R">phenoRegressor.SVR(
  phenotypes,
  genotypes,
  covariances,
  extraCovariates,
  mode = c("tune", "train", "run"),
  tuned.model = NULL,
  scale.pheno = TRUE,
  scale.geno = FALSE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>phenotypes</code></td>
<td>
<p>phenotypes, a numeric array (n x 1), missing values are predicted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>genotypes</code></td>
<td>
<p>SNP genotypes, one row per phenotype (n), one column per marker (m), values in 0/1/2 for
diploids or 0/1/2/...ploidy for polyploids. Can be NULL if <code>covariances</code> is present.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariances</code></td>
<td>
<p>square matrix (n x n) of covariances. Can be NULL if <code>genotypes</code> is present.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extraCovariates</code></td>
<td>
<p>extra covariates set, one row per phenotype (n), one column per covariate (w).
If NULL no extra covariates are considered.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mode</code></td>
<td>
<p>this parameter decides what will happen with the passed dataset
</p>

<ul>
<li> <p><code>mode = "tune"</code> : hyperparameters will be tuned on a grid (you may want to specify
its values using extra params) with a call to <code>e1071::tune.svm</code>. Use this option if
you have no idea about the optimal choice of hyperparameters. This mode can be very slow.
</p>
</li>
<li> <p><code>mode = "train"</code> : an SVR will be trained on the train dataset using the passed hyperparameters
(if you know them). This more invokes <code>e1071::train</code>
</p>
</li>
<li> <p><code>mode = "run"</code> : you already have a tuned and trained SVR (put it into <code>tuned.model</code>) and
want to use it. The fastest mode.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tuned.model</code></td>
<td>
<p>a tuned and trained SVR to be used for prediction. This object is only used if
<code>mode</code> is equal to "run".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale.pheno</code></td>
<td>
<p>if TRUE (default) the phenotypes will be scaled and centered (before tuning or before
applying the passed tuned model).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale.geno</code></td>
<td>
<p>if TRUE the genotypes will be scaled and centered (before tuning or before
applying the passed tuned model. It is usually not a good idea, since it leads to
worse results. Defaults to FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>all extra parameters are passed to <code>e1071::svm</code> or <code>e1071::tune.svm</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The function returns a list with the following fields:
</p>

<ul>
<li> <p><code>predictions</code> : an array of (n) predicted phenotypes
</p>
</li>
<li> <p><code>hyperparams</code> : named vector with the following keys: gamma, cost, coef0, nu, epsilon. Some
of the values may not make sense given the selected model, and will contain
default values from e1071 library.
</p>
</li>
<li> <p><code>extradata</code>   : depending on <code>mode</code> parameter, <code>extradata</code> will contain one of the
following:
1) a SVM object returned by e1071::tune.svm, containing both
the best performing model and the description of the training process
2) a newly trained SVR model
3) the same object passed as <code>tuned.model</code>
</p>
</li>
</ul>
<h3>See Also</h3>

<p>svm, tune.svm, best.svm from e1071 package
</p>
<p>Other phenoRegressors: 
<code>phenoRegressor.BGLR()</code>,
<code>phenoRegressor.RFR()</code>,
<code>phenoRegressor.dummy()</code>,
<code>phenoRegressor.rrBLUP()</code>,
<code>phenoregressor.BGLR.multikinships()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
### WARNING ###
#The 'tuning' part of the example can take quite some time to run,
#depending on the computational power.

#using the GROAN.KI dataset, we regress on the dataset and predict the first ten phenotypes
phenos = GROAN.KI$yield
phenos[1:10] = NA

#--------- TUNE ---------
#tuning the SVR on a grid of hyperparameters
results.tune = phenoRegressor.SVR(
  phenotypes = phenos,
  genotypes = GROAN.KI$SNPs,
  covariances = NULL,
  extraCovariates = NULL,
  mode = 'tune',
  kernel = 'linear', cost = 10^(-3:+3) #SVR-specific parameters
)

#examining the predictions
plot(GROAN.KI$yield, results.tune$predictions,
     main = 'Mode = TUNING\nTrain set (black) and test set (red) regressions',
     xlab = 'Original phenotypes', ylab = 'Predicted phenotypes')
points(GROAN.KI$yield[1:10], results.tune$predictions[1:10], pch=16, col='red')

#printing correlations
test.set.correlation  = cor(GROAN.KI$yield[1:10], results.tune$predictions[1:10])
train.set.correlation = cor(GROAN.KI$yield[-(1:10)], results.tune$predictions[-(1:10)])
writeLines(paste(
  'test-set correlation :', test.set.correlation,
  '\ntrain-set correlation:', train.set.correlation
))

#--------- TRAIN ---------
#training the SVR, hyperparameters are given
results.train = phenoRegressor.SVR(
  phenotypes = phenos,
  genotypes = GROAN.KI$SNPs,
  covariances = NULL,
  extraCovariates = NULL,
  mode = 'train',
  kernel = 'linear', cost = 0.01 #SVR-specific parameters
)

#examining the predictions
plot(GROAN.KI$yield, results.train$predictions,
     main = 'Mode = TRAIN\nTrain set (black) and test set (red) regressions',
     xlab = 'Original phenotypes', ylab = 'Predicted phenotypes')
points(GROAN.KI$yield[1:10], results.train$predictions[1:10], pch=16, col='red')

#printing correlations
test.set.correlation  = cor(GROAN.KI$yield[1:10], results.train$predictions[1:10])
train.set.correlation = cor(GROAN.KI$yield[-(1:10)], results.train$predictions[-(1:10)])
writeLines(paste(
  'test-set correlation :', test.set.correlation,
  '\ntrain-set correlation:', train.set.correlation
))

#--------- RUN ---------
#we recover the trained model from previous run, predictions will be exactly the same
results.run = phenoRegressor.SVR(
  phenotypes = phenos,
  genotypes = GROAN.KI$SNPs,
  covariances = NULL,
  extraCovariates = NULL,
  mode = 'run',
  tuned.model = results.train$extradata
)

#examining the predictions
plot(GROAN.KI$yield, results.run$predictions,
     main = 'Mode = RUN\nTrain set (black) and test set (red) regressions',
     xlab = 'Original phenotypes', ylab = 'Predicted phenotypes')
points(GROAN.KI$yield[1:10], results.run$predictions[1:10], pch=16, col='red')

#printing correlations
test.set.correlation  = cor(GROAN.KI$yield[1:10], results.run$predictions[1:10])
train.set.correlation = cor(GROAN.KI$yield[-(1:10)], results.run$predictions[-(1:10)])
writeLines(paste(
  'test-set correlation :', test.set.correlation,
  '\ntrain-set correlation:', train.set.correlation
))

## End(Not run)
</code></pre>


</div>