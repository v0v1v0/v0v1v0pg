<div class="container">

<table style="width: 100%;"><tr>
<td>galah_geolocate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Narrow a query to within a specified area</h2>

<h3>Description</h3>

<p>Restrict results to those from a specified area using <code>galah_geolocate()</code>.
Areas can be specified as either polygons or bounding boxes, depending on
<code>type</code>. Alternatively, users can call the underlying functions directly via
<code>galah_polygon()</code>, <code>galah_bbox()</code> or <code>galah_radius()</code>. It is possible to use <code>sf</code>
syntax by calling <code>st_crop()</code>, which is synonymous with <code>galah_polygon()</code>.
</p>
<p><strong>Use a polygon</strong>
If calling <code>galah_geolocate()</code>, the default <code>type</code> is <code>"polygon"</code>, which
narrows queries to within an area supplied as a <code>POLYGON</code> or <code>MULTIPOLYGON</code>.
Polygons must be
specified as either an <code>sf</code> object, a 'well-known text' (WKT) string, or a
shapefile. Shapefiles must be simple to be accepted by the ALA.
</p>


<h3>Usage</h3>

<pre><code class="language-R">galah_geolocate(..., type = c("polygon", "bbox", "radius"))

galah_bbox(...)

galah_polygon(...)

galah_radius(...)

## S3 method for class 'data_request'
st_crop(x, y, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>a single <code>sf</code> object, WKT string or shapefile. Bounding boxes can
be supplied as a <code>tibble</code>/<code>data.frame</code> or a <code>bbox</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p><code>string</code>: one of <code>c("polygon", "bbox")</code>. Defaults to
<code>"polygon"</code>. If <code>type = "polygon"</code>, a multipolygon will be built via
<code>galah_polygon()</code>. If <code>type = "bbox"</code>, a multipolygon will be built via
<code>galah_bbox()</code>. The multipolygon is used to narrow a query to the ALA.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An object of class <code>data_request</code>, created using <code>galah_call()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>A valid Well-Known Text string (wkt), a <code>POLYGON</code> or a <code>MULTIPOLYGON</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><strong>Use a bounding box</strong>
Alternatively, set <code>type = "bbox"</code> to narrow queries to within a bounding
box. Bounding boxes can be extracted from a supplied <code>sf</code> object or
a shapefile. A bounding box can also be supplied as a <code>bbox</code> object
(via <code>sf::st_bbox()</code>) or a <code>tibble</code>/<code>data.frame</code>.
</p>
<p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental"><img src="../help/figures/lifecycle-experimental.svg" alt="[Experimental]"></a>
<strong>Use a point radius</strong>
Alternatively, set <code>type = "radius"</code> to narrow queries to within a circular
area around a specific point location. Point coordinates can be supplied as
latitude/longitude coordinate numbers or as an <code>sf</code> object (<code>sfc_POINT</code>).
Area is supplied as a <code>radius</code> in kilometres. Default radius is 10 km.
</p>
<p>If <code>type = "polygon"</code>, WKT strings longer than 10000 characters and
<code>sf</code> objects with more than 500 vertices will not be
accepted by the ALA. Some polygons  may need to be simplified.
If <code>type = "bbox"</code>, sf objects and shapefiles will be converted to a bounding
box to query the ALA.
If <code style="white-space: pre;">⁠type = "radius⁠</code>, <code>sfc_POINT</code> objects will be converted to lon/lat
coordinate numbers to query the ALA. Default radius is 10 km.
</p>


<h3>Value</h3>

<p>If <code>type = "polygon"</code> or <code>type = "bbox"</code>,
length-1 string (class <code>character</code>) containing a multipolygon WKT
string representing the area provided.
If <code>type = "radius"</code>,
<code>list</code> of <code>lat</code>, <code>long</code> and <code>radius</code> values.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
# Search for records within a polygon using a shapefile
location &lt;- sf::st_read("path/to/shapefile.shp")
galah_call() |&gt;
  galah_identify("vulpes") |&gt;
  galah_geolocate(location) |&gt;
  atlas_counts()
  
# Search for records within the bounding box of a shapefile
location &lt;- sf::st_read("path/to/shapefile.shp")
galah_call() |&gt;
  galah_identify("vulpes") |&gt;
  galah_geolocate(location, type = "bbox") |&gt;
  atlas_counts()

# Search for records within a polygon using an `sf` object
location &lt;- "POLYGON((142.3 -29.0,142.7 -29.1,142.7 -29.4,142.3 -29.0))" |&gt;
 sf::st_as_sfc()
galah_call() |&gt;
  galah_identify("reptilia") |&gt;
  galah_polygon(location) |&gt;
  atlas_counts()
  
# Alternatively, we can use `st_crop()` as a synonym for `galah_polygon()`. 
# Hence the above example can be rewritten as:
request_data() |&gt;
  identify("reptilia") |&gt;
  st_crop(location) |&gt;
  count() |&gt;
  collect()
   
# Search for records using a Well-known Text string (WKT)
wkt &lt;- "POLYGON((142.3 -29.0,142.7 -29.1,142.7 -29.4,142.3 -29.0))"
galah_call() |&gt;
  galah_identify("vulpes") |&gt;
  galah_geolocate(wkt) |&gt;
  atlas_counts()

# Search for records within the bounding box extracted from an `sf` object
location &lt;- "POLYGON((142.3 -29.0,142.7 -29.1,142.7 -29.4,142.3 -29.0))" |&gt;
  sf::st_as_sfc()
galah_call() |&gt;
  galah_identify("vulpes") |&gt;
  galah_geolocate(location, type = "bbox") |&gt;
  atlas_counts()

# Search for records using a bounding box of coordinates
b_box &lt;- sf::st_bbox(c(xmin = 143, xmax = 148, ymin = -29, ymax = -28), 
                     crs = sf::st_crs("WGS84"))
galah_call() |&gt;
  galah_identify("reptilia") |&gt;
  galah_geolocate(b_box, type = "bbox") |&gt;
  atlas_counts()

# Search for records using a bounding box in a `tibble` or `data.frame`
b_box &lt;- tibble::tibble(xmin = 148, ymin = -29, xmax = 143, ymax = -21)
galah_call() |&gt;
  galah_identify("vulpes") |&gt;
  galah_geolocate(b_box, type = "bbox") |&gt;
  atlas_counts()

# Search for records within a radius around a point's coordinates
galah_call() |&gt;
  galah_identify("manorina melanocephala") |&gt;
  galah_geolocate(lat = -33.7,
                  lon = 151.3,
                  radius = 5,
                  type = "radius") |&gt;
  atlas_counts()

# Search for records with a radius around an `sf_POINT` object
point &lt;- sf::st_sfc(sf::st_point(c(-33.66741, 151.3174)), crs = 4326)
galah_call() |&gt;
  galah_identify("manorina melanocephala") |&gt;
  galah_geolocate(point,
                  radius = 5,
                  type = "radius") |&gt;
  atlas_counts()

## End(Not run)
</code></pre>


</div>