<div class="container">

<table style="width: 100%;"><tr>
<td>action_predate</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Gadget3 predation actions</h2>

<h3>Description</h3>

<p>Add predation to a g3 model
</p>


<h3>Usage</h3>

<pre><code class="language-R">g3a_predate_catchability_totalfleet(E)

g3a_predate_catchability_numberfleet(E)

g3a_predate_catchability_linearfleet(E)

g3a_predate_catchability_effortfleet(catchability_fs, E)

g3a_predate_catchability_quotafleet(quota_table, E,
                                    sum_stocks = list(),
                                    recalc_f = NULL)

g3a_predate_fleet(fleet_stock, prey_stocks, suitabilities, catchability_f,
    overconsumption_f = quote(
        logspace_add_vec(stock__consratio * -1e3, 0.95 * -1e3) / -1e3 ),
    run_f = ~TRUE, run_at = g3_action_order$predate)

# NB: Deprecated interface, use g3a_predate_fleet with g3a_predate_catchability_totalfleet
g3a_predate_totalfleet(fleet_stock, prey_stocks, suitabilities, amount_f,
    overconsumption_f = quote(
        logspace_add_vec(stock__consratio * -1e3, 0.95 * -1e3) / -1e3 ),
    run_f = ~TRUE, run_at = g3_action_order$predate)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fleet_stock</code></td>
<td>

<p><code>g3_stock</code> that describes the harvesting fleet.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prey_stocks</code></td>
<td>

<p>List of <code>g3_stock</code>s that maturing <var>stock</var> should move into.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>suitabilities</code></td>
<td>

<p>Either a list of stock names to formula objects, with an optional unnamed
default option, or a formula object (which is always used).
</p>
<p>Each formula should define suitability of a stock, for example
by using <code>g3_suitability_exponentiall50</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>catchability_f</code></td>
<td>

<p>A formula generated by one of the <code>g3a_predate_catchability_*</code> functions,
which define the total biomass a fleet is able to catch.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>

<p>A formula defining total catch a fleet can harvest at the current time/area (totalfleet/numberfleet),
or a scaling factor used to define the stock caught (linearfleet/effortfleet/quotafleet).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>catchability_fs</code></td>
<td>

<p>Either a list of stock names to formula objects, with an optional unnamed
default option, or a formula object (which is always used).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quota_table</code></td>
<td>

<p>A data.frame with 'biomass' and 'quota' columns,
'biomass' a numeric column, an upper bound for total biomass amount, the final value always being <code>Inf</code>.
'quota' being a list of <code>formula</code>s, defining the quota for each, e.g. with <code>g3_parameterized</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sum_stocks</code></td>
<td>

<p>Either a list of g3_stock objects to sum when choosing a value from <var>quote_table</var>,
or <code>NULL</code>, in which case choose the quota based on the current prey.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recalc_f</code></td>
<td>

<p>A formula denoting when to recalculate the current quota. For example <code>~cur_step == 1</code>
will ensure the quota is only recalculated at the beginning of the year.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>amount_f</code></td>
<td>

<p>Equivalent to <var>E</var> passed to g3a_predate_catchability_totalfleet.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overconsumption_f</code></td>
<td>

<p>Overconsumption rule, a formula that should cap all values in <var>stock__consratio</var> to &lt;= 95
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_f</code></td>
<td>

<p>formula specifying a condition for running this action, default always runs.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>run_at</code></td>
<td>

<p>Integer order that actions will be run within model, see <code>g3_action_order</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>g3a_predate_fleet</code> will, given a <code>g3_fleet</code> "predator" and <code>g3_stock</code> prey,
add predation into a model. The behaviour is driven by 2 parameters:
</p>

<dl>
<dt><var>suitabilities</var></dt>
<dd>
<p>Defines a predator's preference within a prey stock, normally one of the suitability functions, e.g. <code>g3_suitability_exponentiall50</code> </p>
</dd>
<dt><var>catchability_f</var></dt>
<dd>
<p>Defines a predator's overall requirements, set with one of the catchability functions, e.g. <code>g3a_predate_catchability_totalfleet</code>  </p>
</dd>
</dl>
<p>For the definition of each catchability function, see the values section below.
</p>


<h4>Details for custom actions</h4>

<p>The actions will define the following stock instance variables for each given <var>fleet_stock</var> and <var>prey_stock</var>:
</p>

<dl>
<dt><var>prey_stock__suit_fleet_stock</var></dt>
<dd>
<p>Suitability of (prey_stock) for (fleet_stock), in a prey array.
i.e. the result of calculating the formula in <var>suitabilities</var> for the current state of the prey</p>
</dd>
<dt><var>prey_stock__predby_predstock</var></dt>
<dd>
<p>Biomass of (prey_stock) caught by (fleet_stock), in a prey array</p>
</dd>
<dt><var>fleet_stock__catch</var></dt>
<dd>
<p>Biomass of all prey caught by (fleet stock), in a fleet array</p>
</dd>
<dt><var>prey_stock__totalpredate</var></dt>
<dd>
<p>Biomass of total consumed (prey_stock), in a prey array</p>
</dd>
<dt><var>prey_stock__consratio</var></dt>
<dd>
<p>Ratio of prey_stock__totalpredate / (current biomass), capped by <var>overconsumption_f</var></p>
</dd>
</dl>
<p>A model can have any number of <code>g3a_predate_*</code> actions, so long as the
calling arguments are different. For instance, <code>run_f = ~age == 5</code> and
<code>run_f = ~age == 7</code>.
</p>



<h3>Value</h3>



<h4>g3a_predate_catchability_totalfleet</h4>

<p>A formula that defines a fleet's desired catch by total biomass (e.g. landings data):
</p>
<p style="text-align: center;"><code class="reqn"> \frac{E N_{sl} W_{sl}}{\displaystyle \sum_{\it stocks} \sum_{\it lengths} N_{sl} W_{sl}} </code>
</p>


<dl>
<dt><code class="reqn">E</code></dt>
<dd>
<p><var>E</var> argument, biomass caught by fleet. Generally a <code>g3_timeareadata</code> table containing landings data, with year/step/area/weight columns</p>
</dd>
<dt><code class="reqn">N</code></dt>
<dd>
<p>Number of stock in length cell</p>
</dd>
<dt><code class="reqn">W</code></dt>
<dd>
<p>Mean weight of stock in length cell</p>
</dd>
</dl>
<h4>g3a_predate_catchability_numberfleet</h4>

<p>A formula that defines a fleet's desired catch by total number of stock landed (not the biomass):
</p>
<p style="text-align: center;"><code class="reqn"> \frac{E N_{sl}}{\displaystyle \sum_{\it stocks} \sum_{\it lengths} N_{sl}} </code>
</p>


<dl>
<dt><code class="reqn">E</code></dt>
<dd>
<p><var>E</var> argument, numbers caught by fleet. Generally a <code>g3_timeareadata</code> table containing landings data, or a constant quota</p>
</dd>
<dt><code class="reqn">N</code></dt>
<dd>
<p>Number of stock in length cell</p>
</dd>
</dl>
<h4>g3a_predate_catchability_linearfleet</h4>

<p>A formula object that defines a linear relationship between desired catch and available biomass:
</p>
<p style="text-align: center;"><code class="reqn"> E \Delta t N_{sl} W_{sl} </code>
</p>


<dl>
<dt><code class="reqn">E</code></dt>
<dd>
<p><var>E</var> argument, scaling factor for the stock that is to be caught, per month</p>
</dd>
<dt><code class="reqn">\Delta t</code></dt>
<dd>
<p>length of current timestep in months</p>
</dd>
<dt><code class="reqn">N</code></dt>
<dd>
<p>Number of stock in length cell</p>
</dd>
<dt><code class="reqn">W</code></dt>
<dd>
<p>Mean weight of stock in length cell</p>
</dd>
</dl>
<h4>g3a_predate_catchability_effortfleet</h4>

<p>This is a multi-species extension to linearfleet, allowing differently-parameterized catchability per-stock.
Returns a formula object that defines:
</p>
<p style="text-align: center;"><code class="reqn"> c_{s} E \Delta t N_{sl} W_{sl} </code>
</p>


<dl>
<dt><code class="reqn">c_{s}</code></dt>
<dd>
<p><var>catchability_fs</var> argument for the current stock</p>
</dd>
<dt><code class="reqn">E</code></dt>
<dd>
<p><var>E</var> argument, scaling factor for the stock that is to be caught, per month</p>
</dd>
<dt><code class="reqn">\Delta t</code></dt>
<dd>
<p>length of current timestep in months</p>
</dd>
<dt><code class="reqn">N</code></dt>
<dd>
<p>Number of stock in length cell</p>
</dd>
<dt><code class="reqn">W</code></dt>
<dd>
<p>Mean weight of stock in length cell</p>
</dd>
</dl>
<h4>g3a_predate_catchability_quotafleet</h4>

<p>A formula onject that defines catch based on the available biomass of the stock multiplied by a scaling factor set according to a simple harvest control rule:
</p>
<p style="text-align: center;"><code class="reqn"> q E \Delta t N_{sl} W_{sl} </code>
</p>


<dl>
<dt><code class="reqn">q</code></dt>
<dd>
<p>quota selected from <var>quota_table</var>, corresponding to the total biomass of <var>sum_stocks</var>.
For example, given <code>data.frame(biomass = c(10000, Inf), quota = I(list(g3_parameterized('quota.low'), g3_parameterized('quota.high'))))</code>,
'quota.low' will be chosen when total biomass is less than 10000, otherwise 'quota.high' will be used.
</p>
</dd>
<dt><code class="reqn">E</code></dt>
<dd>
<p><var>E</var> argument, scaling factor for the stock that is to be caught, per month</p>
</dd>
<dt><code class="reqn">\Delta t</code></dt>
<dd>
<p>length of current timestep</p>
</dd>
<dt><code class="reqn">N</code></dt>
<dd>
<p>Number of stock in length cell</p>
</dd>
<dt><code class="reqn">W</code></dt>
<dd>
<p>Mean weight of stock in length cell</p>
</dd>
</dl>
<p>...if <var>recalc_f</var> is set, this will only be recaculated when true. Any other step
will use the previous value.
</p>



<h4>g3a_predate_fleet</h4>

<p>An action (i.e. list of formula objects) that will...</p>

<ol>
<li>
<p>Zero fleet and prey catch counters
</p>
</li>
<li>
<p>For each prey, collect maximum desired by fleet for all prey, into a <var>prey_stock__predby_predstock</var> variable
</p>
</li>
<li>
<p>After all fleet consumption is done, scale consumption using <var>catchability_f</var>, sum into <var>prey_stock__totalpredate</var>
</p>
</li>
<li>
<p>After all consumption is done, temporarily convert <var>prey_stock__predby_predstock</var> to a proprotion of <var>prey_stock__totalpredate</var>
</p>
</li>
<li>
<p>Calculate <var>prey_stock__consratio</var> (ratio of consumed to available), capping using <var>overconsumption_f</var>. Update <var>prey_stock__num</var>
</p>
</li>
<li>
<p>Recalculate <var>prey_stock__predby_predstock</var>, <var>fleet_stock__catch</var>, post-overconsumption
</p>
</li>
</ol>
<h3>See Also</h3>

<p><a href="https://gadget-framework.github.io/gadget2/userguide/chap-stock.html#sec:stockpredator">https://gadget-framework.github.io/gadget2/userguide/chap-stock.html#sec:stockpredator</a>,
<code>g3_stock</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
areas &lt;- c(a = 1, b = 2)
ling_imm &lt;- g3_stock(c(species = 'ling', 'imm'), seq(20, 156, 4)) %&gt;% g3s_age(3, 10)
ling_mat &lt;- g3_stock(c(species = 'ling', 'mat'), seq(20, 156, 4)) %&gt;% g3s_age(5, 15)
lln &lt;- g3_fleet('lln') %&gt;% g3s_livesonareas(areas[c('a', 'b')])

# Invent a lln_landings table
lln_landings &lt;- expand.grid(
    year = 1999:2000,
    step = c(1, 2),
    area = areas[c('a', 'b')])
lln_landings$total_weight &lt;- floor(runif(nrow(lln_landings), min=100, max=999))

# g3a_predate_catchability_totalfleet(): Set catch accordings to landings data
predate_action &lt;- g3a_predate_fleet(
    lln,
    list(ling_imm, ling_mat),
    suitabilities = g3_suitability_exponentiall50(by_stock = 'species'),
    catchability_f = g3a_predate_catchability_totalfleet(
        g3_timeareadata('lln_landings', lln_landings, "total_weight") ))

# g3a_predate_catchability_numberfleet(): Fixed quota of 1000 fish
predate_action &lt;- g3a_predate_fleet(
    lln,
    list(ling_imm, ling_mat),
    suitabilities = g3_suitability_exponentiall50(by_stock = 'species'),
    catchability_f = g3a_predate_catchability_numberfleet(
        g3_parameterized(
            'quota',
            value = 1000,
            by_predator = TRUE,
            scale = 0.5,
            optimise = FALSE) ))
attr(suppressWarnings(g3_to_r(list(predate_action))), 'parameter_template')
</code></pre>


</div>