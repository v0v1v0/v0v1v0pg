<div class="container">

<table style="width: 100%;"><tr>
<td>cr_deploy_packagetests</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Deploy a cloudbuild.yml for R package tests and upload to Codecov</h2>

<h3>Description</h3>

<p>This tests an R package each time you commit, and uploads the test coverage results to Codecov
</p>


<h3>Usage</h3>

<pre><code class="language-R">cr_deploy_packagetests(
  steps = NULL,
  cloudbuild_file = "cloudbuild-tests.yml",
  env = c("NOT_CRAN=true"),
  test_script = NULL,
  codecov_script = NULL,
  codecov_token = "$_CODECOV_TOKEN",
  build_image = "gcr.io/gcer-public/packagetools:latest",
  create_trigger = c("file", "inline", "no"),
  trigger_repo = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>steps</code></td>
<td>
<p>extra steps to run before the cr_buildstep_packagetests steps run (such as decryption of auth files)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cloudbuild_file</code></td>
<td>
<p>The cloudbuild yaml file to write to.  See create_trigger</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env</code></td>
<td>
<p>Environment arguments to be set during the test script runs</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>test_script</code></td>
<td>
<p>The script that will call rcmdcheck to perform tests.  If <code>NULL</code> a default script is used in <code>system.file("r_buildsteps", "devtools_tests.R", package="googlecloudRunner")</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>codecov_script</code></td>
<td>
<p>The script that will call codecov to perform coverage.  If <code>NULL</code> a default script is used in <code>system.file("r_buildsteps", "codecov_tests.R", package="googleCloudRunner")</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>codecov_token</code></td>
<td>
<p>If using codecov, supply your codecov token here.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>build_image</code></td>
<td>
<p>The docker image that will be used to run the R code for the test scripts</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>create_trigger</code></td>
<td>
<p>If creating a trigger, whether to create it from the cloudbuild_file or inline</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trigger_repo</code></td>
<td>
<p>If not NULL, a cr_buildtrigger_repo where a buildtrigger will be created via cr_buildtrigger</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>

<p>Arguments passed on to <code>cr_build_make</code>
</p>

<dl>
<dt><code>yaml</code></dt>
<dd>
<p>A <code>Yaml</code> object created from cr_build_yaml or a file location of a .yaml/.yml cloud build file</p>
</dd>
<dt><code>artifacts</code></dt>
<dd>
<p>Artifacts that may be built via cr_build_yaml_artifact</p>
</dd>
<dt><code>options</code></dt>
<dd>
<p>Options to pass to a Cloud Build</p>
</dd>
<dt><code>availableSecrets</code></dt>
<dd>
<p>Secret Manager objects built by cr_build_yaml_secrets</p>
</dd>
<dt><code>logsBucket</code></dt>
<dd>
<p>The gs:// location of a bucket to put logs in</p>
</dd>
<dt><code>source</code></dt>
<dd>
<p>A Source object specifying the location of the source files to build, usually created by cr_build_source</p>
</dd>
<dt><code>timeout</code></dt>
<dd>
<p>Amount of time that this build should be allowed to run, to second</p>
</dd>
<dt><code>images</code></dt>
<dd>
<p>A list of images to be pushed upon the successful completion of all build</p>
</dd>
<dt><code>substitutions</code></dt>
<dd>
<p>Substitutions data for 'Build' resource</p>
</dd>
<dt><code>serviceAccount</code></dt>
<dd>
<p>service account email to be used for the build</p>
</dd>
</dl>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The trigger repository needs to hold an R package configured to do tests upon.
</p>
<p>For GitHub, the repository will need to be linked to the project you are building within, via <a href="https://console.cloud.google.com/cloud-build/triggers/connect">https://console.cloud.google.com/cloud-build/triggers/connect</a>
</p>
<p>If your tests need authentication details, add these via cr_buildstep_secret to the <code>steps</code> argument, which will prepend decrypting the authentication file before running the tests.
</p>
<p>If you want codecov to ignore some files then also deploy a .covrignore file to your repository - see covr website at <a href="https://covr.r-lib.org/">https://covr.r-lib.org/</a> for details.
</p>


<h3>See Also</h3>

<p>Create your own custom deployment using cr_buildstep_packagetests which this function uses with some defaults
</p>
<p>cr_buildstep_packagetests
</p>
<p>Other Deployment functions: 
<code>cr_deploy_docker_trigger()</code>,
<code>cr_deploy_docker()</code>,
<code>cr_deploy_pkgdown()</code>,
<code>cr_deploy_run_website()</code>,
<code>cr_deploy_run()</code>,
<code>cr_deploy_r()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# create a local cloudbuild.yml file for packagetests
pd &lt;- cr_deploy_packagetests(create_trigger = "no")
pd

# add a decryption step for an auth file
cr_deploy_packagetests(
  steps = cr_buildstep_secret("my_secret", "auth.json"),
  env = c("NOT_CRAN=true", "MY_AUTH_FILE=auth.json"),
  timeout = 1200,
  create_trigger = "no"
)


# creating a buildtrigger repo for trigger_repo
repo &lt;- cr_buildtrigger_repo("MarkEdmondson1234/googleCloudRunner",
  branch = "master"
)
## Not run: 

# will create the file in the repo, and point a buildtrigger at it
cr_deploy_packagetests(create_trigger = "file", trigger_repo = repo)


# will make an inline build within a buildtrigger
cr_deploy_packagetests(create_trigger = "inline", trigger_repo = repo)

## End(Not run)

unlink("cloudbuild-tests.yml")
</code></pre>


</div>