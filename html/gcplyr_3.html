<div class="container">

<table style="width: 100%;"><tr>
<td>calc_deriv</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate derivatives of vector of data</h2>

<h3>Description</h3>

<p>Provided a vector of y values, this function returns either the plain
or per-capita difference or derivative between sequential values
</p>


<h3>Usage</h3>

<pre><code class="language-R">calc_deriv(
  y,
  x = NULL,
  return = "derivative",
  percapita = FALSE,
  x_scale = 1,
  blank = NULL,
  subset_by = NULL,
  window_width = NULL,
  window_width_n = NULL,
  window_width_frac = NULL,
  window_width_n_frac = NULL,
  trans_y = "linear",
  na.rm = TRUE,
  warn_ungrouped = TRUE,
  warn_logtransform_warnings = TRUE,
  warn_logtransform_infinite = TRUE,
  warn_window_toosmall = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Data to calculate difference or derivative of</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Vector of x values provided as a simple numeric.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>return</code></td>
<td>
<p>One of c("difference", "derivative") for whether the
differences in <code>y</code> should be returned, or the
derivative of <code>y</code> with respect to <code>x</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>percapita</code></td>
<td>
<p>When percapita = TRUE, the per-capita difference or
derivative is returned</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_scale</code></td>
<td>
<p>Numeric to scale x by in derivative calculation
</p>
<p>Set x_scale to the ratio of the units of 
x to the desired units. E.g. if x is in seconds, but the 
desired derivative is in units of /minute, set 
<code>x_scale = 60</code> (since there are 60 seconds in 1 minute).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blank</code></td>
<td>
<p>y-value associated with a "blank" where the density is 0.
Is required when <code>percapita = TRUE</code>.
</p>
<p>If a vector of blank values is specified, blank values are
assumed to be in the same order as unique(subset_by)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset_by</code></td>
<td>
<p>An optional vector as long as <code>y</code>. 
<code>y</code> will be split by the unique values of this vector 
and the derivative for each group will be calculated 
independently of the others.
</p>
<p>This provides an internally-implemented approach similar
to group_by and mutate</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>window_width, window_width_n, window_width_frac, window_width_n_frac</code></td>
<td>
<p>Set how many data points are used to determine
the slope at each point.
</p>
<p>When all are <code>NULL</code>, <code>calc_deriv</code> 
calculates the difference or derivative
of each point with the next point, appending
<code>NA</code> at the end.
</p>
<p>When one or multiple are specified, a linear regression 
is fit to all points in the window to determine the 
slope.
</p>
<p><code>window_width_n</code> specifies the width of the
window in number of data points. <code>window_width</code>
specifies the width of the window in units of <code>x</code>.
<code>window_width_n_frac</code> specifies the width of the
window as a fraction of the total number of data points.
</p>
<p>When using multiple window specifications at the same 
time, windows are conservative. Points 
included in each window will meet all of the 
<code>window_width</code>, <code>window_width_n</code>, and
<code>window_width_n_frac</code>.
</p>
<p>A value of <code>window_width_n = 3</code> or 
<code>window_width_n = 5</code> is often a good default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trans_y</code></td>
<td>
<p>One of <code>c("linear", "log")</code> specifying the
transformation of y-values.
</p>
<p><code>'log'</code> is only available when calculating per-capita
derivatives using a fitting approach (when non-default 
values are specified for <code>window_width</code> or 
<code>window_width_n</code>).
</p>
<p>For per-capita growth expected to be exponential or 
nearly-exponential, <code>"log"</code> is recommended, since 
exponential growth is linear when log-transformed. However, 
log-transformations must be used with care, since y-values 
at or below 0 will become undefined and results will be 
more sensitive to incorrect values of <code>blank</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>logical whether NA's should be removed before analyzing</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn_ungrouped</code></td>
<td>
<p>logical whether warning should be issued when
<code>calc_deriv</code> is being called on ungrouped data
and <code>subset_by = NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn_logtransform_warnings</code></td>
<td>
<p>logical whether warning should be issued 
when log(y) produced warnings.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn_logtransform_infinite</code></td>
<td>
<p>logical whether warning should be issued 
when log(y) produced infinite values that will
be treated as <code>NA</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>warn_window_toosmall</code></td>
<td>
<p>logical whether warning should be issued 
when only one data point is in the window
set by <code>window_width_n</code>, 
<code>window_width</code>, or <code>window_width_n_frac</code>,
and so <code>NA</code> will be returned.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For per-capita derivatives, <code>trans_y = 'linear'</code> and
<code>trans_y = 'log'</code> approach the same value as time resolution
increases. 
</p>
<p>For instance, let's assume exponential growth <code class="reqn">N = e^rt</code> with 
per-capita growth rate <code class="reqn">r</code>.
</p>
<p>With <code>trans_y = 'linear'</code>, note that <code class="reqn">dN/dt = r e^rt = r N</code>. 
So we can calculate per-capita growth rate as <code class="reqn">r = dN/dt * 1/N</code>. 
</p>
<p>With <code>trans_y = 'log'</code>, note that <code class="reqn">log(N) = log(e^rt) = rt</code>.
So we can calculate per-capita growth rate as the slope of a linear
fit of <code class="reqn">log(N)</code> against time, <code class="reqn">r = log(N)/t</code>.
</p>


<h3>Value</h3>

<p>A vector of values for the plain (if <code>percapita = FALSE</code>)
or per-capita (if <code>percapita = TRUE</code>) difference 
(if <code>return = "difference"</code>) or derivative 
(if <code>return = "derivative"</code>) between <code>y</code> values. Vector
will be the same length as <code>y</code>,  with <code>NA</code> values 
at the ends
</p>


</div>