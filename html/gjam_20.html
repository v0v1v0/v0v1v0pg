<div class="container">

<table style="width: 100%;"><tr>
<td>gjam</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Gibbs sampler for gjam data</h2>

<h3>Description</h3>

<p>Analyzes joint attribute data (e.g., species abundance) with Gibbs sampling.  
Input can be output from <code>gjamSimData</code>.  Returns a list of objects from Gibbs sampling that can be plotted by <code>gjamPlot</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">  gjam(formula, xdata, ydata, modelList)
  
  ## S3 method for class 'gjam'
print(x, ...)
  
  ## S3 method for class 'gjam'
summary(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>R formula for model, e.g., <code>~ x1 + x2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xdata</code></td>
<td>
<p><code>data.frame</code> containing predictors in <code>formula</code>.  If not found in <code>xdata</code> variables, they must be available from the user's workspace.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ydata</code></td>
<td>
<p><code>n</code> by <code>S</code> response <code>matrix</code> or <code>data.frame</code>.  Column names are unique labels, e.g., species names.  All columns will be included in the analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelList</code></td>
<td>
<p><code>list</code> specifying inputs, including <code>ng</code> (number of Gibbs steps), <code>burnin</code>, and <code>typeNames</code>. Can include the number of holdouts for out-of-sample prediction, <code>holdoutN</code>.  See <b>Details</b>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>object of <code>class gjam</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>currently, also an object of <code>class gjam</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments not used here.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Note that <code>formula</code> begins with <code>~</code>, not <code>y ~</code>.  The response <code>matrix</code> is passed in the form of a <code>n</code> by <code>S</code> matrix or <code>data.frame</code> <code>ydata</code>.  
</p>
<p>Both predictors in <code>xdata</code> and responses in <code>ydata</code> can include missing values as <code>NA</code>. Factors in <code>xdata</code> should be declared using <code>factor</code>.   For computational stability variables that are not factors are standardized by mean and variance, then transformed back to original scales in <code>output</code>.  To retain a variable in its original scale during computation include it in the character string <code>notStandard</code> as part of the <code>list modelList</code>. (example shown in the <code>vignette</code> on traits).  
</p>
<p><code>modelList</code> has these defaults and provides these options:
</p>
<p><code>ng = 2000</code>, number of Gibbs steps.  
</p>
<p><code>burnin = 500</code>, no. initial steps, must be less than <code>ng</code>.  
</p>
<p><code>typeNames</code> can be <code>'PA'</code> (presenceAbsence), <code>'CON'</code> (continuous on <code>(-Inf, Inf)</code>), <code>'CA'</code> (continuous abundance, zero censoring), <code>'DA'</code> (discrete abundance),  <code>'FC'</code> (fractional composition),
<code>'CC'</code> (count composition), <code>'OC'</code> (ordinal counts), <code>'CAT'</code> (categorical classes).  <code>typeNames</code> can be a single value that applies to all columns in <code>ydata</code>, or there can be one value for each column.
</p>
<p><code>holdoutN = 0</code>, number of observations to hold out for out-of-sample
prediction.  
</p>
<p><code>holdoutIndex = numeric(0)</code>, <code>numeric vector</code> of observations (row numbers) to holdout for out-of-sample prediction.  
</p>
<p><code>censor = NULL</code>, <code>list</code> specifying columns, values, and intervals for
censoring, see <code>gjamCensorY</code>.
</p>
<p><code>effort = NULL</code>, <code>list</code> containing <code>'columns'</code>, a vector of length <code>&lt;= S</code> giving the names of columns in in <code>y</code>, and <code>'values'</code>, a length-<code>n</code> vector of effort or a <code>n</code> by <code>S</code> matrix (see Examples).  <code>effort</code> can be plot area, search time, etc. for discrete count data <code>'DA'</code>.
</p>
<p><code>FULL = F</code> in <code>modelList</code> will save full prediction chains in <code>$chains$ygibbs</code>.
</p>
<p><code>notStandard = NULL</code>, <code>character vector</code> of column names in <code>xdata</code> that should not be standardized.
</p>
<p><code>reductList = list(N = 20, r = 3)</code>, <code>list</code> of dimension reduction parameters, invoked when <code>reductList</code> is included in <code>modelList</code> or automatically when <code>ydata</code> has too many columns.  See <code>vignette</code> on Dimension Reduction.
</p>
<p><code>random</code>, <code>character</code> string giving the name of a column in <code>xdata</code> that will be used to specify random effects.  The random group column should be declared as a <code>factor</code>.  There should be replication, i.e., each group level occurs multiple times.
</p>
<p><code>REDUCT = F</code> in <code>modelList</code> overrides automatic dimension reduction. 
</p>
<p><code>FCgroups, CCgroups</code>, are length-<code>S vectors</code> assigned to columns in <code>ydata</code> indicating composition <code>'FC'</code> or <code>'CC'</code> group membership.  For example, if there are two 'CA' columns in <code>ydata</code> followed by two groups of fractional composition data, each having three columns, then <code>typeNames = c('CA','CA','FC','FC','FC','FC','FC','FC')</code> and <code>FCgroups = c(0,0,1,1,1,2,2,2)</code>.  note: <code>gjamSimData</code> is not currently set up to simulate multiple composition groups, but <code>gjam</code> will model it.
</p>
<p><code>PREDICTX = T</code> executes inverse prediction of <code>x</code>.  Speed-up by setting <code>PREDICTX = F</code>.
</p>
<p><code>ematAlpha = .5</code> is the probability assigned for conditional and marginal independence in the <code>ematrix</code>.
</p>
<p><code>traitList = list(plotByTrait, traitTypes, specByTrait)</code>, list of trait objects.  See vignette on Trait analysis.
</p>
<p>More detailed vignettes can be obtained with:
</p>
<p><code>browseVignettes('gjam')</code>
</p>


<h3>Value</h3>

<p>Returns an object of <code>class "gjam"</code>, which is a list containing the following components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>call</code></td>
<td>
<p>function call</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chains</code></td>
<td>
<p><code>list</code> of MCMC matrices, each with <code>ng</code> rows; includes coefficients <code>bgibbs</code>(<code>Q*S</code> columns), <code>bgibbsUn</code> (unstandardized for <code>x</code>), sensitivity <code>fgibbs</code> (<code>Q1</code> columns), and <code>fbgibbs</code> (<code>Q1</code> columns, where <code>Q1 = Q - 1</code>, unless there are multilevel factors); covariance <code>sgibbs</code> has <code>S*(S + 1)/2</code> columns (<code>REDUCT == F</code>) or <code>N*r</code> columns (<code>REDUCT == T</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p><code>list</code> of diagnostics (<code>DIC, rmspeAll, rmspeBySpec, xscore, yscore</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inputs</code></td>
<td>
<p><code>list</code> of input summaries, including <code>breakMat</code> (partition matrix), <code>classBySpec</code> (interval assignment),  <code>designTable</code> (summary of design matrix), [<code>factorBeta, interBeta, intMat, linFactor</code>] (factor and interaction information), <code>other, notOther</code> (response columns to exclude and not), [<code>standMat, standRows, standX</code>] means and variances to standardize <code>x</code>, [<code>x, xdata, y</code>] cleaned versions of data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>missing</code></td>
<td>
<p><code>list</code> of missing objects, including locations for predictors <code>xmiss</code> and responses <code>ymiss</code> in <code>xdata</code> and <code>ydata</code>, respectively, predictor means <code>xmissMu</code> and standard errors <code>xmissSe</code>, response means <code>ymissMu</code> and standard errors <code>ymissSe</code> .</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>modelList</code></td>
<td>
<p><code>list</code> of model specifications from input <code>modelList</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parameters</code></td>
<td>
<p><code>list</code> of parameter estimates, including coefficient matrices on standardized (<code>betaMu, betaSe</code>), unstandardized  (<code>betaMuUn, betaSeUn</code>), and dimensionless (<code>fBetaMu, fBetaSd</code>) scales; correlation (<code>corMu, corSe</code>) and covariance (<code>sigMu, sigSe</code>) matrices;  sensitivities to predictors (<code>fmatrix, fMu, fSe</code>); environmental response matrix (<code>ematrix</code>), with locations of zero elements, conditionally (<code>whConZero</code>) and marginally (<code>whichZero</code>), set at probability level <code>modelList$ematAlpha</code>); and latent variables (<code>wMu, wSd</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prediction</code></td>
<td>
<p><code>list</code> of predicted values, including species <code>richness</code> (responses predicted &gt; 0); inverse predicted <code>x</code> (<code>xpredMu, xpredSd</code>) and predicted <code>y</code> (<code>ypredMu, ypredSd</code>) matrices. 
</p>
</td>
</tr>
</table>
<p>If <b>traits</b> are modeled, then <code>parameters</code> will additionally include <code>betaTraitMu</code>, <code>betaTraitSe</code> (coefficients), <code>sigmaTraitMu</code>, <code>sigmaTraitSe</code> (covariance).  <code>prediction</code> will additionally include <code>tMuOrd</code> (ordinal trait means), <code>tMu</code>, <code>tSe</code> (trait predictions).
</p>


<h3>Author(s)</h3>

<p>James S Clark, <a href="mailto:jimclark@duke.edu">jimclark@duke.edu</a>
</p>


<h3>References</h3>

<p>Clark, J.S., D. Nemergut, B. Seyednasrollah, P. Turner, and S. Zhang. 2017.  Generalized joint attribute modeling for biodiversity analysis: Median-zero, multivariate, multifarious data.  Ecological Monographs, 87, 34-56.
</p>


<h3>See Also</h3>

<p><code>gjamSimData</code> simulates data
</p>
<p>A more detailed vignette is can be obtained with:
</p>
<p><code>browseVignettes('gjam')</code>
</p>
<p>website 'http://sites.nicholas.duke.edu/clarklab/code/'.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
## combinations of scales
types &lt;- c('DA','DA','OC','OC','OC','OC','CON','CON','CON','CON','CON','CA','CA','PA','PA')         
f    &lt;- gjamSimData(S = length(types), typeNames = types)
ml   &lt;- list(ng = 500, burnin = 50, typeNames = f$typeNames)
out  &lt;- gjam(f$formula, f$xdata, f$ydata, modelList = ml)
summary(out)

# repeat with ng = 5000, burnin = 500, then plot data:
pl  &lt;- list(trueValues = f$trueValues)
gjamPlot(out, plotPars = pl)

## discrete abundance with heterogeneous effort 
S   &lt;- 5                             
n   &lt;- 1000
eff &lt;- list( columns = 1:S, values = round(runif(n,.5,5),1) )
f   &lt;- gjamSimData(n, S, typeNames='DA', effort=eff)
ml  &lt;- list(ng = 2000, burnin = 500, typeNames = f$typeNames, effort = eff)
out &lt;- gjam(f$formula, f$xdata, f$ydata, modelList = ml)
summary(out)

# repeat with ng = 2000, burnin = 500, then plot data:
pl  &lt;- list(trueValues = f$trueValues)
gjamPlot(out, plotPars = pl)

## End(Not run)
</code></pre>


</div>