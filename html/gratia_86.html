<div class="container">

<table style="width: 100%;"><tr>
<td>draw.gam</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot estimated smooths from a fitted GAM</h2>

<h3>Description</h3>

<p>Plots estimated smooths from a fitted GAM model in a similar way to
<code>mgcv::plot.gam()</code> but instead of using base graphics, <code>ggplot2::ggplot()</code>
is used instead.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'gam'
draw(
  object,
  data = NULL,
  select = NULL,
  parametric = FALSE,
  terms = NULL,
  residuals = FALSE,
  scales = c("free", "fixed"),
  ci_level = 0.95,
  n = 100,
  n_3d = 16,
  n_4d = 4,
  unconditional = FALSE,
  overall_uncertainty = TRUE,
  constant = NULL,
  fun = NULL,
  dist = 0.1,
  rug = TRUE,
  contour = TRUE,
  grouped_by = FALSE,
  ci_alpha = 0.2,
  ci_col = "black",
  smooth_col = "black",
  resid_col = "steelblue3",
  contour_col = "black",
  n_contour = NULL,
  partial_match = FALSE,
  discrete_colour = NULL,
  discrete_fill = NULL,
  continuous_colour = NULL,
  continuous_fill = NULL,
  position = "identity",
  angle = NULL,
  ncol = NULL,
  nrow = NULL,
  guides = "keep",
  widths = NULL,
  heights = NULL,
  crs = NULL,
  default_crs = NULL,
  lims_method = "cross",
  wrap = TRUE,
  envir = environment(formula(object)),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>a fitted GAM, the result of a call to <code>mgcv::gam()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a optional data frame that may or may not be used? FIXME!</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>select</code></td>
<td>
<p>character, logical, or numeric; which smooths to plot. If
<code>NULL</code>, the default, then all model smooths are drawn. Numeric <code>select</code>
indexes the smooths in the order they are specified in the formula and
stored in <code>object</code>. Character <code>select</code> matches the labels for smooths
as shown for example in the output from <code>summary(object)</code>. Logical
<code>select</code> operates as per numeric <code>select</code> in the order that smooths are
stored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parametric</code></td>
<td>
<p>logical; plot parametric terms also? Note that <code>select</code> is
used for selecting which smooths to plot. The <code>terms</code> argument is used to
select which parametric effects are plotted. The default, as with
<code>mgcv::plot.gam()</code>, is to not draw parametric effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>terms</code></td>
<td>
<p>character; which model parametric terms should be drawn? The
Default of <code>NULL</code> will plot all parametric terms that can be drawn.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>logical; should partial residuals for a smooth be drawn?
Ignored for anything but a simple univariate smooth.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scales</code></td>
<td>
<p>character; should all univariate smooths be plotted with the
same y-axis scale? If <code>scales = "free"</code>, the default, each univariate
smooth has its own y-axis scale. If <code>scales = "fixed"</code>, a common y axis
scale is used for all univariate smooths.
</p>
<p>Currently does not affect the y-axis scale of plots of the parametric
terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci_level</code></td>
<td>
<p>numeric between 0 and 1; the coverage of credible interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>numeric; the number of points over the range of the covariate at
which to evaluate the smooth.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_3d</code></td>
<td>
<p>numeric; the number of new observations to generate for the third
dimension of a 3D smooth.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_4d</code></td>
<td>
<p>numeric; the number of new observations to generate for the
dimensions higher than 2 (!) of a <em>k</em>D smooth (<em>k</em> &gt;= 4). For example, if
the smooth is a 4D smooth, each of dimensions 3 and 4 will get <code>n_4d</code>
new observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unconditional</code></td>
<td>
<p>logical; should confidence intervals include the
uncertainty due to smoothness selection? If <code>TRUE</code>, the corrected Bayesian
covariance matrix will be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overall_uncertainty</code></td>
<td>
<p>logical; should the uncertainty in the model
constant term be included in the standard error of the evaluate values of
the smooth?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>constant</code></td>
<td>
<p>numeric; a constant to add to the estimated values of the
smooth. <code>constant</code>, if supplied, will be added to the estimated value
before the confidence band is computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fun</code></td>
<td>
<p>function; a function that will be applied to the estimated values
and confidence interval before plotting. Can be a function or the name of a
function. Function <code>fun</code> will be applied after adding any <code>constant</code>, if
provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dist</code></td>
<td>
<p>numeric; if greater than 0, this is used to determine when
a location is too far from data to be plotted when plotting 2-D smooths.
The data are scaled into the unit square before deciding what to exclude,
and <code>dist</code> is a distance within the unit square. See
<code>mgcv::exclude.too.far()</code> for further details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rug</code></td>
<td>
<p>logical; draw a rug plot at the bottom of each plot for 1-D
smooths or plot locations of data for higher dimensions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contour</code></td>
<td>
<p>logical; should contours be draw on the plot using
<code>ggplot2::geom_contour()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>grouped_by</code></td>
<td>
<p>logical; should factor by smooths be drawn as one panel
per level of the factor (<code>FALSE</code>, the default), or should the individual
smooths be combined into a single panel containing all levels (<code>TRUE</code>)?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci_alpha</code></td>
<td>
<p>numeric; alpha transparency for confidence or simultaneous
interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci_col</code></td>
<td>
<p>colour specification for the confidence/credible intervals
band. Affects the fill of the interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth_col</code></td>
<td>
<p>colour specification for the smooth line.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resid_col</code></td>
<td>
<p>colour specification for the partial residuals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contour_col</code></td>
<td>
<p>colour specification for contour lines.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_contour</code></td>
<td>
<p>numeric; the number of contour bins. Will result in
<code>n_contour - 1</code> contour lines being drawn. See <code>ggplot2::geom_contour()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>partial_match</code></td>
<td>
<p>logical; should smooths be selected by partial matches
with <code>select</code>? If <code>TRUE</code>, <code>select</code> can only be a single string to match
against.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>discrete_colour</code></td>
<td>
<p>a suitable colour scale to be used when plotting
discrete variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>discrete_fill</code></td>
<td>
<p>a suitable fill scale to be used when plotting
discrete variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>continuous_colour</code></td>
<td>
<p>a suitable colour scale to be used when plotting
continuous variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>continuous_fill</code></td>
<td>
<p>a suitable fill scale to be used when plotting
continuous variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>position</code></td>
<td>
<p>Position adjustment, either as a string, or the result of a
call to a position adjustment function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>angle</code></td>
<td>
<p>numeric; the angle at which the x axis tick labels are to be
drawn passed to the <code>angle</code> argument of <code>ggplot2::guide_axis()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncol, nrow</code></td>
<td>
<p>numeric; the numbers of rows and columns over which to
spread the plots</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>guides</code></td>
<td>
<p>character; one of <code>"keep"</code> (the default), <code>"collect"</code>, or
<code>"auto"</code>. Passed to <code>patchwork::plot_layout()</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>widths, heights</code></td>
<td>
<p>The relative widths and heights of each column and
row in the grid. Will get repeated to match the dimensions of the grid. If
there is more than 1 plot and <code>widths = NULL</code>, the value of <code>widths</code> will
be set internally to <code>widths = 1</code> to accommodate plots of smooths that
use a fixed aspect ratio.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>crs</code></td>
<td>
<p>the coordinate reference system (CRS) to use for the plot. All
data will be projected into this CRS. See <code>ggplot2::coord_sf()</code> for
details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>default_crs</code></td>
<td>
<p>the coordinate reference system (CRS) to use for the
non-sf layers in the plot. If left at the default <code>NULL</code>, the CRS used is
4326 (WGS84), which is appropriate for spline-on-the-sphere smooths, which
are parameterized in terms of latitude and longitude as coordinates. See
<code>ggplot2::coord_sf()</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lims_method</code></td>
<td>
<p>character; affects how the axis limits are determined. See
<code>ggplot2::coord_sf()</code>. Be careful; in testing of some examples, changing
this to <code>"orthogonal"</code> for example with the chlorophyll-a example from
Simon Wood's GAM book quickly used up all the RAM in my test system and the
OS killed R. This could be incorrect usage on my part; right now the grid
of points at which SOS smooths are evaluated (if not supplied by the user)
can produce invalid coordinates for the corners of tiles as the grid is
generated for tile centres without respect to the spacing of those tiles.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wrap</code></td>
<td>
<p>logical; wrap plots as a patchwork? If <code>FALSE</code>, a list of
ggplot objects is returned, 1 per term plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>envir</code></td>
<td>
<p>an environment to look up the data within.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments passed to <code>patchwork::wrap_plots()</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The object returned is created by <code>patchwork::wrap_plots()</code>.
</p>


<h3>Note</h3>

<p>Internally, plots of each smooth are created using <code>ggplot2::ggplot()</code>
and composed into a single plot using <code>patchwork::wrap_plots()</code>. As a
result, it is not possible to use <code>+</code> to add to the plots in the way one
might typically work with <code>ggplot()</code> plots. Instead, use the <code>&amp;</code> operator;
see the examples.
</p>


<h3>Author(s)</h3>

<p>Gavin L. Simpson
</p>


<h3>Examples</h3>

<pre><code class="language-R">load_mgcv()

# simulate some data
df1 &lt;- data_sim("eg1", n = 400, dist = "normal", scale = 2, seed = 2)
# fit GAM
m1 &lt;- gam(y ~ s(x0) + s(x1) + s(x2) + s(x3), data = df1, method = "REML")

# plot all smooths
draw(m1)

# can add partial residuals
draw(m1, residuals = TRUE)

df2 &lt;- data_sim("eg2", n = 1000, dist = "normal", scale = 1, seed = 2)
m2 &lt;- gam(y ~ s(x, z, k = 40), data = df2, method = "REML")
draw(m2, contour = FALSE, n = 50)

# See https://gavinsimpson.github.io/gratia/articles/custom-plotting.html
# for more examples and for details on how to modify the theme of all the
# plots produced by draw(). To modify all panels, for example to change the
# theme, use the &amp; operator
</code></pre>


</div>