<div class="container">

<table style="width: 100%;"><tr>
<td>gce_schedule_docker</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Schedule running a docker image upon a VM</h2>

<h3>Description</h3>

<p>Utility function to start a VM to run a docker container on a schedule.  
You will need to create and build the Dockerfile first.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gce_schedule_docker(docker_image, schedule = "53 4 * * *",
  vm = gce_vm_scheduler())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>docker_image</code></td>
<td>
<p>the hosted docker image to run on a schedule</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>schedule</code></td>
<td>
<p>The schedule you want to run via cron</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vm</code></td>
<td>
<p>A VM object to schedule the script upon that you can SSH into</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>You may need to run gce_vm_scheduler yourself first and then set 
up SSH details if not defaults, to pass to argument <code>vm</code>
</p>
<p>You can create a Dockerfile with your R script installed by 
running it through <code>containeRit::dockerfile</code>.  It also takes care of any dependencies.
</p>
<p>It is recommended to create a script that is self contained in output and input, 
e.g. don't save files to the VM, instead upload or download any files 
from Google Cloud Storage via authentication via <code>googleAuthR::gar_gce_auth()</code> 
then downloading and uploading data using <code>library(googleCloudStorageR)</code> or similar. 
</p>
<p>Once the script is working locally, build it and upload to a repository 
so it can be reached via argument <code>docker_image</code>
</p>
<p>You can build via Google cloud repository build triggers, 
in which case the name can be created via gce_tag_container
or build via docker_build to build on another VM or locally, 
then push to a registry via gce_push_registry
</p>
<p>Any Docker image can be run, it does not have to be an R one.
</p>


<h3>Value</h3>

<p>The crontab schedule of the VM including your script
</p>


<h3>See Also</h3>

<p>Other scheduler functions: <code>gce_vm_scheduler</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
# create a Dockerfile of your script
if(!require(containeRit)){
  remotes::install_github("o2r-project/containerit")
  library(containeRit)
}


## create your scheduled script, example below named schedule.R
## it will run the script whilst making the dockerfile
container &lt;- dockerfile("schedule.R",
                        copy = "script_dir",
                        cmd = CMD_Rscript("schedule.R"),
                        soft = TRUE)
write(container, file = "Dockerfile")

## upload created Dockerfile to GitHub, 
  then use a Build Trigger to create Docker image "demoDockerScheduler"
## built trigger uses "demo-docker-scheduler" as must be lowercase

## After image is built:
## Create a VM to run the schedule
vm &lt;- gce_vm_scheduler("my_scheduler")

## setup any SSH not on defaults
vm &lt;- gce_vm_setup(vm, username = "mark")

## get the name of the just built Docker image that runs your script
docker_tag &lt;- gce_tag_container("demo-docker-scheduler", project = "gcer-public")

## Schedule the docker_tag to run every day at 0453AM
gce_schedule_docker(docker_tag, schedule = "53 4 * * *", vm = vm)



## End(Not run)

</code></pre>


</div>