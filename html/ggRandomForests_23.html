<div class="container">

<table style="width: 100%;"><tr>
<td>gg_partial</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Partial variable dependence object</h2>

<h3>Description</h3>

<p>The <code>plot.variable</code> function
returns a list of either marginal variable dependence or partial variable
dependence data from a <code>rfsrc</code> object.
The <code>gg_partial</code> function formulates the
<code>plot.variable</code> output for partial plots
(where <code>partial=TRUE</code>) into a data object for creation of partial
dependence plots using the <code>plot.gg_partial</code> function.
</p>
<p>Partial variable dependence plots are the risk adjusted estimates of the
specified response as a function of a single covariate, possibly subsetted
on other covariates.
</p>
<p>An option <code>named</code> argument can name a column for merging multiple
plots together
</p>


<h3>Usage</h3>

<pre><code class="language-R">gg_partial(object, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>the partial variable dependence data object from
<code>plot.variable</code> function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional arguments</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>gg_partial</code> object. A <code>data.frame</code> or <code>list</code> of
<code>data.frames</code> corresponding the variables
contained within the <code>plot.variable</code> output.
</p>


<h3>References</h3>

<p>Friedman, Jerome H. 2000. "Greedy Function Approximation: A Gradient
Boosting Machine." Annals of Statistics 29: 1189-1232."
</p>


<h3>See Also</h3>

<p><code>plot.gg_partial</code>
</p>
<p><code>plot.variable</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## ------------------------------------------------------------
## classification
## ------------------------------------------------------------
## -------- iris data
## iris "Petal.Width" partial dependence plot
##
rfsrc_iris &lt;- rfsrc(Species ~., data = iris)
partial_iris &lt;- plot.variable(rfsrc_iris, 
                              xvar.names = "Petal.Width",
                              partial=TRUE)

gg_dta &lt;- gg_partial(partial_iris)
plot(gg_dta)

## ------------------------------------------------------------
## regression
## ------------------------------------------------------------
## Not run: 
## -------- air quality data
## airquality "Wind" partial dependence plot
##
rfsrc_airq &lt;- rfsrc(Ozone ~ ., data = airquality)
partial_airq &lt;- plot.variable(rfsrc_airq, 
                              xvar.names = "Wind",
                             partial=TRUE, show.plot=FALSE)

gg_dta &lt;- gg_partial(partial_airq)
plot(gg_dta)


## End(Not run)
## Not run: 
## -------- Boston data
data(Boston, package = "MASS")
Boston$chas &lt;- as.logical(Boston$chas)
rfsrc_boston &lt;- rfsrc(medv ~ .,
   data = Boston,
   forest = TRUE,
   importance = TRUE,
   tree.err = TRUE,
   save.memory = TRUE)
   
varsel_boston &lt;- var.select(rfsrc_boston)

partial_boston &lt;- plot.variable(rfsrc_boston, 
  xvar.names = varsel_boston$topvars,
  sorted = FALSE,
  partial = TRUE, 
  show.plots = FALSE)
gg_dta &lt;- gg_partial(partial_boston)
plot(gg_dta, panel=TRUE)

## End(Not run)
## Not run: 
## -------- mtcars data
rfsrc_mtcars &lt;- rfsrc(mpg ~ ., data = mtcars)
varsel_mtcars &lt;- var.select(rfsrc_mtcars)

partial_mtcars &lt;- plot.variable(rfsrc_mtcars, 
  xvar.names = varsel_mtcars$topvars,
  sorted = FALSE,
  partial = TRUE, 
  show.plots = FALSE)

gg_dta &lt;- gg_partial(partial_mtcars)

gg_dta.cat &lt;- gg_dta
gg_dta.cat[["disp"]] &lt;- gg_dta.cat[["wt"]] &lt;- gg_dta.cat[["hp"]] &lt;- NULL
gg_dta.cat[["drat"]] &lt;- gg_dta.cat[["carb"]] &lt;- gg_dta.cat[["qsec"]] &lt;- NULL

plot(gg_dta.cat, panel=TRUE, notch=TRUE)

gg_dta[["cyl"]] &lt;- gg_dta[["vs"]] &lt;- gg_dta[["am"]] &lt;- NULL
gg_dta[["gear"]] &lt;- NULL
plot(gg_dta, panel=TRUE)

## End(Not run)

## ------------------------------------------------------------
## survival examples
## ------------------------------------------------------------
## Not run: 
## -------- veteran data
## survival "age" partial variable dependence plot
##
 data(veteran, package = "randomForestSRC")
 rfsrc_veteran &lt;- rfsrc(Surv(time,status)~., veteran, nsplit = 10,
     ntree = 100)

varsel_rfsrc &lt;- var.select(rfsrc_veteran)

## 30 day partial plot for age
partial_veteran &lt;- plot.variable(rfsrc_veteran, surv.type = "surv",
                               partial = TRUE, time=30,
                               show.plots=FALSE)

gg_dta &lt;- gg_partial(partial_veteran)
plot(gg_dta, panel=TRUE)

gg_dta.cat &lt;- gg_dta
gg_dta[["celltype"]] &lt;- gg_dta[["trt"]] &lt;- gg_dta[["prior"]] &lt;- NULL
plot(gg_dta, panel=TRUE)

gg_dta.cat[["karno"]] &lt;- gg_dta.cat[["diagtime"]] &lt;-
    gg_dta.cat[["age"]] &lt;- NULL
plot(gg_dta.cat, panel=TRUE, notch=TRUE)

gg_dta &lt;- lapply(partial_veteran, gg_partial)
gg_dta &lt;- combine.gg_partial(gg_dta[[1]], gg_dta[[2]] )

plot(gg_dta[["karno"]])
plot(gg_dta[["celltype"]])

gg_dta.cat &lt;- gg_dta
gg_dta[["celltype"]] &lt;- gg_dta[["trt"]] &lt;- gg_dta[["prior"]] &lt;- NULL
plot(gg_dta, panel=TRUE)

gg_dta.cat[["karno"]] &lt;- gg_dta.cat[["diagtime"]] &lt;-
    gg_dta.cat[["age"]] &lt;- NULL
plot(gg_dta.cat, panel=TRUE, notch=TRUE)

## ------------------------------------------------------------
## -------- pbc data
# We need to create this dataset
data(pbc, package = "randomForestSRC",) 
# For whatever reason, the age variable is in days... makes no sense to me
for (ind in seq_len(dim(pbc)[2])) {
 if (!is.factor(pbc[, ind])) {
   if (length(unique(pbc[which(!is.na(pbc[, ind])), ind])) &lt;= 2) {
     if (sum(range(pbc[, ind], na.rm = TRUE) == c(0, 1)) == 2) {
       pbc[, ind] &lt;- as.logical(pbc[, ind])
     }
   }
 } else {
   if (length(unique(pbc[which(!is.na(pbc[, ind])), ind])) &lt;= 2) {
     if (sum(sort(unique(pbc[, ind])) == c(0, 1)) == 2) {
       pbc[, ind] &lt;- as.logical(pbc[, ind])
     }
     if (sum(sort(unique(pbc[, ind])) == c(FALSE, TRUE)) == 2) {
       pbc[, ind] &lt;- as.logical(pbc[, ind])
     }
   }
 }
 if (!is.logical(pbc[, ind]) &amp;
     length(unique(pbc[which(!is.na(pbc[, ind])), ind])) &lt;= 5) {
   pbc[, ind] &lt;- factor(pbc[, ind])
 }
}
#Convert age to years
pbc$age &lt;- pbc$age / 364.24

pbc$years &lt;- pbc$days / 364.24
pbc &lt;- pbc[, -which(colnames(pbc) == "days")]
pbc$treatment &lt;- as.numeric(pbc$treatment)
pbc$treatment[which(pbc$treatment == 1)] &lt;- "DPCA"
pbc$treatment[which(pbc$treatment == 2)] &lt;- "placebo"
pbc$treatment &lt;- factor(pbc$treatment)
dta_train &lt;- pbc[-which(is.na(pbc$treatment)), ]
# Create a test set from the remaining patients
 pbc_test &lt;- pbc[which(is.na(pbc$treatment)), ]

#========
# build the forest:
rfsrc_pbc &lt;- randomForestSRC::rfsrc(
  Surv(years, status) ~ .,
 dta_train,
 nsplit = 10,
 na.action = "na.impute",
 forest = TRUE,
 importance = TRUE,
 save.memory = TRUE
)

varsel_pbc &lt;- var.select(rfsrc_pbc)

xvar &lt;- varsel_pbc$topvars

# Convert all partial plots to gg_partial objects
gg_dta &lt;- lapply(partial_pbc, gg_partial)

# Combine the objects to get multiple time curves
# along variables on a single figure.
pbc_ggpart &lt;- combine.gg_partial(gg_dta[[1]], gg_dta[[2]],
                                 lbls = c("1 Year", "3 Years"))

summary(pbc_ggpart)
class(pbc_ggpart[["bili"]])

# Plot the highest ranked variable, by name.
#plot(pbc_ggpart[["bili"]])

# Create a temporary holder and remove the stage and edema data
ggpart &lt;- pbc_ggpart
ggpart$edema &lt;- NULL

# Panel plot the remainder.
plot(ggpart, panel = TRUE)

plot(pbc_ggpart[["edema"]])

## End(Not run)
</code></pre>


</div>