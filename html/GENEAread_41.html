<div class="container">

<table style="width: 100%;"><tr>
<td>GENEAread-package</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>A package to process binary accelerometer output files.</h2>

<h3>Description</h3>

<p>This is a package to process binary output files from the GENEA accelerometer data.
</p>
<p>The main functions are: </p>

<ul>
<li>
<p> read.bin
</p>
</li>
<li>
<p> stft
</p>
</li>
<li>
<p> epoch
</p>
</li>
</ul>
<p>A function to process binary accelerometer files and convert the information into R objects.
</p>


<h3>Usage</h3>

<pre><code class="language-R">read.bin(
  binfile,
  outfile = NULL,
  start = NULL,
  end = NULL,
  Use.Timestamps = FALSE,
  verbose = TRUE,
  do.temp = TRUE,
  do.volt = TRUE,
  calibrate = TRUE,
  downsample = NULL,
  blocksize,
  virtual = FALSE,
  mmap.load = (.Machine$sizeof.pointer &gt;= 8),
  pagerefs = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>binfile</code></td>
<td>
<p>A filename of a file to process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outfile</code></td>
<td>
<p>An optional filename specifying where to save the processed data object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>Either: A representation of when in the file to begin processing, see Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end</code></td>
<td>
<p>Either: A representation of when in the file to end processing, see Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Use.Timestamps</code></td>
<td>
<p>To use timestamps as the start and end time values this has to be set to TRUE. (Default FALSE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>A boolean variable indicating whether some information should be printed during
processing should be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.temp</code></td>
<td>
<p>A boolean variable indicating whether the temperature signal should be extracted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.volt</code></td>
<td>
<p>A boolean variable indicating whether the voltage signal should be extracted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>calibrate</code></td>
<td>
<p>A boolean variable indicating whether the raw accelerometer values and the light
variable should be calibrated according to the calibration data in the headers.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>downsample</code></td>
<td>
<p>A variable indicating the type of downsampling to apply to the data as it is loaded.
Can take values:
NULL: (Default) No downsampling
Single numeric: Reads every downsample-th value, starting from the first.
Length two numeric vector: Reads every downsample[1]-th value, starting from
the downsample[2]-th.
Non-integer, or non-divisor of 300 downsampling factors are allowed, but will
lead to imprecise frequency calculations, leap seconds being introduced, and
generally potential problems with other methods. Use with care.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blocksize</code></td>
<td>
<p>Integer value giving maximum number of data pages to read in each pass. Defaults
to 10000 for larger data files. Sufficiently small sizes will split very
large data files to read chunk by chunk, reducing memory requirements for the
read.bin function (without affecting the final object), but conversely possibly
increasing processing time. Can be set to Inf for no splitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>virtual</code></td>
<td>
<p>logical. If set TRUE, do not do any actual data reading. Instead construct a VirtualAccData
object containing header information to allow use with get.intervals</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mmap.load</code></td>
<td>
<p>Default is (.Machine$sizeof.pointer &gt;= 8). see <code>mmap</code> for more details</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pagerefs</code></td>
<td>
<p>A variable that can take two forms, and is considered only for <code>mmap.load = TRUE</code>
NULL or FALSE, in which case pagerefs are dynamically calculated for each record. (Default)
A vector giving sorted byte offsets for each record for mmap reading of data files.
TRUE, in which case a full page reference table is computed before any processing occurs.
</p>
<p>Computing pagerefs takes a little time and so is a little slower.
However, it is safer than dynamic computations in the case of missing pages and high temperature variations.
Further, once page references are calculated, future reads are much faster, so long as the previously
computed references are supplied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Any other optional arguments can be supplied that affect manual calibration and data processing.
These are: </p>

<ul>
<li>
<p> mmap: logical. If TRUE (Default on 64bit R), use the mmap package to process the binfile
</p>
</li>
<li>
<p> gain: a vector of 3 values for manual gain calibration of the raw (x,y,z) axes. If gain=NULL, the
gain calibration values are taken from within the output file itself.
</p>
</li>
<li>
<p> offset: a vector of 3 value for manual offset calibration of the raw (x,y,z) axes. If offset=NULL,
the offset calibration values are taken from within the output file itself.
</p>
</li>
<li>
<p> luxv: a value for manual lux calibration of the light meter. If luxv=NULL, the lux calibration value
is taken from within the output file itself.
</p>
</li>
<li>
<p> voltv: a value for manual volts calibration of the light meter. If voltv=NULL, the volts calibration
value is taken from within the output file itself.
</p>
</li>
<li>
<p> warn: if set to true, give a warning if input file is large, and require user confirmation.
</p>
</li>
</ul>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The main tasks performed by the package are listed below.
The relevant topic contains documentation and examples for each.
</p>

<ul>
<li>
<p> Extraction of file header material is accomplished by <code>header.info</code>.
</p>
</li>
<li>
<p> Input and downsampling of data is accomplished by <code>read.bin</code>.
</p>
</li>
<li>
<p> Selection of time intervals is accomplished via <code>get.intervals</code>.
</p>
</li>
<li>
<p> Computation of epochal summaries is accomplished by <code>epoch</code> and other functions documented therein.
</p>
</li>
<li>
<p> Computation of STFT analyses is accomplished by <code>stft</code>.
</p>
</li>
</ul>
<p>The package provides definitions and methods for the following S3 classes:
</p>

<ul>
<li>
<p> GRtime: Provides numeric storage and streamlined plotting for times. <code>GRtime</code>
</p>
</li>
<li>
<p> AccData: Stores GENEA accelerometer data, allowing plotting, subsetting and other computation.<code>AccData</code>
</p>
</li>
<li>
<p> VirtAccData: A virtual AccData object, for just-in-time data access via <code>get.intervals</code>.
</p>
</li>
<li>
<p> stft: Processed STFT outputs, for plotting via <code>plot.stft</code>.
</p>
</li>
</ul>
<p>The read.bin package reads in binary files compatible with the GeneActiv line of Accelerometers,
for further processing by the other functions in this package. Most of the default options are those
required in the most common cases, though users are advised to consider setting start and end to
smaller intervals and/or choosing some level of downsampling when working with data files of
longer than 24 hours in length.
</p>
<p>The function reads in the desired analysis time window specified by start and end. For convenience,
a variety of time window formats are accepted:
</p>
<p>Large integers are read as page numbers in the dataset. Page numbers larger than that which is
available in the file itself are constrained to what is available. Note that the first page is page 1.
Small values (between 0 and 1) are taken as proportions of the data. For example, ‘start = 0.5‘
would specify that reading should begin at the midpoint of the data.
Strings are interpreted as dates and times using parse.time. In particular, times specified as
"HH:MM" or "HH:MM:SS" are taken as the earliest time interval containing these times in the
file. Strings with an integer prepended, using a space seperator, as interpreted as that time after
the appropriate number of midnights have passed - in other words, the appropriate time of day on
the Nth full day. Days of the week and dates in "day/month", "day/month/year", "month-day",
"year-month-day" are also handled. Note that the time is interpreted in the same time zone as the
data recording itself.
</p>
<p>Actual data reading proceeds by two methods, depending on whether mmap is true or false. With
mmap = FALSE, data is read in line by line using readLine until blocksize is filled, and then
processed. With mmap = TRUE, the mmap package is used to map the entire data file into an address
file, byte locations are calculated (depending on the setting of pagerefs), blocksize chunks of
data are loaded, and then processed as raw vectors.
</p>
<p>There are advantages and disadvantages to both methods: the <code>mmap</code> method is usually much faster,
especially when we are only loading the final parts of the data. <code>readLines</code> will have to
process the entire file in such a case. On the other hand, mmap requires a large amount of memory address
space, and so can fail in 32 bit systems. Finally, reading of compressed bin files can only be done
with the readLine method. Generally, if mmap reading fails, the function will attempt to catch the
failure, and reprocess the file with the readLine method, giving a warning. Once data is loaded,
calibration is then either performed using values from the binary file, or using
manually inputted values (using the gain, offset,luxv and voltv arguments).
</p>


<h3>Main tasks performed</h3>

<p>NA
</p>


<h3>Classes implemented</h3>

<p>NA
</p>


<h3>WARNING</h3>

<p>Reading in an entire .bin file will take a long time if the file contains a lot of datasets.
Reading in such files without downsampling can use up all available memory. See memory.limit.
This function is specific to header structure in GENEActiv output files.
By design, it should be compatible with all firmware and software versions to date
(as of version of current release).
If order or field names are changed in future .bin files, this function may have to be updated appropriately.
</p>


<h3>Author(s)</h3>

<p>Zhou Fang &lt;zhou@activinsights.co.uk&gt;
</p>
<p>Activinsights Ltd. &lt;joss.langford@activinsights.co.uk&gt;
</p>
<p>Charles Sweetland &lt;charles@sweetland-solutions.co.uk&gt;
</p>


<h3>Examples</h3>

<pre><code class="language-R">requireNamespace("GENEAread")
binfile = system.file("binfile/TESTfile.bin", package = "GENEAread")[1]
#Read in the entire file, calibrated
procfile &lt;- read.bin(binfile)
# print(procfile)
# procfile$data.out[1:5,]
# Uncalibrated, mmap off
procfile2 &lt;- read.bin(binfile, calibrate = FALSE)
# procfile2$data.out[1:5,]
#Read in again, reusing already computed mmap pagerefs
# procfile3 &lt;- read.bin(binfile, pagerefs = procfile2$pagerefs )
#Downsample by a factor of 10
procfilelo&lt;-read.bin(binfile, downsample = 10)
# print(procfilelo)
object.size(procfilelo) / object.size(procfile)
#Read in a 1 minute interval
procfileshort &lt;- read.bin(binfile, start = "16:50", end = "16:51")
# print(procfileshort)
##NOT RUN: Read, and save as a R workspace
#read.bin(binfile, outfile = "tmp.Rdata")
#print(load("tmp.Rdata"))
#print(processedfile)
</code></pre>


</div>