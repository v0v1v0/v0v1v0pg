<div class="container">

<table style="width: 100%;"><tr>
<td>google_analytics</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Get Google Analytics v4 data</h2>

<h3>Description</h3>

<p>Fetch Google Analytics data using the v4 API.  For the v3 API use google_analytics_3, for GA4's Data API use ga_data.  See website help for lots of examples: <a href="https://8-bit-sheep.com/googleAnalyticsR/articles/v4.html">Google Analytics Reporting API v4 in R</a>
</p>


<h3>Usage</h3>

<pre><code class="language-R">google_analytics(
  viewId,
  date_range = NULL,
  metrics = NULL,
  dimensions = NULL,
  dim_filters = NULL,
  met_filters = NULL,
  filtersExpression = NULL,
  order = NULL,
  segments = NULL,
  pivots = NULL,
  cohorts = NULL,
  max = 1000,
  samplingLevel = c("DEFAULT", "SMALL", "LARGE"),
  metricFormat = NULL,
  histogramBuckets = NULL,
  anti_sample = FALSE,
  anti_sample_batches = "auto",
  slow_fetch = FALSE,
  useResourceQuotas = NULL,
  rows_per_call = 10000L
)

google_analytics_4(...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>viewId</code></td>
<td>
<p>viewId of data to get.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date_range</code></td>
<td>
<p>character or date vector of format <code>c(start, end)</code> or
for two date ranges: <code>c(start1,end1,start2,end2)</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metrics</code></td>
<td>
<p>Metric(s) to fetch as a character vector.  You do not need to
supply the <code>"ga:"</code> prefix.  See meta for a list of dimensons
and metrics the API supports. Also supports your own calculated metrics.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dimensions</code></td>
<td>
<p>Dimension(s) to fetch as a character vector. You do not need to
supply the <code>"ga:"</code> prefix. See meta for a list of dimensons
and metrics the API supports.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dim_filters</code></td>
<td>
<p>A filter_clause_ga4 wrapping dim_filter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>met_filters</code></td>
<td>
<p>A filter_clause_ga4 wrapping met_filter</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filtersExpression</code></td>
<td>
<p>A v3 API style simple filter string. Not used with other filters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>An order_type object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>segments</code></td>
<td>
<p>List of segments as created by segment_ga4</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pivots</code></td>
<td>
<p>Pivots of the data as created by pivot_ga4</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cohorts</code></td>
<td>
<p>Cohorts created by make_cohort_group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max</code></td>
<td>
<p>Maximum number of rows to fetch. Defaults at 1000. Use -1 to fetch all results. Ignored when <code>anti_sample=TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>samplingLevel</code></td>
<td>
<p>Sample level</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metricFormat</code></td>
<td>
<p>If supplying calculated metrics, specify the metric type</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>histogramBuckets</code></td>
<td>
<p>For numeric dimensions such as hour, a list of buckets of data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>anti_sample</code></td>
<td>
<p>If TRUE will split up the call to avoid sampling.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>anti_sample_batches</code></td>
<td>
<p>"auto" default, or set to number of days per batch. 1 = daily.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>slow_fetch</code></td>
<td>
<p>For large, complicated API requests this bypasses some API hacks that may result in 500 errors.  For smaller queries, leave this as <code>FALSE</code> for quicker data fetching.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useResourceQuotas</code></td>
<td>
<p>If using GA360, access increased sampling limits.
Default <code>NULL</code>, set to <code>TRUE</code> or <code>FALSE</code> if you have access to this feature.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rows_per_call</code></td>
<td>
<p>Set how many rows are requested by the API per call, up to a maximum of 100000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Arguments passed to google_analytics</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A Google Analytics data.frame, with attributes showing row totals, sampling etc.
</p>


<h3>Row requests</h3>

<p>By default the API call will use v4 batching that splits requests into 5 separate calls of 10k rows each.  This can go up to 100k, so this means up to 500k rows can be fetched per API call, however the API servers will fail with a 500 error if the query is too complicated as the processing time at Google's end gets too long.  In this case, you may want to tweak the <code>rows_per_call</code> argument downwards, or fall back to using <code>slow_fetch = FALSE</code> which will send an API request one at a time.  If fetching data via scheduled scripts this is recommended as the default.
</p>


<h3>Anti-sampling</h3>

<p><code>anti_sample</code> being TRUE ignores <code>max</code> as the API call is split over days
to mitigate the sampling session limit, in which case a row limit won't work.  Take the top rows
of the result yourself instead e.g. <code>head(ga_data_unsampled, 50300)</code>
</p>
<p><code>anti_sample</code> being TRUE will also set <code>samplingLevel='LARGE'</code> to minimise
the number of calls.
</p>


<h3>Resource Quotas</h3>

<p>If you are on GA360 and have access to resource quotas,
set the <code>useResourceQuotas=TRUE</code> and set the Google Cloud
client ID to the project that has resource quotas activated,
via gar_set_client or options.
</p>


<h3>Caching</h3>

<p>By default local caching is turned on for v4 API requests.  This means that
making the same request as one this session will read from memory and not
make an API call. You can also set the cache to disk via
the ga_cache_call function.  This can be useful
when running RMarkdown reports using data.
</p>


<h3>Metrics</h3>

<p>Metrics support calculated metrics like ga:users / ga:sessions if you supply
them in a named vector.
</p>
<p>You must supply the correct 'ga:' prefix unlike normal metrics
</p>
<p>You can mix calculated and normal metrics like so:
</p>
<p><code>customMetric &lt;- c(sessionPerVisitor = "ga:sessions / ga:visitors", "bounceRate", "entrances")</code>
</p>
<p>You can also optionally supply a <code>metricFormat</code> parameter that must be
the same length as the metrics.  <code>metricFormat</code> can be:
<code style="white-space: pre;">⁠METRIC_TYPE_UNSPECIFIED, INTEGER, FLOAT, CURRENCY, PERCENT, TIME⁠</code>
</p>
<p>All metrics are currently parsed to as.numeric when in R.
</p>


<h3>Dimensions</h3>

<p>Supply a character vector of dimensions, with or without <code style="white-space: pre;">⁠ga:⁠</code> prefix.
</p>
<p>Optionally for numeric dimension types such as
<code style="white-space: pre;">⁠ga:hour, ga:browserVersion, ga:sessionsToTransaction⁠</code>, etc. supply
histogram buckets suitable for histogram plots.
</p>
<p>If non-empty, we place dimension values into buckets after string to int64.
Dimension values that are not the string representation of an integral value
will be converted to zero. The bucket values have to be in increasing order.
Each bucket is closed on the lower end, and open on the upper end.
The "first" bucket includes all values less than the first boundary,
the "last" bucket includes all values up to infinity.
Dimension values that fall in a bucket get transformed to a new dimension
value. For example, if one gives a list of "0, 1, 3, 4, 7", then we
return the following buckets: -
</p>

<ul>
<li>
<p> bucket #1: values &lt; 0, dimension value "&lt;0"
</p>
</li>
<li>
<p> bucket #2: values in [0,1), dimension value "0"
</p>
</li>
<li>
<p> bucket #3: values in [1,3), dimension value "1-2"
</p>
</li>
<li>
<p> bucket #4: values in [3,4), dimension value "3"
</p>
</li>
<li>
<p> bucket #5: values in [4,7), dimension value "4-6"
</p>
</li>
<li>
<p> bucket #6: values &gt;= 7, dimension value "7+"
</p>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">
## Not run: 
library(googleAnalyticsR)

## authenticate, or use the RStudio Addin "Google API Auth" with analytics scopes set

ga_auth()

## get your accounts

account_list &lt;- ga_account_list()

## account_list will have a column called "viewId"
account_list$viewId

## View account_list and pick the viewId you want to extract data from
ga_id &lt;- 123456

# examine the meta table to see metrics and dimensions you can query
meta

## simple query to test connection
google_analytics(ga_id, 
                 date_range = c("2017-01-01", "2017-03-01"), 
                 metrics = "sessions", 
                 dimensions = "date")

## change the quotaUser to fetch under
google_analytics(1234567, date_range = c("30daysAgo", "yesterday"), metrics = "sessions")

options("googleAnalyticsR.quotaUser" = "test_user")
google_analytics(1234567, date_range = c("30daysAgo", "yesterday"), metrics = "sessions")


## End(Not run)

</code></pre>


</div>